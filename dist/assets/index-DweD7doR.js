var h1=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var LR=h1((WR,c1)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Av={exports:{}},ku={},Fv={exports:{}},we={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sa=Symbol.for("react.element"),f1=Symbol.for("react.portal"),d1=Symbol.for("react.fragment"),p1=Symbol.for("react.strict_mode"),v1=Symbol.for("react.profiler"),m1=Symbol.for("react.provider"),g1=Symbol.for("react.context"),y1=Symbol.for("react.forward_ref"),x1=Symbol.for("react.suspense"),w1=Symbol.for("react.memo"),b1=Symbol.for("react.lazy"),yd=Symbol.iterator;function C1(e){return e===null||typeof e!="object"?null:(e=yd&&e[yd]||e["@@iterator"],typeof e=="function"?e:null)}var Mv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ov=Object.assign,Bv={};function wi(e,t,n){this.props=e,this.context=t,this.refs=Bv,this.updater=n||Mv}wi.prototype.isReactComponent={};wi.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};wi.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Lv(){}Lv.prototype=wi.prototype;function wh(e,t,n){this.props=e,this.context=t,this.refs=Bv,this.updater=n||Mv}var bh=wh.prototype=new Lv;bh.constructor=wh;Ov(bh,wi.prototype);bh.isPureReactComponent=!0;var xd=Array.isArray,jv=Object.prototype.hasOwnProperty,Ch={current:null},Wv={key:!0,ref:!0,__self:!0,__source:!0};function zv(e,t,n){var r,o={},i=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)jv.call(t,r)&&!Wv.hasOwnProperty(r)&&(o[r]=t[r]);var s=arguments.length-2;if(s===1)o.children=n;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)o[r]===void 0&&(o[r]=s[r]);return{$$typeof:Sa,type:e,key:i,ref:a,props:o,_owner:Ch.current}}function _1(e,t){return{$$typeof:Sa,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function _h(e){return typeof e=="object"&&e!==null&&e.$$typeof===Sa}function E1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var wd=/\/+/g;function ol(e,t){return typeof e=="object"&&e!==null&&e.key!=null?E1(""+e.key):t.toString(36)}function xs(e,t,n,r,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Sa:case f1:a=!0}}if(a)return a=e,o=o(a),e=r===""?"."+ol(a,0):r,xd(o)?(n="",e!=null&&(n=e.replace(wd,"$&/")+"/"),xs(o,t,n,"",function(l){return l})):o!=null&&(_h(o)&&(o=_1(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(wd,"$&/")+"/")+e)),t.push(o)),1;if(a=0,r=r===""?".":r+":",xd(e))for(var s=0;s<e.length;s++){i=e[s];var u=r+ol(i,s);a+=xs(i,t,n,u,o)}else if(u=C1(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=r+ol(i,s++),a+=xs(i,t,n,u,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function za(e,t,n){if(e==null)return e;var r=[],o=0;return xs(e,r,"","",function(i){return t.call(n,i,o++)}),r}function k1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Dt={current:null},ws={transition:null},S1={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:ws,ReactCurrentOwner:Ch};function Uv(){throw Error("act(...) is not supported in production builds of React.")}we.Children={map:za,forEach:function(e,t,n){za(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return za(e,function(){t++}),t},toArray:function(e){return za(e,function(t){return t})||[]},only:function(e){if(!_h(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};we.Component=wi;we.Fragment=d1;we.Profiler=v1;we.PureComponent=wh;we.StrictMode=p1;we.Suspense=x1;we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S1;we.act=Uv;we.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Ov({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Ch.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)jv.call(t,u)&&!Wv.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:Sa,type:e.type,key:o,ref:i,props:r,_owner:a}};we.createContext=function(e){return e={$$typeof:g1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:m1,_context:e},e.Consumer=e};we.createElement=zv;we.createFactory=function(e){var t=zv.bind(null,e);return t.type=e,t};we.createRef=function(){return{current:null}};we.forwardRef=function(e){return{$$typeof:y1,render:e}};we.isValidElement=_h;we.lazy=function(e){return{$$typeof:b1,_payload:{_status:-1,_result:e},_init:k1}};we.memo=function(e,t){return{$$typeof:w1,type:e,compare:t===void 0?null:t}};we.startTransition=function(e){var t=ws.transition;ws.transition={};try{e()}finally{ws.transition=t}};we.unstable_act=Uv;we.useCallback=function(e,t){return Dt.current.useCallback(e,t)};we.useContext=function(e){return Dt.current.useContext(e)};we.useDebugValue=function(){};we.useDeferredValue=function(e){return Dt.current.useDeferredValue(e)};we.useEffect=function(e,t){return Dt.current.useEffect(e,t)};we.useId=function(){return Dt.current.useId()};we.useImperativeHandle=function(e,t,n){return Dt.current.useImperativeHandle(e,t,n)};we.useInsertionEffect=function(e,t){return Dt.current.useInsertionEffect(e,t)};we.useLayoutEffect=function(e,t){return Dt.current.useLayoutEffect(e,t)};we.useMemo=function(e,t){return Dt.current.useMemo(e,t)};we.useReducer=function(e,t,n){return Dt.current.useReducer(e,t,n)};we.useRef=function(e){return Dt.current.useRef(e)};we.useState=function(e){return Dt.current.useState(e)};we.useSyncExternalStore=function(e,t,n){return Dt.current.useSyncExternalStore(e,t,n)};we.useTransition=function(){return Dt.current.useTransition()};we.version="18.3.1";Fv.exports=we;var fe=Fv.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N1=fe,R1=Symbol.for("react.element"),I1=Symbol.for("react.fragment"),T1=Object.prototype.hasOwnProperty,P1=N1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,D1={key:!0,ref:!0,__self:!0,__source:!0};function Vv(e,t,n){var r,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)T1.call(t,r)&&!D1.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:R1,type:e,key:i,ref:a,props:o,_owner:P1.current}}ku.Fragment=I1;ku.jsx=Vv;ku.jsxs=Vv;Av.exports=ku;var _=Av.exports,$v={exports:{}},tn={},Hv={exports:{}},Gv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,M){var B=F.length;F.push(M);e:for(;0<B;){var G=B-1>>>1,X=F[G];if(0<o(X,M))F[G]=M,F[B]=X,B=G;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var M=F[0],B=F.pop();if(B!==M){F[0]=B;e:for(var G=0,X=F.length,ne=X>>>1;G<ne;){var ae=2*(G+1)-1,se=F[ae],ue=ae+1,de=F[ue];if(0>o(se,B))ue<X&&0>o(de,se)?(F[G]=de,F[ue]=B,G=ue):(F[G]=se,F[ae]=B,G=ae);else if(ue<X&&0>o(de,B))F[G]=de,F[ue]=B,G=ue;else break e}}return M}function o(F,M){var B=F.sortIndex-M.sortIndex;return B!==0?B:F.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,h=null,f=3,d=!1,p=!1,m=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(F){for(var M=n(l);M!==null;){if(M.callback===null)r(l);else if(M.startTime<=F)r(l),M.sortIndex=M.expirationTime,t(u,M);else break;M=n(l)}}function w(F){if(m=!1,x(F),!p)if(n(u)!==null)p=!0,$(b);else{var M=n(l);M!==null&&V(w,M.startTime-F)}}function b(F,M){p=!1,m&&(m=!1,v(E),E=-1),d=!0;var B=f;try{for(x(M),h=n(u);h!==null&&(!(h.expirationTime>M)||F&&!P());){var G=h.callback;if(typeof G=="function"){h.callback=null,f=h.priorityLevel;var X=G(h.expirationTime<=M);M=e.unstable_now(),typeof X=="function"?h.callback=X:h===n(u)&&r(u),x(M)}else r(u);h=n(u)}if(h!==null)var ne=!0;else{var ae=n(l);ae!==null&&V(w,ae.startTime-M),ne=!1}return ne}finally{h=null,f=B,d=!1}}var C=!1,S=null,E=-1,R=5,N=-1;function P(){return!(e.unstable_now()-N<R)}function D(){if(S!==null){var F=e.unstable_now();N=F;var M=!0;try{M=S(!0,F)}finally{M?z():(C=!1,S=null)}}else C=!1}var z;if(typeof g=="function")z=function(){g(D)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,j=W.port2;W.port1.onmessage=D,z=function(){j.postMessage(null)}}else z=function(){y(D,0)};function $(F){S=F,C||(C=!0,z())}function V(F,M){E=y(function(){F(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,$(b))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(F){switch(f){case 1:case 2:case 3:var M=3;break;default:M=f}var B=f;f=M;try{return F()}finally{f=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,M){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var B=f;f=F;try{return M()}finally{f=B}},e.unstable_scheduleCallback=function(F,M,B){var G=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?G+B:G):B=G,F){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=B+X,F={id:c++,callback:M,priorityLevel:F,startTime:B,expirationTime:X,sortIndex:-1},B>G?(F.sortIndex=B,t(l,F),n(u)===null&&F===n(l)&&(m?(v(E),E=-1):m=!0,V(w,B-G))):(F.sortIndex=X,t(u,F),p||d||(p=!0,$(b))),F},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(F){var M=f;return function(){var B=f;f=M;try{return F.apply(this,arguments)}finally{f=B}}}})(Gv);Hv.exports=Gv;var A1=Hv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F1=fe,en=A1;function q(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qv=new Set,na={};function wo(e,t){li(e,t),li(e+"Capture",t)}function li(e,t){for(na[e]=t,e=0;e<t.length;e++)qv.add(t[e])}var sr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oc=Object.prototype.hasOwnProperty,M1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bd={},Cd={};function O1(e){return oc.call(Cd,e)?!0:oc.call(bd,e)?!1:M1.test(e)?Cd[e]=!0:(bd[e]=!0,!1)}function B1(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function L1(e,t,n,r){if(t===null||typeof t>"u"||B1(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function At(e,t,n,r,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){mt[e]=new At(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];mt[t]=new At(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){mt[e]=new At(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){mt[e]=new At(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){mt[e]=new At(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){mt[e]=new At(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){mt[e]=new At(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){mt[e]=new At(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){mt[e]=new At(e,5,!1,e.toLowerCase(),null,!1,!1)});var Eh=/[\-:]([a-z])/g;function kh(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Eh,kh);mt[t]=new At(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Eh,kh);mt[t]=new At(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Eh,kh);mt[t]=new At(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){mt[e]=new At(e,1,!1,e.toLowerCase(),null,!1,!1)});mt.xlinkHref=new At("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){mt[e]=new At(e,1,!1,e.toLowerCase(),null,!0,!0)});function Sh(e,t,n,r){var o=mt.hasOwnProperty(t)?mt[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(L1(t,n,o,r)&&(n=null),r||o===null?O1(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var hr=F1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ua=Symbol.for("react.element"),Bo=Symbol.for("react.portal"),Lo=Symbol.for("react.fragment"),Nh=Symbol.for("react.strict_mode"),ic=Symbol.for("react.profiler"),Xv=Symbol.for("react.provider"),Kv=Symbol.for("react.context"),Rh=Symbol.for("react.forward_ref"),ac=Symbol.for("react.suspense"),sc=Symbol.for("react.suspense_list"),Ih=Symbol.for("react.memo"),_r=Symbol.for("react.lazy"),Qv=Symbol.for("react.offscreen"),_d=Symbol.iterator;function Ni(e){return e===null||typeof e!="object"?null:(e=_d&&e[_d]||e["@@iterator"],typeof e=="function"?e:null)}var $e=Object.assign,il;function Wi(e){if(il===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);il=t&&t[1]||""}return`
`+il+e}var al=!1;function sl(e,t){if(!e||al)return"";al=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var o=l.stack.split(`
`),i=r.stack.split(`
`),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(a!==1||s!==1)do if(a--,s--,0>s||o[a]!==i[s]){var u=`
`+o[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=a&&0<=s);break}}}finally{al=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Wi(e):""}function j1(e){switch(e.tag){case 5:return Wi(e.type);case 16:return Wi("Lazy");case 13:return Wi("Suspense");case 19:return Wi("SuspenseList");case 0:case 2:case 15:return e=sl(e.type,!1),e;case 11:return e=sl(e.type.render,!1),e;case 1:return e=sl(e.type,!0),e;default:return""}}function uc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Lo:return"Fragment";case Bo:return"Portal";case ic:return"Profiler";case Nh:return"StrictMode";case ac:return"Suspense";case sc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Kv:return(e.displayName||"Context")+".Consumer";case Xv:return(e._context.displayName||"Context")+".Provider";case Rh:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ih:return t=e.displayName||null,t!==null?t:uc(e.type)||"Memo";case _r:t=e._payload,e=e._init;try{return uc(e(t))}catch{}}return null}function W1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return uc(t);case 8:return t===Nh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ur(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Yv(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function z1(e){var t=Yv(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Va(e){e._valueTracker||(e._valueTracker=z1(e))}function Jv(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Yv(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Ds(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function lc(e,t){var n=t.checked;return $e({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Ed(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Ur(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Zv(e,t){t=t.checked,t!=null&&Sh(e,"checked",t,!1)}function cc(e,t){Zv(e,t);var n=Ur(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?hc(e,t.type,n):t.hasOwnProperty("defaultValue")&&hc(e,t.type,Ur(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function kd(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function hc(e,t,n){(t!=="number"||Ds(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var zi=Array.isArray;function Ko(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Ur(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function fc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(q(91));return $e({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Sd(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(q(92));if(zi(n)){if(1<n.length)throw Error(q(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Ur(n)}}function em(e,t){var n=Ur(t.value),r=Ur(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Nd(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function tm(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?tm(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var $a,nm=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for($a=$a||document.createElement("div"),$a.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=$a.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ra(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var $i={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U1=["Webkit","ms","Moz","O"];Object.keys($i).forEach(function(e){U1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$i[t]=$i[e]})});function rm(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||$i.hasOwnProperty(e)&&$i[e]?(""+t).trim():t+"px"}function om(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=rm(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var V1=$e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pc(e,t){if(t){if(V1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(q(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(q(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(q(61))}if(t.style!=null&&typeof t.style!="object")throw Error(q(62))}}function vc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mc=null;function Th(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var gc=null,Qo=null,Yo=null;function Rd(e){if(e=Ia(e)){if(typeof gc!="function")throw Error(q(280));var t=e.stateNode;t&&(t=Tu(t),gc(e.stateNode,e.type,t))}}function im(e){Qo?Yo?Yo.push(e):Yo=[e]:Qo=e}function am(){if(Qo){var e=Qo,t=Yo;if(Yo=Qo=null,Rd(e),t)for(e=0;e<t.length;e++)Rd(t[e])}}function sm(e,t){return e(t)}function um(){}var ul=!1;function lm(e,t,n){if(ul)return e(t,n);ul=!0;try{return sm(e,t,n)}finally{ul=!1,(Qo!==null||Yo!==null)&&(um(),am())}}function oa(e,t){var n=e.stateNode;if(n===null)return null;var r=Tu(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(q(231,t,typeof n));return n}var yc=!1;if(sr)try{var Ri={};Object.defineProperty(Ri,"passive",{get:function(){yc=!0}}),window.addEventListener("test",Ri,Ri),window.removeEventListener("test",Ri,Ri)}catch{yc=!1}function $1(e,t,n,r,o,i,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Hi=!1,As=null,Fs=!1,xc=null,H1={onError:function(e){Hi=!0,As=e}};function G1(e,t,n,r,o,i,a,s,u){Hi=!1,As=null,$1.apply(H1,arguments)}function q1(e,t,n,r,o,i,a,s,u){if(G1.apply(this,arguments),Hi){if(Hi){var l=As;Hi=!1,As=null}else throw Error(q(198));Fs||(Fs=!0,xc=l)}}function bo(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function cm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Id(e){if(bo(e)!==e)throw Error(q(188))}function X1(e){var t=e.alternate;if(!t){if(t=bo(e),t===null)throw Error(q(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Id(o),e;if(i===r)return Id(o),t;i=i.sibling}throw Error(q(188))}if(n.return!==r.return)n=o,r=i;else{for(var a=!1,s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a){for(s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a)throw Error(q(189))}}if(n.alternate!==r)throw Error(q(190))}if(n.tag!==3)throw Error(q(188));return n.stateNode.current===n?e:t}function hm(e){return e=X1(e),e!==null?fm(e):null}function fm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=fm(e);if(t!==null)return t;e=e.sibling}return null}var dm=en.unstable_scheduleCallback,Td=en.unstable_cancelCallback,K1=en.unstable_shouldYield,Q1=en.unstable_requestPaint,Xe=en.unstable_now,Y1=en.unstable_getCurrentPriorityLevel,Ph=en.unstable_ImmediatePriority,pm=en.unstable_UserBlockingPriority,Ms=en.unstable_NormalPriority,J1=en.unstable_LowPriority,vm=en.unstable_IdlePriority,Su=null,zn=null;function Z1(e){if(zn&&typeof zn.onCommitFiberRoot=="function")try{zn.onCommitFiberRoot(Su,e,void 0,(e.current.flags&128)===128)}catch{}}var kn=Math.clz32?Math.clz32:nx,ex=Math.log,tx=Math.LN2;function nx(e){return e>>>=0,e===0?32:31-(ex(e)/tx|0)|0}var Ha=64,Ga=4194304;function Ui(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Os(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var s=a&~o;s!==0?r=Ui(s):(i&=a,i!==0&&(r=Ui(i)))}else a=n&~o,a!==0?r=Ui(a):i!==0&&(r=Ui(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-kn(t),o=1<<n,r|=e[n],t&=~o;return r}function rx(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ox(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-kn(i),s=1<<a,u=o[a];u===-1?(!(s&n)||s&r)&&(o[a]=rx(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}function wc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function mm(){var e=Ha;return Ha<<=1,!(Ha&4194240)&&(Ha=64),e}function ll(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Na(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-kn(t),e[t]=n}function ix(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-kn(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}function Dh(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-kn(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var Re=0;function gm(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var ym,Ah,xm,wm,bm,bc=!1,qa=[],Pr=null,Dr=null,Ar=null,ia=new Map,aa=new Map,kr=[],ax="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pd(e,t){switch(e){case"focusin":case"focusout":Pr=null;break;case"dragenter":case"dragleave":Dr=null;break;case"mouseover":case"mouseout":Ar=null;break;case"pointerover":case"pointerout":ia.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":aa.delete(t.pointerId)}}function Ii(e,t,n,r,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Ia(t),t!==null&&Ah(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function sx(e,t,n,r,o){switch(t){case"focusin":return Pr=Ii(Pr,e,t,n,r,o),!0;case"dragenter":return Dr=Ii(Dr,e,t,n,r,o),!0;case"mouseover":return Ar=Ii(Ar,e,t,n,r,o),!0;case"pointerover":var i=o.pointerId;return ia.set(i,Ii(ia.get(i)||null,e,t,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,aa.set(i,Ii(aa.get(i)||null,e,t,n,r,o)),!0}return!1}function Cm(e){var t=oo(e.target);if(t!==null){var n=bo(t);if(n!==null){if(t=n.tag,t===13){if(t=cm(n),t!==null){e.blockedOn=t,bm(e.priority,function(){xm(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function bs(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Cc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);mc=r,n.target.dispatchEvent(r),mc=null}else return t=Ia(n),t!==null&&Ah(t),e.blockedOn=n,!1;t.shift()}return!0}function Dd(e,t,n){bs(e)&&n.delete(t)}function ux(){bc=!1,Pr!==null&&bs(Pr)&&(Pr=null),Dr!==null&&bs(Dr)&&(Dr=null),Ar!==null&&bs(Ar)&&(Ar=null),ia.forEach(Dd),aa.forEach(Dd)}function Ti(e,t){e.blockedOn===t&&(e.blockedOn=null,bc||(bc=!0,en.unstable_scheduleCallback(en.unstable_NormalPriority,ux)))}function sa(e){function t(o){return Ti(o,e)}if(0<qa.length){Ti(qa[0],e);for(var n=1;n<qa.length;n++){var r=qa[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Pr!==null&&Ti(Pr,e),Dr!==null&&Ti(Dr,e),Ar!==null&&Ti(Ar,e),ia.forEach(t),aa.forEach(t),n=0;n<kr.length;n++)r=kr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<kr.length&&(n=kr[0],n.blockedOn===null);)Cm(n),n.blockedOn===null&&kr.shift()}var Jo=hr.ReactCurrentBatchConfig,Bs=!0;function lx(e,t,n,r){var o=Re,i=Jo.transition;Jo.transition=null;try{Re=1,Fh(e,t,n,r)}finally{Re=o,Jo.transition=i}}function cx(e,t,n,r){var o=Re,i=Jo.transition;Jo.transition=null;try{Re=4,Fh(e,t,n,r)}finally{Re=o,Jo.transition=i}}function Fh(e,t,n,r){if(Bs){var o=Cc(e,t,n,r);if(o===null)xl(e,t,r,Ls,n),Pd(e,r);else if(sx(o,e,t,n,r))r.stopPropagation();else if(Pd(e,r),t&4&&-1<ax.indexOf(e)){for(;o!==null;){var i=Ia(o);if(i!==null&&ym(i),i=Cc(e,t,n,r),i===null&&xl(e,t,r,Ls,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else xl(e,t,r,null,n)}}var Ls=null;function Cc(e,t,n,r){if(Ls=null,e=Th(r),e=oo(e),e!==null)if(t=bo(e),t===null)e=null;else if(n=t.tag,n===13){if(e=cm(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ls=e,null}function _m(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y1()){case Ph:return 1;case pm:return 4;case Ms:case J1:return 16;case vm:return 536870912;default:return 16}default:return 16}}var Nr=null,Mh=null,Cs=null;function Em(){if(Cs)return Cs;var e,t=Mh,n=t.length,r,o="value"in Nr?Nr.value:Nr.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(r=1;r<=a&&t[n-r]===o[i-r];r++);return Cs=o.slice(e,1<r?1-r:void 0)}function _s(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Xa(){return!0}function Ad(){return!1}function nn(e){function t(n,r,o,i,a){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(n=e[s],this[s]=n?n(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Xa:Ad,this.isPropagationStopped=Ad,this}return $e(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Xa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Xa)},persist:function(){},isPersistent:Xa}),t}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Oh=nn(bi),Ra=$e({},bi,{view:0,detail:0}),hx=nn(Ra),cl,hl,Pi,Nu=$e({},Ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Pi&&(Pi&&e.type==="mousemove"?(cl=e.screenX-Pi.screenX,hl=e.screenY-Pi.screenY):hl=cl=0,Pi=e),cl)},movementY:function(e){return"movementY"in e?e.movementY:hl}}),Fd=nn(Nu),fx=$e({},Nu,{dataTransfer:0}),dx=nn(fx),px=$e({},Ra,{relatedTarget:0}),fl=nn(px),vx=$e({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),mx=nn(vx),gx=$e({},bi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yx=nn(gx),xx=$e({},bi,{data:0}),Md=nn(xx),wx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _x(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Cx[e])?!!t[e]:!1}function Bh(){return _x}var Ex=$e({},Ra,{key:function(e){if(e.key){var t=wx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=_s(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?bx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bh,charCode:function(e){return e.type==="keypress"?_s(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?_s(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),kx=nn(Ex),Sx=$e({},Nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Od=nn(Sx),Nx=$e({},Ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bh}),Rx=nn(Nx),Ix=$e({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Tx=nn(Ix),Px=$e({},Nu,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dx=nn(Px),Ax=[9,13,27,32],Lh=sr&&"CompositionEvent"in window,Gi=null;sr&&"documentMode"in document&&(Gi=document.documentMode);var Fx=sr&&"TextEvent"in window&&!Gi,km=sr&&(!Lh||Gi&&8<Gi&&11>=Gi),Bd=" ",Ld=!1;function Sm(e,t){switch(e){case"keyup":return Ax.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var jo=!1;function Mx(e,t){switch(e){case"compositionend":return Nm(t);case"keypress":return t.which!==32?null:(Ld=!0,Bd);case"textInput":return e=t.data,e===Bd&&Ld?null:e;default:return null}}function Ox(e,t){if(jo)return e==="compositionend"||!Lh&&Sm(e,t)?(e=Em(),Cs=Mh=Nr=null,jo=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return km&&t.locale!=="ko"?null:t.data;default:return null}}var Bx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Bx[e.type]:t==="textarea"}function Rm(e,t,n,r){im(r),t=js(t,"onChange"),0<t.length&&(n=new Oh("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qi=null,ua=null;function Lx(e){jm(e,0)}function Ru(e){var t=Uo(e);if(Jv(t))return e}function jx(e,t){if(e==="change")return t}var Im=!1;if(sr){var dl;if(sr){var pl="oninput"in document;if(!pl){var Wd=document.createElement("div");Wd.setAttribute("oninput","return;"),pl=typeof Wd.oninput=="function"}dl=pl}else dl=!1;Im=dl&&(!document.documentMode||9<document.documentMode)}function zd(){qi&&(qi.detachEvent("onpropertychange",Tm),ua=qi=null)}function Tm(e){if(e.propertyName==="value"&&Ru(ua)){var t=[];Rm(t,ua,e,Th(e)),lm(Lx,t)}}function Wx(e,t,n){e==="focusin"?(zd(),qi=t,ua=n,qi.attachEvent("onpropertychange",Tm)):e==="focusout"&&zd()}function zx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ru(ua)}function Ux(e,t){if(e==="click")return Ru(t)}function Vx(e,t){if(e==="input"||e==="change")return Ru(t)}function $x(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Rn=typeof Object.is=="function"?Object.is:$x;function la(e,t){if(Rn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!oc.call(t,o)||!Rn(e[o],t[o]))return!1}return!0}function Ud(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Vd(e,t){var n=Ud(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ud(n)}}function Pm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Pm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Dm(){for(var e=window,t=Ds();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ds(e.document)}return t}function jh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Hx(e){var t=Dm(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Pm(n.ownerDocument.documentElement,n)){if(r!==null&&jh(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!e.extend&&i>r&&(o=r,r=i,i=o),o=Vd(n,i);var a=Vd(n,r);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Gx=sr&&"documentMode"in document&&11>=document.documentMode,Wo=null,_c=null,Xi=null,Ec=!1;function $d(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ec||Wo==null||Wo!==Ds(r)||(r=Wo,"selectionStart"in r&&jh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Xi&&la(Xi,r)||(Xi=r,r=js(_c,"onSelect"),0<r.length&&(t=new Oh("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Wo)))}function Ka(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var zo={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionend:Ka("Transition","TransitionEnd")},vl={},Am={};sr&&(Am=document.createElement("div").style,"AnimationEvent"in window||(delete zo.animationend.animation,delete zo.animationiteration.animation,delete zo.animationstart.animation),"TransitionEvent"in window||delete zo.transitionend.transition);function Iu(e){if(vl[e])return vl[e];if(!zo[e])return e;var t=zo[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Am)return vl[e]=t[n];return e}var Fm=Iu("animationend"),Mm=Iu("animationiteration"),Om=Iu("animationstart"),Bm=Iu("transitionend"),Lm=new Map,Hd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gr(e,t){Lm.set(e,t),wo(t,[e])}for(var ml=0;ml<Hd.length;ml++){var gl=Hd[ml],qx=gl.toLowerCase(),Xx=gl[0].toUpperCase()+gl.slice(1);Gr(qx,"on"+Xx)}Gr(Fm,"onAnimationEnd");Gr(Mm,"onAnimationIteration");Gr(Om,"onAnimationStart");Gr("dblclick","onDoubleClick");Gr("focusin","onFocus");Gr("focusout","onBlur");Gr(Bm,"onTransitionEnd");li("onMouseEnter",["mouseout","mouseover"]);li("onMouseLeave",["mouseout","mouseover"]);li("onPointerEnter",["pointerout","pointerover"]);li("onPointerLeave",["pointerout","pointerover"]);wo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wo("onBeforeInput",["compositionend","keypress","textInput","paste"]);wo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vi));function Gd(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,q1(r,t,void 0,e),e.currentTarget=null}function jm(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&o.isPropagationStopped())break e;Gd(o,s,l),i=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&o.isPropagationStopped())break e;Gd(o,s,l),i=u}}}if(Fs)throw e=xc,Fs=!1,xc=null,e}function Me(e,t){var n=t[Ic];n===void 0&&(n=t[Ic]=new Set);var r=e+"__bubble";n.has(r)||(Wm(t,e,2,!1),n.add(r))}function yl(e,t,n){var r=0;t&&(r|=4),Wm(n,e,r,t)}var Qa="_reactListening"+Math.random().toString(36).slice(2);function ca(e){if(!e[Qa]){e[Qa]=!0,qv.forEach(function(n){n!=="selectionchange"&&(Kx.has(n)||yl(n,!1,e),yl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Qa]||(t[Qa]=!0,yl("selectionchange",!1,t))}}function Wm(e,t,n,r){switch(_m(t)){case 1:var o=lx;break;case 4:o=cx;break;default:o=Fh}n=o.bind(null,t,n,e),o=void 0,!yc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function xl(e,t,n,r,o){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;a=a.return}for(;s!==null;){if(a=oo(s),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}s=s.parentNode}}r=r.return}lm(function(){var l=i,c=Th(n),h=[];e:{var f=Lm.get(e);if(f!==void 0){var d=Oh,p=e;switch(e){case"keypress":if(_s(n)===0)break e;case"keydown":case"keyup":d=kx;break;case"focusin":p="focus",d=fl;break;case"focusout":p="blur",d=fl;break;case"beforeblur":case"afterblur":d=fl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Fd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=dx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=Rx;break;case Fm:case Mm:case Om:d=mx;break;case Bm:d=Tx;break;case"scroll":d=hx;break;case"wheel":d=Dx;break;case"copy":case"cut":case"paste":d=yx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Od}var m=(t&4)!==0,y=!m&&e==="scroll",v=m?f!==null?f+"Capture":null:f;m=[];for(var g=l,x;g!==null;){x=g;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=oa(g,v),w!=null&&m.push(ha(g,w,x)))),y)break;g=g.return}0<m.length&&(f=new d(f,p,null,n,c),h.push({event:f,listeners:m}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",d=e==="mouseout"||e==="pointerout",f&&n!==mc&&(p=n.relatedTarget||n.fromElement)&&(oo(p)||p[ur]))break e;if((d||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=l,p=p?oo(p):null,p!==null&&(y=bo(p),p!==y||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=l),d!==p)){if(m=Fd,w="onMouseLeave",v="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(m=Od,w="onPointerLeave",v="onPointerEnter",g="pointer"),y=d==null?f:Uo(d),x=p==null?f:Uo(p),f=new m(w,g+"leave",d,n,c),f.target=y,f.relatedTarget=x,w=null,oo(c)===l&&(m=new m(v,g+"enter",p,n,c),m.target=x,m.relatedTarget=y,w=m),y=w,d&&p)t:{for(m=d,v=p,g=0,x=m;x;x=Ro(x))g++;for(x=0,w=v;w;w=Ro(w))x++;for(;0<g-x;)m=Ro(m),g--;for(;0<x-g;)v=Ro(v),x--;for(;g--;){if(m===v||v!==null&&m===v.alternate)break t;m=Ro(m),v=Ro(v)}m=null}else m=null;d!==null&&qd(h,f,d,m,!1),p!==null&&y!==null&&qd(h,y,p,m,!0)}}e:{if(f=l?Uo(l):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var b=jx;else if(jd(f))if(Im)b=Vx;else{b=zx;var C=Wx}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=Ux);if(b&&(b=b(e,l))){Rm(h,b,n,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&hc(f,"number",f.value)}switch(C=l?Uo(l):window,e){case"focusin":(jd(C)||C.contentEditable==="true")&&(Wo=C,_c=l,Xi=null);break;case"focusout":Xi=_c=Wo=null;break;case"mousedown":Ec=!0;break;case"contextmenu":case"mouseup":case"dragend":Ec=!1,$d(h,n,c);break;case"selectionchange":if(Gx)break;case"keydown":case"keyup":$d(h,n,c)}var S;if(Lh)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else jo?Sm(e,n)&&(E="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(km&&n.locale!=="ko"&&(jo||E!=="onCompositionStart"?E==="onCompositionEnd"&&jo&&(S=Em()):(Nr=c,Mh="value"in Nr?Nr.value:Nr.textContent,jo=!0)),C=js(l,E),0<C.length&&(E=new Md(E,e,null,n,c),h.push({event:E,listeners:C}),S?E.data=S:(S=Nm(n),S!==null&&(E.data=S)))),(S=Fx?Mx(e,n):Ox(e,n))&&(l=js(l,"onBeforeInput"),0<l.length&&(c=new Md("onBeforeInput","beforeinput",null,n,c),h.push({event:c,listeners:l}),c.data=S))}jm(h,t)})}function ha(e,t,n){return{instance:e,listener:t,currentTarget:n}}function js(e,t){for(var n=t+"Capture",r=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=oa(e,n),i!=null&&r.unshift(ha(e,i,o)),i=oa(e,t),i!=null&&r.push(ha(e,i,o))),e=e.return}return r}function Ro(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function qd(e,t,n,r,o){for(var i=t._reactName,a=[];n!==null&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,o?(u=oa(n,i),u!=null&&a.unshift(ha(n,u,s))):o||(u=oa(n,i),u!=null&&a.push(ha(n,u,s)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var Qx=/\r\n?/g,Yx=/\u0000|\uFFFD/g;function Xd(e){return(typeof e=="string"?e:""+e).replace(Qx,`
`).replace(Yx,"")}function Ya(e,t,n){if(t=Xd(t),Xd(e)!==t&&n)throw Error(q(425))}function Ws(){}var kc=null,Sc=null;function Nc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Rc=typeof setTimeout=="function"?setTimeout:void 0,Jx=typeof clearTimeout=="function"?clearTimeout:void 0,Kd=typeof Promise=="function"?Promise:void 0,Zx=typeof queueMicrotask=="function"?queueMicrotask:typeof Kd<"u"?function(e){return Kd.resolve(null).then(e).catch(ew)}:Rc;function ew(e){setTimeout(function(){throw e})}function wl(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){e.removeChild(o),sa(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);sa(t)}function Fr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Qd(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ci=Math.random().toString(36).slice(2),Bn="__reactFiber$"+Ci,fa="__reactProps$"+Ci,ur="__reactContainer$"+Ci,Ic="__reactEvents$"+Ci,tw="__reactListeners$"+Ci,nw="__reactHandles$"+Ci;function oo(e){var t=e[Bn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ur]||n[Bn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Qd(e);e!==null;){if(n=e[Bn])return n;e=Qd(e)}return t}e=n,n=e.parentNode}return null}function Ia(e){return e=e[Bn]||e[ur],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Uo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(q(33))}function Tu(e){return e[fa]||null}var Tc=[],Vo=-1;function qr(e){return{current:e}}function Be(e){0>Vo||(e.current=Tc[Vo],Tc[Vo]=null,Vo--)}function Te(e,t){Vo++,Tc[Vo]=e.current,e.current=t}var Vr={},St=qr(Vr),Lt=qr(!1),fo=Vr;function ci(e,t){var n=e.type.contextTypes;if(!n)return Vr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function jt(e){return e=e.childContextTypes,e!=null}function zs(){Be(Lt),Be(St)}function Yd(e,t,n){if(St.current!==Vr)throw Error(q(168));Te(St,t),Te(Lt,n)}function zm(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(q(108,W1(e)||"Unknown",o));return $e({},n,r)}function Us(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vr,fo=St.current,Te(St,e),Te(Lt,Lt.current),!0}function Jd(e,t,n){var r=e.stateNode;if(!r)throw Error(q(169));n?(e=zm(e,t,fo),r.__reactInternalMemoizedMergedChildContext=e,Be(Lt),Be(St),Te(St,e)):Be(Lt),Te(Lt,n)}var nr=null,Pu=!1,bl=!1;function Um(e){nr===null?nr=[e]:nr.push(e)}function rw(e){Pu=!0,Um(e)}function Xr(){if(!bl&&nr!==null){bl=!0;var e=0,t=Re;try{var n=nr;for(Re=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}nr=null,Pu=!1}catch(o){throw nr!==null&&(nr=nr.slice(e+1)),dm(Ph,Xr),o}finally{Re=t,bl=!1}}return null}var $o=[],Ho=0,Vs=null,$s=0,sn=[],un=0,po=null,or=1,ir="";function Zr(e,t){$o[Ho++]=$s,$o[Ho++]=Vs,Vs=e,$s=t}function Vm(e,t,n){sn[un++]=or,sn[un++]=ir,sn[un++]=po,po=e;var r=or;e=ir;var o=32-kn(r)-1;r&=~(1<<o),n+=1;var i=32-kn(t)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,or=1<<32-kn(t)+o|n<<o|r,ir=i+e}else or=1<<i|n<<o|r,ir=e}function Wh(e){e.return!==null&&(Zr(e,1),Vm(e,1,0))}function zh(e){for(;e===Vs;)Vs=$o[--Ho],$o[Ho]=null,$s=$o[--Ho],$o[Ho]=null;for(;e===po;)po=sn[--un],sn[un]=null,ir=sn[--un],sn[un]=null,or=sn[--un],sn[un]=null}var Jt=null,Xt=null,je=!1,Cn=null;function $m(e,t){var n=hn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Zd(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Jt=e,Xt=Fr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Jt=e,Xt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=po!==null?{id:or,overflow:ir}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=hn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Jt=e,Xt=null,!0):!1;default:return!1}}function Pc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Dc(e){if(je){var t=Xt;if(t){var n=t;if(!Zd(e,t)){if(Pc(e))throw Error(q(418));t=Fr(n.nextSibling);var r=Jt;t&&Zd(e,t)?$m(r,n):(e.flags=e.flags&-4097|2,je=!1,Jt=e)}}else{if(Pc(e))throw Error(q(418));e.flags=e.flags&-4097|2,je=!1,Jt=e}}}function ep(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Jt=e}function Ja(e){if(e!==Jt)return!1;if(!je)return ep(e),je=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Nc(e.type,e.memoizedProps)),t&&(t=Xt)){if(Pc(e))throw Hm(),Error(q(418));for(;t;)$m(e,t),t=Fr(t.nextSibling)}if(ep(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(q(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Xt=Fr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Xt=null}}else Xt=Jt?Fr(e.stateNode.nextSibling):null;return!0}function Hm(){for(var e=Xt;e;)e=Fr(e.nextSibling)}function hi(){Xt=Jt=null,je=!1}function Uh(e){Cn===null?Cn=[e]:Cn.push(e)}var ow=hr.ReactCurrentBatchConfig;function Di(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(q(309));var r=n.stateNode}if(!r)throw Error(q(147,e));var o=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var s=o.refs;a===null?delete s[i]:s[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(q(284));if(!n._owner)throw Error(q(290,e))}return e}function Za(e,t){throw e=Object.prototype.toString.call(t),Error(q(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function tp(e){var t=e._init;return t(e._payload)}function Gm(e){function t(v,g){if(e){var x=v.deletions;x===null?(v.deletions=[g],v.flags|=16):x.push(g)}}function n(v,g){if(!e)return null;for(;g!==null;)t(v,g),g=g.sibling;return null}function r(v,g){for(v=new Map;g!==null;)g.key!==null?v.set(g.key,g):v.set(g.index,g),g=g.sibling;return v}function o(v,g){return v=Lr(v,g),v.index=0,v.sibling=null,v}function i(v,g,x){return v.index=x,e?(x=v.alternate,x!==null?(x=x.index,x<g?(v.flags|=2,g):x):(v.flags|=2,g)):(v.flags|=1048576,g)}function a(v){return e&&v.alternate===null&&(v.flags|=2),v}function s(v,g,x,w){return g===null||g.tag!==6?(g=Rl(x,v.mode,w),g.return=v,g):(g=o(g,x),g.return=v,g)}function u(v,g,x,w){var b=x.type;return b===Lo?c(v,g,x.props.children,w,x.key):g!==null&&(g.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===_r&&tp(b)===g.type)?(w=o(g,x.props),w.ref=Di(v,g,x),w.return=v,w):(w=Ts(x.type,x.key,x.props,null,v.mode,w),w.ref=Di(v,g,x),w.return=v,w)}function l(v,g,x,w){return g===null||g.tag!==4||g.stateNode.containerInfo!==x.containerInfo||g.stateNode.implementation!==x.implementation?(g=Il(x,v.mode,w),g.return=v,g):(g=o(g,x.children||[]),g.return=v,g)}function c(v,g,x,w,b){return g===null||g.tag!==7?(g=co(x,v.mode,w,b),g.return=v,g):(g=o(g,x),g.return=v,g)}function h(v,g,x){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Rl(""+g,v.mode,x),g.return=v,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ua:return x=Ts(g.type,g.key,g.props,null,v.mode,x),x.ref=Di(v,null,g),x.return=v,x;case Bo:return g=Il(g,v.mode,x),g.return=v,g;case _r:var w=g._init;return h(v,w(g._payload),x)}if(zi(g)||Ni(g))return g=co(g,v.mode,x,null),g.return=v,g;Za(v,g)}return null}function f(v,g,x,w){var b=g!==null?g.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return b!==null?null:s(v,g,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ua:return x.key===b?u(v,g,x,w):null;case Bo:return x.key===b?l(v,g,x,w):null;case _r:return b=x._init,f(v,g,b(x._payload),w)}if(zi(x)||Ni(x))return b!==null?null:c(v,g,x,w,null);Za(v,x)}return null}function d(v,g,x,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,s(g,v,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ua:return v=v.get(w.key===null?x:w.key)||null,u(g,v,w,b);case Bo:return v=v.get(w.key===null?x:w.key)||null,l(g,v,w,b);case _r:var C=w._init;return d(v,g,x,C(w._payload),b)}if(zi(w)||Ni(w))return v=v.get(x)||null,c(g,v,w,b,null);Za(g,w)}return null}function p(v,g,x,w){for(var b=null,C=null,S=g,E=g=0,R=null;S!==null&&E<x.length;E++){S.index>E?(R=S,S=null):R=S.sibling;var N=f(v,S,x[E],w);if(N===null){S===null&&(S=R);break}e&&S&&N.alternate===null&&t(v,S),g=i(N,g,E),C===null?b=N:C.sibling=N,C=N,S=R}if(E===x.length)return n(v,S),je&&Zr(v,E),b;if(S===null){for(;E<x.length;E++)S=h(v,x[E],w),S!==null&&(g=i(S,g,E),C===null?b=S:C.sibling=S,C=S);return je&&Zr(v,E),b}for(S=r(v,S);E<x.length;E++)R=d(S,v,E,x[E],w),R!==null&&(e&&R.alternate!==null&&S.delete(R.key===null?E:R.key),g=i(R,g,E),C===null?b=R:C.sibling=R,C=R);return e&&S.forEach(function(P){return t(v,P)}),je&&Zr(v,E),b}function m(v,g,x,w){var b=Ni(x);if(typeof b!="function")throw Error(q(150));if(x=b.call(x),x==null)throw Error(q(151));for(var C=b=null,S=g,E=g=0,R=null,N=x.next();S!==null&&!N.done;E++,N=x.next()){S.index>E?(R=S,S=null):R=S.sibling;var P=f(v,S,N.value,w);if(P===null){S===null&&(S=R);break}e&&S&&P.alternate===null&&t(v,S),g=i(P,g,E),C===null?b=P:C.sibling=P,C=P,S=R}if(N.done)return n(v,S),je&&Zr(v,E),b;if(S===null){for(;!N.done;E++,N=x.next())N=h(v,N.value,w),N!==null&&(g=i(N,g,E),C===null?b=N:C.sibling=N,C=N);return je&&Zr(v,E),b}for(S=r(v,S);!N.done;E++,N=x.next())N=d(S,v,E,N.value,w),N!==null&&(e&&N.alternate!==null&&S.delete(N.key===null?E:N.key),g=i(N,g,E),C===null?b=N:C.sibling=N,C=N);return e&&S.forEach(function(D){return t(v,D)}),je&&Zr(v,E),b}function y(v,g,x,w){if(typeof x=="object"&&x!==null&&x.type===Lo&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Ua:e:{for(var b=x.key,C=g;C!==null;){if(C.key===b){if(b=x.type,b===Lo){if(C.tag===7){n(v,C.sibling),g=o(C,x.props.children),g.return=v,v=g;break e}}else if(C.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===_r&&tp(b)===C.type){n(v,C.sibling),g=o(C,x.props),g.ref=Di(v,C,x),g.return=v,v=g;break e}n(v,C);break}else t(v,C);C=C.sibling}x.type===Lo?(g=co(x.props.children,v.mode,w,x.key),g.return=v,v=g):(w=Ts(x.type,x.key,x.props,null,v.mode,w),w.ref=Di(v,g,x),w.return=v,v=w)}return a(v);case Bo:e:{for(C=x.key;g!==null;){if(g.key===C)if(g.tag===4&&g.stateNode.containerInfo===x.containerInfo&&g.stateNode.implementation===x.implementation){n(v,g.sibling),g=o(g,x.children||[]),g.return=v,v=g;break e}else{n(v,g);break}else t(v,g);g=g.sibling}g=Il(x,v.mode,w),g.return=v,v=g}return a(v);case _r:return C=x._init,y(v,g,C(x._payload),w)}if(zi(x))return p(v,g,x,w);if(Ni(x))return m(v,g,x,w);Za(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,g!==null&&g.tag===6?(n(v,g.sibling),g=o(g,x),g.return=v,v=g):(n(v,g),g=Rl(x,v.mode,w),g.return=v,v=g),a(v)):n(v,g)}return y}var fi=Gm(!0),qm=Gm(!1),Hs=qr(null),Gs=null,Go=null,Vh=null;function $h(){Vh=Go=Gs=null}function Hh(e){var t=Hs.current;Be(Hs),e._currentValue=t}function Ac(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Zo(e,t){Gs=e,Vh=Go=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Bt=!0),e.firstContext=null)}function pn(e){var t=e._currentValue;if(Vh!==e)if(e={context:e,memoizedValue:t,next:null},Go===null){if(Gs===null)throw Error(q(308));Go=e,Gs.dependencies={lanes:0,firstContext:e}}else Go=Go.next=e;return t}var io=null;function Gh(e){io===null?io=[e]:io.push(e)}function Xm(e,t,n,r){var o=t.interleaved;return o===null?(n.next=n,Gh(t)):(n.next=o.next,o.next=n),t.interleaved=n,lr(e,r)}function lr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Er=!1;function qh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Km(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ar(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Mr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,_e&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,lr(e,n)}return o=r.interleaved,o===null?(t.next=t,Gh(r)):(t.next=o.next,o.next=t),r.interleaved=t,lr(e,n)}function Es(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Dh(e,n)}}function np(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qs(e,t,n,r){var o=e.updateQueue;Er=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?i=l:a.next=l,a=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(i!==null){var h=o.baseState;a=0,c=l=u=null,s=i;do{var f=s.lane,d=s.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(f=t,d=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,f=typeof p=="function"?p.call(d,h,f):p,f==null)break e;h=$e({},h,f);break e;case 2:Er=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=o.effects,f===null?o.effects=[s]:f.push(s))}else d={eventTime:d,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=d,u=h):c=c.next=d,a|=f;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;f=s,s=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(!0);if(c===null&&(u=h),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);mo|=a,e.lanes=a,e.memoizedState=h}}function rp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(q(191,o));o.call(r)}}}var Ta={},Un=qr(Ta),da=qr(Ta),pa=qr(Ta);function ao(e){if(e===Ta)throw Error(q(174));return e}function Xh(e,t){switch(Te(pa,t),Te(da,e),Te(Un,Ta),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dc(t,e)}Be(Un),Te(Un,t)}function di(){Be(Un),Be(da),Be(pa)}function Qm(e){ao(pa.current);var t=ao(Un.current),n=dc(t,e.type);t!==n&&(Te(da,e),Te(Un,n))}function Kh(e){da.current===e&&(Be(Un),Be(da))}var We=qr(0);function Xs(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Cl=[];function Qh(){for(var e=0;e<Cl.length;e++)Cl[e]._workInProgressVersionPrimary=null;Cl.length=0}var ks=hr.ReactCurrentDispatcher,_l=hr.ReactCurrentBatchConfig,vo=0,Ve=null,Ze=null,st=null,Ks=!1,Ki=!1,va=0,iw=0;function yt(){throw Error(q(321))}function Yh(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Rn(e[n],t[n]))return!1;return!0}function Jh(e,t,n,r,o,i){if(vo=i,Ve=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ks.current=e===null||e.memoizedState===null?lw:cw,e=n(r,o),Ki){i=0;do{if(Ki=!1,va=0,25<=i)throw Error(q(301));i+=1,st=Ze=null,t.updateQueue=null,ks.current=hw,e=n(r,o)}while(Ki)}if(ks.current=Qs,t=Ze!==null&&Ze.next!==null,vo=0,st=Ze=Ve=null,Ks=!1,t)throw Error(q(300));return e}function Zh(){var e=va!==0;return va=0,e}function Fn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return st===null?Ve.memoizedState=st=e:st=st.next=e,st}function vn(){if(Ze===null){var e=Ve.alternate;e=e!==null?e.memoizedState:null}else e=Ze.next;var t=st===null?Ve.memoizedState:st.next;if(t!==null)st=t,Ze=e;else{if(e===null)throw Error(q(310));Ze=e,e={memoizedState:Ze.memoizedState,baseState:Ze.baseState,baseQueue:Ze.baseQueue,queue:Ze.queue,next:null},st===null?Ve.memoizedState=st=e:st=st.next=e}return st}function ma(e,t){return typeof t=="function"?t(e):t}function El(e){var t=vn(),n=t.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=e;var r=Ze,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var s=a=null,u=null,l=i;do{var c=l.lane;if((vo&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=h,a=r):u=u.next=h,Ve.lanes|=c,mo|=c}l=l.next}while(l!==null&&l!==i);u===null?a=r:u.next=s,Rn(r,t.memoizedState)||(Bt=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){o=e;do i=o.lane,Ve.lanes|=i,mo|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function kl(e){var t=vn(),n=t.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);Rn(i,t.memoizedState)||(Bt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Ym(){}function Jm(e,t){var n=Ve,r=vn(),o=t(),i=!Rn(r.memoizedState,o);if(i&&(r.memoizedState=o,Bt=!0),r=r.queue,ef(tg.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||st!==null&&st.memoizedState.tag&1){if(n.flags|=2048,ga(9,eg.bind(null,n,r,o,t),void 0,null),ut===null)throw Error(q(349));vo&30||Zm(n,t,o)}return o}function Zm(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Ve.updateQueue,t===null?(t={lastEffect:null,stores:null},Ve.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function eg(e,t,n,r){t.value=n,t.getSnapshot=r,ng(t)&&rg(e)}function tg(e,t,n){return n(function(){ng(t)&&rg(e)})}function ng(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Rn(e,n)}catch{return!0}}function rg(e){var t=lr(e,1);t!==null&&Sn(t,e,1,-1)}function op(e){var t=Fn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:e},t.queue=e,e=e.dispatch=uw.bind(null,Ve,e),[t.memoizedState,e]}function ga(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Ve.updateQueue,t===null?(t={lastEffect:null,stores:null},Ve.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function og(){return vn().memoizedState}function Ss(e,t,n,r){var o=Fn();Ve.flags|=e,o.memoizedState=ga(1|t,n,void 0,r===void 0?null:r)}function Du(e,t,n,r){var o=vn();r=r===void 0?null:r;var i=void 0;if(Ze!==null){var a=Ze.memoizedState;if(i=a.destroy,r!==null&&Yh(r,a.deps)){o.memoizedState=ga(t,n,i,r);return}}Ve.flags|=e,o.memoizedState=ga(1|t,n,i,r)}function ip(e,t){return Ss(8390656,8,e,t)}function ef(e,t){return Du(2048,8,e,t)}function ig(e,t){return Du(4,2,e,t)}function ag(e,t){return Du(4,4,e,t)}function sg(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ug(e,t,n){return n=n!=null?n.concat([e]):null,Du(4,4,sg.bind(null,t,e),n)}function tf(){}function lg(e,t){var n=vn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Yh(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function cg(e,t){var n=vn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Yh(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function hg(e,t,n){return vo&21?(Rn(n,t)||(n=mm(),Ve.lanes|=n,mo|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Bt=!0),e.memoizedState=n)}function aw(e,t){var n=Re;Re=n!==0&&4>n?n:4,e(!0);var r=_l.transition;_l.transition={};try{e(!1),t()}finally{Re=n,_l.transition=r}}function fg(){return vn().memoizedState}function sw(e,t,n){var r=Br(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},dg(e))pg(t,n);else if(n=Xm(e,t,n,r),n!==null){var o=Pt();Sn(n,e,r,o),vg(n,t,r)}}function uw(e,t,n){var r=Br(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(dg(e))pg(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,Rn(s,a)){var u=t.interleaved;u===null?(o.next=o,Gh(t)):(o.next=u.next,u.next=o),t.interleaved=o;return}}catch{}finally{}n=Xm(e,t,o,r),n!==null&&(o=Pt(),Sn(n,e,r,o),vg(n,t,r))}}function dg(e){var t=e.alternate;return e===Ve||t!==null&&t===Ve}function pg(e,t){Ki=Ks=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function vg(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Dh(e,n)}}var Qs={readContext:pn,useCallback:yt,useContext:yt,useEffect:yt,useImperativeHandle:yt,useInsertionEffect:yt,useLayoutEffect:yt,useMemo:yt,useReducer:yt,useRef:yt,useState:yt,useDebugValue:yt,useDeferredValue:yt,useTransition:yt,useMutableSource:yt,useSyncExternalStore:yt,useId:yt,unstable_isNewReconciler:!1},lw={readContext:pn,useCallback:function(e,t){return Fn().memoizedState=[e,t===void 0?null:t],e},useContext:pn,useEffect:ip,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Ss(4194308,4,sg.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ss(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ss(4,2,e,t)},useMemo:function(e,t){var n=Fn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Fn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=sw.bind(null,Ve,e),[r.memoizedState,e]},useRef:function(e){var t=Fn();return e={current:e},t.memoizedState=e},useState:op,useDebugValue:tf,useDeferredValue:function(e){return Fn().memoizedState=e},useTransition:function(){var e=op(!1),t=e[0];return e=aw.bind(null,e[1]),Fn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Ve,o=Fn();if(je){if(n===void 0)throw Error(q(407));n=n()}else{if(n=t(),ut===null)throw Error(q(349));vo&30||Zm(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,ip(tg.bind(null,r,i,e),[e]),r.flags|=2048,ga(9,eg.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Fn(),t=ut.identifierPrefix;if(je){var n=ir,r=or;n=(r&~(1<<32-kn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=va++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=iw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cw={readContext:pn,useCallback:lg,useContext:pn,useEffect:ef,useImperativeHandle:ug,useInsertionEffect:ig,useLayoutEffect:ag,useMemo:cg,useReducer:El,useRef:og,useState:function(){return El(ma)},useDebugValue:tf,useDeferredValue:function(e){var t=vn();return hg(t,Ze.memoizedState,e)},useTransition:function(){var e=El(ma)[0],t=vn().memoizedState;return[e,t]},useMutableSource:Ym,useSyncExternalStore:Jm,useId:fg,unstable_isNewReconciler:!1},hw={readContext:pn,useCallback:lg,useContext:pn,useEffect:ef,useImperativeHandle:ug,useInsertionEffect:ig,useLayoutEffect:ag,useMemo:cg,useReducer:kl,useRef:og,useState:function(){return kl(ma)},useDebugValue:tf,useDeferredValue:function(e){var t=vn();return Ze===null?t.memoizedState=e:hg(t,Ze.memoizedState,e)},useTransition:function(){var e=kl(ma)[0],t=vn().memoizedState;return[e,t]},useMutableSource:Ym,useSyncExternalStore:Jm,useId:fg,unstable_isNewReconciler:!1};function wn(e,t){if(e&&e.defaultProps){t=$e({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Fc(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:$e({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Au={isMounted:function(e){return(e=e._reactInternals)?bo(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Pt(),o=Br(e),i=ar(r,o);i.payload=t,n!=null&&(i.callback=n),t=Mr(e,i,o),t!==null&&(Sn(t,e,o,r),Es(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Pt(),o=Br(e),i=ar(r,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=Mr(e,i,o),t!==null&&(Sn(t,e,o,r),Es(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Pt(),r=Br(e),o=ar(n,r);o.tag=2,t!=null&&(o.callback=t),t=Mr(e,o,r),t!==null&&(Sn(t,e,r,n),Es(t,e,r))}};function ap(e,t,n,r,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,a):t.prototype&&t.prototype.isPureReactComponent?!la(n,r)||!la(o,i):!0}function mg(e,t,n){var r=!1,o=Vr,i=t.contextType;return typeof i=="object"&&i!==null?i=pn(i):(o=jt(t)?fo:St.current,r=t.contextTypes,i=(r=r!=null)?ci(e,o):Vr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Au,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function sp(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Au.enqueueReplaceState(t,t.state,null)}function Mc(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},qh(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=pn(i):(i=jt(t)?fo:St.current,o.context=ci(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Fc(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Au.enqueueReplaceState(o,o.state,null),qs(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function pi(e,t){try{var n="",r=t;do n+=j1(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Sl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Oc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fw=typeof WeakMap=="function"?WeakMap:Map;function gg(e,t,n){n=ar(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Js||(Js=!0,Gc=r),Oc(e,t)},n}function yg(e,t,n){n=ar(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){Oc(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Oc(e,t),typeof r!="function"&&(Or===null?Or=new Set([this]):Or.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function up(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new fw;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Sw.bind(null,e,t,n),t.then(e,e))}function lp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function cp(e,t,n,r,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=ar(-1,1),t.tag=2,Mr(n,t,1))),n.lanes|=1),e)}var dw=hr.ReactCurrentOwner,Bt=!1;function It(e,t,n,r){t.child=e===null?qm(t,null,n,r):fi(t,e.child,n,r)}function hp(e,t,n,r,o){n=n.render;var i=t.ref;return Zo(t,o),r=Jh(e,t,n,r,i,o),n=Zh(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,cr(e,t,o)):(je&&n&&Wh(t),t.flags|=1,It(e,t,r,o),t.child)}function fp(e,t,n,r,o){if(e===null){var i=n.type;return typeof i=="function"&&!cf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,xg(e,t,i,r,o)):(e=Ts(n.type,null,r,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:la,n(a,r)&&e.ref===t.ref)return cr(e,t,o)}return t.flags|=1,e=Lr(i,r),e.ref=t.ref,e.return=t,t.child=e}function xg(e,t,n,r,o){if(e!==null){var i=e.memoizedProps;if(la(i,r)&&e.ref===t.ref)if(Bt=!1,t.pendingProps=r=i,(e.lanes&o)!==0)e.flags&131072&&(Bt=!0);else return t.lanes=e.lanes,cr(e,t,o)}return Bc(e,t,n,r,o)}function wg(e,t,n){var r=t.pendingProps,o=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Te(Xo,Ht),Ht|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Te(Xo,Ht),Ht|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Te(Xo,Ht),Ht|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,Te(Xo,Ht),Ht|=r;return It(e,t,o,n),t.child}function bg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Bc(e,t,n,r,o){var i=jt(n)?fo:St.current;return i=ci(t,i),Zo(t,o),n=Jh(e,t,n,r,i,o),r=Zh(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,cr(e,t,o)):(je&&r&&Wh(t),t.flags|=1,It(e,t,n,o),t.child)}function dp(e,t,n,r,o){if(jt(n)){var i=!0;Us(t)}else i=!1;if(Zo(t,o),t.stateNode===null)Ns(e,t),mg(t,n,r),Mc(t,n,r,o),r=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,l=n.contextType;typeof l=="object"&&l!==null?l=pn(l):(l=jt(n)?fo:St.current,l=ci(t,l));var c=n.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&sp(t,a,r,l),Er=!1;var f=t.memoizedState;a.state=f,qs(t,r,a,o),u=t.memoizedState,s!==r||f!==u||Lt.current||Er?(typeof c=="function"&&(Fc(t,n,c,r),u=t.memoizedState),(s=Er||ap(t,n,s,r,f,u,l))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Km(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:wn(t.type,s),a.props=l,h=t.pendingProps,f=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=pn(u):(u=jt(n)?fo:St.current,u=ci(t,u));var d=n.getDerivedStateFromProps;(c=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==h||f!==u)&&sp(t,a,r,u),Er=!1,f=t.memoizedState,a.state=f,qs(t,r,a,o);var p=t.memoizedState;s!==h||f!==p||Lt.current||Er?(typeof d=="function"&&(Fc(t,n,d,r),p=t.memoizedState),(l=Er||ap(t,n,l,r,f,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,u)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Lc(e,t,n,r,i,o)}function Lc(e,t,n,r,o,i){bg(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return o&&Jd(t,n,!1),cr(e,t,i);r=t.stateNode,dw.current=t;var s=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=fi(t,e.child,null,i),t.child=fi(t,null,s,i)):It(e,t,s,i),t.memoizedState=r.state,o&&Jd(t,n,!0),t.child}function Cg(e){var t=e.stateNode;t.pendingContext?Yd(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Yd(e,t.context,!1),Xh(e,t.containerInfo)}function pp(e,t,n,r,o){return hi(),Uh(o),t.flags|=256,It(e,t,n,r),t.child}var jc={dehydrated:null,treeContext:null,retryLane:0};function Wc(e){return{baseLanes:e,cachePool:null,transitions:null}}function _g(e,t,n){var r=t.pendingProps,o=We.current,i=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),Te(We,o&1),e===null)return Dc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,i?(r=t.mode,i=t.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Ou(a,r,0,null),e=co(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Wc(n),t.memoizedState=jc,e):nf(t,a));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return pw(e,t,a,r,s,o,n);if(i){i=r.fallback,a=t.mode,o=e.child,s=o.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=Lr(o,u),r.subtreeFlags=o.subtreeFlags&14680064),s!==null?i=Lr(s,i):(i=co(i,a,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,a=e.child.memoizedState,a=a===null?Wc(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=jc,r}return i=e.child,e=i.sibling,r=Lr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function nf(e,t){return t=Ou({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function es(e,t,n,r){return r!==null&&Uh(r),fi(t,e.child,null,n),e=nf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function pw(e,t,n,r,o,i,a){if(n)return t.flags&256?(t.flags&=-257,r=Sl(Error(q(422))),es(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Ou({mode:"visible",children:r.children},o,0,null),i=co(i,o,a,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&fi(t,e.child,null,a),t.child.memoizedState=Wc(a),t.memoizedState=jc,i);if(!(t.mode&1))return es(e,t,a,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var s=r.dgst;return r=s,i=Error(q(419)),r=Sl(i,r,void 0),es(e,t,a,r)}if(s=(a&e.childLanes)!==0,Bt||s){if(r=ut,r!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,lr(e,o),Sn(r,e,o,-1))}return lf(),r=Sl(Error(q(421))),es(e,t,a,r)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=Nw.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Xt=Fr(o.nextSibling),Jt=t,je=!0,Cn=null,e!==null&&(sn[un++]=or,sn[un++]=ir,sn[un++]=po,or=e.id,ir=e.overflow,po=t),t=nf(t,r.children),t.flags|=4096,t)}function vp(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Ac(e.return,t,n)}function Nl(e,t,n,r,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function Eg(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(It(e,t,r.children,n),r=We.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vp(e,n,t);else if(e.tag===19)vp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Te(We,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&Xs(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Nl(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Xs(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Nl(t,!0,n,null,i);break;case"together":Nl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ns(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function cr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),mo|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(q(153));if(t.child!==null){for(e=t.child,n=Lr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Lr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function vw(e,t,n){switch(t.tag){case 3:Cg(t),hi();break;case 5:Qm(t);break;case 1:jt(t.type)&&Us(t);break;case 4:Xh(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Te(Hs,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Te(We,We.current&1),t.flags|=128,null):n&t.child.childLanes?_g(e,t,n):(Te(We,We.current&1),e=cr(e,t,n),e!==null?e.sibling:null);Te(We,We.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Eg(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Te(We,We.current),r)break;return null;case 22:case 23:return t.lanes=0,wg(e,t,n)}return cr(e,t,n)}var kg,zc,Sg,Ng;kg=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};zc=function(){};Sg=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,ao(Un.current);var i=null;switch(n){case"input":o=lc(e,o),r=lc(e,r),i=[];break;case"select":o=$e({},o,{value:void 0}),r=$e({},r,{value:void 0}),i=[];break;case"textarea":o=fc(e,o),r=fc(e,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Ws)}pc(n,r);var a;n=null;for(l in o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&o[l]!=null)if(l==="style"){var s=o[l];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(na.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in r){var u=r[l];if(s=o!=null?o[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(na.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Me("scroll",e),i||s===u||(i=[])):(i=i||[]).push(l,u))}n&&(i=i||[]).push("style",n);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};Ng=function(e,t,n,r){n!==r&&(t.flags|=4)};function Ai(e,t){if(!je)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function xt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function mw(e,t,n){var r=t.pendingProps;switch(zh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(t),null;case 1:return jt(t.type)&&zs(),xt(t),null;case 3:return r=t.stateNode,di(),Be(Lt),Be(St),Qh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ja(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Cn!==null&&(Kc(Cn),Cn=null))),zc(e,t),xt(t),null;case 5:Kh(t);var o=ao(pa.current);if(n=t.type,e!==null&&t.stateNode!=null)Sg(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(q(166));return xt(t),null}if(e=ao(Un.current),Ja(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[Bn]=t,r[fa]=i,e=(t.mode&1)!==0,n){case"dialog":Me("cancel",r),Me("close",r);break;case"iframe":case"object":case"embed":Me("load",r);break;case"video":case"audio":for(o=0;o<Vi.length;o++)Me(Vi[o],r);break;case"source":Me("error",r);break;case"img":case"image":case"link":Me("error",r),Me("load",r);break;case"details":Me("toggle",r);break;case"input":Ed(r,i),Me("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Me("invalid",r);break;case"textarea":Sd(r,i),Me("invalid",r)}pc(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];a==="children"?typeof s=="string"?r.textContent!==s&&(i.suppressHydrationWarning!==!0&&Ya(r.textContent,s,e),o=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&Ya(r.textContent,s,e),o=["children",""+s]):na.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Me("scroll",r)}switch(n){case"input":Va(r),kd(r,i,!0);break;case"textarea":Va(r),Nd(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ws)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tm(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(n,{is:r.is}):(e=a.createElement(n),n==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,n),e[Bn]=t,e[fa]=r,kg(e,t,!1,!1),t.stateNode=e;e:{switch(a=vc(n,r),n){case"dialog":Me("cancel",e),Me("close",e),o=r;break;case"iframe":case"object":case"embed":Me("load",e),o=r;break;case"video":case"audio":for(o=0;o<Vi.length;o++)Me(Vi[o],e);o=r;break;case"source":Me("error",e),o=r;break;case"img":case"image":case"link":Me("error",e),Me("load",e),o=r;break;case"details":Me("toggle",e),o=r;break;case"input":Ed(e,r),o=lc(e,r),Me("invalid",e);break;case"option":o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=$e({},r,{value:void 0}),Me("invalid",e);break;case"textarea":Sd(e,r),o=fc(e,r),Me("invalid",e);break;default:o=r}pc(n,o),s=o;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?om(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&nm(e,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&ra(e,u):typeof u=="number"&&ra(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(na.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Me("scroll",e):u!=null&&Sh(e,i,u,a))}switch(n){case"input":Va(e),kd(e,r,!1);break;case"textarea":Va(e),Nd(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Ur(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Ko(e,!!r.multiple,i,!1):r.defaultValue!=null&&Ko(e,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=Ws)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return xt(t),null;case 6:if(e&&t.stateNode!=null)Ng(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(q(166));if(n=ao(pa.current),ao(Un.current),Ja(t)){if(r=t.stateNode,n=t.memoizedProps,r[Bn]=t,(i=r.nodeValue!==n)&&(e=Jt,e!==null))switch(e.tag){case 3:Ya(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ya(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Bn]=t,t.stateNode=r}return xt(t),null;case 13:if(Be(We),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(je&&Xt!==null&&t.mode&1&&!(t.flags&128))Hm(),hi(),t.flags|=98560,i=!1;else if(i=Ja(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(q(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[Bn]=t}else hi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;xt(t),i=!1}else Cn!==null&&(Kc(Cn),Cn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||We.current&1?et===0&&(et=3):lf())),t.updateQueue!==null&&(t.flags|=4),xt(t),null);case 4:return di(),zc(e,t),e===null&&ca(t.stateNode.containerInfo),xt(t),null;case 10:return Hh(t.type._context),xt(t),null;case 17:return jt(t.type)&&zs(),xt(t),null;case 19:if(Be(We),i=t.memoizedState,i===null)return xt(t),null;if(r=(t.flags&128)!==0,a=i.rendering,a===null)if(r)Ai(i,!1);else{if(et!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Xs(e),a!==null){for(t.flags|=128,Ai(i,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Te(We,We.current&1|2),t.child}e=e.sibling}i.tail!==null&&Xe()>vi&&(t.flags|=128,r=!0,Ai(i,!1),t.lanes=4194304)}else{if(!r)if(e=Xs(a),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ai(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!je)return xt(t),null}else 2*Xe()-i.renderingStartTime>vi&&n!==1073741824&&(t.flags|=128,r=!0,Ai(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Xe(),t.sibling=null,n=We.current,Te(We,r?n&1|2:n&1),t):(xt(t),null);case 22:case 23:return uf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Ht&1073741824&&(xt(t),t.subtreeFlags&6&&(t.flags|=8192)):xt(t),null;case 24:return null;case 25:return null}throw Error(q(156,t.tag))}function gw(e,t){switch(zh(t),t.tag){case 1:return jt(t.type)&&zs(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return di(),Be(Lt),Be(St),Qh(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Kh(t),null;case 13:if(Be(We),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(q(340));hi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Be(We),null;case 4:return di(),null;case 10:return Hh(t.type._context),null;case 22:case 23:return uf(),null;case 24:return null;default:return null}}var ts=!1,bt=!1,yw=typeof WeakSet=="function"?WeakSet:Set,J=null;function qo(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qe(e,t,r)}else n.current=null}function Uc(e,t,n){try{n()}catch(r){qe(e,t,r)}}var mp=!1;function xw(e,t){if(kc=Bs,e=Dm(),jh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,s=-1,u=-1,l=0,c=0,h=e,f=null;t:for(;;){for(var d;h!==n||o!==0&&h.nodeType!==3||(s=a+o),h!==i||r!==0&&h.nodeType!==3||(u=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===e)break t;if(f===n&&++l===o&&(s=a),f===i&&++c===r&&(u=a),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Sc={focusedElem:e,selectionRange:n},Bs=!1,J=t;J!==null;)if(t=J,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,J=e;else for(;J!==null;){t=J;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,y=p.memoizedState,v=t.stateNode,g=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:wn(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(w){qe(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,J=e;break}J=t.return}return p=mp,mp=!1,p}function Qi(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&Uc(t,n,i)}o=o.next}while(o!==r)}}function Fu(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Vc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Rg(e){var t=e.alternate;t!==null&&(e.alternate=null,Rg(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Bn],delete t[fa],delete t[Ic],delete t[tw],delete t[nw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Ig(e){return e.tag===5||e.tag===3||e.tag===4}function gp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ig(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $c(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ws));else if(r!==4&&(e=e.child,e!==null))for($c(e,t,n),e=e.sibling;e!==null;)$c(e,t,n),e=e.sibling}function Hc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Hc(e,t,n),e=e.sibling;e!==null;)Hc(e,t,n),e=e.sibling}var ht=null,bn=!1;function wr(e,t,n){for(n=n.child;n!==null;)Tg(e,t,n),n=n.sibling}function Tg(e,t,n){if(zn&&typeof zn.onCommitFiberUnmount=="function")try{zn.onCommitFiberUnmount(Su,n)}catch{}switch(n.tag){case 5:bt||qo(n,t);case 6:var r=ht,o=bn;ht=null,wr(e,t,n),ht=r,bn=o,ht!==null&&(bn?(e=ht,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):ht.removeChild(n.stateNode));break;case 18:ht!==null&&(bn?(e=ht,n=n.stateNode,e.nodeType===8?wl(e.parentNode,n):e.nodeType===1&&wl(e,n),sa(e)):wl(ht,n.stateNode));break;case 4:r=ht,o=bn,ht=n.stateNode.containerInfo,bn=!0,wr(e,t,n),ht=r,bn=o;break;case 0:case 11:case 14:case 15:if(!bt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Uc(n,t,a),o=o.next}while(o!==r)}wr(e,t,n);break;case 1:if(!bt&&(qo(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){qe(n,t,s)}wr(e,t,n);break;case 21:wr(e,t,n);break;case 22:n.mode&1?(bt=(r=bt)||n.memoizedState!==null,wr(e,t,n),bt=r):wr(e,t,n);break;default:wr(e,t,n)}}function yp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new yw),t.forEach(function(r){var o=Rw.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}function xn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:ht=s.stateNode,bn=!1;break e;case 3:ht=s.stateNode.containerInfo,bn=!0;break e;case 4:ht=s.stateNode.containerInfo,bn=!0;break e}s=s.return}if(ht===null)throw Error(q(160));Tg(i,a,o),ht=null,bn=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(l){qe(o,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Pg(t,e),t=t.sibling}function Pg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xn(t,e),Dn(e),r&4){try{Qi(3,e,e.return),Fu(3,e)}catch(m){qe(e,e.return,m)}try{Qi(5,e,e.return)}catch(m){qe(e,e.return,m)}}break;case 1:xn(t,e),Dn(e),r&512&&n!==null&&qo(n,n.return);break;case 5:if(xn(t,e),Dn(e),r&512&&n!==null&&qo(n,n.return),e.flags&32){var o=e.stateNode;try{ra(o,"")}catch(m){qe(e,e.return,m)}}if(r&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&Zv(o,i),vc(s,a);var l=vc(s,i);for(a=0;a<u.length;a+=2){var c=u[a],h=u[a+1];c==="style"?om(o,h):c==="dangerouslySetInnerHTML"?nm(o,h):c==="children"?ra(o,h):Sh(o,c,h,l)}switch(s){case"input":cc(o,i);break;case"textarea":em(o,i);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var d=i.value;d!=null?Ko(o,!!i.multiple,d,!1):f!==!!i.multiple&&(i.defaultValue!=null?Ko(o,!!i.multiple,i.defaultValue,!0):Ko(o,!!i.multiple,i.multiple?[]:"",!1))}o[fa]=i}catch(m){qe(e,e.return,m)}}break;case 6:if(xn(t,e),Dn(e),r&4){if(e.stateNode===null)throw Error(q(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(m){qe(e,e.return,m)}}break;case 3:if(xn(t,e),Dn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{sa(t.containerInfo)}catch(m){qe(e,e.return,m)}break;case 4:xn(t,e),Dn(e);break;case 13:xn(t,e),Dn(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(af=Xe())),r&4&&yp(e);break;case 22:if(c=n!==null&&n.memoizedState!==null,e.mode&1?(bt=(l=bt)||c,xn(t,e),bt=l):xn(t,e),Dn(e),r&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(J=e,c=e.child;c!==null;){for(h=J=c;J!==null;){switch(f=J,d=f.child,f.tag){case 0:case 11:case 14:case 15:Qi(4,f,f.return);break;case 1:qo(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){qe(r,n,m)}}break;case 5:qo(f,f.return);break;case 22:if(f.memoizedState!==null){wp(h);continue}}d!==null?(d.return=f,J=d):wp(h)}c=c.sibling}e:for(c=null,h=e;;){if(h.tag===5){if(c===null){c=h;try{o=h.stateNode,l?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=h.stateNode,u=h.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=rm("display",a))}catch(m){qe(e,e.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(m){qe(e,e.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:xn(t,e),Dn(e),r&4&&yp(e);break;case 21:break;default:xn(t,e),Dn(e)}}function Dn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Ig(n)){var r=n;break e}n=n.return}throw Error(q(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(ra(o,""),r.flags&=-33);var i=gp(e);Hc(e,i,o);break;case 3:case 4:var a=r.stateNode.containerInfo,s=gp(e);$c(e,s,a);break;default:throw Error(q(161))}}catch(u){qe(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ww(e,t,n){J=e,Dg(e)}function Dg(e,t,n){for(var r=(e.mode&1)!==0;J!==null;){var o=J,i=o.child;if(o.tag===22&&r){var a=o.memoizedState!==null||ts;if(!a){var s=o.alternate,u=s!==null&&s.memoizedState!==null||bt;s=ts;var l=bt;if(ts=a,(bt=u)&&!l)for(J=o;J!==null;)a=J,u=a.child,a.tag===22&&a.memoizedState!==null?bp(o):u!==null?(u.return=a,J=u):bp(o);for(;i!==null;)J=i,Dg(i),i=i.sibling;J=o,ts=s,bt=l}xp(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,J=i):xp(e)}}function xp(e){for(;J!==null;){var t=J;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:bt||Fu(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!bt)if(n===null)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:wn(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&rp(t,i,r);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}rp(t,a,n)}break;case 5:var s=t.stateNode;if(n===null&&t.flags&4){n=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&sa(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}bt||t.flags&512&&Vc(t)}catch(f){qe(t,t.return,f)}}if(t===e){J=null;break}if(n=t.sibling,n!==null){n.return=t.return,J=n;break}J=t.return}}function wp(e){for(;J!==null;){var t=J;if(t===e){J=null;break}var n=t.sibling;if(n!==null){n.return=t.return,J=n;break}J=t.return}}function bp(e){for(;J!==null;){var t=J;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Fu(4,t)}catch(u){qe(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(u){qe(t,o,u)}}var i=t.return;try{Vc(t)}catch(u){qe(t,i,u)}break;case 5:var a=t.return;try{Vc(t)}catch(u){qe(t,a,u)}}}catch(u){qe(t,t.return,u)}if(t===e){J=null;break}var s=t.sibling;if(s!==null){s.return=t.return,J=s;break}J=t.return}}var bw=Math.ceil,Ys=hr.ReactCurrentDispatcher,rf=hr.ReactCurrentOwner,dn=hr.ReactCurrentBatchConfig,_e=0,ut=null,Qe=null,vt=0,Ht=0,Xo=qr(0),et=0,ya=null,mo=0,Mu=0,of=0,Yi=null,Ft=null,af=0,vi=1/0,tr=null,Js=!1,Gc=null,Or=null,ns=!1,Rr=null,Zs=0,Ji=0,qc=null,Rs=-1,Is=0;function Pt(){return _e&6?Xe():Rs!==-1?Rs:Rs=Xe()}function Br(e){return e.mode&1?_e&2&&vt!==0?vt&-vt:ow.transition!==null?(Is===0&&(Is=mm()),Is):(e=Re,e!==0||(e=window.event,e=e===void 0?16:_m(e.type)),e):1}function Sn(e,t,n,r){if(50<Ji)throw Ji=0,qc=null,Error(q(185));Na(e,n,r),(!(_e&2)||e!==ut)&&(e===ut&&(!(_e&2)&&(Mu|=n),et===4&&Sr(e,vt)),Wt(e,r),n===1&&_e===0&&!(t.mode&1)&&(vi=Xe()+500,Pu&&Xr()))}function Wt(e,t){var n=e.callbackNode;ox(e,t);var r=Os(e,e===ut?vt:0);if(r===0)n!==null&&Td(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Td(n),t===1)e.tag===0?rw(Cp.bind(null,e)):Um(Cp.bind(null,e)),Zx(function(){!(_e&6)&&Xr()}),n=null;else{switch(gm(r)){case 1:n=Ph;break;case 4:n=pm;break;case 16:n=Ms;break;case 536870912:n=vm;break;default:n=Ms}n=Wg(n,Ag.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Ag(e,t){if(Rs=-1,Is=0,_e&6)throw Error(q(327));var n=e.callbackNode;if(ei()&&e.callbackNode!==n)return null;var r=Os(e,e===ut?vt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=eu(e,r);else{t=r;var o=_e;_e|=2;var i=Mg();(ut!==e||vt!==t)&&(tr=null,vi=Xe()+500,lo(e,t));do try{Ew();break}catch(s){Fg(e,s)}while(!0);$h(),Ys.current=i,_e=o,Qe!==null?t=0:(ut=null,vt=0,t=et)}if(t!==0){if(t===2&&(o=wc(e),o!==0&&(r=o,t=Xc(e,o))),t===1)throw n=ya,lo(e,0),Sr(e,r),Wt(e,Xe()),n;if(t===6)Sr(e,r);else{if(o=e.current.alternate,!(r&30)&&!Cw(o)&&(t=eu(e,r),t===2&&(i=wc(e),i!==0&&(r=i,t=Xc(e,i))),t===1))throw n=ya,lo(e,0),Sr(e,r),Wt(e,Xe()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(q(345));case 2:eo(e,Ft,tr);break;case 3:if(Sr(e,r),(r&130023424)===r&&(t=af+500-Xe(),10<t)){if(Os(e,0)!==0)break;if(o=e.suspendedLanes,(o&r)!==r){Pt(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Rc(eo.bind(null,e,Ft,tr),t);break}eo(e,Ft,tr);break;case 4:if(Sr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,o=-1;0<r;){var a=31-kn(r);i=1<<a,a=t[a],a>o&&(o=a),r&=~i}if(r=o,r=Xe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bw(r/1960))-r,10<r){e.timeoutHandle=Rc(eo.bind(null,e,Ft,tr),r);break}eo(e,Ft,tr);break;case 5:eo(e,Ft,tr);break;default:throw Error(q(329))}}}return Wt(e,Xe()),e.callbackNode===n?Ag.bind(null,e):null}function Xc(e,t){var n=Yi;return e.current.memoizedState.isDehydrated&&(lo(e,t).flags|=256),e=eu(e,t),e!==2&&(t=Ft,Ft=n,t!==null&&Kc(t)),e}function Kc(e){Ft===null?Ft=e:Ft.push.apply(Ft,e)}function Cw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!Rn(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Sr(e,t){for(t&=~of,t&=~Mu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-kn(t),r=1<<n;e[n]=-1,t&=~r}}function Cp(e){if(_e&6)throw Error(q(327));ei();var t=Os(e,0);if(!(t&1))return Wt(e,Xe()),null;var n=eu(e,t);if(e.tag!==0&&n===2){var r=wc(e);r!==0&&(t=r,n=Xc(e,r))}if(n===1)throw n=ya,lo(e,0),Sr(e,t),Wt(e,Xe()),n;if(n===6)throw Error(q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,eo(e,Ft,tr),Wt(e,Xe()),null}function sf(e,t){var n=_e;_e|=1;try{return e(t)}finally{_e=n,_e===0&&(vi=Xe()+500,Pu&&Xr())}}function go(e){Rr!==null&&Rr.tag===0&&!(_e&6)&&ei();var t=_e;_e|=1;var n=dn.transition,r=Re;try{if(dn.transition=null,Re=1,e)return e()}finally{Re=r,dn.transition=n,_e=t,!(_e&6)&&Xr()}}function uf(){Ht=Xo.current,Be(Xo)}function lo(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Jx(n)),Qe!==null)for(n=Qe.return;n!==null;){var r=n;switch(zh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&zs();break;case 3:di(),Be(Lt),Be(St),Qh();break;case 5:Kh(r);break;case 4:di();break;case 13:Be(We);break;case 19:Be(We);break;case 10:Hh(r.type._context);break;case 22:case 23:uf()}n=n.return}if(ut=e,Qe=e=Lr(e.current,null),vt=Ht=t,et=0,ya=null,of=Mu=mo=0,Ft=Yi=null,io!==null){for(t=0;t<io.length;t++)if(n=io[t],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,r.next=a}n.pending=r}io=null}return e}function Fg(e,t){do{var n=Qe;try{if($h(),ks.current=Qs,Ks){for(var r=Ve.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Ks=!1}if(vo=0,st=Ze=Ve=null,Ki=!1,va=0,rf.current=null,n===null||n.return===null){et=1,ya=t,Qe=null;break}e:{var i=e,a=n.return,s=n,u=t;if(t=vt,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=lp(a);if(d!==null){d.flags&=-257,cp(d,a,s,i,t),d.mode&1&&up(i,l,t),t=d,u=l;var p=t.updateQueue;if(p===null){var m=new Set;m.add(u),t.updateQueue=m}else p.add(u);break e}else{if(!(t&1)){up(i,l,t),lf();break e}u=Error(q(426))}}else if(je&&s.mode&1){var y=lp(a);if(y!==null){!(y.flags&65536)&&(y.flags|=256),cp(y,a,s,i,t),Uh(pi(u,s));break e}}i=u=pi(u,s),et!==4&&(et=2),Yi===null?Yi=[i]:Yi.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var v=gg(i,u,t);np(i,v);break e;case 1:s=u;var g=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Or===null||!Or.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t;var w=yg(i,s,t);np(i,w);break e}}i=i.return}while(i!==null)}Bg(n)}catch(b){t=b,Qe===n&&n!==null&&(Qe=n=n.return);continue}break}while(!0)}function Mg(){var e=Ys.current;return Ys.current=Qs,e===null?Qs:e}function lf(){(et===0||et===3||et===2)&&(et=4),ut===null||!(mo&268435455)&&!(Mu&268435455)||Sr(ut,vt)}function eu(e,t){var n=_e;_e|=2;var r=Mg();(ut!==e||vt!==t)&&(tr=null,lo(e,t));do try{_w();break}catch(o){Fg(e,o)}while(!0);if($h(),_e=n,Ys.current=r,Qe!==null)throw Error(q(261));return ut=null,vt=0,et}function _w(){for(;Qe!==null;)Og(Qe)}function Ew(){for(;Qe!==null&&!K1();)Og(Qe)}function Og(e){var t=jg(e.alternate,e,Ht);e.memoizedProps=e.pendingProps,t===null?Bg(e):Qe=t,rf.current=null}function Bg(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=gw(n,t),n!==null){n.flags&=32767,Qe=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{et=6,Qe=null;return}}else if(n=mw(n,t,Ht),n!==null){Qe=n;return}if(t=t.sibling,t!==null){Qe=t;return}Qe=t=e}while(t!==null);et===0&&(et=5)}function eo(e,t,n){var r=Re,o=dn.transition;try{dn.transition=null,Re=1,kw(e,t,n,r)}finally{dn.transition=o,Re=r}return null}function kw(e,t,n,r){do ei();while(Rr!==null);if(_e&6)throw Error(q(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(q(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(ix(e,i),e===ut&&(Qe=ut=null,vt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ns||(ns=!0,Wg(Ms,function(){return ei(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=dn.transition,dn.transition=null;var a=Re;Re=1;var s=_e;_e|=4,rf.current=null,xw(e,n),Pg(n,e),Hx(Sc),Bs=!!kc,Sc=kc=null,e.current=n,ww(n),Q1(),_e=s,Re=a,dn.transition=i}else e.current=n;if(ns&&(ns=!1,Rr=e,Zs=o),i=e.pendingLanes,i===0&&(Or=null),Z1(n.stateNode),Wt(e,Xe()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Js)throw Js=!1,e=Gc,Gc=null,e;return Zs&1&&e.tag!==0&&ei(),i=e.pendingLanes,i&1?e===qc?Ji++:(Ji=0,qc=e):Ji=0,Xr(),null}function ei(){if(Rr!==null){var e=gm(Zs),t=dn.transition,n=Re;try{if(dn.transition=null,Re=16>e?16:e,Rr===null)var r=!1;else{if(e=Rr,Rr=null,Zs=0,_e&6)throw Error(q(331));var o=_e;for(_e|=4,J=e.current;J!==null;){var i=J,a=i.child;if(J.flags&16){var s=i.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(J=l;J!==null;){var c=J;switch(c.tag){case 0:case 11:case 15:Qi(8,c,i)}var h=c.child;if(h!==null)h.return=c,J=h;else for(;J!==null;){c=J;var f=c.sibling,d=c.return;if(Rg(c),c===l){J=null;break}if(f!==null){f.return=d,J=f;break}J=d}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(m!==null)}}J=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,J=a;else e:for(;J!==null;){if(i=J,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Qi(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,J=v;break e}J=i.return}}var g=e.current;for(J=g;J!==null;){a=J;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,J=x;else e:for(a=g;J!==null;){if(s=J,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Fu(9,s)}}catch(b){qe(s,s.return,b)}if(s===a){J=null;break e}var w=s.sibling;if(w!==null){w.return=s.return,J=w;break e}J=s.return}}if(_e=o,Xr(),zn&&typeof zn.onPostCommitFiberRoot=="function")try{zn.onPostCommitFiberRoot(Su,e)}catch{}r=!0}return r}finally{Re=n,dn.transition=t}}return!1}function _p(e,t,n){t=pi(n,t),t=gg(e,t,1),e=Mr(e,t,1),t=Pt(),e!==null&&(Na(e,1,t),Wt(e,t))}function qe(e,t,n){if(e.tag===3)_p(e,e,n);else for(;t!==null;){if(t.tag===3){_p(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Or===null||!Or.has(r))){e=pi(n,e),e=yg(t,e,1),t=Mr(t,e,1),e=Pt(),t!==null&&(Na(t,1,e),Wt(t,e));break}}t=t.return}}function Sw(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Pt(),e.pingedLanes|=e.suspendedLanes&n,ut===e&&(vt&n)===n&&(et===4||et===3&&(vt&130023424)===vt&&500>Xe()-af?lo(e,0):of|=n),Wt(e,t)}function Lg(e,t){t===0&&(e.mode&1?(t=Ga,Ga<<=1,!(Ga&130023424)&&(Ga=4194304)):t=1);var n=Pt();e=lr(e,t),e!==null&&(Na(e,t,n),Wt(e,n))}function Nw(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Lg(e,n)}function Rw(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(t),Lg(e,n)}var jg;jg=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Lt.current)Bt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Bt=!1,vw(e,t,n);Bt=!!(e.flags&131072)}else Bt=!1,je&&t.flags&1048576&&Vm(t,$s,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ns(e,t),e=t.pendingProps;var o=ci(t,St.current);Zo(t,n),o=Jh(null,t,r,e,o,n);var i=Zh();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,jt(r)?(i=!0,Us(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,qh(t),o.updater=Au,t.stateNode=o,o._reactInternals=t,Mc(t,r,e,n),t=Lc(null,t,r,!0,i,n)):(t.tag=0,je&&i&&Wh(t),It(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ns(e,t),e=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=Tw(r),e=wn(r,e),o){case 0:t=Bc(null,t,r,e,n);break e;case 1:t=dp(null,t,r,e,n);break e;case 11:t=hp(null,t,r,e,n);break e;case 14:t=fp(null,t,r,wn(r.type,e),n);break e}throw Error(q(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:wn(r,o),Bc(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:wn(r,o),dp(e,t,r,o,n);case 3:e:{if(Cg(t),e===null)throw Error(q(387));r=t.pendingProps,i=t.memoizedState,o=i.element,Km(e,t),qs(t,r,null,n);var a=t.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=pi(Error(q(423)),t),t=pp(e,t,r,n,o);break e}else if(r!==o){o=pi(Error(q(424)),t),t=pp(e,t,r,n,o);break e}else for(Xt=Fr(t.stateNode.containerInfo.firstChild),Jt=t,je=!0,Cn=null,n=qm(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(hi(),r===o){t=cr(e,t,n);break e}It(e,t,r,n)}t=t.child}return t;case 5:return Qm(t),e===null&&Dc(t),r=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,Nc(r,o)?a=null:i!==null&&Nc(r,i)&&(t.flags|=32),bg(e,t),It(e,t,a,n),t.child;case 6:return e===null&&Dc(t),null;case 13:return _g(e,t,n);case 4:return Xh(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=fi(t,null,r,n):It(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:wn(r,o),hp(e,t,r,o,n);case 7:return It(e,t,t.pendingProps,n),t.child;case 8:return It(e,t,t.pendingProps.children,n),t.child;case 12:return It(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,Te(Hs,r._currentValue),r._currentValue=a,i!==null)if(Rn(i.value,a)){if(i.children===o.children&&!Lt.current){t=cr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){a=i.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=ar(-1,n&-n),u.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),Ac(i.return,n,t),s.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(q(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),Ac(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}It(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Zo(t,n),o=pn(o),r=r(o),t.flags|=1,It(e,t,r,n),t.child;case 14:return r=t.type,o=wn(r,t.pendingProps),o=wn(r.type,o),fp(e,t,r,o,n);case 15:return xg(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:wn(r,o),Ns(e,t),t.tag=1,jt(r)?(e=!0,Us(t)):e=!1,Zo(t,n),mg(t,r,o),Mc(t,r,o,n),Lc(null,t,r,!0,e,n);case 19:return Eg(e,t,n);case 22:return wg(e,t,n)}throw Error(q(156,t.tag))};function Wg(e,t){return dm(e,t)}function Iw(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hn(e,t,n,r){return new Iw(e,t,n,r)}function cf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Tw(e){if(typeof e=="function")return cf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Rh)return 11;if(e===Ih)return 14}return 2}function Lr(e,t){var n=e.alternate;return n===null?(n=hn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ts(e,t,n,r,o,i){var a=2;if(r=e,typeof e=="function")cf(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Lo:return co(n.children,o,i,t);case Nh:a=8,o|=8;break;case ic:return e=hn(12,n,t,o|2),e.elementType=ic,e.lanes=i,e;case ac:return e=hn(13,n,t,o),e.elementType=ac,e.lanes=i,e;case sc:return e=hn(19,n,t,o),e.elementType=sc,e.lanes=i,e;case Qv:return Ou(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Xv:a=10;break e;case Kv:a=9;break e;case Rh:a=11;break e;case Ih:a=14;break e;case _r:a=16,r=null;break e}throw Error(q(130,e==null?e:typeof e,""))}return t=hn(a,n,t,o),t.elementType=e,t.type=r,t.lanes=i,t}function co(e,t,n,r){return e=hn(7,e,r,t),e.lanes=n,e}function Ou(e,t,n,r){return e=hn(22,e,r,t),e.elementType=Qv,e.lanes=n,e.stateNode={isHidden:!1},e}function Rl(e,t,n){return e=hn(6,e,null,t),e.lanes=n,e}function Il(e,t,n){return t=hn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pw(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ll(0),this.expirationTimes=ll(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ll(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function hf(e,t,n,r,o,i,a,s,u){return e=new Pw(e,t,n,s,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=hn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},qh(i),e}function Dw(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bo,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function zg(e){if(!e)return Vr;e=e._reactInternals;e:{if(bo(e)!==e||e.tag!==1)throw Error(q(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(jt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(q(171))}if(e.tag===1){var n=e.type;if(jt(n))return zm(e,n,t)}return t}function Ug(e,t,n,r,o,i,a,s,u){return e=hf(n,r,!0,e,o,i,a,s,u),e.context=zg(null),n=e.current,r=Pt(),o=Br(n),i=ar(r,o),i.callback=t??null,Mr(n,i,o),e.current.lanes=o,Na(e,o,r),Wt(e,r),e}function Bu(e,t,n,r){var o=t.current,i=Pt(),a=Br(o);return n=zg(n),t.context===null?t.context=n:t.pendingContext=n,t=ar(i,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Mr(o,t,a),e!==null&&(Sn(e,o,a,i),Es(e,o,a)),a}function tu(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ep(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function ff(e,t){Ep(e,t),(e=e.alternate)&&Ep(e,t)}function Aw(){return null}var Vg=typeof reportError=="function"?reportError:function(e){console.error(e)};function df(e){this._internalRoot=e}Lu.prototype.render=df.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(q(409));Bu(e,t,null,null)};Lu.prototype.unmount=df.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;go(function(){Bu(null,e,null,null)}),t[ur]=null}};function Lu(e){this._internalRoot=e}Lu.prototype.unstable_scheduleHydration=function(e){if(e){var t=wm();e={blockedOn:null,target:e,priority:t};for(var n=0;n<kr.length&&t!==0&&t<kr[n].priority;n++);kr.splice(n,0,e),n===0&&Cm(e)}};function pf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ju(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function kp(){}function Fw(e,t,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var l=tu(a);i.call(l)}}var a=Ug(t,r,e,0,null,!1,!1,"",kp);return e._reactRootContainer=a,e[ur]=a.current,ca(e.nodeType===8?e.parentNode:e),go(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof r=="function"){var s=r;r=function(){var l=tu(u);s.call(l)}}var u=hf(e,0,!1,null,null,!1,!1,"",kp);return e._reactRootContainer=u,e[ur]=u.current,ca(e.nodeType===8?e.parentNode:e),go(function(){Bu(t,u,n,r)}),u}function Wu(e,t,n,r,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var s=o;o=function(){var u=tu(a);s.call(u)}}Bu(t,a,e,o)}else a=Fw(n,t,e,o,r);return tu(a)}ym=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ui(t.pendingLanes);n!==0&&(Dh(t,n|1),Wt(t,Xe()),!(_e&6)&&(vi=Xe()+500,Xr()))}break;case 13:go(function(){var r=lr(e,1);if(r!==null){var o=Pt();Sn(r,e,1,o)}}),ff(e,1)}};Ah=function(e){if(e.tag===13){var t=lr(e,134217728);if(t!==null){var n=Pt();Sn(t,e,134217728,n)}ff(e,134217728)}};xm=function(e){if(e.tag===13){var t=Br(e),n=lr(e,t);if(n!==null){var r=Pt();Sn(n,e,t,r)}ff(e,t)}};wm=function(){return Re};bm=function(e,t){var n=Re;try{return Re=e,t()}finally{Re=n}};gc=function(e,t,n){switch(t){case"input":if(cc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=Tu(r);if(!o)throw Error(q(90));Jv(r),cc(r,o)}}}break;case"textarea":em(e,n);break;case"select":t=n.value,t!=null&&Ko(e,!!n.multiple,t,!1)}};sm=sf;um=go;var Mw={usingClientEntryPoint:!1,Events:[Ia,Uo,Tu,im,am,sf]},Fi={findFiberByHostInstance:oo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ow={bundleType:Fi.bundleType,version:Fi.version,rendererPackageName:Fi.rendererPackageName,rendererConfig:Fi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=hm(e),e===null?null:e.stateNode},findFiberByHostInstance:Fi.findFiberByHostInstance||Aw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rs.isDisabled&&rs.supportsFiber)try{Su=rs.inject(Ow),zn=rs}catch{}}tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mw;tn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pf(t))throw Error(q(200));return Dw(e,t,null,n)};tn.createRoot=function(e,t){if(!pf(e))throw Error(q(299));var n=!1,r="",o=Vg;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=hf(e,1,!1,null,null,n,!1,r,o),e[ur]=t.current,ca(e.nodeType===8?e.parentNode:e),new df(t)};tn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(q(188)):(e=Object.keys(e).join(","),Error(q(268,e)));return e=hm(t),e=e===null?null:e.stateNode,e};tn.flushSync=function(e){return go(e)};tn.hydrate=function(e,t,n){if(!ju(t))throw Error(q(200));return Wu(null,e,t,!0,n)};tn.hydrateRoot=function(e,t,n){if(!pf(e))throw Error(q(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",a=Vg;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=Ug(t,null,e,1,n??null,o,!1,i,a),e[ur]=t.current,ca(e),r)for(e=0;e<r.length;e++)n=r[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Lu(t)};tn.render=function(e,t,n){if(!ju(t))throw Error(q(200));return Wu(null,e,t,!1,n)};tn.unmountComponentAtNode=function(e){if(!ju(e))throw Error(q(40));return e._reactRootContainer?(go(function(){Wu(null,null,e,!1,function(){e._reactRootContainer=null,e[ur]=null})}),!0):!1};tn.unstable_batchedUpdates=sf;tn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ju(n))throw Error(q(200));if(e==null||e._reactInternals===void 0)throw Error(q(38));return Wu(e,t,n,!1,r)};tn.version="18.3.1-next-f1338f8080-20240426";function $g(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($g)}catch(e){console.error(e)}}$g(),$v.exports=tn;var Bw=$v.exports,Hg,Sp=Bw;Hg=Sp.createRoot,Sp.hydrateRoot;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gg=function(e,t){return(Gg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])})(e,t)};function In(e,t){function n(){this.constructor=e}Gg(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Z(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(l){try{u(r.next(l))}catch(c){i(c)}}function s(l){try{u(r.throw(l))}catch(c){i(c)}}function u(l){l.done?o(l.value):new n(function(c){c(l.value)}).then(a,s)}u((r=r.apply(e,[])).next())})}function ee(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(h){c=[6,h],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var Lw=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,o=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return jw(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0],u=a[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},e}();function jw(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function U(){return qg}var qg=null,nu=new Map,Qc=new Map;function Xg(e,t){var n=Qg(e,t);return nu.get(n)}function Ww(e){return Qc.get(e)}function Np(e){for(var t=nu.entries(),n=[];;){var r=t.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&n.push(s)}return n}function Kg(e){var t=e.kernelName,n=e.backendName,r=Qg(t,n);if(nu.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");nu.set(r,e)}function zw(e){var t=e.kernelName;Qc.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Qc.set(t,e)}function Qg(e,t){return t+"_"+e}function Yc(e,t,n){return Math.max(e,Math.min(t,n))}function Yg(e){return e%2==0?e:e+1}function Uw(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function I(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Ne(e,t,n){n===void 0&&(n=""),I(lt(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function _i(e){I(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function mi(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||Vn(e)&&!n)for(var r=0;r<e.length;++r)mi(e[r],t,n);else t.push(e);return t}function te(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function lt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ke(e){return e%1==0}function Vw(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Jc(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ti(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Rp(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=t(i);n!=null&&i>=n?o():setTimeout(a,s)}};a()})}function $w(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function it(e,t){var n=t.length;return I((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),I(e.every(function(r){return Ke(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function ro(e,t){for(var n=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||o?null:it(t,e).sort(),a=0,s=0;s<e.length;++s){if(i!=null){if(i[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(i[a]==null||i[a]>s)&&e[s]===1&&(n.push(e[s]),r.push(s)),i[a]<=s&&a++}e[s]!==1&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function xa(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function ru(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Hw(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Gw(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function qw(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function Vn(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Jg(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function Xw(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function vf(e){return typeof e=="string"||e instanceof String}function Kw(e){return typeof e=="boolean"}function Qw(e){return typeof e=="number"}function Pa(e){return Array.isArray(e)?Pa(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Qw(e)?"float32":vf(e)?"string":Kw(e)?"bool":"float32"}function Zc(e){return!!(e&&e.constructor&&e.call&&e.apply)}function eh(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function $n(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Zg(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=mi(e)),n&&Hw(e,t),function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function Ip(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,o){return r*o});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],l=0;l<u;l++)s[l]=a[o+l];else{u=i[0];var c=i.slice(1),h=c.reduce(function(f,d){return f*d});for(l=0;l<u;l++)s[l]=r(o+l*h,c,a)}return s}(0,e,t)}function e0(e,t){for(var n=Da(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Da(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function On(){return U().platform.now()}function t0(e){e.forEach(function(t){I(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function Yw(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",U().platform.encode(e,t)}function ou(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",U().platform.decode(e,t)}function Tp(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function Jw(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}var Zw=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new e2)}return e.prototype.profileKernel=function(t,n,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var d=l[f];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+h+"'"),!0}})(u,s.dtype,t),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),i.logger.logKernelProfile(t,s,u,l.kernelMs,n,c)})})}),o},e}(),e2=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,i,a){var s=typeof o=="number"?ti(o+"ms",9):o.error,u=ti(t,25),l=n.rank,c=n.size,h=ti(n.shape.toString(),14),f="";for(var d in i){var p=i[d].shape||n.shape,m=p.length;f+=d+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),Pp=20,Mi=3,Tl=7;function t2(e,t,n,r){var o=$n(t),i=function(l,c,h,f){var d=te(c),p=f[f.length-1],m=new Array(p).fill(0),y=c.length,v=h==="complex64"?Bi(l):l;if(y>1)for(var g=0;g<d/p;g++)for(var x=g*p,w=0;w<p;w++)m[w]=Math.max(m[w],Oi(v[x+w],0,h).length);return m}(e,t,n,o),a=t.length,s=function l(c,h,f,d,p,m){m===void 0&&(m=!0);var y=f==="complex64"?2:1,v=h[0],g=h.length;if(g===0)return f==="complex64"?[Oi(Bi(c)[0],0,f)]:f==="bool"?[n0(c[0])]:[c[0].toString()];if(g===1){if(v>Pp){var x=Mi*y,w=Array.from(c.slice(0,x)),b=Array.from(c.slice((v-Mi)*y,v*y));return f==="complex64"&&(w=Bi(w),b=Bi(b)),["["+w.map(function(j,$){return Oi(j,p[$],f)}).join(", ")+", ..., "+b.map(function(j,$){return Oi(j,p[v-Mi+$],f)}).join(", ")+"]"]}return["["+(f==="complex64"?Bi(c):Array.from(c)).map(function(j,$){return Oi(j,p[$],f)}).join(", ")+"]"]}var C=h.slice(1),S=d.slice(1),E=d[0]*y,R=[];if(v>Pp){for(var N=0;N<Mi;N++){var P=(D=N*E)+E;R.push.apply(R,l(c.slice(D,P),C,f,S,p,!1))}for(R.push("..."),N=v-Mi;N<v;N++)P=(D=N*E)+E,R.push.apply(R,l(c.slice(D,P),C,f,S,p,N===v-1))}else for(N=0;N<v;N++){var D;P=(D=N*E)+E,R.push.apply(R,l(c.slice(D,P),C,f,S,p,N===v-1))}var z=g===2?",":"";for(R[0]="["+R[0]+z,N=1;N<R.length-1;N++)R[N]=" "+R[N]+z;var W=`,
`;for(N=2;N<g;N++)W+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(m?"":W),R}(e,t,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Oi(e,t,n){return ti(Array.isArray(e)?parseFloat(e[0].toFixed(Tl))+" + "+parseFloat(e[1].toFixed(Tl))+"j":vf(e)?"'"+e+"'":n==="bool"?n0(e):parseFloat(e.toFixed(Tl)).toString(),t)}function n0(e){return e===0?"false":"true"}function Bi(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var wa=function(){function e(t,n,r){var o=this;if(this.dtype=n,this.shape=t.slice(),this.size=te(t),r!=null){var i=r.length;I(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ru(n,this.size),this.strides=$n(t)}return e.prototype.set=function(t){for(var n=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),I(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var i=this.locToIndex(r);this.values[i]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,o=0,i=t;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Ln().makeTensor(this.values,this.shape,this.dtype)},e}(),Ln=null,L=null,r0=null,ze=function(){function e(t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=te(t),this.strides=$n(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),I(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,i){return this.throwIfDisposed(),this.reshape([t,n,r,o,i])},e.prototype.asType=function(t){return this.throwIfDisposed(),L.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return Z(this,void 0,void 0,function(){var t;return ee(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,L.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return L.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return Z(this,void 0,void 0,function(){var t;return ee(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,Ip(this.shape,t)]}})})},e.prototype.arraySync=function(){return Ip(this.shape,this.dataSync())},e.prototype.data=function(){return Z(this,void 0,void 0,function(){var t,n;return ee(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=Ln().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(o){return ou(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=Ln().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return ou(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return Z(this,void 0,void 0,function(){var t;return ee(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,Ln().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Ln().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),L.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),L.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),L.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),L.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),L.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),L.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),L.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),t2(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),L.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),L.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),L.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),L.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),L.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),L.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),L.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),L.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),L.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),L.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),L.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),L.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,i){return r===void 0&&(r=.001),r0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,i,o,r)},e.prototype.batchNorm=function(t,n,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),L.batchNorm(this,t,n,r,o,i)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),L.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),L.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),L.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),L.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),L.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),L.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),L.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),L.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),L.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),L.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),L.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),L.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),L.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),L.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),L.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),L.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),L.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),L.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),L.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),L.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),L.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),L.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),L.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),L.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),L.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),L.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),L.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),L.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),L.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),L.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),L.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),L.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),L.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),L.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),L.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),L.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),L.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),L.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),L.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),L.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),L.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),L.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),L.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),L.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),L.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),L.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),L.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),L.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),L.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),L.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),L.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),L.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),L.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),L.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),L.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),L.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),L.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),L.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),L.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),L.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),L.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),L.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),L.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),L.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),L.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),L.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),L.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),L.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),L.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),L.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),L.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),L.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),L.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),L.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),L.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),L.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),L.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),L.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),L.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),L.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),L.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),L.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),L.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),L.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),L.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),L.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),L.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),L.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),L.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),L.conv1d(this,t,n,r,o,i,a)},e.prototype.conv2d=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),L.conv2d(this,t,n,r,o,i,a)},e.prototype.conv2dTranspose=function(t,n,r,o,i){return this.throwIfDisposed(),L.conv2dTranspose(this,t,n,r,o,i)},e.prototype.depthwiseConv2D=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),L.depthwiseConv2d(this,t,n,r,o,i,a)},e.prototype.separableConv2d=function(t,n,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),L.separableConv2d(this,t,n,r,o,i,a)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),L.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),L.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),L.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,i){return this.throwIfDisposed(),L.pool(this,t,n,r,o,i)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),Ln().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),L.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),L.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),L.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),L.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),L.stridedSlice(this,t,n,r,o,i,a,s,u)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),L.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),L.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),L.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),L.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),L.spectral.irfft(this)},e}();Object.defineProperty(ze,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var Dp,th,nh,rh,oh,gi=function(e){function t(n,r,o,i){var a=e.call(this,n.shape,n.dtype,n.dataId,i)||this;return a.trainable=r,a.name=o,a}return In(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!lt(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Ln().disposeTensor(this),this.dataId=n.dataId,Ln().incRef(this,null)},t.prototype.dispose=function(){Ln().disposeVariable(this),this.isDisposedInternal=!0},t}(ze);Object.defineProperty(gi,Symbol.hasInstance,{value:function(e){return e instanceof ze&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Dp||(Dp={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(th||(th={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(nh||(nh={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(rh||(rh={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(oh||(oh={}));var n2={float32:rh,int32:th,bool:nh,complex64:oh};function dt(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return n2[e][t]}function Pl(e){return dt(e,"int32")}function He(e,t){if(e.dtype===t.dtype)return[e,t];var n=dt(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function r2(e,t){I(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function o0(e){var t=[];return function n(r,o,i){if(r!=null){if(r instanceof ze)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];i.has(l)||(i.add(l),n(l,o,i))}}}}(e,t,new Set),t}var Dl,Ap=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),o2=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ap}return e.prototype.ready=function(){return Z(this,void 0,void 0,function(){var t,n,r;return ee(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,o.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return Z(this,void 0,void 0,function(){var n,r,o;return ee(this,function(i){switch(i.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Zw(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;Np(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;Np(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<n.pendingBackendInitId)&&(n.registry[t]=s,n.pendingBackendInit=null,!0)}).catch(function(s){return!(i<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),o=r.backend,i=this.readSync(n);o.disposeData(n),r.backend=t,t.move(n,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,o=this,i=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(i){throw n(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(o){return{x:function(){return o.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,o,i){return this.runKernelFunc(null,n,null,t,r,o,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-n-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,o,i,a,s){var u,l=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var c=[],h=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var f,d=function(g){h&&(c=g.map(function(x){return l.keep(l.clone(x))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,v=Xg(o,this.backendName);return f=v!=null?function(){var g=l.backend.numDataIds();y=v.kernelFunc({inputs:n,attrs:i,backend:l.backend});var x=Array.isArray(y)?y:[y];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,g,x);var w=x.map(function(C){var S=C.dataId,E=C.shape,R=C.dtype;return l.makeTensorFromDataId(S,E,R)}),b=w.filter(function(C,S){return s[S]});return d((a||[]).slice().concat(b)),w}:function(){var g=l.backend.numDataIds();y=l.tidy(function(){return t(l.backend,d)});var x=Array.isArray(y)?y:[y];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,g,x),x},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,n,function(){return f()}):f()}),h&&this.addTapeNode(o,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(g){return n[g].shape}),outputShapes:u.map(function(g){return g.shape})}),Array.isArray(y)?u:u[0]},e.prototype.makeTensor=function(t,n,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=t;r==="string"&&vf(t[0])&&(i=t.map(function(c){return Yw(c)}));var a=o.write(i,n,r),s=new ze(n,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),l=Xw(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},e.prototype.makeTensorFromDataId=function(t,n,r,o){var i=new ze(n,r=r||"float32",t,this.nextTensorId());return this.incRef(i,o),i},e.prototype.makeVariable=function(t,n,r,o){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var i=new gi(t,n,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*Jg(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof gi||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return Z(this,void 0,void 0,function(){var n,r;return ee(this,function(o){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:i},u=Ww(t);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(l){return l=l.map(function(c,h){if(c==null){var f=r[h],d=Da(f.size,f.dtype);return a.makeTensor(d,f.shape,f.dtype)}return c}),o(l.length>1?l:l[0],i)}),this.state.activeTape.push(s)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=o0(t),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||n.track(u)})},e.prototype.gradients=function(t,n,r,o){var i=this;if(o===void 0&&(o=!1),I(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});I(a instanceof ze,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var h={},f={},d=0;d<l.length;d++)h[l[d].id]=!0;for(d=0;d<u.length;d++){var p=(C=u[d]).inputs;for(var m in p){for(var y=p[m],v=!1,g=0;g<l.length;g++)if(h[y.id]){C.outputs.forEach(function(N){return h[N.id]=!0}),v=!0,f[C.id]=!0;break}if(v)break}}var x={};x[c.id]=!0;var w={};for(d=u.length-1;d>=0;d--)for(p=(C=u[d]).inputs,g=0;g<C.outputs.length;g++)if(x[C.outputs[g].id]){for(var m in p)x[p[m].id]=!0,w[C.id]=!0;break}var b=[];for(d=0;d<u.length;d++){var C;if(f[(C=u[d]).id]&&w[C.id]){var S={};for(var m in C.inputs){var E=C.inputs[m];h[E.id]&&(S[m]=E)}var R=Object.assign({},C);R.inputs=S,R.outputs=C.outputs,b.push(R)}}return b}(this.state.activeTape,n,a);if(!o&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=e0(te(u),"float32"),A.makeTensor(l,u,"float32")),function(f,d,p){for(var m=function(v){var g=d[v],x=[];if(g.outputs.forEach(function(S){var E=f[S.id];E!=null?x.push(E):x.push(null)}),g.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+g.kernelName+".");var w=g.gradient(x),b=function(S){if(!(S in w))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(w)+".");var E=p(function(){return w[S]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+g.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+E.dtype+"'");var R=g.inputs[S];if(!lt(E.shape,R.shape))throw new Error("Error in gradient for op "+g.kernelName+". The gradient of input '"+S+"' has shape '"+E.shape+"', which does not match the shape of the input '"+R.shape+"'");if(f[R.id]==null)f[R.id]=E;else{var N=f[R.id];f[R.id]=N.add(E),N.dispose()}};for(var C in g.inputs)b(C)},y=d.length-1;y>=0;y--)m(y)}(c,s,function(f){return i.tidy(f)});var h=n.map(function(f){return c[f.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(f){for(var d=0,p=f.saved;d<p.length;d++)p[d].dispose()}),i.state.activeTape=null),{value:a,grads:h}})},e.prototype.customGrad=function(t){var n=this;return I(Zc(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];I(o.every(function(s){return s instanceof ze}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),n.runKernelFunc(function(s,u){return I((r=t.apply(void 0,o.concat([u]))).value instanceof ze,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I(Zc(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];I(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I(c.every(function(f){return f instanceof ze}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,d){h[d]=function(){return f}}),h})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return Z(this,void 0,void 0,function(){var n,r;return ee(this,function(o){switch(o.label){case 0:return n=On(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=On()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ap,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),A=function(){var e=function(){if(Dl==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Dl=n}return Dl}();if(e._tfengine==null){var t=new Lw(e);e._tfengine=new o2(t)}return function(n){qg=n}(e._tfengine.ENV),Ln=function(){return e._tfengine},e._tfengine}();function i0(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Zn=U();Zn.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Zn.registerFlag("IS_BROWSER",function(){return i0()}),Zn.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Zn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Zn.registerFlag("PROD",function(){return!1}),Zn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Zn.getBool("DEBUG")}),Zn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Zn.registerFlag("IS_TEST",function(){return!1});var ba,Kt,qt,to={},Al={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function i2(e,t){to[e]=t}function qn(e){e in to||(to[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete to[n]},!1),n===1?r.getContext("webgl",Al)||r.getContext("experimental-webgl",Al):r.getContext("webgl2",Al)}(e));var t=to[e];return t.isContextLost()?(delete to[e],qn(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),to[e])}function zu(e,t){return[t,e]}function Zi(e){var t=te(e);return Jc(Math.ceil(t/4))}function Aa(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function mf(e,t){var n,r,o,i,a,s,u,l,c,h=e;return U().getNumber("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,o=h.RGBA16F,i=h.RGBA32F,a=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,i=h.RGBA,a=e.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function re(e,t,n){var r=n();return t&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+l2(o,i))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(ba||(ba={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Kt||(Kt={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(qt||(qt={}));var a2=596e-10,s2=65504;function u2(e){return!!(U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||a2<Math.abs(e)&&Math.abs(e)<s2)}function l2(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function os(e,t,n){return fr(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function c2(e,t,n){var r=fr(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(re(e,t,function(){return e.shaderSource(r,n)}),re(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function h2(e,t,n){var r=fr(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(re(e,t,function(){return e.shaderSource(r,n)}),re(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(o,i){var a=f2.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),l=u.length.toString().length+2,c=u.map(function(y,v){return ti((v+1).toString(),l)+y}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var d=c.slice(0,s-1),p=c.slice(s-1,s),m=c.slice(s);console.log(d.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+ti(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Fl,Ml,f2=/ERROR: [0-9]+:([0-9]+):/g;function d2(e,t){return fr(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function p2(e,t,n){if(re(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Ol(e,t,n){if(re(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function v2(e,t,n){var r=fr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return re(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),re(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function m2(e,t,n){var r=fr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return re(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),re(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function g2(e,t){return fr(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function y2(e,t){var n=U().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function x2(e,t){return fr(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Fp(e,t,n,r,o,i,a,s){var u=e.getAttribLocation(n,r);return u!==-1&&(re(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),re(e,t,function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)}),re(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function w2(e,t,n,r){k2(e,r),re(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function b2(e,t,n,r){return fr(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function C2(e,t,n){return e.getUniformLocation(t,n)}function _2(e,t,n,r,o,i){re(e,t,function(){return w2(e,t,r,i)}),re(e,t,function(){return e.uniform1i(o,i)})}function Bl(e,t,n,r){re(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),re(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function Mp(e,t,n){re(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),re(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function is(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+E2(e,t))}function E2(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function fr(e,t,n,r){var o=re(e,t,function(){return n()});if(o==null)throw new Error(r);return o}function k2(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function iu(e,t){return t===void 0&&(t=2),te(e.slice(0,e.length-t))}function au(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ll(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[iu(e)].concat(au(e))),t}function S2(e,t){var n;t===void 0&&(t=!1);var r=U().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(l,c){return c>=e.length-2?Yg(e[c]):e[c]})).length===1&&(e=[2,e[0]])),e.length!==2){var o=ro(e);e=o.newShape}var i=te(e);if(e.length<=1&&i<=r)return[1,i];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var a=iu(e),s=2,u=2;return e.length&&(s=(n=au(e))[0],u=n[1]),Jc(i=a*(s/2)*(u/2)).map(function(l){return 2*l})}return Jc(i)}function as(e){return e%2==0}function ss(e,t){if(lt(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||as(n)&&as(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&as(e[0])&&as(t[0])}function N2(e){if(Fl==null){var t=qn(e);Fl=t.getParameter(t.MAX_TEXTURE_SIZE)}return Fl}function R2(e){if(Ml==null){var t=qn(e);Ml=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ml)}function I2(e){if(e===0)return 0;var t=qn(e);return fn(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:fn(t,"EXT_disjoint_timer_query")?1:0}function fn(e,t){return e.getExtension(t)!=null}function Op(e){try{if(qn(e)!=null)return!0}catch{return!1}return!1}function T2(e){if(e===0)return!1;var t=qn(e);if(e===1){if(!fn(t,"OES_texture_float"))return!1}else if(!fn(t,"EXT_color_buffer_float"))return!1;return ih(t)}function P2(e){if(e===0)return!1;var t=qn(e);if(e!==1){if(fn(t,"EXT_color_buffer_float"))return ih(t);if(fn(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=mf(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(t,n)}return!1}return!!fn(t,"OES_texture_float")&&!!fn(t,"WEBGL_color_buffer_float")&&ih(t)}function ih(e){var t=mf(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function D2(e){return e===2&&qn(e).fenceSync!=null}var le=U();function a0(e){U().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Y(e,t){return A.tidy(e,t)}function zt(e){o0(e).forEach(function(t){return t.dispose()})}function A2(e){return A.keep(e)}function su(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];U().getBool("IS_TEST")||console.warn.apply(console,e)}function Kr(e,t){var n=e;if(Vn(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Vn(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&U().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Vn(i))return void I(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});I(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),I(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),l=0;l<i.length;++l)o(i[l],u,s.concat(l))}(e,r,[]),r}function Bp(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function k(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof ze)return Bp(r,e.dtype,t,n),e;var o=Pa(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Bp(r,o,t,n),e==null||!Vn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var i=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Kr(e,o);Vn(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?Zg(e,o,U().getBool("DEBUG")):mi(e,[],!0);return A.makeTensor(s,a,o)}function uu(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(o,i){return k(o,t+"["+i+"]",n)},r)}function s0(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function F2(e,t,n){for(var r=e.length+t.length,o=[],i=0,a=0,s=0;s<r;s++)n.indexOf(s)===-1?o.push(e[i++]):o.push(t[a++]);return o}function wt(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(i){return e[i]})]}function Ut(e,t){return F2(e,t.map(function(n){return 1}),t)}function Gt(e,t,n){I(s0(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function Xn(e,t){if(s0(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function gf(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function Kn(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function M2(e,t){var n=e[0].length;e.forEach(function(o,i){I(o.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+n+")"})}),I(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(o,i){for(var a=0;a<n;a++)I(a===t||o[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function yi(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function T(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];A.startScope(n);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),A.endScope(s),s}catch(u){throw A.endScope(null),u}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}le.registerFlag("HAS_WEBGL",function(){return le.getNumber("WEBGL_VERSION")>0}),le.registerFlag("WEBGL_VERSION",function(){return Op(2)?2:Op(1)?1:0}),le.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return le.get("WEBGL_VERSION")===2}),le.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),le.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),le.registerFlag("WEBGL_PACK",function(){return le.getBool("HAS_WEBGL")}),le.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_CLIP",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),le.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_REDUCE",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_LAZILY_UNPACK",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_CONV_IM2COL",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return N2(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return R2(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=le.getNumber("WEBGL_VERSION");return e===0?0:I2(e)}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return le.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),le.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return T2(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!le.getBool("WEBGL_FORCE_F16_TEXTURES")&&le.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),le.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return P2(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return D2(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return le.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),r0=a0;var ft=T({complex_:function(e,t){var n=k(e,"real","complex"),r=k(t,"imag","complex");return Ne(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),A.runKernelFunc(function(o){return o.complex(n,r)},{$real:n,$imag:r})}}),cn=T({real_:function(e){var t=k(e,"input","real");return A.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),jn=T({imag_:function(e){var t=k(e,"input","imag");return A.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function pt(e,t,n){return Qr(e,t,Kr(e,n),n)}function Qr(e,t,n,r){if(r==null&&(r=Pa(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Vn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){t0(t);var o=te(t),i=te(n);I(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==te(t.slice(a));I(n[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Vn(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?Zg(e,r,U().getBool("DEBUG")):mi(e,[],!0),A.makeTensor(e,t,r)}function K(e,t){if((Vn(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Vn(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Qr(e,[],[],t)}function Ye(e,t){_i(e);var n=Kr(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Qr(e,null,n,t)}function jr(e,t,n){if(_i(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Kr(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Qr(e,t,r,n)}function yf(e,t,n){if(_i(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Kr(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Qr(e,t,r,n)}function Mt(e,t,n){if(_i(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Kr(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Qr(e,t,r,n)}function O2(e,t,n){if(_i(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Kr(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Qr(e,t,r,n)}function B2(e,t,n){if(_i(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Kr(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Qr(e,t=t||r,r,n)}function L2(e,t,n,r){return t===void 0&&(t=!0),A.makeVariable(e,t,n,r)}function Ei(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Ei(e,"float32"),r=Oe(e,"float32");return ft(n,r)}var o=e0(te(e),t);return A.makeTensor(o,e,t)}function Oe(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Oe(e,"float32"),r=Oe(e,"float32");return ft(n,r)}var o=Da(te(e),t);return A.makeTensor(o,e,t)}function Hn(e,t,n){return A.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function j2(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return A.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function lu(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Oe([0],r);var o=Da(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return Ye(o,r)}var u0=T({onesLike_:function(e){var t=k(e,"x","onesLike");if(t.dtype==="complex64"){var n=u0(cn(t)),r=Ce(jn(t));return ft(n,r)}return A.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,i){return{$x:function(){return Ce(o)}}})}}),Ce=T({zerosLike_:function(e){var t=k(e,"x","zerosLike");return A.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return Ce(n)}}})}}),tt=T({concat_:function(e,t){t===void 0&&(t=0),I(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=uu(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=it(t,n[0].shape)[0];var r=yi(n.map(function(s){return s.shape}),t);if(te(r)===0)return pt([],r);if((n=n.filter(function(s){return s.size>0})).length===1)return n[0];var o=n.map(function(s){return s.shape});M2(o,t);var i=n,a={axis:t};return A.runKernelFunc(function(s){return s.concat(n,t)},i,function(s){var u=o.map(function(l){return l[t]});return xf(s,u,t).map(function(l){return function(){return l}})},"Concat",a)}}),W2=T({concat1d_:function(e){return tt(e,0)}}),z2=T({concat2d_:function(e,t){return tt(e,t)}}),U2=T({concat3d_:function(e,t){return tt(e,t)}}),V2=T({concat4d_:function(e,t){return tt(e,t)}}),xf=T({split_:function(e,t,n){n===void 0&&(n=0);var r,o=k(e,"x","split");return n=it(n,o.shape)[0],typeof t=="number"?(I(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(I(o.shape[n]===t.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),A.runKernelFunc(function(i){return i.split(o,r,n)},{$x:o},function(i){return{$x:function(){return tt(i,n)}}})}});function Co(e,t){return e(t={exports:{}},t.exports),t.exports}var $2=Co(function(e){(function(t,n,r){function o(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var d=.02519603282416938*(u+=h.charCodeAt(f));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new o(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.alea=a})(0,e)}),H2=Co(function(e){(function(t,n,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.xor128=a})(0,e)}),G2=Co(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.xorwow=a})(0,e)}),q2=Co(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.xorshift7=a})(0,e)}),X2=Co(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,d=u.i;return u.w=h=h+1640531527|0,c=f[d+34&127],l=f[d=d+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[d]=c^l,u.i=d,c+(h^h>>>16)|0},function(l,c){var h,f,d,p,m,y=[],v=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,v=Math.max(v,c.length)),d=0,p=-32;p<v;++p)c&&(f^=c.charCodeAt((p+32)%c.length)),p===0&&(m=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(m=m+1640531527|0,d=(h=y[127&p]^=f+m)==0?d+1:0);for(d>=128&&(y[127&(c&&c.length||0)]=-1),d=127,p=512;p>0;--p)f=y[d+34&127],h=y[d=d+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,y[d]=f^h;l.w=m,l.X=y,l.i=d}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.xor4096=a})(0,e)}),K2=Co(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var h=u.b,f=u.c,d=u.d,p=u.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-d|0,u.d=d<<16^f>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&i(c,l),h.state=function(){return i(l,{})}),h}n&&n.exports?n.exports=a:this.tychei=a})(0,e)}),no=Co(function(e){(function(t,n){var r,o=this,i=256,a=6,s="random",u=n.pow(i,a),l=n.pow(2,52),c=2*l,h=i-1;function f(v,g,x){var w=[],b=m(function E(R,N){var P,D=[],z=typeof R;if(N&&z=="object")for(P in R)try{D.push(E(R[P],N-1))}catch{}return D.length?D:z=="string"?R:R+"\0"}((g=g==1?{entropy:!0}:g||{}).entropy?[v,y(t)]:v??function(){try{var E;return r&&(E=r.randomBytes)?E=E(i):(E=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(E)),y(E)}catch{var R=o.navigator,N=R&&R.plugins;return[+new Date,o,N,o.screen,y(t)]}}(),3),w),C=new d(w),S=function(){for(var E=C.g(a),R=u,N=0;E<l;)E=(E+N)*i,R*=i,N=C.g(1);for(;E>=c;)E/=2,R/=2,N>>>=1;return(E+N)/R};return S.int32=function(){return 0|C.g(4)},S.quick=function(){return C.g(4)/4294967296},S.double=S,m(y(C.S),t),(g.pass||x||function(E,R,N,P){return P&&(P.S&&p(P,C),E.state=function(){return p(C,{})}),N?(n[s]=E,R):E})(S,b,"global"in g?g.global:this==n,g.state)}function d(v){var g,x=v.length,w=this,b=0,C=w.i=w.j=0,S=w.S=[];for(x||(v=[x++]);b<i;)S[b]=b++;for(b=0;b<i;b++)S[b]=S[C=h&C+v[b%x]+(g=S[b])],S[C]=g;(w.g=function(E){for(var R,N=0,P=w.i,D=w.j,z=w.S;E--;)R=z[P=h&P+1],N=N*i+z[h&(z[P]=z[D=h&D+R])+(z[D]=R)];return w.i=P,w.j=D,N})(i)}function p(v,g){return g.i=v.i,g.j=v.j,g.S=v.S.slice(),g}function m(v,g){for(var x,w=v+"",b=0;b<w.length;)g[h&b]=h&(x^=19*g[h&b])+w.charCodeAt(b++);return y(g)}function y(v){return String.fromCharCode.apply(0,v)}if(n["seed"+s]=f,m(n.random(),t),e.exports){e.exports=f;try{r=require("crypto")}catch{}}})([],Math)});no.alea=$2,no.xor128=H2,no.xorwow=G2,no.xorshift7=q2,no.xor4096=X2,no.tychei=K2;var Uu=no.alea,wf=function(){function e(t,n,r,o,i){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Uu(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),Q2=function(){function e(t,n,r,o){this.alpha=t,this.beta=1/n,this.dtype=r;var i=o||Math.random();this.randu=Uu(i.toString()),this.randn=new wf(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,n=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-a+Math.log(a)),(i=this.randu())<n||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),Y2=function(){function e(t,n,r,o){var i=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=Uu(o)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function he(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",t0(e),new wa(e,t,n)}function J2(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var l0=T({batchToSpaceND_:function(e,t,n){var r=k(e,"x","batchToSpaceND"),o=t.reduce(function(i,a){return i*a});return I(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),I(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),I(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),A.runKernelFunc(function(i){return i.batchToSpaceND(r,t,n)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,n)}}})}}),Z2=T({broadcastTo_:function(e,t){var n=k(e,"broadcastTo","x"),r=n.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(t),a=t.length-1;a>=0;a--)if(n.shape[a]===t[a])i[a]=1;else if(n.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?n.clone():A.runKernelFunc(function(u){return u.tile(n,i)},{input:n},function(u){return{input:function(){return u.sum(s,!0)}}})}}),eb=T({cast_:function(e,t){var n=k(e,"x","cast");if(!Gw(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return A.runKernelFunc(function(o){return o.cast(n,t)},{x:n},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),tb=T({clone_:function(e){var t=k(e,"x","clone",null);return A.runKernelFunc(function(){return A.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),nb=T({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=k(e,"x","cumsum"),i=Xn([t|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=Kn(1,o.rank)[0],u=A.runKernelFunc(function(l){return l.cumsum(a,s,n,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(t,n,!r)}}});return i!=null&&(u=u.transpose(i)),u}}),rb=T({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=k(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],a=n==="NHWC"?r.shape[3]:r.shape[1];return I(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),I(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape}),I(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape}),A.runKernelFunc(function(s){return s.depthToSpace(r,t,n)},{$x:r})}}),ln=T({expandDims_:function(e,t){t===void 0&&(t=0);var n=k(e,"x","expandDims",null);I(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(I(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),En(n,r)}}),c0=T({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=he([e,t],r),i=e<=t?e:t,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,t);if(n==null)return s;if(n.length===1)return ni(ln(s,0),[n[0],1,1]);if(n.length===2)return ni(ln(ln(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return ni(ln(ln(ln(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),ob=T({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var o=k(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=a===1?o.as2D(1,-1):o,u=A.runKernelFunc(function(l){return l.multinomial(s,r,t,n)},{logits2D:s});return a===1?u.as1D():u}}),ah=T({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=k(e,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),A.runKernelFunc(function(a){return a.oneHot(o,t,n,r)},{$indices:o},function(a){return{$indices:function(){return Oe(o.shape,"float32")}}}).reshape(i)}}),_o=T({pad_:function(e,t,n){n===void 0&&(n=0);var r=k(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return A.runKernelFunc(function(i){return i.pad(r,t,n)},{x:r},function(i){var a=t.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",o)}}),ib=T({pad1d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),_o(e,[t],n)}}),ab=T({pad2d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_o(e,t,n)}}),sb=T({pad3d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_o(e,t,n)}}),ub=T({pad4d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_o(e,t,n)}}),lb=T({rand_:function(e,t,n){var r=te(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return A.makeTensor(o,e,n)}}),cb=T({randomNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new wf(t,n,r,!1,o),a=he(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),hb=T({randomGamma_:function(e,t,n,r,o){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new Q2(t,n,r,o),a=he(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),h0=T({randomUniform_:function(e,t,n,r,o){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var i=he(e,r),a=new Y2(t,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),En=T({reshape_:function(e,t){var n=k(e,"x","reshape",null);t=$w(t,n.size),I(n.size===te(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return A.runKernelFunc(function(o){return o.reshape(n,t)},{x:n},function(o){return{x:function(){return o.reshape(n.shape)}}},"Reshape",r)}}),f0=T({spaceToBatchND_:function(e,t,n){var r=k(e,"x","spaceToBatchND");return I(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),I(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),I(r.shape.reduce(function(o,i,a){return a>0&&a<=t.length?o&&(i+n[a-1][0]+n[a-1][1])%t[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),A.runKernelFunc(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}}),d0=T({squeeze_:function(e,t){var n=k(e,"x","squeeze");return En(n,ro(n.shape,t).newShape)}}),Zt=T({stack_:function(e,t){t===void 0&&(t=0);var n=uu(e,"tensors","stack");if(I(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;I(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(s){Ne(o,s.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(s){I(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(s){return s.expandDims(t)});return tt(a,t)}}),ni=T({tile_:function(e,t){var n=k(e,"x","tile",null);I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return A.runKernelFunc(function(i,a){var s=i.tile(n,t);return a([n]),s},{x:n},function(i,a){var s=a[0];return{x:function(){var u=Ce(s);if(s.rank===1)for(var l=0;l<t[0];++l)u=u.add(i.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(i.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var h=0;h<t[2];++h)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(h=0;h<t[2];++h)for(var f=0;f<t[3];++f)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],h*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,r)}}),fb=T({truncatedNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new wf(t,n,r,!0,o),a=he(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),nt=T({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=k(e,"x","unstack");I(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return A.runKernelFunc(function(o){return o.unstack(n,t)},{x:n},function(o){return{x:function(){return Zt(o,t)}}},"Unpack",r)}}),db=function(e,t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,h;return ee(this,function(f){switch(f.label){case 0:return n=k(e,"x","setdiff1d"),r=k(t,"y","setdiff1d"),I(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),I(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),I(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new wa([s],n.dtype),l=new wa([s],"int32"),c=0,h=0;c<o.length;c++)a.has(o[c])||(u.values[h]=o[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function cu(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,a=0;a<i;++a)o=o.concat([e[a+1]/t[a],t[a]]);o=o.concat(e.slice(i+1))}return o}function hu(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function fu(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function p0(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function v0(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function m0(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=e.shape,s=n.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var l=$n(e.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var g0=30;function jl(e){return e<=g0?e:eh(e,Math.floor(Math.sqrt(e)))}function pb(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==t.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function vb(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}pb(n,t,e)}function du(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:te(t.shape)/u,sliceSize:a,strides:$n(n.slice(0,o)).concat([1]),outputSize:te(n)}}function mb(e,t,n){I(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),I(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(i){I(t[i]+n[i]<=e.shape[i],function(){return"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+n[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")"})},o=0;o<e.rank;++o)r(o)}function Lp(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function bf(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function gb(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=Yc(0,i,s-1)}function yb(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?Yc(0,i,s):Yc(-1,i,s-1)}function y0(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function x0(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function xb(e,t){I(Zc(e),function(){return"The f passed in variableGrads(f) must be a function"}),I(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof gi}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],A.registeredVariables)t.push(A.registeredVariables[r]);var o=n?t.filter(function(c){return!c.trainable}):null,i=t.length;I((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=A.gradients(e,t,null,!0),s=a.value,u=a.grads;I(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),I(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),o!=null&&o.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Vu(e){return A.customGrad(e)}var dr=T({softmax_:function(e,t){t===void 0&&(t=-1);var n=k(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return A.runKernelFunc(function(r,o){var i=r.softmax(n,t);return o([i]),i},{logits:n},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([t],!0).mul(i))}}},"Softmax",{dim:t},[],[!0])}}),wb=T({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=k(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Vu(function(r,o){var i=r.max(t,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(n)}}),w0=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),b0=function(){function e(){}return e.prototype.time=function(t){return O("time")},e.prototype.read=function(t){return O("read")},e.prototype.readSync=function(t){return O("readSync")},e.prototype.numDataIds=function(){return O("numDataIds")},e.prototype.disposeData=function(t){return O("disposeData")},e.prototype.write=function(t,n,r){return O("write")},e.prototype.move=function(t,n,r,o){return O("move")},e.prototype.memory=function(){return O("memory")},e.prototype.floatPrecision=function(){return O("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,o){return O("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,O("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return O("slice")},e.prototype.stridedSlice=function(t,n,r,o){return O("stridedSlice")},e.prototype.unstack=function(t,n){return O("unstack")},e.prototype.reverse=function(t,n){return O("reverse")},e.prototype.concat=function(t,n){return O("concat")},e.prototype.neg=function(t){return O("neg")},e.prototype.add=function(t,n){return O("add")},e.prototype.addN=function(t){return O("addN")},e.prototype.subtract=function(t,n){return O("subtract")},e.prototype.multiply=function(t,n){return O("multiply")},e.prototype.realDivide=function(t,n){return O("realDivide")},e.prototype.floorDiv=function(t,n){return O("floorDiv")},e.prototype.sum=function(t,n){return O("sum")},e.prototype.prod=function(t,n){return O("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return O("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return O("argMin")},e.prototype.argMax=function(t,n){return O("argMax")},e.prototype.equal=function(t,n){return O("equal")},e.prototype.notEqual=function(t,n){return O("notEqual")},e.prototype.less=function(t,n){return O("less")},e.prototype.lessEqual=function(t,n){return O("lessEqual")},e.prototype.greater=function(t,n){return O("greater")},e.prototype.greaterEqual=function(t,n){return O("greaterEqual")},e.prototype.logicalNot=function(t){return O("logicalNot")},e.prototype.logicalAnd=function(t,n){return O("logicalAnd")},e.prototype.logicalOr=function(t,n){return O("logicalOr")},e.prototype.where=function(t){return O("where")},e.prototype.select=function(t,n,r){return O("select")},e.prototype.topk=function(t,n,r){return O("topk")},e.prototype.min=function(t,n){return O("min")},e.prototype.minimum=function(t,n){return O("minimum")},e.prototype.mod=function(t,n){return O("mod")},e.prototype.max=function(t,n){return O("max")},e.prototype.maximum=function(t,n){return O("maximum")},e.prototype.all=function(t,n){return O("all")},e.prototype.any=function(t,n){return O("any")},e.prototype.squaredDifference=function(t,n){return O("squaredDifference")},e.prototype.ceil=function(t){return O("ceil")},e.prototype.floor=function(t){return O("floor")},e.prototype.round=function(t){return O("round")},e.prototype.sign=function(t){return O("sign")},e.prototype.isNaN=function(t){return O("isNaN")},e.prototype.isInf=function(t){return O("isInf")},e.prototype.isFinite=function(t){return O("isFinite")},e.prototype.pow=function(t,n){return O("pow")},e.prototype.exp=function(t){return O("exp")},e.prototype.expm1=function(t){return O("expm1")},e.prototype.softmax=function(t,n){return O("softmax")},e.prototype.log=function(t){return O("log")},e.prototype.log1p=function(t){return O("log1p")},e.prototype.sqrt=function(t){return O("sqrt")},e.prototype.rsqrt=function(t){return O("rsqrt")},e.prototype.square=function(t){return O("square")},e.prototype.reciprocal=function(t){return O("reciprocal")},e.prototype.relu=function(t){return O("relu")},e.prototype.relu6=function(t){return O("relu6")},e.prototype.prelu=function(t,n){return O("prelu")},e.prototype.elu=function(t){return O("elu")},e.prototype.eluDer=function(t,n){return O("eluDer")},e.prototype.selu=function(t){return O("selu")},e.prototype.int=function(t){return O("int")},e.prototype.clip=function(t,n,r){return O("clip")},e.prototype.abs=function(t){return O("abs")},e.prototype.complexAbs=function(t){return O("complexAbs")},e.prototype.sigmoid=function(t){return O("sigmoid")},e.prototype.softplus=function(t){return O("softplus")},e.prototype.sin=function(t){return O("sin")},e.prototype.cos=function(t){return O("cos")},e.prototype.tan=function(t){return O("tan")},e.prototype.asin=function(t){return O("asin")},e.prototype.acos=function(t){return O("acos")},e.prototype.atan=function(t){return O("atan")},e.prototype.atan2=function(t,n){return O("atan2")},e.prototype.sinh=function(t){return O("sinh")},e.prototype.cosh=function(t){return O("cosh")},e.prototype.tanh=function(t){return O("tanh")},e.prototype.asinh=function(t){return O("asinh")},e.prototype.acosh=function(t){return O("acosh")},e.prototype.atanh=function(t){return O("atanh")},e.prototype.erf=function(t){return O("erf")},e.prototype.step=function(t,n){return O("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,O("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return O("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return O("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return O("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,O("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return O("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return O("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return O("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return O("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return O("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return O("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return O("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,o){return O("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return O("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return O("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return O("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return O("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return O("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,o){return O("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return O("reshape")},e.prototype.cast=function(t,n){return O("cast")},e.prototype.tile=function(t,n){return O("tile")},e.prototype.pad=function(t,n,r){return O("pad")},e.prototype.transpose=function(t,n){return O("transpose")},e.prototype.gather=function(t,n,r){return O("gather")},e.prototype.gatherND=function(t,n){return O("gatherND")},e.prototype.scatterND=function(t,n,r){return O("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return O("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return O("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,o){return O("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return O("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,o){return O("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return O("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,o,i,a){return O("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){return O("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,o,i,a,s){return O("LRNGrad")},e.prototype.multinomial=function(t,n,r,o){return O("multinomial")},e.prototype.oneHot=function(t,n,r,o){return O("oneHot")},e.prototype.cumsum=function(t,n,r,o){return O("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return O("nonMaxSuppression")},e.prototype.fft=function(t){return O("fft")},e.prototype.ifft=function(t){return O("ifft")},e.prototype.complex=function(t,n){return O("complex")},e.prototype.real=function(t){return O("real")},e.prototype.imag=function(t){return O("imag")},e.prototype.cropAndResize=function(t,n,r,o,i,a){return O("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return O("depthToSpace")},e.prototype.split=function(t,n,r){return O("split")},e.prototype.sparseToDense=function(t,n,r,o){return O("sparseToDense")},e.prototype.diag=function(t){return O("diag")},e.prototype.fill=function(t,n,r){return O("fill")},e.prototype.onesLike=function(t){return O("onesLike")},e.prototype.zerosLike=function(t){return O("zerosLike")},e.prototype.linspace=function(t,n,r){return O("linspace")},e.prototype.dispose=function(){return O("dispose")},e}();function O(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ir(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,a=e[i]||1;(t[t.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function rt(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,a=t[i];(o==null||o===1&&a>1)&&n.unshift(i)}return n}function xe(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var a=t[t.length-o-1];if(a==null&&(a=1),i===1)n.unshift(a);else if(a===1)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function Ca(e,t,n,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=mu(t),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,e[1],e[1]]}return Eo(e,s,n,r,o,i,!1,a)}function pu(e,t,n,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,l=sh(t),c=l[0],h=l[1],f=l[2];if(a==="NDHWC")u="channelsLast",s=[c,h,f,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,h,f,e[1],e[1]]}return vu(e,s,n,r,o,!1,u,i)}function Eo(e,t,n,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(s==="channelsLast")l=e[0],c=e[1],h=e[2],f=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=e[0],f=e[1],c=e[2],h=e[3]}var d,p=t[0],m=t[1],y=t[3],v=mu(n),g=v[0],x=v[1],w=mu(r),b=w[0],C=w[1],S=ri(p,b),E=ri(m,C),R=function(W,j,$,V,F,M,B,G){var X,ne,ae;if(typeof W=="number"){X={top:W,bottom:W,left:W,right:W,type:W===0?"VALID":"NUMBER"};var se=function(ye,Ee,me,Le,Ae){Le==null&&(Le=C0(ye,Ee,me));var Ie=ye[0],rn=ye[1],on=ea((Ie-Ee+2*Le)/me+1,Ae);I(Ke(on),function(){return"The output # of rows ("+on+") must be an integer. Change the stride and/or zero pad parameters"});var Rt=ea((rn-Ee+2*Le)/me+1,Ae);return I(Ke(Rt),function(){return"The output # of columns ("+Rt+") must be an integer. Change the stride and/or zero pad parameters"}),[on,Rt]}([j,$],M,V,W,G);ne=se[0],ae=se[1]}else if(W==="same"){ne=Math.ceil(j/V),ae=Math.ceil($/F);var ue=Math.max(0,(ne-1)*V+M-j),de=Math.max(0,(ae-1)*F+B-$),ve=Math.floor(ue/2),be=ue-ve,De=Math.floor(de/2);X={top:ve,bottom:be,left:De,right:de-De,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);X={top:0,bottom:0,left:0,right:0,type:"VALID"},ne=Math.ceil((j-M+1)/V),ae=Math.ceil(($-B+1)/F)}return{padInfo:X,outHeight:ne,outWidth:ae}}(o,c,h,g,x,S,E,i),N=R.padInfo,P=R.outHeight,D=R.outWidth,z=a?y*f:y;return s==="channelsFirst"?d=[l,z,P,D]:s==="channelsLast"&&(d=[l,P,D,z]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:P,outWidth:D,outChannels:z,padInfo:N,strideHeight:g,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:E,dilationHeight:b,dilationWidth:C,inShape:e,outShape:d,filterShape:t}}function vu(e,t,n,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3],d=u[4];if(a==="channelsLast")l=e[0],c=e[1],h=e[2],f=e[3],d=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=e[0],d=e[1],c=e[2],h=e[3],f=e[4]}var p,m=t[0],y=t[1],v=t[2],g=t[4],x=sh(n),w=x[0],b=x[1],C=x[2],S=sh(r),E=S[0],R=S[1],N=S[2],P=ri(m,E),D=ri(y,R),z=ri(v,N),W=function(B,G,X,ne,ae,se,ue,de,ve,be,De){var ye,Ee,me,Le;if(typeof B=="number"){ye={top:B,bottom:B,left:B,right:B,front:B,back:B,type:B===0?"VALID":"NUMBER"};var Ae=function(Yn,yn,ki,xr,Q,ke){Q==null&&(Q=C0(Yn,yn,xr));var Fe=Yn[0],Pn=Yn[1],Jn=Yn[2],No=ea((Fe-yn+2*Q)/xr+1,ke);I(Ke(No),function(){return"The output # of depths ("+No+") must be an integer. Change the stride and/or zero pad parameters"});var Si=ea((Pn-yn+2*Q)/xr+1,ke);I(Ke(Si),function(){return"The output # of rows ("+Si+") must be an integer. Change the stride and/or zero pad parameters"});var rl=ea((Jn-yn+2*Q)/xr+1,ke);return I(Ke(rl),function(){return"The output # of columns ("+rl+") must be an integer. Change the stride and/or zero pad parameters"}),[No,Si,rl,ki]}([G,X,ne,1],de,1,ae,B,De);Ee=Ae[0],me=Ae[1],Le=Ae[2]}else if(B==="same"){Ee=Math.ceil(G/ae),me=Math.ceil(X/se),Le=Math.ceil(ne/ue);var Ie=(Ee-1)*ae+de-G,rn=(me-1)*se+ve-X,on=(Le-1)*ue+be-ne,Rt=Math.floor(Ie/2),yr=Ie-Rt,$t=Math.floor(rn/2),gn=rn-$t,an=Math.floor(on/2);ye={top:$t,bottom:gn,left:an,right:on-an,front:Rt,back:yr,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);ye={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ee=Math.ceil((G-de+1)/ae),me=Math.ceil((X-ve+1)/se),Le=Math.ceil((ne-be+1)/ue)}return{padInfo:ye,outDepth:Ee,outHeight:me,outWidth:Le}}(o,c,h,f,w,b,C,P,D,z,s),j=W.padInfo,$=W.outDepth,V=W.outHeight,F=W.outWidth,M=i?g*d:g;return a==="channelsFirst"?p=[l,M,$,V,F]:a==="channelsLast"&&(p=[l,$,V,F,M]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:f,inChannels:d,outDepth:$,outHeight:V,outWidth:F,outChannels:M,padInfo:j,strideDepth:w,strideHeight:b,strideWidth:C,filterDepth:m,filterHeight:y,filterWidth:v,effectiveFilterDepth:P,effectiveFilterHeight:D,effectiveFilterWidth:z,dilationDepth:E,dilationHeight:R,dilationWidth:N,inShape:e,outShape:p,filterShape:t}}function C0(e,t,n,r){r===void 0&&(r=1);var o=ri(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function mu(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function sh(e){return typeof e=="number"?[e,e,e]:e}function ri(e,t){return t<=1?e:e+(e-1)*(t-1)}function ea(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function xi(e){var t=mu(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function Vt(e,t){return xi(e)||xi(t)}function Cf(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function _0(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Oe(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!qw(e.dtype,t))return A.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var a=n.real(e);return i=a.cast(t),a.dispose(),i}if(t==="int32")return n.int(e);if(t==="bool"){var s=K(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function uh(e,t){return A.makeTensorFromDataId(e.dataId,t,e.dtype)}function E0(e,t,n){var r=(t-e)/(n-1),o=Da(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Ye(o,"float32")}function lh(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function jp(e,t){return{real:e[2*t],imag:e[2*t+1]}}function bb(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Cb(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function _b(e,t,n){var r=function(i,a,s){return function(u,l,c){for(var h=0,f=u.length,d=0,p=!1;h<f;){var m=c(l,u[d=h+(f-h>>>1)]);m>0?h=d+1:(f=d,p=!m)}return p?h:-h-1}(i,a,s||Eb)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Eb(e,t){return e>t?1:e<t?-1:0}function _f(e,t,n,r,o){return k0(e,t,n,r,o,0).selectedIndices}function Ef(e,t,n,r,o,i){var a=k0(e,t,n,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function k0(e,t,n,r,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(w,b){return{score:w,boxIndex:b,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(Wp),l=i>0?-.5/i:0,c=[],h=[];c.length<n&&u.length>0;){var f=u.pop(),d=f.score,p=f.boxIndex,m=f.suppressBeginIndex;if(d<o)break;for(var y=!1,v=c.length-1;v>=m;--v){var g=kb(e,p,c[v]);if(g>=r){y=!0;break}if(f.score=f.score*Sb(r,l,g),f.score<=o)break}f.suppressBeginIndex=c.length,y||(f.score===d?(c.push(p),h.push(f.score)):f.score>o&&_b(u,f,Wp))}var x=c.length;return s&&(c.fill(0,x),h.fill(0,x)),{selectedIndices:Ye(c,"int32"),selectedScores:Ye(h,"float32"),numValidOutputs:K(x,"int32")}}function kb(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(s-i)*(u-a),p=(h-l)*(f-c);if(d<=0||p<=0)return 0;var m=Math.max(i,l),y=Math.max(a,c),v=Math.min(s,h),g=Math.min(u,f),x=Math.max(v-m,0)*Math.max(g-y,0);return x/(d+p-x)}function Sb(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Wp(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function S0(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(i){o[n]=i;var a=e.slice(r,o);return r[n]+=i,a})}function N0(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=he(n,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function R0(e,t,n,r,o){for(var i=t[t.length-1],a=[e.length/i,i],s=a[0],u=a[1],l=xa(n,s*r),c=xa("int32",s*r),h=0;h<s;h++){for(var f=h*u,d=e.subarray(f,f+u),p=[],m=0;m<d.length;m++)p.push({value:d[m],index:m});p.sort(function(w,b){return b.value-w.value});var y=h*r,v=l.subarray(y,y+r),g=c.subarray(y,y+r);for(m=0;m<r;m++)v[m]=p[m].value,g[m]=p[m].index}var x=t.slice();return x[x.length-1]=r,[pt(l,x,n),pt(c,x,"int32")]}function kf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=he(e,"int32"),i=he([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var Nb=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},Rb=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},Ib=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function I0(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function Ot(e,t){return t===1?[e]:I0(e,t)}function _t(){var e,t,n,r,o,i,a,s,u,l;return U().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function so(e,t,n){n===void 0&&(n="index");var r=$n(t);return r.map(function(o,i){return"int "+e[i]+" = "+n+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"}).join("")}function Sf(e){var t=$n(e).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var T0=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Tb(e,t,n,r){var o=[];e.forEach(function(d){var p=te(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?o.push("uniform float "+d.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+d.name+";"),o.push("uniform int offset"+d.name+";"))});var i,a,s=o.join(`
`),u=e.map(function(d){return function(p,m,y){y===void 0&&(y=!1);var v="";v+=y?P0(p):Ao(p);var g=p.shapeInfo.logicalShape,x=m.logicalShape;return g.length<=x.length&&(v+=y?function(w,b){var C,S=w.name,E=S.charAt(0).toUpperCase()+S.slice(1),R="get"+E+"AtOutCoords",N=w.shapeInfo.logicalShape.length,P=b.logicalShape.length,D=Ir(w.shapeInfo.logicalShape,b.logicalShape),z=Pe(P),W=P-N,j=["x","y","z","w","u","v"];C=N===0?"":P<2&&D.length>=1?"coords = 0;":D.map(function(X){return"coords."+j[X+W]+" = 0;"}).join(`
`);var $="";$=P<2&&N>0?"coords":w.shapeInfo.logicalShape.map(function(X,ne){return"coords."+j[ne+W]}).join(", ");var V="return outputValue;",F=te(w.shapeInfo.logicalShape)===1,M=te(b.logicalShape)===1;if(N!==1||F||M){if(F&&!M)V=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(D.length){var B=N-2,G=N-1;D.indexOf(B)>-1&&D.indexOf(G)>-1?V="return vec4(outputValue.x);":D.indexOf(B)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":D.indexOf(G)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+z+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+E+"("+$+`);
      `+V+`
    }
  `}(p,m):function(w,b){var C=w.name,S=C.charAt(0).toUpperCase()+C.slice(1),E="get"+S+"AtOutCoords",R=b.texShape,N=w.shapeInfo.texShape,P=w.shapeInfo.logicalShape.length,D=b.logicalShape.length;if(!w.shapeInfo.isUniform&&P===D&&w.shapeInfo.flatOffset==null&&lt(N,R))return`
      float `+E+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var z,W=Pe(D),j=Ir(w.shapeInfo.logicalShape,b.logicalShape),$=D-P,V=["x","y","z","w","u","v"];z=P===0?"":D<2&&j.length>=1?"coords = 0;":j.map(function(M){return"coords."+V[M+$]+" = 0;"}).join(`
`);var F="";return F=D<2&&P>0?"coords":w.shapeInfo.logicalShape.map(function(M,B){return"coords."+V[B+$]}).join(", "),`
    float `+E+`() {
      `+W+` coords = getOutputCoords();
      `+z+`
      return get`+S+"("+F+`);
    }
  `}(p,m)),v}(d,t,r)}).join(`
`),l=t.texShape,c=_t(),h=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Pb+`
    `+Db+`
    `+Ab+`
  `}(c);return t.isPacked?(i=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,b){var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(w,b){var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];if(lt(w,b))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var S=Math.ceil(w[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `}(d,p);case 3:return m=d,y=p,v=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],g=Math.ceil(m[2]/2),x=g*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+g+`);
      int c = imod(index, `+g+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(w,b){for(var C=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],S=Math.ceil(w[w.length-1]/2),E=S*Math.ceil(w[w.length-2]/2),R=E,N="",P="b, r, c",D=2;D<w.length-1;D++)R*=w[w.length-D-1],N=`
      int b`+D+" = index / "+R+`;
      index -= b`+D+" * "+R+`;
    `+N,P="b"+D+", "+P;return`
    ivec`+w.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+N+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+w.length+"("+P+`);
    }
  `}(d,p)}var m,y,v,g,x}(t.logicalShape,l),a=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(c)):(i=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,g){return g[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+g[1]+`.0);
      }
    `:g[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+g[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      return resTexRC.x * `+g[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,g){return lt(v,g)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+g[0]+", "+g[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+g[0]+", "+g[1]+`));
        int index = resTexRC.x * `+g[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+g[0]+", "+g[1]+`));
        int index = resTexRC.x * `+g[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(d,p);case 3:return m=p,y=so(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,g){var x=so(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(d,p);case 5:return function(v,g){var x=so(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+g[0]+`,
                             `+g[1]+`));

      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,p);case 6:return function(v,g){var x=so(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,p);default:throw new Error(d.length+"-D output sampling is not yet supported")}var m,y}(t.logicalShape,l),a=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=Fb),[f,h,a,s,i,u,n].join(`
`)}function Ao(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],h=Jr(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Io(n)+`
      }
    `;var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Jr(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n.shapeInfo.texShape;if(a!=null&&lt(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=ro(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var d=Fo(n,f);return`
      `+Ao(d)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Mo(["row","col"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Io(n)+`
      }
    `;var p=a[0],m=a[1],y=Jr(o);return m===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=ro(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=Fo(n,h);return`
        `+Ao(f)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Mo(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Io(n)+`
      }
    `;var d=n.shapeInfo.texShape,p=d[0],m=d[1],y=n.shapeInfo.flatOffset;if(m===a&&y==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(m===s&&y==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var v=Jr(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=ro(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=Fo(n,c);return`
      `+Ao(f)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Mo(["row","col","depth","depth2"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Io(n)+`
      }
    `;var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],y=p[1];if(y===u&&d==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(y===a&&d==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var v=Jr(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+y+", index + "+v+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=ro(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var d=Fo(n,h);return`
      `+Ao(d)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Mo(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Io(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,y=m[0],v=m[1];if(v===l&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(v===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=Jr(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+g+`;
      vec2 uv = uvFromFlat(`+y+", "+v+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=ro(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=Fo(n,s);return`
      `+Ao(l)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Mo(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,d=r[2]*f,p=r[1]*d;if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Io(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,y=n.shapeInfo.texShape,v=y[0],g=y[1];if(g===p&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===c&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=Jr(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+d+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function P0(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=_t(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=_t();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+i+`, uv);
    }
  `}(e);case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=u[0],c=u[1],h=_t();if(u!=null&&lt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(e);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var c=i.slice(1),h=Fo(o,c);return`
        `+P0(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+Mo(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],p=Math.ceil(i[2]/2),m=p*Math.ceil(i[1]/2),y=_t();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+m+", "+p+`, b, row, col);
      return `+y.texture2D+"("+a+`, uv);
    }
  `}(e);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],d=Math.ceil(i[a-1]/2),p=d*Math.ceil(i[a-2]/2),m="int b, int row, int col",y="b * "+p+" + (row / 2) * "+d+" + (col / 2)",v=2;v<a-1;v++)m="int b"+v+", "+m,p*=i[a-v-1],y="b"+v+" * "+p+" + "+y;var g=_t();return`
    vec4 `+u+"("+m+`) {
      int index = `+y+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+g.texture2D+"("+s+`, uv);
    }
  `}(e)}}var Pb=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Db=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ab=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fb=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Jr(e){return"offset"+e}function Io(e){var t=e.name,n=te(e.shapeInfo.logicalShape);return n<2?"return "+t+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Pe(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Fo(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Mo(e,t){return t.map(function(n){return e[n]}).join(", ")}var Mb=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,I(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Pe(l),h=Ot("coords",l);if(i===1){var f=Pe(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),p="."+d[s-1],m=d.map(function(E){return"int "+E}),y=Ot("sourceLocR",s-1).concat("inIdx.r"),v=Ot("sourceLocG",s-1).concat("inIdx.g"),g=Ot("sourceLocB",s-1).concat("inIdx.b"),x=Ot("sourceLocA",s-1).concat("inIdx.a"),w=n==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",C=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",S=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+b+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+w+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Ob=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},Bb=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=c-1-e.padInfo.front,p=h-1-e.padInfo.top,m=f-1-e.padInfo.left,y=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+m+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Lb=function(e,t,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],xe(e,t),xe(e,n);var a="0.0";r!=null&&(xe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(xe(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},jb=function(e,t,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xe(e,t),xe(e,n);var a="vec4(0.0)";r!=null&&(xe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(xe(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Wb="return areal * breal - aimag * bimag;",zb="return areal * bimag + aimag * breal;",zp=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xe(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Wl="return a + b;",zl="return a - b;",Up="return a * b;",D0="return (a < 0.) ? b * a : a;",Ge=function(e,t,n){this.variableNames=["A","B"],this.outputShape=xe(t,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},A0=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,er=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe(t,n);var o=this.outputShape.length,i="";if(r)if(o===0||te(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Pe(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Ot("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},Ub=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),Vb=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),$b=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Hb=function(e){this.outputShape=[],this.outputShape=yi(e,1),this.variableNames=e.map(function(s,u){return"T"+u});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var i=t.length,a=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Gb=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=yi(e,t);var n=this.outputShape,r=n.length,o=Pe(r),i=Ot("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(y,v){return"T"+v});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=a[t],c=a.slice(-2),h=a.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var d=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+us(a,l,d)+`),
            vec2(`+us(c,l,d)+`));
        }`}var p=s.length,m=s[s.length-1];f+=`
        return getChannel(
          getT`+p+"("+us(a,l,m)+`),
          vec2(`+us(c,l,m)+"));",this.userCode=`
      float getValue(`+a.map(function(y){return"int "+y})+`) {
        `+f+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+n[r-2]+` &&
            `+i[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function us(e,t,n){var r=e.indexOf(t);return e.map(function(o,i){return i===r?o+" - "+n:o}).join()}var qb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Xb=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=i?1:2,l=i?2:3,c=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Kb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Qb=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Yb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Jb=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Vp=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),d=e.inChannels%4,p=e.dataFormat==="channelsLast",m=p?1:2,y=p?2:3,v=p?3:1,g="",x="";n&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,x="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+w+`
        `+x+`
        setOutput(result);
      }
    `},Zb=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},$p=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=e.outChannels/e.inChannels,m="",y="";n&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,y="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+y+`
        setOutput(result);
      }
    `},Hp=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=d,m="int xR; int xC; int xCOffset;",y=0;y<f;y++)for(var v=0;v<d;v++)m+=`
          vec4 xTexelR`+y+"C"+2*v+` = vec4(0.);
          vec4 wR`+y+"C"+v+` = vec4(0.);
          vec4 xR`+y+"C"+v+" = vec4(0.);";for(y=0;y<f;y++)for(var g=0;g<p;g++){if(m+=`
          xR = xRCorner + `+y*c+`;
          xC = xCCorner + `+(v=2*g)*h+`;
        `,l===1){if(v<d&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+y+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+v+" = vec4(previous.zw, xTexelR"+y+"C"+v+`.xy);
                } else {
                  xR`+y+"C"+v+" = vec4(0, 0, xTexelR"+y+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xR`+y+"C"+v+" = xTexelR"+y+"C"+v+`;
              `,v+1<d)){var x=s%2==0?Yg(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+y+"C"+(v+1)+` = vec4(
                    xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(v+1)+" = xTexelR"+y+"C"+(v+2)+`;
                `}}else v<d&&(m+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(v+2)+` = vec4(0.);
                }

                xR`+y+"C"+v+` = vec4(
                  xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.zw);
              `,v+1<d&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(v+1)+" = vec4(xTexelR"+y+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+y+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+y+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(v+2)+` = vec4(0.);
                }

                xR`+y+"C"+v+` = vec4(
                  xTexelR`+y+"C"+v+".xy, xTexelR"+y+"C"+(v+2)+`.xy);
              `,v+1<d&&(m+=`
                  xR`+y+"C"+(v+1)+` = vec4(
                    xTexelR`+y+"C"+v+".zw, xTexelR"+y+"C"+(v+2)+`.zw);
                `)),m+="}");v<d&&(m+=`
            vec4 wTexelR`+y+"C"+v+" = getW("+y+", "+v+`, d1, q);
            wR`+y+"C"+v+" = vec4(wTexelR"+y+"C"+v+".xz, wTexelR"+y+"C"+v+`.xz);
          `,v+1<d&&(m+=`
              vec4 wTexelR`+y+"C"+(v+1)+" = getW("+y+", "+(v+1)+`, d1, q);
              wR`+y+"C"+(v+1)+` =
                vec4(wTexelR`+y+"C"+(v+1)+".xz, wTexelR"+y+"C"+(v+1)+".xz);"))}for(y=0;y<f;y++)for(v=0;v<d;v++)m+="dotProd += xR"+y+"C"+v+" * wR"+y+"C"+v+";";var w="",b="";n&&(w=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,b="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+C+`
        `+b+`
        setOutput(result);
      }
    `},eC=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],l=t[0],c=n[0],h=n[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,d=[a-1+".0",s-1+".0"],p=d[0],m=d[1],y=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=y[0],g=y[1],x=y[2],w=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],b=w[0],C=w[1],S=w[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+b+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+g+`;
        float width_scale = `+C+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},tC=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Pe(r)+` coords = getOutputCoords();
        int end = `+Gp(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Gp(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Gp(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var nC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ba.DENSE;var t=Zi(e),n=_t();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+so(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},rC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ba.DENSE;var t=Zi(e),n=_t();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+so(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},oC=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),iC=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},aC=function(e){this.variableNames=["A"],this.outTexUsage=Kt.DOWNLOAD;var t=_t();this.outputShape=e,this.userCode=`
      `+T0+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},sC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Kt.DOWNLOAD;var t=_t();this.outputShape=e,this.userCode=`
      `+T0+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},uC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=_t(),o=t[0],i=t[1];this.outputShape=e;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Sf(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},lC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=_t(),o=t[0],i=t[1];this.outputShape=e;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+e[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Sf(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},cC="return real * expR - imag * expI;",hC="return real * expI + imag * expR;",qp=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},fC=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),dC=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Pe(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},pC=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Pe(t.length),o=Pe(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function vC(e,t){var n=_t();return c2(e,t,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function mC(e,t){return v2(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function gC(e,t){return m2(e,t,new Uint16Array([0,1,2,2,1,3]))}function Fa(e,t,n,r,o,i,a){y2(n,r);var s=g2(e,t),u=e.TEXTURE_2D;return re(e,t,function(){return e.bindTexture(u,s)}),re(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),re(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),re(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),re(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),re(e,t,function(){return e.texImage2D(u,0,o,n,r,0,i,a,null)}),re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function yC(e,t,n,r,o){var i=zu(n,r);return Fa(e,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function xC(e,t,n,r,o){var i=zu(n,r);return Fa(e,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function wC(e,t,n,r,o){var i=zu(n,r);return Fa(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function bC(e,t,n,r,o){var i=Aa(n,r);return Fa(e,t,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function CC(e,t,n,r,o){var i=Aa(n,r);return Fa(e,t,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function _C(e,t,n,r){return re(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Fp(e,t,n,"clipSpacePos",r,3,20,0)&&Fp(e,t,n,"uv",r,2,20,12)}function EC(e,t,n,r,o,i,a){var s,u,l;re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=a.internalFormatPackedFloat),s.set(i),re(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function kC(e,t,n,r){re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?re(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):re(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),re(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function SC(e,t,n,r,o){var i=e.createBuffer();re(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return re(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)}),re(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),re(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),i}function NC(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function RC(e,t,n,r,o){var i=zu(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return re(e,t,function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function IC(e,t,n,r,o,i,a,s){var u=e,l=new Float32Array(function(c,h){var f=Aa(c,h);return f[0]*f[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function TC(e,t,n,r){var o=new Float32Array(n*r*4);return re(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var PC=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=U().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,i2(n,t)):this.gl=qn(n);var r="WEBGL_color_buffer_float";if(U().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=os(this.gl,this.debug,"OES_texture_float"),fn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=os(this.gl,this.debug,"OES_texture_half_float");else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),fn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=os(this.gl,this.debug,"EXT_color_buffer_half_float");else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",fn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!fn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=mC(this.gl,this.debug),this.indexBuffer=gC(this.gl,this.debug),this.framebuffer=x2(this.gl,this.debug),this.textureConfig=mf(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return U().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;re(n,this.debug,function(){return n.finish()}),re(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),re(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),re(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),re(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),re(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),yC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),xC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),wC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),kC(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,o){this.throwIfDisposed(),EC(this.gl,this.debug,t,n,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),CC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),bC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(Mp(this.gl,this.debug,this.framebuffer),this.outputTexture=null),re(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return RC(o.gl,o.debug,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,i,a){return IC(this.gl,t,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return NC(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=SC(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(U().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=a}else U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return TC(o.gl,o.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=h2(n,this.debug,t),o=vC(n,this.debug),i=d2(n,this.debug);return re(n,this.debug,function(){return n.attachShader(i,o)}),re(n,this.debug,function(){return n.attachShader(i,r)}),p2(n,this.debug,i),this.debug&&Ol(n,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=_C(n,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&re(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Ol(this.gl,this.debug,this.program),re(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?b2(this.gl,this.debug,t,n):C2(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),re(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),_2(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=Aa(n,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(t,i,a)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Ol(this.gl,this.debug,this.program),is(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),re(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=os(this.gl,this.debug,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return Z(this,void 0,void 0,function(){var n=this;return ee(this,function(r){switch(r.label){case 0:return[4,Rp(function(){return n.disposed||n.isQueryAvailable(t,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||Rp(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Bl(this.gl,this.debug,t,this.framebuffer),this.debug&&is(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Bl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&is(this.gl)):Mp(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;Bl(o,this.debug,t,this.framebuffer),this.debug&&is(o),this.outputTexture=t,re(o,this.debug,function(){return o.viewport(0,0,n,r)}),re(o,this.debug,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var i=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return i.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function Xp(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,i=t[r],a=i.shape;if(!lt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!n.isUniform||!i.isUniform){var s=n.texShape,u=i.isUniform?null:i.texData.texShape;if(!lt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var DC=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,h=n.dataFormat,f=s.left,d=s.top,p=o*r,m=_t(),y=h==="channelsLast",v=y?0:1,g=y?1:2,x="",w=0;w<=1;w++)for(var b=0;b<=1;b++)x+=`
          blockIndex = rc.y + `+b+`;
          pos = rc.x + `+w+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+d+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+t[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+t[g]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+m.output+` = result;
      }
    `},AC=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},FC=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},MC=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},OC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},BC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,h=u-1-e.padInfo.top,f=l-1-e.padInfo.left,d=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ul=function(e,t,n,r,o,i,a){n===void 0&&(n=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";i&&(d=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},LC=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),jC=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},WC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=Ot("rc",t),r=Pe(t),o=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c}(t,e,n),i=function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,e[e.length-1],e[e.length-2],n),a=function(s,u){var l=s.length,c=function(h,f){for(var d=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var y=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<h;v++)y=f[f.length-1-v]+","+y;d.push(y)}return d}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},zC=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+e[l]+u[1]});var r=e.length,o=Pe(r),i=t.map(function(u){return u[0]}).join(","),a=t.map(function(u,l){return u[0]+e[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},UC=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(y,v){return y[0]+e[v]+y[1]});for(var r=e.length,o=Pe(r),i=t.map(function(y){return y[0]}).join(","),a=t.map(function(y,v){return y[0]+e[v]}).join(","),s=Ot("rc",r),u=Ot("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,m=r===1?2:4;p<m;p++)d+=`
        `+h[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+n+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},Vl=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var f=t==="avg",d="0.0";if(f||(d="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),y=r%4,v=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},$l=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var y=t==="avg",v="0.0";if(y||(v="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+d+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(g="avgValue / count");var x=4*Math.floor(r/4),w=r%4,b=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+d+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+b+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(w===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+b+`
            }
          }
          setOutput(`+g+`);
        }
      }
    `}},VC=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",s="min"):t==="max"&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";o%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},$C=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+so(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+Sf(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `},HC=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,m=2*Math.ceil(d)+2,y=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},GC=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},qC=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},XC=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,m=2*Math.ceil(d)+2,y=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},KC=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},QC=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(i,a){return function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),o=Pe(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},YC=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Ot("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Pe(n);function s(u){var l=e.map(function(c,h){return function(f,d){return t.indexOf(f)!==-1&&e[f]!==1?e[f]+" - "+d[f]+" - 1":""+d[f]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Kp=function(e,t,n,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Pe(o.length),u=Pe(i.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",d=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},JC=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var h="";o%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},ZC=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=Pe(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},e_=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Pe(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(a===1)return"sourceLoc";if(a<=6)return Hl.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(a,s){return"sourceLoc."+Hl[s]+" = start["+s+"] + coords."+Hl[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+n+`
        setOutput(getSource(`+i+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),Hl=["x","y","z","w","u","v"],t_=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Pe(this.rank),r=Ot("coords",this.rank),o=Ot("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+t.map(function(c,h){return"start["+h+"]"}).join()+");":t.map(function(c,h){return o[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),n_=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Pe(n.length),i=Pe(n.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=n.map(function(u,l){return s++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},r_=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,i=Qp(n,r),a=Yp(t,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===qt.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===qt.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===qt.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===qt.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===qt.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var i=Yp(n,Qp(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Qp(e,t){if(e===Kt.UPLOAD)return qt.PACKED_2X2_FLOAT32;if(e===Kt.RENDER||e==null)return function(n){return U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qt.PACKED_2X2_FLOAT32:qt.UNPACKED_FLOAT32:n?qt.PACKED_2X2_FLOAT16:qt.UNPACKED_FLOAT16}(t);if(e===Kt.DOWNLOAD||e===Kt.PIXELS)return qt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Yp(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var o_=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Pe(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},i_=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Pe(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},a_=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Pe(this.rank),i=I0("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Nf=1.7580993408473768,Rf=1.0507009873554805,pe=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Tn="if (isnan(x)) return x;",s_="return x;",Jp="return abs(x);",F0=Tn+`
  return (x < 0.0) ? 0.0 : x;
`,M0=Tn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,O0="return (x >= 0.0) ? x : (exp(x) - 1.0);",u_=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Nf+`;
  float scale = `+Rf+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Zp="return -x;",ev="return ceil(x);",tv="return floor(x);",nv="return exp(x);",rv="return exp(x) - 1.0;",l_=Tn+`
  return sin(x);
`,c_=Tn+`
  return cos(x);
`,h_=Tn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,f_=Tn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,d_=Tn+`
  return atan(x);
`,p_=Tn+"return log(x + sqrt(x * x + 1.0));",v_=Tn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,m_=Tn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ls="return x;",g_="return x;",B0=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,L0=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,j0=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Li=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},y_=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Ot("rc",t),r=Pe(t),o=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,n),i=n.slice(-2),a=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},cs={};function hs(e,t){if(t===void 0&&(t=!1),e==="linear")return t?g_:s_;if(e==="relu")return t?B0:F0;if(e==="elu")return t?j0:O0;if(e==="relu6")return t?L0:M0;if(e==="prelu")return t?A0:D0;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var x_=600,w_=function(e){function t(n){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!U().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var i=qn(U().getNumber("WEBGL_VERSION"));o.binaryCache=((r=U().getNumber("WEBGL_VERSION"))in cs||(cs[r]={}),cs[r]),o.gpgpu=new PC(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=n,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=n.gl.canvas;return o.textureManager=new r_(o.gpgpu),o.numMBBeforeWarning=U().global.screen==null?1024:U().global.screen.height*U().global.screen.width*window.devicePixelRatio*x_/1024/1024,o.texData=new w0(o,A),o}return In(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,o){if(U().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:n,usage:Kt.UPLOAD}),i},t.prototype.move=function(n,r,o,i){if(U().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:o,dtype:i,values:r,usage:Kt.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Li(u,ls):new pe(u,ls);var h=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:i}],i),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(o!=null)return this.convertAndCacheOnCPU(n);if(i==="string")return o;var d,p,m=this.activeTimers!=null;return m&&(d=On()),i==="complex64"?p=lh(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(n),m&&(this.downloadWaitMs+=On()-d),this.convertAndCacheOnCPU(n,p)},t.prototype.read=function(n){return Z(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,h,f,d,p,m,y,v,g,x,w,b,C,S,E;return ee(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(N){return r.push(N)})];if(o=this.texData.get(n),i=o.values,a=o.shape,s=o.slice,u=o.dtype,l=o.complexTensors,c=o.isPacked,s!=null)return h=void 0,h=c?new Li(a,ls):new pe(a,ls),f=this.runWebGLProgram(h,[{dataId:n,shape:a,dtype:u}],u),d=this.read(f.dataId),this.disposeData(f.dataId),[2,d];if(i!=null)return[2,this.convertAndCacheOnCPU(n)];if(!U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&U().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&U().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(n),y=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[y.texture].concat(Zi(a)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return g=R.sent(),x=g[0],w=g[1],v=lh(x,w),[3,5];case 4:p==null?v=this.getValuesFromTexture(n):(b=te(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,b)),R.label=5;case 5:return m!=null&&this.disposeData(m.dataId),C=this.convertAndCacheOnCPU(n,v),S=this.pendingRead.get(n),this.pendingRead.delete(n),S.forEach(function(N){return N(C)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,C]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var o=n[r];if(!u2(o))throw U().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.isPacked,u=te(i);if(U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Zi(i))).subarray(0,u);return this.disposeData(l.dataId),h}var f=U().getBool("WEBGL_PACK")&&s===!0,d=f?Ll(i):i,p=f?new sC(d):new aC(d),m=this.runWebGLProgram(p,[{shape:d,dtype:a,dataId:n}],"float32"),y=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),v},t.prototype.time=function(n){return Z(this,void 0,void 0,function(){var r,o,i,a,s,u,l;return ee(this,function(c){switch(c.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,n(),a=mi(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=mi(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=Uw(l),u.getExtraProfileInfo=function(){return l.map(function(h,f){return{name:s[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:On(),endMs:null}},t.prototype.endTimer=function(n){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=On(),n)},t.prototype.getQueryTime=function(n){return Z(this,void 0,void 0,function(){var r;return ee(this,function(o){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return U().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=A.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var o=this.makeOutput(n.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:A.keep(n.clone()),imag:A.keep(r.clone())},o},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,o);if(te(o)===0)return pt([],o,n.dtype);var i=this.texData.get(n.dataId).isPacked,a=y0(n.shape,r,o);if(i||!a){var s=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t_(o):new e_(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,o)},t.prototype.shallowSlice=function(n,r,o){var i=this.texData.get(n.dataId),a=this.makeOutput(o,n.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=n.dtype;var u=x0(r,n.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||n.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},t.prototype.stridedSlice=function(n,r,o,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,o,i);var a=bf(r,o,i);if(a.some(function(u){return u===0}))return pt([],a);var s=new n_(r,i,a);return this.compileAndRun(s,[n])},t.prototype.reverse=function(n,r){var o=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YC(n.shape,r):new QC(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var o=n.map(function(d){return cn(d)}),i=n.map(function(d){return jn(d)});return ft(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>U().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),s=this.concat(n.slice(0,a),r),u=this.concat(n.slice(a),r);return this.concat([s,u],r)}if(U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new Gb(n.map(function(d){return d.shape}),r);return this.compileAndRun(l,n)}var c=yi(n.map(function(d){return d.shape}),r),h=n.map(function(d){return d.as2D(-1,te(d.shape.slice(r)))}),f=new Hb(h.map(function(d){return d.shape}));return this.compileAndRun(f,h).reshape(c)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Zp,n.dtype);var r=new pe(n.shape,Zp);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,o,i){var a=o?n.shape[2]:n.shape[1],s=i?r.shape[1]:r.shape[2],u=o?n.shape[1]:n.shape[2],l=n.shape[0];if((a===1||s===1)&&u>1e3){o&&(n=n.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var c=s===1?n:n.as3D(l,u,1),h=s===1?2:1,f=s===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(h,!0)}var d=dt(n.dtype,r.dtype),p=new Ul(n.shape,[l,a,s],o,i);return this.compileAndRun(p,[n,r],d)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=i?r.shape[2]:r.shape[1],h=a?o.shape[1]:o.shape[2],f=r.shape[0],d=dt(r.dtype,o.dtype),p=s!=null,m=l!=null,y=u?hs(u,!0):null,v=new Ul(r.shape,[f,c,h],i,a,p,y,m),g=[r,o];return s&&g.push(s),l&&g.push(l),this.compileAndRun(v,g,d)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var o=this.texData.get(n.dataId),i=this.texData.get(r.dataId),a=new zp(Wb,n.shape,r.shape),s=new zp(zb,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Up,n.dtype);var f=new Ge(Up,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){var u=[n,r,o],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),U().getBool("WEBGL_PACK_NORMALIZATION")){var h=new jb(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(h,u)}var f=new Lb(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){var s=U().getBool("WEBGL_PACK_NORMALIZATION")?new MC(n.shape,r,o,i,a):new AC(n.shape,r,o,i,a);return this.compileAndRun(s,[n])},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){var l=new FC(r.shape,i,a,s,u);return this.compileAndRun(l,[r,o,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var o=this.readSync(n.dataId).map(function(a){return ou(a)});return N0(he(n.shape,n.dtype,o),r)}var i=new o_(n.shape,r);return this.compileAndRun(i,[n])},t.prototype.pad=function(n,r,o){var i=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new UC(n.shape,r,o):new zC(n.shape,r,o);return this.compileAndRun(i,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var o=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new a_(n.shape,r):new i_(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.gather=function(n,r,o){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,o);var i=new dC(n.shape,r.size,o);return this.compileAndRun(i,[n,r])},t.prototype.batchToSpaceND=function(n,r,o){I(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(h,f){return h*f}),a=cu(n.shape,r,i),s=hu(a.length,r.length),u=fu(n.shape,r,i),l=p0(o,r.length),c=v0(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){I(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,d){return f*d}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=cu(u.shape,r,i,!1),c=hu(l.length,r.length,!1),h=fu(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(h)},t.prototype.reduce=function(n,r,o){var i=n.shape[0],a=n.shape[1],s=jl(a),u=new VC({windowSize:s,inSize:a,batchSize:i},r),l=this.compileAndRun(u,[n],o);return l.shape[1]===1?l:this.reduce(l,r,o)},t.prototype.argReduce=function(n,r,o){o===void 0&&(o=null);var i=n.shape[0],a=n.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=jl(a),u=new Ib({windowSize:s,inSize:a,batchSize:i},r,o==null),l=[n];o!=null&&l.push(o);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},t.prototype.argReducePacked=function(n,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:n.shape,a=jl(i[i.length-1]),s=new Mb(i,a,r,o==null),u=o==null?[n]:[n,o],l=this.compileAndRun(s,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},t.prototype.sum=function(n,r){Gt("sum",r,n.rank);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a),u=Pl(n.dtype);return this.reduce(s,"sum",u).reshape(i)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a),u=Pl(n.dtype);return this.reduce(s,"prod",u).reshape(i)},t.prototype.unsortedSegmentSum=function(n,r,o){var i=0,a=Xn([i],n.rank),s=n;a!=null&&(s=n.transpose(a),i=Kn(1,n.rank)[0]);var u=function(d,p,m){for(var y=[],v=d.length,g=0;g<v;g++)g!==p?y.push(d[g]):y.push(m);return y}(s.shape,i,o),l=te([s.shape[i]]),c=s.as2D(-1,l),h=Pl(n.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,h,o).reshape(u);return a!=null&&(f=f.transpose(gf(a))),f},t.prototype.segOpCompute=function(n,r,o,i,a){var s=n.shape[0],u=n.shape[1],l=function(f,d){var p,m=!1;for(f<=g0?(p=f,m=!0):p=eh(f,Math.floor(Math.sqrt(f)));!m;)p>d||p===f?m=!0:p=eh(f,p+1);return p}(u,a),c=new JC({windowSize:l,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(c,[n,o],i);return h.shape[1]===a?h:(o=lu(0,a).tile([u/l]),this.segOpCompute(h,r,o,i,a))},t.prototype.argMinMaxReduce=function(n,r,o){var i=[r];if(Gt("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,n.rank),!U().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var a=wt(n.shape,i),s=a[0],u=te(a[1]),l=n.as2D(-1,u);return this.argReduce(l,o).reshape(s)}return this.argReducePacked(n,o)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,o,i){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var a=new tC(n.shape,o,i);return this.compileAndRun(a,[n])},t.prototype.equal=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var o=new Ge("return float(a == b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new Ge("return float(a != b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new Ge("return float(a < b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new Ge("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new Ge("return float(a > b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new Ge("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new pe(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new Ge("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new Ge("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.select=function(n,r,o){var i=new ZC(n.rank,r.shape,r.rank);return this.compileAndRun(i,[n,r,o],dt(r.dtype,o.dtype))},t.prototype.where=function(n){su("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return kf(n.shape,r)},t.prototype.topk=function(n,r,o){return R0(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){Gt("min",r,n.rank);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.mod=function(n,r){var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ge(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);Gt("max",r,n.rank);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.all=function(n,r){Gt("all",r,n.rank);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},t.prototype.any=function(n,r){Gt("any",r,n.rank);var o=wt(n.shape,r),i=o[0],a=te(o[1]),s=n.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},t.prototype.realDivide=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new Ge(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new Ge(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Wl);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var o=dt(n.dtype,r.dtype);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Wl,o);var i=new Ge(Wl,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.packedUnaryOp=function(n,r,o){var i=new Li(n.shape,r);return this.compileAndRun(i,[n],o)},t.prototype.packedBinaryOp=function(n,r,o,i,a){a===void 0&&(a=!1);var s=new er(o,n.shape,r.shape,a);return this.compileAndRun(s,[n,r],i)},t.prototype.complexSeparableBinaryOp=function(n,r,o){var i=this,a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var d=f[0],p=f[1],m=i.makeComplexComponentTensorInfo(n,d),y=i.makeComplexComponentTensorInfo(r,p),v=new Ge(o,n.shape,r.shape);return i.compileAndRun(v,[m,y],dt(d.dtype,p.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>U().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),o=this.addN(n.slice(0,r)),i=this.addN(n.slice(r));return this.addN([o,i])}var a=n.map(function(l){return l.dtype}).reduce(function(l,c){return dt(l,c)}),s=n.map(function(l){return l.shape}),u=U().getBool("WEBGL_PACK")?new Rb(n[0].shape,s):new Nb(n[0].shape,s);return this.compileAndRun(u,n,a)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,zl);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var o=dt(n.dtype,r.dtype);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,zl,n.dtype);var i=new Ge(zl,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.pow=function(n,r){var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ge(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),i=dt(n.dtype,r.dtype);return this.compileAndRun(o,[n,r],i)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,ev,n.dtype);var r=new pe(n.shape,ev);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,tv,n.dtype);var r=new pe(n.shape,tv);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new pe(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new pe(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new pe(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new pe(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new pe(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,nv,n.dtype);var r=new pe(n.shape,nv);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,rv,n.dtype);var r=new pe(n.shape,rv);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var o=it([r],n.shape),i=this.max(n,o),a=Ut(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new pe(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new pe(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new pe(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new pe(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new pe(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=U().getBool("WEBGL_PACK")?new Li(n.shape,B0):new pe(n.shape,F0),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=U().getBool("WEBGL_PACK")?new Li(n.shape,L0):new pe(n.shape,M0),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(A0,n.shape,r.shape):new Ge(D0,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.elu=function(n){if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,j0,n.dtype);var r=new pe(n.shape,O0);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new Ge("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.selu=function(n){var r=new pe(n.shape,u_);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new pe(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,o){var i,a=(i=U().getBool("WEBGL_PACK_CLIP")?new Vb(n.shape):new Ub(n.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[n],null,a)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Jp,n.dtype);var r=new pe(n.shape,Jp);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),o=new $b(n.shape),i=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(o,i)},t.prototype.sigmoid=function(n){var r=new pe(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new pe(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new pe(n.shape,l_);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new pe(n.shape,c_);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new pe(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new pe(n.shape,h_);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new pe(n.shape,f_);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new pe(n.shape,d_);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var o=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.sinh=function(n){var r=new pe(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new pe(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new pe(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new pe(n.shape,p_);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new pe(n.shape,v_);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new pe(n.shape,m_);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new pe(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var o=new pe(n.shape,function(i){return i===void 0&&(i=0),Tn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(o,[n])},t.prototype.conv2dByMatMul=function(n,r,o,i,a,s){var u=n.shape,l=this.texData.get(n.dataId),c=o.inChannels,h=u[0]*u[1]*u[2],f=o.outChannels,d=o.dataFormat==="channelsLast",p=(h===1||f===1)&&c>1e3,m=u[2]%2!=0&&!!l.isPacked;if(p||!U().getBool("WEBGL_LAZILY_UNPACK")||!U().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var y=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(n,[1,y,o.inChannels]),g=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:g,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),w={dataId:n.dataId,shape:[1,x,o.inChannels],dtype:n.dtype},b=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,I(ss(l.shape,w.shape),function(){return"packed reshape "+l.shape+" to "+w.shape+" isn't free"});var C=this.reshape(r,[1,o.inChannels,o.outChannels]),S=this.fusedBatchMatMul({a:w,b:C,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),E=this.texData.get(S.dataId);return I(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=b,E.shape=o.outShape,A.makeTensorFromDataId(S.dataId,o.outShape,S.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,o,i,a,s){var u=o.filterWidth,l=o.filterHeight,c=o.inChannels,h=o.outWidth,f=o.outHeight,d=o.dataFormat==="channelsLast",p=u*l*c,m=f*h,y=[p,m],v=n.squeeze([0]),g=r.reshape([1,p,-1]),x=new DC(y,v.shape,o),w=this.compileAndRun(x,[v]).reshape([1,y[0],y[1]]),b=i!=null,C=s!=null,S=a?hs(a,!0):null,E=new Ul(w.shape,[1,m,o.outChannels],!0,!1,b,S,C),R=[w,g];i&&R.push(i),C&&R.push(s);var N=this.compileAndRun(E,R);return d?N.reshape([1,f,h,o.outChannels]):N.reshape([1,o.outChannels,f,h])},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(U().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var l=a!=null,c=u!=null,h=s?hs(s,!1):null,f=new Vp(i,l,h,c),d=[r,o];return a&&d.push(a),u&&d.push(u),this.compileAndRun(f,d)},t.prototype.conv2d=function(n,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,o);if(U().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,o);var i=new Vp(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerInput=function(n,r,o){var i=new Xb(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerFilter=function(n,r,o){var i=new qb(o);return this.compileAndRun(i,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,o=n.input,i=n.filter,a=n.convInfo,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=U().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?hs(u,c):null,f=[o,i],d=s!=null,p=l!=null;return d&&f.push(s),p&&f.push(l),c?(r=new Hp(a,d,h,p),this.compileAndRun(r,f)):(r=new $p(a,d,h,p),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(n,r,o){var i;return U().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Hp(o),this.compileAndRun(i,[n,r])):(i=new $p(o),this.compileAndRun(i,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,o){var i=new Jb(o);return this.compileAndRun(i,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){var i=new Yb(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3d=function(n,r,o){var i=new Zb(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerInput=function(n,r,o){var i=new Qb(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerFilter=function(n,r,o){var i=new Kb(o);return this.compileAndRun(i,[n,r])},t.prototype.maxPool=function(n,r){var o=new Vl(r,"max",!1);return this.compileAndRun(o,[n])},t.prototype.avgPool=function(n,r){var o=new Vl(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,o,i){var a=new Vl(i,"max",!0),s=this.compileAndRun(a,[r]),u=new OC(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(n,r,o){var i=new Ob(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.cast=function(n,r){return _0(n,r,this)},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.avgPool3d=function(n,r){var o=new $l(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,o){var i=new Bb(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var o=new $l(r,"max",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,o,i){var a=new $l(i,"max",!0),s=this.compileAndRun(a,[r]),u=new BC(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(n,r){var o=this.texData.get(n.dataId);if(o.isPacked&&!ss(n.shape,r)&&(o.texture===null||!ss(o.shape,r))){var i=this.packedReshape(n,r);return A.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return uh(n,r)},t.prototype.resizeBilinear=function(n,r,o,i){var a=U().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new qC(n.shape,r,o,i):new GC(n.shape,r,o,i);return this.compileAndRun(a,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,o){var i=new HC(n,r,o);return this.compileAndRun(i,[n])},t.prototype.resizeNearestNeighbor=function(n,r,o,i){var a=new KC(n.shape,r,o,i);return this.compileAndRun(a,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){var i=new XC(n,r,o);return this.compileAndRun(i,[n])},t.prototype.multinomial=function(n,r,o,i){var a=r?n:dr(n),s=a.shape[0],u=a.shape[1],l=new LC(s,u,o),c=l.getCustomSetupFunc(i);return this.compileAndRun(l,[a],"int32",c)},t.prototype.oneHot=function(n,r,o,i){var a=new jC(n.size,r,o,i);return this.compileAndRun(a,[n])},t.prototype.diag=function(n){var r=new iC(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return su("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),_f(n.dataSync(),r.dataSync(),o,i,a)},t.prototype.cropAndResize=function(n,r,o,i,a,s){var u=new eC(n.shape,r.shape,i,a,s);return this.compileAndRun(u,[n,r,o],"float32")},t.prototype.depthToSpace=function(n,r,o){I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=n.shape[0],a=o==="NHWC"?n.shape[1]:n.shape[2],s=o==="NHWC"?n.shape[2]:n.shape[3],u=o==="NHWC"?n.shape[3]:n.shape[1],l=a*r,c=s*r,h=u/(r*r),f=new oC(o==="NHWC"?[i,l,c,h]:[i,h,l,c],r,o);return this.compileAndRun(f,[n])},t.prototype.split=function(n,r,o){return S0(n,r,o)},t.prototype.scatterND=function(n,r,o){var i=du(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,h=[c/u,u],f=n.reshape([s,a]),d=r.reshape([s,u]);if(c===0)return uh(pt([]),o);var p=K(0),m=new Kp(s,a,f.rank,d.rank,l,h);return this.compileAndRun(m,[d,f,p]).reshape(o)},t.prototype.sparseToDense=function(n,r,o,i){var a=du(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,h=new Kp(u,s,n.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,n,i]).reshape(o)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var o=this.texData.get(n.dataId),i=new qp(cC,n.shape,r),a=new qp(hC,n.shape,r),s=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],u=this.compileAndRun(i,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=m0(n,r),s=a[0],u=a[1],l=a[2],c=a[3],h=r.reshape([u,i]),f=n.reshape([n.size/l,l]),d=new pC(i,c,[u,l]);return this.compileAndRun(d,[f,h]).reshape(s)},t.prototype.fill=function(n,r,o){if((o=o||Pa(r))==="string"){var i=ru(o,te(n));return i.fill(r),A.makeTensor(i,n,o,this)}var a=new fC(n,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,o){return E0(n,r,o)},t.prototype.makeTensorInfo=function(n,r){var o=this.write(null,n,r);return this.texData.get(o).usage=null,{dataId:o,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var o=this.makeTensorInfo(n,r).dataId;return A.makeTensorFromDataId(o,n,r,this)},t.prototype.unpackTensor=function(n){var r=new y_(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new WC(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var o=[iu(n.shape)].concat(au(n.shape)),i={dtype:n.dtype,shape:o,dataId:n.dataId},a=[iu(r)].concat(au(r)),s=new $C(a,o),u=this.runWebGLProgram(s,[i],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(n){var r,o=this.texData.get(n),i=o.isPacked,a=o.shape,s=o.dtype,u=Ll(a);return r=i?new rC(u):new nC(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:n}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(n.outputShape,o),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===ba.DENSE){var c=Zi(n.outputShape);l.texShape=c.map(function(x){return 2*x})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),te(u.shape)===0)return l.values=xa(u.dtype,0),u;var h=[],f=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(x.dataId);if(w.texture==null){if(!n.packedInputs&&te(x.shape)<=U().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:w.values};n.packedInputs&&(w.isPacked=!0,w.shape=x.shape)}else if(!!w.isPacked!=!!n.packedInputs)x=w.isPacked?s.unpackTensor(x):s.packTensor(x),h.push(x),w=s.texData.get(x.dataId);else if(w.isPacked&&!ss(w.shape,x.shape)){var b=x,C=x.shape;x.shape=w.shape,x=s.packedReshape(x,C),h.push(x),w=s.texData.get(x.dataId),b.shape=C}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var d,p={shape:u.shape,texData:l,isUniform:!1},m=function(x,w,b){var C="";w.concat(b).forEach(function(R){var N=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,P=R.isUniform?"uniform":R.texData.texShape;C+=R.shape+"_"+P+"_"+N});var S=x.userCode,E=x.constructor.name;return E+="_"+C+"_"+S}(n,f,p),y=this.getAndSaveBinary(m,function(){return function(x,w,b,C){var S=w.userCode,E=b.map(function(F,M){var B={logicalShape:F.shape,texShape:F.isUniform?null:F.texData.texShape,isUniform:F.isUniform,isPacked:!F.isUniform&&F.texData.isPacked,flatOffset:null};return F.texData!=null&&F.texData.slice!=null&&F.texData.slice.flatOffset>0&&(B.flatOffset=F.texData.slice.flatOffset),{name:w.variableNames[M],shapeInfo:B}}),R=E.map(function(F){return F.shapeInfo}),N={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},P=Tb(E,N,S,w.packedInputs),D=x.createProgram(P),z=null,W=x.getUniformLocation(D,"NAN",!1);U().getNumber("WEBGL_VERSION")===1&&(z=x.getUniformLocation(D,"INFINITY",!1));for(var j={},$=0;$<w.variableNames.length;$++){var V=w.variableNames[$];j[V]=x.getUniformLocation(D,V,!1),j["offset"+V]=x.getUniformLocation(D,"offset"+V,!1)}return{program:w,source:P,webGLProgram:D,uniformLocations:j,inShapeInfos:R,outShapeInfo:N,infLoc:z,nanLoc:W}}(s.gpgpu,n,f,p)}),v=this.activeTimers!=null;if(v&&(d=this.startTimer()),function(x,w,b,C,S){Xp(w.inShapeInfos,b),Xp([w.outShapeInfo],[C]);var E=C.texData.texture,R=C.texData.texShape;C.texData.isPacked?x.setOutputPackedMatrixTexture(E,R[0],R[1]):x.setOutputMatrixTexture(E,R[0],R[1]),x.setProgram(w.webGLProgram),U().getNumber("WEBGL_VERSION")===1&&w.infLoc!==null&&x.gl.uniform1f(w.infLoc,1/0),w.nanLoc!==null&&x.gl.uniform1f(w.nanLoc,NaN),b.forEach(function(N,P){var D=w.program.variableNames[P],z=w.uniformLocations[D],W=w.uniformLocations["offset"+D];if(z!=null)if(N.isUniform)if(te(N.shape)<2)x.gl.uniform1f(z,N.uniformValues[0]);else{var j=N.uniformValues;j instanceof Float32Array||(j=new Float32Array(j)),x.gl.uniform1fv(z,j)}else N.texData.slice!=null&&W!=null&&x.gl.uniform1i(W,N.texData.slice.flatOffset),x.setInputMatrixTexture(N.texData.texture,z,P)}),S!=null&&S(x,w.webGLProgram),x.executeProgram()}(this.gpgpu,y,f,p,i),h.forEach(function(x){return s.disposeData(x.dataId)}),v&&(d=this.endTimer(d),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(d)})),!U().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var g=this.unpackTensor(u);return this.disposeData(u.dataId),g}return u},t.prototype.compileAndRun=function(n,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(n,r,o,i,a);return A.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(U().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Y(function(){if(!U().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=U().getBool("DEBUG");U().set("DEBUG",!1);var o=n.abs(K(1e-8)).dataSync()[0];if(U().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.values,u=o.texture,l=o.usage,c=o.isPacked;if(u==null){var h,f=this.activeTimers!=null;f&&(h=On());var d=o.texShape;if(d==null&&(d=S2(i,c),o.texShape=d),s!=null){var p=Ll(i),m=void 0,y=d[1],v=d[0],g=s instanceof Uint8Array;c?(y=(r=Aa(d[0],d[1]))[0],v=r[1],m=new lC(p,[v,y],g)):m=new uC(p,[v,y],g);var x=this.makeTensorInfo([v,y],a);this.texData.get(x.dataId).usage=g?Kt.PIXELS:Kt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),y,v,s);var w=this.runWebGLProgram(m,[x],a,null,!0),b=this.texData.get(w.dataId);o.texture=b.texture,o.texShape=b.texShape,o.isPacked=b.isPacked,o.usage=b.usage,this.disposeData(x.dataId),this.texData.delete(w.dataId),o.values=null,f&&(this.uploadWaitMs+=On()-h)}else{var C=this.acquireTexture(d,l,a,c);o.texture=C}}},t.prototype.convertAndCacheOnCPU=function(n,r){var o=this.texData.get(n),i=o.dtype;return this.releaseGPUData(n),r!=null&&(o.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},t.prototype.acquireTexture=function(n,r,o,i){if(this.numBytesInGPU+=this.computeBytes(n,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,i)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*Jg(r)},t}(b0);i0()&&A.registerBackend("webgl",function(){return new w_},2);var b_=T({square_:function(e){var t=k(e,"x","square"),n=[t];return A.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),_a="SquaredDifference",W0=T({squaredDifference_:function(e,t){var n,r=k(e,"a","squaredDifference"),o=k(t,"b","squaredDifference");n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return A.runKernelFunc(function(s,u){var l=s.squaredDifference(r,o);return u([r,o]),l},i,function(s,u){var l=u[0],c=u[1],h=K(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}},_a,{},a,[])}}),C_=T({abs_:function(e){var t=k(e,"x","abs");return t.dtype==="complex64"?A.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):A.runKernelFunc(function(n,r){var o=n.abs(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.toFloat().step(-1))}}},"Abs")}}),__=T({acos_:function(e){var t=k(e,"x","acos");return A.runKernelFunc(function(n,r){var o=n.acos(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(K(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),E_=T({acosh_:function(e){var t=k(e,"x","acosh");return A.runKernelFunc(function(n,r){var o=n.acosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),k_=T({asin_:function(e){var t=k(e,"x","asin");return A.runKernelFunc(function(n,r){var o=n.asin(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(K(1).sub(o.toFloat().square()).sqrt())}}})}}),S_=T({asinh_:function(e){var t=k(e,"x","asinh");return A.runKernelFunc(function(n,r){var o=n.asinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(K(1).add(o.toFloat().square()).sqrt())}}})}}),N_=T({atan_:function(e){var t=k(e,"x","atan");return A.runKernelFunc(function(n,r){var o=n.atan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().square().add(1))}}})}}),R_=T({atanh_:function(e){var t=k(e,"x","atanh");return A.runKernelFunc(function(n,r){var o=n.atanh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(K(1).sub(o.toFloat().square()))}}})}}),I_=T({ceil_:function(e){var t=k(e,"x","ceil");return A.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),If=T({clipByValue_:function(e,t,n){var r=k(e,"x","clipByValue");I(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],i={min:t,max:n};return A.runKernelFunc(function(a,s){var u=a.clip(r,t,n);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(t).logicalAnd(u.lessEqual(n)),Ce(a))}}},"ClipByValue",i,o)}}),T_=T({cos_:function(e){var t=k(e,"x","cos"),n=[t];return A.runKernelFunc(function(r,o){var i=r.cos(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),P_=T({cosh_:function(e){var t=k(e,"x","cosh");return A.runKernelFunc(function(n,r){var o=n.cosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(n)}}})}}),D_=T({erf_:function(e){var t=k(e,"x","erf");return I(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),A.runKernelFunc(function(n,r){var o=n.erf(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),ch=T({exp_:function(e){var t=k(e,"x","exp");return A.runKernelFunc(function(n,r){var o=n.exp(t);return r([o]),o},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),A_=T({expm1_:function(e){var t=k(e,"x","expm1");return A.runKernelFunc(function(n,r){var o=n.expm1(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.exp())}}})}}),F_=T({floor_:function(e){var t=k(e,"x","floor");return A.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),M_=T({log_:function(e){var t=k(e,"x","log"),n=[t];return A.runKernelFunc(function(r,o){var i=r.log(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},n)}}),O_=T({log1p_:function(e){var t=k(e,"x","log1p");return A.runKernelFunc(function(n,r){var o=n.log1p(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.add(1))}}})}}),B_=T({logSigmoid_:function(e){var t=k(e,"x","logSigmoid");return A.runKernelFunc(function(n,r){var o=n.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.neg().sigmoid())}}})}}),gu=T({neg_:function(e){var t=k(e,"x","neg"),n=[t];return A.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),L_=T({reciprocal_:function(e){var t=k(e,"x","reciprocal");return A.runKernelFunc(function(n,r){var o=n.reciprocal(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.square().neg())}}})}}),j_=T({round_:function(e){var t=k(e,"x","round");return A.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),z0=T({rsqrt_:function(e){var t=k(e,"x","rsqrt"),n=[t];return A.runKernelFunc(function(r,o){var i=r.rsqrt(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),U0=T({sigmoid_:function(e){var t=k(e,"x","sigmoid");return A.runKernelFunc(function(n,r){var o=n.sigmoid(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.mul(K(1).sub(o)))}}},"Sigmoid")}}),W_=T({sign_:function(e){var t=k(e,"x","sign");return A.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),z_=T({isNaN_:function(e){var t=k(e,"x","isNaN");return A.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),U_=T({isInf_:function(e){var t=k(e,"x","isInf");return A.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),V_=T({isFinite_:function(e){var t=k(e,"x","isFinite");return A.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return Ce(n)}}})}}),$_=T({sin_:function(e){var t=k(e,"x","sin"),n=[t];return A.runKernelFunc(function(r,o){var i=r.sin(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},n)}}),H_=T({sinh_:function(e){var t=k(e,"x","sinh");return A.runKernelFunc(function(n,r){var o=n.sinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(n)}}})}}),G_=T({softplus_:function(e){var t=k(e,"x","softplus");return A.runKernelFunc(function(n,r){var o=n.softplus(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.sigmoid())}}})}}),q_=T({sqrt_:function(e){var t=k(e,"x","sqrt");return A.runKernelFunc(function(n,r){var o=n.sqrt(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().sqrt().mul(2))}}})}}),X_=T({step_:function(e,t){t===void 0&&(t=0);var n=k(e,"x","step");return A.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Ce(r)}}})}}),K_=T({tan_:function(e){var t=k(e,"x","tan");return A.runKernelFunc(function(n,r){var o=n.tan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.cos().square())}}})}}),Q_=T({tanh_:function(e){var t=k(e,"x","tanh");return A.runKernelFunc(function(n,r){var o=n.tanh(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return K(1).sub(o.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function V0(e,t,n,r,o,i){var a,s,u=k(e,"x","batchNorm"),l=k(t,"mean","batchNorm"),c=k(n,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),r!=null&&(s=k(r,"offset","batchNorm")),I(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),I(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Ma(u,l,c,s,a,i)}function $0(e,t,n,r,o,i){var a,s,u=k(e,"x","batchNorm"),l=k(t,"mean","batchNorm"),c=k(n,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),r!=null&&(s=k(r,"offset","batchNorm")),I(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),I(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Ma(u,l,c,s,a,i)}function H0(e,t,n,r,o,i){var a,s,u=k(e,"x","batchNorm"),l=k(t,"mean","batchNorm"),c=k(n,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),r!=null&&(s=k(r,"offset","batchNorm")),I(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),I(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),I(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&I(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&I(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Ma(u,l,c,s,a,i)}function Ma(e,t,n,r,o,i){i==null&&(i=.001);var a,s,u,l=k(e,"x","batchNorm"),c=k(t,"mean","batchNorm"),h=k(n,"variance","batchNorm");o!=null&&(a=k(o,"scale","batchNorm")),r!=null&&(s=k(r,"offset","batchNorm")),I(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,h,a];return A.runKernelFunc(function(d,p){var m=d.batchNormalization(u,fs(c),fs(h),i,fs(a),fs(s));return p([l,c,h,a]),m},{x:l,mean:c,variance:h,scale:a,offset:s},function(d,p){var m=p,y=m[0],v=m[1],g=m[2],x=m[3],w=x??K(1),b=rt(v.shape,u.shape),C=[];if(v.rank===1){for(var S=0;S<u.shape.length-1;++S)C.push(u.shape[S]);C.push(1)}var E=y.sub(v),R=d.mul(w),N=z0(g.add(K(i))),P=N.mul(N).mul(N).mul(K(-.5));return{x:function(){return v.rank===1?d.mul(ni(N.as4D(1,1,1,v.shape[0]),C)).mul(w).reshape(y.shape):d.mul(N).mul(w).reshape(y.shape)},mean:function(){var D=N.mul(K(-1)).mul(R);return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)},variance:function(){var D=P.mul(E).mul(R);return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)},scale:function(){var D=E.mul(N),z=d.mul(D);return v.rank===1&&(z=z.sum(b)),z.reshape(v.shape)},offset:function(){var D=d;return v.rank===1&&(D=D.sum(b)),D.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},f).reshape(l.shape)}function fs(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function $u(){a0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Y_=T({batchNormalization2d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),$u(),V0(e,t,n,i,o,r)}}),J_=T({batchNormalization3d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),$u(),$0(e,t,n,i,o,r)}}),Z_=T({batchNormalization4d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),$u(),H0(e,t,n,i,o,r)}}),eE=T({batchNormalization_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),$u(),Ma(e,t,n,i,o,r)}}),G0=T({batchNorm_:Ma}),tE=T({batchNorm2d_:V0}),nE=T({batchNorm3d_:$0}),rE=T({batchNorm4d_:H0}),Hu=T({logicalAnd_:function(e,t){var n=k(e,"a","logicalAnd","bool"),r=k(t,"b","logicalAnd","bool");return xe(n.shape,r.shape),A.runKernelFunc(function(o){return o.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),oE=T({logicalNot_:function(e){var t=k(e,"x","logicalNot","bool");return A.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),q0=T({logicalOr_:function(e,t){var n=k(e,"a","logicalOr","bool"),r=k(t,"b","logicalOr","bool");return xe(n.shape,r.shape),A.runKernelFunc(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}}),iE=T({logicalXor_:function(e,t){var n=k(e,"a","logicalXor","bool"),r=k(t,"b","logicalXor","bool");return xe(n.shape,r.shape),q0(e,t).logicalAnd(Hu(e,t).logicalNot())}}),yo=T({where_:function(e,t,n){var r=k(t,"a","where"),o=k(n,"b","where"),i=k(e,"condition","where","bool");return Ne(r.shape,o.shape,"Error in where: "),i.rank===1?I(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ne(i.shape,o.shape,"Error in where: "),A.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Ce(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),X0=function(e){return Z(this,void 0,void 0,function(){var t,n,r;return ee(this,function(o){switch(o.label){case 0:return[4,(t=k(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=kf(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},ge=T({add_:function(e,t){var n,r=k(e,"a","add"),o=k(t,"b","add");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=rt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=rt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),aE=T({addN_:function(e){I(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),I(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,i){return k(o,"tensors"+i,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!lt(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return A.runKernelFunc(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),sE=T({addStrict_:function(e,t){var n=k(e,"a","addStrict"),r=k(t,"b","addStrict");return Ne(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),uE=T({atan2_:function(e,t){var n,r=k(e,"a","atan2"),o=k(t,"b","atan2");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=ge(u.square(),l.square()),h=a.mul(l.div(c)),f=rt(u.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=ge(u.square(),l.square()),h=gu(a.mul(u.div(c))),f=rt(l.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),_n=T({div_:function(e,t){var n,r=k(e,"a","div"),o=k(t,"b","div");if(n=He(r,o),r=n[0],o=n[1],r.dtype==="int32"&&o.dtype==="int32")return K0(r,o);var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=rt(u.shape,i);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=rt(l.shape,i);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),lE=T({divNoNan_:function(e,t){var n,r=k(e,"a","div"),o=k(t,"b","div");r=(n=He(r,o))[0],o=n[1];var i=_n(r,o),a=Ce(i),s=o.equal(a);return yo(s,a,i)}}),cE=T({divStrict_:function(e,t){var n=k(e,"a","div"),r=k(t,"b","div");return Ne(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),K0=T({floorDiv_:function(e,t){var n,r=k(e,"a","floorDiv"),o=k(t,"b","floorDiv");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=rt(u.shape,i);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=rt(l.shape,i);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),Tf=T({maximum_:function(e,t){var n,r=k(e,"a","maximum"),o=k(t,"b","maximum");return n=He(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),xe(r.shape,o.shape),A.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),hE=T({maximumStrict_:function(e,t){var n=k(e,"a","maximumStrict"),r=k(t,"b","maximumStrict");return Ne(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Q0=T({minimum_:function(e,t){var n,r=k(e,"a","minimum"),o=k(t,"b","minimum");return n=He(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),xe(r.shape,o.shape),A.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),fE=T({minimumStrict_:function(e,t){var n=k(e,"a","minimumStrict"),r=k(t,"b","minimumStrict");return Ne(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),dE=T({mod_:function(e,t){var n,r=k(e,"a","mod"),o=k(t,"b","mod");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=rt(u.shape,i);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=rt(l.shape,i);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),pE=T({modStrict_:function(e,t){var n=k(e,"a","modStrict"),r=k(t,"b","modStrict");return Ne(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),kt=T({mul_:function(e,t){var n,r=k(e,"a","mul"),o=k(t,"b","mul");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),h=rt(u.shape,i);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=rt(l.shape,i);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),vE=T({mulStrict_:function(e,t){var n=k(e,"a","mul"),r=k(t,"b","mul");return Ne(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),yu=T({pow_:function(e,t){var n,r=k(e,"base","pow"),o=k(t,"exp","pow");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape),a=[r,o];return A.runKernelFunc(function(s,u){var l=s.pow(r,o);return u([r,o,l]),l},{a:r,b:o},function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var f=c.toFloat(),d=s.mul(f.mul(l.pow(f.sub(K(1))))),p=rt(l.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(l.shape)},b:function(){var f=l.greater(0),d=l.log().where(f,Ce(l)),p=s.mul(h.mul(d)),m=rt(c.shape,i);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}},"Pow",{},a,[!0])}}),mE=T({powStrict_:function(e,t){return Ne(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),gE=T({squaredDifferenceStrict_:function(e,t){var n=k(e,"a","squaredDifferenceStrict"),r=k(t,"b","squaredDifferenceStrict");return Ne(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),ot=T({sub_:function(e,t){var n,r=k(e,"a","sub"),o=k(t,"b","sub");n=He(r,o),r=n[0],o=n[1];var i=xe(r.shape,o.shape);return A.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=rt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=rt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),yE=T({subStrict_:function(e,t){var n=k(e,"a","subStrict"),r=k(t,"b","subStrict");return Ne(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Y0=T({equal_:function(e,t){var n,r=k(e,"a","equal"),o=k(t,"b","equal");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),xE=T({equalStrict_:function(e,t){var n=k(e,"a","equalStrict"),r=k(t,"b","equalStrict");return Ne(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),wE=T({greater_:function(e,t){var n,r=k(e,"a","greater"),o=k(t,"b","greater");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),J0=T({greaterEqual_:function(e,t){var n,r=k(e,"a","greaterEqual"),o=k(t,"b","greaterEqual");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Ce(s)},b:function(){return Ce(u)}}},"GreaterEqual")}}),bE=T({greaterEqualStrict_:function(e,t){var n=k(e,"a","greaterEqualStrict"),r=k(t,"b","greaterEqualStrict");return Ne(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),CE=T({greaterStrict_:function(e,t){var n=k(e,"a","greaterStrict"),r=k(t,"b","greaterStrict");return Ne(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),_E=T({less_:function(e,t){var n,r=k(e,"a","less"),o=k(t,"b","less");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),EE=T({lessEqual_:function(e,t){var n,r=k(e,"a","lessEqual"),o=k(t,"b","lessEqual");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),kE=T({lessEqualStrict_:function(e,t){var n=k(e,"a","lessEqualStrict"),r=k(t,"b","lessEqualStrict");return Ne(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),SE=T({lessStrict_:function(e,t){var n=k(e,"a","lessStrict"),r=k(t,"b","lessStrict");return Ne(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),NE=T({notEqual_:function(e,t){var n,r=k(e,"a","notEqual"),o=k(t,"b","notEqual");return n=He(r,o),r=n[0],o=n[1],xe(r.shape,o.shape),A.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),RE=T({notEqualStrict_:function(e,t){var n=k(e,"a","notEqualStrict"),r=k(t,"b","notEqualStrict");return Ne(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function ov(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function iv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Pf=T({gather_:function(e,t,n){n===void 0&&(n=0);var r=k(e,"x","gather"),o=k(t,"indices","gather","int32");n=it(n,r.shape)[0];var i=function(a,s,u){for(var l=a.shape[u],c=[],h=1,f=1,d=0;d<u;d++)c.push(a.shape[d]),h*=a.shape[d];for(d=0;d<s.rank;d++)c.push(s.shape[d]);for(d=u+1;d<a.rank;d++)c.push(a.shape[d]),f*=a.shape[d];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}}(r,o,n);return A.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),n);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,n),f=h.length,d=l.slice(n,l.length).slice(1),p=d.length,m=ov(0,f),y=ov(f+1,f+1+p),v=iv([h,[c],d]),g=a.reshape(v),x=u.reshape([c]),w=iv([[f],m,y]),b=g.transpose(w),C=Z0(b,x,r.shape[n]),S=gf(w);return C=C.transpose(S)},indices:function(){return u}}},"Gather",{axis:n}).reshape(i.outputShape)}}),Z0=T({unsortedSegmentSum_:function(e,t,n){var r=k(e,"x","unsortedSegmentSum"),o=k(t,"segmentIds","unsortedSegmentSum","int32");return I(Ke(n),function(){return"numSegments must be of dtype int"}),A.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,n);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=Tf(l,Ce(l)),h=Pf(u,c),f=J0(l,K(0,"int32")),d=h.rank-f.rank,p=0;p<d;++p)f=ln(f,p+1);f=Hu(f,Ei(h.shape,"bool"));var m=Ce(h);return yo(f,h,m)}(i,s)}}})}}),IE=function(e,t,n){return Z(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,h,f,d,p,m;return ee(this,function(y){switch(y.label){case 0:for(r=k(e,"tensor","boolMask"),o=k(t,"mask","boolMask","bool"),i=n??0,a=o.rank,s=r.shape,I(a>0,function(){return"mask cannot be scalar"}),Ne(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+a;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+a)),h=r.reshape(c),f=o.reshape([-1]),[4,X0(f)];case 1:return d=y.sent(),p=d.squeeze([1]),m=Pf(h,p,i),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),h.dispose(),f.dispose(),d.dispose(),[2,m]}})})};function ey(e,t,n,r,o,i,a){i===void 0&&(i="NHWC"),I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),I(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),I(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),I(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=i==="NHWC"?s[3]:s[1],h=i==="NHWC"?u.shape[3]:u.shape[1];I(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),I(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),a!=null&&I(Ke(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Cf(i),d=Eo(s,n.shape,r,1,o,a,!1,f),p=A.runKernelFunc(function(m,y){var v=m.conv2dDerInput(u,n,d);return y([n,u]),v},{dy4D:u,filter:n},function(m,y){var v=y[0],g=y[1];return{dy4D:function(){return mn(m,v,r,o,i,1,a)},filter:function(){return Df(m,g,v.shape,r,o,i,a)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Gl(e){var t=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function ty(e,t,n,r,o){I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,a=t,s=!1;t.rank===4&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],l=a.shape[4];I(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),I(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),I(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),I(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),I(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=vu(i,n.shape,r,1,o),h=A.runKernelFunc(function(f){return f.conv3dDerInput(a,n,c)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var TE=T({conv1d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=k(e,"x","conv1d"),u=k(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),I(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),I(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&I(Ke(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),I(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),I(Vt(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),I(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=mn(f,h,[1,n],r,"NHWC",[1,i],a);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),mn=T({conv2d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=k(e,"x","conv2d"),u=k(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&I(Ke(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=o==="NHWC"?l.shape[3]:l.shape[1];I(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),I(Vt(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var f=Cf(o),d=Eo(l.shape,u.shape,n,i,r,a,!1,f),p=[u,l],m=A.runKernelFunc(function(y,v){var g=y.conv2d(l,u,d);return v([u,l]),g},{x:l,filter:u},function(y,v){var g=v,x=g[0],w=g[1];return I(xi(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return ny(w.shape,y,x,n,r,o)},filter:function(){return Df(w,y,x.shape,n,r,o)}}},"Conv2D",d,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),PE=T({conv3d_:function(e,t,n,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=k(e,"x","conv3d"),s=k(t,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),I(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),I(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),I(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),I(function(f,d){return Gl(f)||Gl(d)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),I(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=vu(u.shape,s.shape,n,i,r),h=A.runKernelFunc(function(f,d){var p=f.conv3d(u,s,c);return d([u,s]),p},{x:u,$filter:s},function(f,d){I(Gl(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=d[0],m=d[1];return{x:function(){return ty(p.shape,f,m,n,r)},$filter:function(){return function(y,v,g,x,w){var b=y;y.rank===4&&(b=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var C=v;C.rank===4&&(C=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),I(b.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+b.shape+"."}),I(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),I(g.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+g+"."}),I(b.shape[4]===g[3],function(){return"Error in conv3dDerFilter: depth of input "+b.shape[4]+") must match input depth in filter ("+g[3]+"."}),I(C.shape[4]===g[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+g[4]+")."});var S=vu(b.shape,g,x,1,w);return A.runKernelFunc(function(E){return E.conv3dDerFilter(b,C,S)},{x5D:b,dy5D:C})}(p,f,m.shape,n,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Df=T({conv2dDerFilter_:function(e,t,n,r,o,i,a){i===void 0&&(i="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),I(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),I(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),I(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];I(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),I(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),a!=null&&I(Ke(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=Cf(i),f=Eo(s.shape,n,r,1,o,a,!1,h);return A.runKernelFunc(function(d){return d.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),ny=T({conv2dDerInput_:ey}),Gu=T({depthwiseConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]);var s=k(e,"x","depthwiseConv2d"),u=k(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),I(Vt(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),a!=null&&I(Ke(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=Eo(l.shape,u.shape,n,i,r,a,!0),f=[l,u],d=A.runKernelFunc(function(p,m){var y=p.depthwiseConv2D(l,u,h);return m([l,u]),y},{x:l,filter:u},function(p,m){I(xi(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var y=m[0],v=m[1];return{x:function(){return ry(y.shape,p,v,h)},filter:function(){return oy(y,p,v.shape,h)}}},"DepthwiseConv2dNative",h,f);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),ry=T({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=A.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),oy=T({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),A.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Af=T({separableConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=k(e,"x","separableConv2d"),u=k(t,"depthwiseFilter","separableConv2d"),l=k(n,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),I(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),I(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],d=u.shape[3];I(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var p=Gu(c,u,r,o,a,i),m=mn(p,l,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),DE=T({conv2dTranspose_:function(e,t,n,r,o,i){return ey(n,k(e,"x","conv2dTranspose"),k(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),AE=T({conv3dTranspose_:function(e,t,n,r,o){return ty(n,k(e,"x","conv3dTranspose"),k(t,"filter","conv3dTranspose"),r,o)}}),qu=T({matMul_:function(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var i=k(e,"a","matMul"),a=k(t,"b","matMul");o=He(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=i.shape.slice(0,-2),f=a.shape.slice(0,-2),d=te(h),p=te(f);I(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),I(lt(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),I(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,c]),y=n?i.as3D(d,s,l):i.as3D(d,l,s),v=r?a.as3D(p,c,u):a.as3D(p,u,c),g={transposeA:n,transposeB:r};return A.runKernelFunc(function(x,w){var b=x.batchMatMul(y,v,n,r);return w([y,v]),b},{a:y,b:v},function(x,w){var b=w,C=b[0],S=b[1];return n||r?!n&&r?{a:function(){return x.matMul(S,!1,!1)},b:function(){return x.matMul(C,!0,!1)}}:n&&!r?{a:function(){return S.matMul(x,!1,!0)},b:function(){return C.matMul(x,!1,!1)}}:{a:function(){return S.matMul(x,!0,!0)},b:function(){return x.matMul(C,!0,!0)}}:{a:function(){return x.matMul(S,!1,!0)},b:function(){return C.matMul(x,!0,!1)}}},"BatchMatMul",g).reshape(m)}}),FE=T({dot_:function(e,t){var n=k(e,"t1","dot"),r=k(t,"t2","dot");I(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];return I(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),ME=T({outerProduct_:function(e,t){var n=k(e,"v1","outerProduct"),r=k(t,"v2","outerProduct");return I(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Oa=T({reverse_:function(e,t){var n=k(e,"x","reverse");if(n.rank===0)return n.clone();var r=it(t,n.shape);return A.runKernelFunc(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}}),OE=T({reverse1d_:function(e){var t=k(e,"x","reverse");return I(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Oa(t,0)}}),BE=T({reverse2d_:function(e,t){var n=k(e,"x","reverse");return I(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Oa(n,t)}}),LE=T({reverse3d_:function(e,t){var n=k(e,"x","reverse");return I(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Oa(n,t)}}),jE=T({reverse4d_:function(e,t){var n=k(e,"x","reverse");return I(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Oa(n,t)}});function iy(e,t,n,r,o,i){var a=k(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),I(Vt(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),i!=null&&I(Ke(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Ca(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&lt(l.inShape,l.outShape))return a.clone();var c=[s],h=A.runKernelFunc(function(f,d){var p=f.maxPool(s,l);return d([s,p]),p},{x:s},function(f,d){var p=d[0],m=d[1];return{x:function(){return function(y,v,g,x,w,b,C,S){var E=k(y,"dy","maxPoolBackprop"),R=k(v,"input","maxPoolBackprop"),N=k(g,"output","maxPoolBackprop");I(R.rank===E.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+E.rank+")"}),I(Vt(w,b),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),I(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),I(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var P=Ca(R.shape,x,w,b,C,S);return A.runKernelFunc(function(D){return D.maxPoolBackprop(E,R,N,P)},{$dy:E,$input:R})}(f,p,m,t,n,r,o)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function ay(e,t,n,r,o,i){var a=k(e,"x","avgPool","float32");I(Vt(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&I(Ke(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Ca(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&lt(l.inShape,l.outShape))return a.clone();var c=A.runKernelFunc(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return function(f,d,p,m,y,v){var g=k(f,"dy","avgPoolBackprop"),x=k(d,"input","avgPoolBackprop");I(x.rank===g.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+g.rank+")"}),I(Vt(m,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+y+"'"});var w=x,b=g,C=!1;x.rank===3&&(C=!0,w=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),b=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),I(b.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+b.rank+"."}),I(w.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var S=Ca(w.shape,p,m,y,v),E=A.runKernelFunc(function(R){return R.avgPoolBackprop(b,w,S)},{dy4D:b,input4D:w});return C?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(h,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var at=T({maxPool_:function(e,t,n,r,o){return iy(e,t,n,1,r,o)}}),Ba=T({avgPool_:function(e,t,n,r,o){return ay(e,t,n,1,r,o)}}),WE=T({pool_:function(e,t,n,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=k(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),I(Vt(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=Ca(s.shape,t,i,o,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(w,b){var C=w.map(function(R,N){return R+(R-1)*(b[N]-1)}).map(function(R){return R-1}),S=C.map(function(R){return Math.floor(R/2)}),E=C.map(function(R,N){return R-S[N]});return C.map(function(R,N){return[S[N],E[N]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,d=function(w,b,C){var S=C.map(function(W){return W[0]}),E=C.map(function(W){return W[1]}),R=w.concat(S,E),N=b.map(function(W,j){return(W-R[j]%W)%W}),P=E.map(function(W,j){return W+N[j]}),D=b.map(function(W,j){return[S[j],P[j]]}),z=b.map(function(W,j){return[0,N[j]]});return[D,z]}([c.inHeight,c.inWidth],h,l),p=d[0],m=d[1],y=f?r:"valid",v=f?s:f0(s,h,p),g=(n==="avg"?function(){return ay(v,t,i,1,y)}:function(){return iy(v,t,i,1,y)})(),x=f?g:l0(g,h,m);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),zE=T({maxPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=k(e,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),I(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),I(Vt(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&I(Ke(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=pu(u.shape,t,n,a,r,o,i),h=A.runKernelFunc(function(f,d){var p=f.maxPool3d(u,c);return d([u,p]),p},{x:u},function(f,d){var p=d[0],m=d[1];return{x:function(){return function(y,v,g,x,w,b,C,S){var E=k(y,"dy","maxPool3dBackprop"),R=k(v,"input","maxPool3dBackprop"),N=k(g,"output","maxPool3dBackprop"),P=E,D=R,z=N,W=!1;R.rank===4&&(W=!0,P=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),D=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),z=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),I(P.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),I(D.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+D.rank+"."}),I(z.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+z.rank+"."}),b==null&&(b=[1,1,1]),I(Vt(w,b),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),S!=null&&I(Ke(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+C+"."});var j=pu(D.shape,x,w,b,C,S),$=A.runKernelFunc(function(V){return V.maxPool3dBackprop(P,D,z,j)},{dy5D:P,input5D:D});return W?$.as4D($.shape[1],$.shape[2],$.shape[3],$.shape[4]):$}(f,p,m,t,n,a,r,o)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),UE=T({avgPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=k(e,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),I(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),I(Vt(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&I(Ke(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=pu(u.shape,t,n,a,r,o,i),h=A.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(d,p,m,y,v,g,x){var w=k(d,"dy","avgPool3dBackprop"),b=k(p,"input","avgPool3dBackprop"),C=w,S=b,E=!1;b.rank===4&&(E=!0,C=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),S=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),I(C.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."}),I(S.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."}),v==null&&(v=[1,1,1]),I(Vt(y,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+v+"'"}),x!=null&&I(Ke(g),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+g+"."});var R=pu(S.shape,m,y,v,g,x),N=A.runKernelFunc(function(P){return P.avgPool3dBackprop(C,S,R)},{dy5D:C,input5D:S});return E?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N}(f,u,t,n,a,r,o)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Gn=T({slice_:function(e,t,n){var r,o,i=k(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(u){I(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=n==null?new Array(i.rank).fill(-1):typeof n=="number"?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(I(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),i.shape[l]-r[l])}),mb(i,r,o);var a=i.shape,s={begin:r,size:o};return A.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-o[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),VE=T({slice1d_:function(e,t,n){var r=k(e,"x","slice1d");return I(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Gn(r,[t],[n])}}),$E=T({slice2d_:function(e,t,n){var r=k(e,"x","slice2d");return I(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Gn(r,t,n)}}),sy=T({slice3d_:function(e,t,n){var r=k(e,"x","slice3d");return I(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Gn(r,t,n)}}),HE=T({slice4d_:function(e,t,n){var r=k(e,"x","slice4d");return I(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Gn(r,t,n)}});function uy(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(Ut(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Ut(e.shape,r))),{x:function(){var i=e.mul(n.equal(t).cast(e.dtype));return o==null?i:i.transpose(o)}}}var GE=T({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","all","bool"),o=it(t,r.shape),i=o,a=Xn(i,r.rank);a!=null&&(r=r.transpose(a),i=Kn(i.length,r.rank));var s=A.runKernelFunc(function(l){return l.all(r,i)},{$x:r});if(n){var u=Ut(s.shape,o);return s.reshape(u)}return s}}),qE=T({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","any","bool"),o=it(t,r.shape),i=o,a=Xn(i,r.rank);a!=null&&(r=r.transpose(a),i=Kn(i.length,r.rank));var s=A.runKernelFunc(function(l){return l.any(r,i)},{$x:r});if(n){var u=Ut(s.shape,o);return s.reshape(u)}return s}}),XE=T({argMax_:function(e,t){t===void 0&&(t=0);var n=k(e,"x","argMax");t==null&&(t=0);var r=it(t,n.shape),o=Xn(r,n.rank);o!=null&&(n=n.transpose(o),r=Kn(r.length,n.rank));var i={axis:r[0]},a=[n];return A.runKernelFunc(function(s,u){var l=s.argMax(n,r[0]);return u([n]),l},{x:n},function(s,u){var l=u[0];return{x:function(){return Ce(l)}}},"ArgMax",i,a)}}),KE=T({argMin_:function(e,t){t===void 0&&(t=0);var n=k(e,"x","argMin");t==null&&(t=0);var r=it(t,n.shape),o=Xn(r,n.rank);return o!=null&&(n=n.transpose(o),r=Kn(r.length,n.rank)),A.runKernelFunc(function(i,a){var s=i.argMin(n,r[0]);return a([n]),s},{$x:n},function(i,a){var s=a[0];return{$x:function(){return Ce(s)}}})}}),QE=T({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","logSumExp"),o=it(t,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=Ut(s.shape,o);return s.reshape(u)}return s}}),Xu=T({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","max"),o=r,i=it(t,r.shape),a=i,s=Xn(a,r.rank);s!=null&&(r=r.transpose(s),a=Kn(a.length,r.rank));var u=[r],l=A.runKernelFunc(function(h,f){var d=h.max(r,a);return f([o,d]),d},{x:r},function(h,f){return uy(h,f[1],f[0],i,s)},"Max",{axes:a},u,[!0]);if(n){var c=Ut(l.shape,i);l=l.reshape(c)}return l}}),YE=T({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","mean"),o=it(t,r.shape),i=te(wt(r.shape,o)[1]);return Vu(function(a){var s=K(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(t,n),gradFunc:function(u){var l=a.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(Ei(a.shape,"float32")).div(i)}}})(r)}}),JE=T({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","min"),o=r,i=it(t,r.shape),a=i,s=Xn(a,r.rank);s!=null&&(r=r.transpose(s),a=Kn(a.length,r.rank));var u=[r],l=A.runKernelFunc(function(h,f){var d=h.min(r,a);return f([o,d]),d},{x:r},function(h,f){return uy(h,f[1],f[0],i,s)},"Min",{axes:a},u,[!0]);if(n){var c=Ut(l.shape,i);l=l.reshape(c)}return l}}),ZE=T({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=it(t,(e=k(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;n||(i=Ut(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),ly=T({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=it(t,r.shape);return Vu(function(i){var a=Xn(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=Kn(s.length,i.rank));var l=function(d){var p=i.shape.slice();return o.forEach(function(m){p[m]=1}),d.reshape(p).mul(Ei(i.shape,"float32"))},c={axes:s},h=A.runKernelFunc(function(d){return d.sum(u,s)},{x:u},function(d){return{x:function(){return l(d)}}},"Sum",c);if(n){var f=Ut(h.shape,o);h=h.reshape(f)}return{value:h,gradFunc:l}})(r)}}),ek=T({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=k(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=it(t,r.shape),i=Xn(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=Kn(a.length,r.rank));var u=A.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(n){var l=Ut(u.shape,o);u=u.reshape(l)}return u}}),cy=T({elu_:function(e){var t=k(e,"x","elu");return A.runKernelFunc(function(n,r){var o=n.elu(t);return r([o]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return A.runKernelFunc(function(i){return i.eluDer(n,o)},{dy:n,y:o})}}})}}),tk=T({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=k(e,"x","leakyRelu");return Tf(K(t).mul(n),n)}}),hy=T({prelu_:function(e,t){var n=k(e,"x","prelu"),r=k(t,"alpha","prelu");return A.runKernelFunc(function(o,i){var a=o.prelu(n,r);return i([n,r]),a},{x:n,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return yo(u,o,o.mul(s))},alpha:function(){var l=yo(u,Ce(o),o.mul(a)),c=rt(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),Ue=T({relu_:function(e){var t=k(e,"x","relu");return t.dtype==="bool"?t.toInt():A.runKernelFunc(function(n,r){var o=n.relu(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mulStrict(o.step().toFloat())}}},"Relu")}}),fy=T({relu6_:function(e){var t=k(e,"x","relu6");return t.dtype==="bool"?t.toInt():A.runKernelFunc(function(n,r){var o=n.relu6(t);return r([t]),o},{x:t},function(n,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return n.mulStrict(i.toFloat())}}},"Relu6")}}),nk=T({selu_:function(e){var t=k(e,"x","selu");return A.runKernelFunc(function(n,r){var o=n.selu(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){var i=o.greater(K(0)),a=K(Nf),s=K(Rf),u=n.mul(s),l=n.mul(a).mul(o.toFloat().exp());return yo(i,u,l)}}})}}),$r=T({transpose_:function(e,t){var n=k(e,"x","transpose");if(t==null&&(t=n.shape.map(function(o,i){return i}).reverse()),I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(o){I(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return A.runKernelFunc(function(o){return o.transpose(n,t)},{x:n},function(o){var i=gf(t);return{x:function(){return o.transpose(i)}}},"Transpose",r)}}),rk=T({localResponseNormalization_:function(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=k(e,"x","localResponseNormalization");I(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),I(Ke(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=A.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(a,t,n,r,o);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return A.runKernelFunc(function(d){return d.LRNGrad(l,h,f,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),dy=T({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(K(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(e=k(e,"x","norm"),t,n),i=o.shape;if(r){var a=it(n,e.shape);i=Ut(o.shape,a)}return o.reshape(i)}}),ok=T({basicLSTMCell_:function(e,t,n,r,o,i){var a=k(e,"forgetBias","basicLSTMCell"),s=k(t,"lstmKernel","basicLSTMCell"),u=k(n,"lstmBias","basicLSTMCell"),l=k(r,"data","basicLSTMCell"),c=k(o,"c","basicLSTMCell"),h=k(i,"h","basicLSTMCell"),f=l.concat(h,1).matMul(s).add(u),d=f.shape[0],p=f.shape[1]/4,m=[d,p],y=f.slice([0,0],m),v=f.slice([0,p],m),g=f.slice([0,2*p],m),x=f.slice([0,3*p],m),w=y.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(a.add(g).sigmoid())),b=w.tanh().mulStrict(x.sigmoid());return[w,b]}}),ik=T({multiRNNCell_:function(e,t,n,r){for(var o=k(t,"data","multiRNNCell"),i=uu(n,"c","multiRNNCell"),a=uu(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),ak=T({movingAverage_:function(e,t,n,r,o){o===void 0&&(o=!0);var i=k(e,"v","movingAverage"),a=k(t,"x","movingAverage"),s=k(n,"decay","movingAverage");r2(i,a),I(lt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=K(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){I(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=k(r,"step","movingAverage");c=c.div(u.sub(yu(s,h)))}return i.add(c)}}),sk=T({stridedSlice_:function(e,t,n,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=k(e,"x","stridedSlice"),c=Lp(s),h=l.shape.slice();c.forEach(function(y){t[y]=0,n[y]=1,h.splice(y,0,1)}),l=l.reshape(h);for(var f=0;f<l.rank;f++)t[f]=gb(o,t,r,l.shape,f),n[f]=yb(i,n,r,l.shape,f),r[f]=r[f]||1;var d=Lp(u);d.forEach(function(y){n[y]=t[y]+1,r[y]=1});var p=bf(t,n,r),m=p.filter(function(y,v){return d.indexOf(v)===-1});return r.every(function(y){return y===1})?Gn(l,t,p).reshape(m):A.runKernelFunc(function(y){return y.stridedSlice(l,t,n,r)},{$x:l}).reshape(m)}}),uk=T({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=k(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=A.runKernelFunc(function(a){return a.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),lk=T({scatterND_:function(e,t,n){var r=k(e,"indices","scatterND","int32"),o=k(t,"updates","scatterND");return vb(o,r,n),A.runKernelFunc(function(i){return i.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Ff=T({fft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return A.runKernelFunc(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}}),xu=T({ifft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return A.runKernelFunc(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}}),Mf=T({rfft_:function(e,t){I(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(t!=null&&t<r){var i=e.shape.map(function(v){return 0}),a=e.shape.map(function(v){return v});a[e.shape.length-1]=t,n=e.slice(i,a),r=t}else if(t!=null&&t>r){var s=e.shape.map(function(v){return v});s[e.shape.length-1]=t-r,n=e.concat(Oe(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=ft(n,u).as2D(o,r),c=Ff(l),h=Math.floor(r/2)+1,f=cn(c),d=jn(c),p=f.split([h,r-h],f.shape.length-1),m=d.split([h,r-h],d.shape.length-1),y=n.shape.slice();return y[n.shape.length-1]=h,ft(p[0],m[0]).reshape(y)}}),py=T({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=xu(r);return cn(o)}var i=[n,2*(t-1)],a=cn(e).as2D(n,t),s=jn(e).as2D(n,t),u=a.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(K(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=ft(c,h).as2D(i[0],i[1]),o=xu(r),cn(o)}}),ck=Object.freeze({fft:Ff,ifft:xu,rfft:Mf,irfft:py}),hk=T({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var o=k(e,"sparseIndices","sparseToDense","int32"),i=k(t,"sparseValues","sparseToDense"),a=k(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),A.runKernelFunc(function(s){return s.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),fk=T({gatherND_:function(e,t){var n=k(t,"indices","gatherND","int32"),r=k(e,"x","gatherND");return A.runKernelFunc(function(o){return o.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),dk=T({diag_:function(e){var t=k(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return A.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),pk=T({dropout_:function(e,t,n,r){var o=k(e,"x","dropout");if(I(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),I(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof ze?o.clone():o;var i=function(u,l){if(l==null)return u.shape.slice();if(lt(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(o,n),a=1-t,s=h0(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function vy(e,t,n){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=t-n*Math.cos(a)}return Ye(o,"float32")}var Of=T({hannWindow_:function(e){return vy(e,.5,.5)}}),my=T({hammingWindow_:function(e){return vy(e,.54,.46)}}),Bf=T({frame_:function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+t<=e.size;)a.push(Gn(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=tt([Gn(e,i,t-s),Hn([s],o)]);a.push(u),i+=n}return a.length===0?jr([],[0,t]):tt(a).as2D(a.length,t)}}),gy=T({stft_:function(e,t,n,r,o){var i;o===void 0&&(o=Of),r==null&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Bf(e,t,n),s=kt(a,o(t)),u=[],l=0;l<a.shape[0];l++)u.push(Mf(s.slice([l,0],[1,t]),r));return tt(u)}}),vk=Object.freeze({hannWindow:Of,hammingWindow:my,frame:Bf,stft:gy}),Et,mk=function(e,t,n){return n===void 0&&(n=1),Z(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,h,f,d,p,m,y;return ee(this,function(v){switch(v.label){case 0:return r=k(e,"predictions","inTopK"),o=k(t,"targets","inTopK"),I(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),I(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Ne(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],I(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],c=u[1],h=xa("bool",l=u[0]),f=0;f<l;f++){for(d=f*c,p=a.subarray(d,d+c),m=[],y=0;y<p.length;y++)m.push({value:p[y],index:y});for(m.sort(function(g,x){return x.value-g.value}),h[f]=0,y=0;y<n;y++)if(m[y].index===s[f]){h[f]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,pt(h,o.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Et||(Et={}));var gk=T({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Et.SUM_BY_NONZERO_WEIGHTS);var o=k(e,"labels","absoluteDifference"),i=k(t,"predictions","absoluteDifference"),a=null;n!=null&&(a=k(n,"weights","absoluteDifference")),Ne(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return pr(s,a,r)}}),pr=T({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Et.SUM_BY_NONZERO_WEIGHTS);var r=k(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=k(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(n===Et.NONE)return i;if(n===Et.SUM)return i.sum();if(n===Et.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(K(a)):s}if(n===Et.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(K(r.size));var u=o.mul(Ei(r.shape)).notEqual(K(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),yk=T({cosineDistance_:function(e,t,n,r,o){o===void 0&&(o=Et.SUM_BY_NONZERO_WEIGHTS);var i=k(e,"labels","cosineDistance"),a=k(t,"predictions","cosineDistance"),s=null;r!=null&&(s=k(r,"weights","cosineDistance")),Ne(i.shape,a.shape,"Error in cosineDistance: ");var u=K(1).sub(i.mul(a).sum(n,!0));return pr(u,s,o)}}),xk=T({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Et.SUM_BY_NONZERO_WEIGHTS);var o=k(e,"labels","hingeLoss"),i=k(t,"predictions","hingeLoss"),a=null;n!=null&&(a=k(n,"weights","hingeLoss")),Ne(o.shape,i.shape,"Error in hingeLoss: ");var s=K(1);o=K(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return pr(u,a,r)}}),wk=T({huberLoss_:function(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Et.SUM_BY_NONZERO_WEIGHTS);var i=k(e,"labels","huberLoss"),a=k(t,"predictions","huberLoss"),s=null;n!=null&&(s=k(n,"weights","huberLoss")),Ne(i.shape,a.shape,"Error in huberLoss: ");var u=K(r),l=a.sub(i).abs(),c=Q0(l,u),h=l.sub(c),f=K(.5).mul(c.square()).add(u.mul(h));return pr(f,s,o)}}),bk=T({logLoss_:function(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Et.SUM_BY_NONZERO_WEIGHTS);var i=k(e,"labels","logLoss"),a=k(t,"predictions","logLoss"),s=null;n!=null&&(s=k(n,"weights","logLoss")),Ne(i.shape,a.shape,"Error in logLoss: ");var u=K(1),l=K(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return pr(c,s,o)}}),Ck=T({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Et.SUM_BY_NONZERO_WEIGHTS);var o=k(e,"labels","meanSquaredError"),i=k(t,"predictions","meanSquaredError"),a=null;n!=null&&(a=k(n,"weights","meanSquaredError")),Ne(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return pr(s,a,r)}}),_k=T({sigmoidCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Et.SUM_BY_NONZERO_WEIGHTS);var i=k(e,"multiClassLabels","sigmoidCrossEntropy"),a=k(t,"logits","sigmoidCrossEntropy"),s=null;if(n!=null&&(s=k(n,"weights","sigmoidCrossEntropy")),Ne(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=K(r),l=K(1),c=K(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var h=function(f,d){var p=k(f,"labels","sigmoidCrossEntropyWithLogits"),m=k(d,"logits","sigmoidCrossEntropyWithLogits");Ne(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=m.relu(),v=m.mul(p),g=m.abs().neg().exp().log1p();return y.sub(v).add(g)}(i,a);return pr(h,s,o)}}),Ek=T({softmaxCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Et.SUM_BY_NONZERO_WEIGHTS);var i=k(e,"onehotLabels","softmaxCrossEntropy"),a=k(t,"logits","softmaxCrossEntropy"),s=null;if(n!=null&&(s=k(n,"weights","softmaxCrossEntropy")),Ne(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=K(r),l=K(1),c=K(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var h=function(f,d,p){if(p===void 0&&(p=-1),p===-1&&(p=d.rank-1),p!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+p);return Vu(function(m,y,v){var g=y.logSumExp([p],!0),x=y.toFloat().sub(g);return v([m,x]),{value:x.mul(m).neg().sum([p]),gradFunc:function(w,b){var C=b[0],S=b[1],E=Ut(w.shape,[p]);return[w.reshape(E).mul(C.toFloat().sub(S.exp())),w.reshape(E).mul(S.exp().sub(C.toFloat()))]}}})(f,d)}(i,a);return pr(h,s,o)}}),kk=Object.freeze({get Reduction(){return Et},absoluteDifference:gk,computeWeightedLoss:pr,cosineDistance:yk,hingeLoss:xk,huberLoss:wk,logLoss:bk,meanSquaredError:Ck,sigmoidCrossEntropy:_k,softmaxCrossEntropy:Ek});function av(e,t){return t===void 0&&(t=!1),A.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=c0(n),i=e.clone(),a=jr([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(h){var f,d=i,p=s,m=o;f=A.tidy(function(){var y=i.slice([h,h],[n-h,1]),v=y.norm(),g=i.slice([h,h],[1,1]),x=jr([[-1]]).where(g.greater(0),jr([[1]])),w=g.sub(x.mul(v)),b=y.div(w);s=b.shape[0]===1?a.clone():a.concat(b.slice([1,0],[b.shape[0]-1,b.shape[1]]),0);var C=x.matMul(w).div(v).neg(),S=i.slice([h,0],[n-h,r]),E=C.mul(s);if(h===0)i=S.sub(E.matMul(s.transpose().matMul(S)));else{var R=S.sub(E.matMul(s.transpose().matMul(S)));i=i.slice([0,0],[h,r]).concat(R,0)}var N=o.slice([0,h],[n,o.shape[1]-h]);if(h===0)o=N.sub(N.matMul(s).matMul(E.transpose()));else{var P=N.sub(N.matMul(s).matMul(E.transpose()));o=o.slice([0,0],[n,h]).concat(P,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],zt([d,p,m])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var Sk=T({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=k(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),n<0&&(n=s);var u=lu(0,a,1,"int32").reshape([-1,1]),l=lu(0,s,1,"int32"),c=ot(u,l),h=Hu(c.lessEqual(K(+t,"int32")),c.greaterEqual(K(-n,"int32"))),f=Oe([a,s],r.dtype);return Zt(nt(r.reshape([-1,a,s])).map(function(d){return yo(h,d,f)})).reshape(o)}}),Nk=T({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,I(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(u){I(e[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=xf(e,e.shape[0],0).map(function(u){return d0(u,[0])});I(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],a=e,s=function(u){i.push(A.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=ly(i[c].mulStrict(l)).mul(i[c]);l=l.sub(h)}return l.div(dy(l,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Zt(i,0):i}}),Rk=T({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return av(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(a,s){return a*s}),r=nt(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=av(a,t),u=s[0],l=s[1];o.push(u),i.push(l)}),[Zt(o,0).reshape(e.shape),Zt(i,0).reshape(e.shape)]}}),Ik=Object.freeze({bandPart:Sk,gramSchmidt:Nk,qr:Rk});function Ku(e,t,n,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=e.shape[0];return n=Math.min(n,a),I(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),I(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),I(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),I(t.rank===1,function(){return"scores must be a 1D tensor"}),I(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),I(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var Tk=T({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=k(e,"images","resizeBilinear");I(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=A.runKernelFunc(function(l,c){return c([o]),l.resizeBilinear(o,a,s,n)},{x:o},function(l,c){return{x:function(){return A.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Pk=T({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=k(e,"images","resizeNearestNeighbor");I(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),I(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=A.runKernelFunc(function(l,c){return c([o]),l.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(l,c){return{batchImages:function(){return A.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Dk=T({nonMaxSuppression_:function(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=k(e,"boxes","nonMaxSuppression"),a=k(t,"scores","nonMaxSuppression"),s=Ku(i,a,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return A.runKernelFunc(function(l){return l.nonMaxSuppression(i,a,n,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),Ak=function(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Z(this,void 0,void 0,function(){var i,a,s,u,l,c,h;return ee(this,function(f){switch(f.label){case 0:return i=k(e,"boxes","nonMaxSuppressionAsync"),a=k(t,"scores","nonMaxSuppressionAsync"),s=Ku(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],h=_f(l,c,n,r,o),i!==e&&i.dispose(),a!==t&&a.dispose(),[2,h]}})})},Fk=T({nonMaxSuppressionWithScore_:function(e,t,n,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=k(e,"boxes","nonMaxSuppression"),s=k(t,"scores","nonMaxSuppression"),u=Ku(a,s,n,r,o,i),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},c=A.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),Mk=function(e,t,n,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Z(this,void 0,void 0,function(){var a,s,u,l,c,h,f;return ee(this,function(d){switch(d.label){case 0:return a=k(e,"boxes","nonMaxSuppressionAsync"),s=k(t,"scores","nonMaxSuppressionAsync"),u=Ku(a,s,n,r,o,i),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=d.sent(),c=l[0],h=l[1],f=Ef(c,h,n,r,o,i),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,f]}})})},Ok=T({cropAndResize_:function(e,t,n,r,o,i){var a=k(e,"image","cropAndResize"),s=k(t,"boxes","cropAndResize","float32"),u=k(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return I(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),I(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),I(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),I(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),I(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),I(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),A.runKernelFunc(function(c,h){return c.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Lf=Object.freeze({resizeBilinear:Tk,resizeNearestNeighbor:Pk,nonMaxSuppression:Dk,nonMaxSuppressionAsync:Ak,nonMaxSuppressionWithScore:Fk,nonMaxSuppressionWithScoreAsync:Mk,cropAndResize:Ok}),jf=function(e,t){return!(e>0)||t==="linear"},Wf=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},zf=function(e,t){var n=t,r=rt(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Uf=function(e,t,n){if(t==="linear")return e;if(t==="relu")return Ue(e);if(t==="elu")return cy(e);if(t==="relu6")return fy(e);if(t==="prelu")return hy(e,n);throw new Error("Unknown fused activation "+t+".")},Bk=T({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,i=o!==void 0&&o,a=e.transposeB,s=a!==void 0&&a,u=e.bias,l=e.activation,c=l===void 0?"linear":l,h=e.preluActivationWeights;if(jf(A.state.gradientDepth,c)===!1){var f=qu(n,r,i,s);return u!=null&&(f=ge(f,u)),Uf(f,c,h)}var d=k(n,"a","fused matMul"),p=k(r,"b","fused matMul");t=He(d,p),d=t[0],p=t[1];var m=i?d.shape[d.rank-2]:d.shape[d.rank-1],y=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?d.shape[d.rank-1]:d.shape[d.rank-2],g=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=d.shape.slice(0,-2),w=p.shape.slice(0,-2),b=te(x),C=te(w);I(d.rank>=2&&p.rank>=2&&d.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."}),I(lt(x,w),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+w+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."}),I(m===y,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+y+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var S,E,R=d.shape.slice(0,-2).concat([v,g]),N=i?d.as3D(b,m,v):d.as3D(b,v,m),P=s?p.as3D(C,g,y):p.as3D(C,y,g);u!=null&&xe(R,(S=He(S=k(u,"bias","fused matMul"),d)[0]).shape),h!=null&&(E=k(h,"prelu weights","fused matMul"));var D={a:N,b:P};u!=null&&(D.bias=S),h!=null&&(D.preluActivationWeights=E);var z=[N,P];return A.runKernelFunc(function(W,j){var $=W.fusedBatchMatMul({a:N,b:P,transposeA:i,transposeB:s,bias:S,activation:c,preluActivationWeights:E});return j([N,P,$]),$},D,function(W,j){var $=j[0],V=j[1],F=j[2],M=Wf(W,F,c),B={};return u!=null&&(B={bias:function(){return zf(S,M)}}),Object.assign(i||s?!i&&s?{a:function(){return M.matMul(V,!1,!1)},b:function(){return M.matMul($,!0,!1)}}:i&&!s?{a:function(){return V.matMul(M,!1,!0)},b:function(){return $.matMul(M,!1,!1)}}:{a:function(){return V.matMul(M,!0,!0)},b:function(){return M.matMul($,!0,!0)}}:{a:function(){return M.matMul(V,!1,!0)},b:function(){return $.matMul(M,!0,!1)}},B)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:c},z,[!0]).reshape(R)}}),Lk=T({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,h=e.activation,f=h===void 0?"linear":h,d=e.preluActivationWeights;if(f=f||"linear",jf(A.state.gradientDepth,f)===!1){var p=mn(t,n,r,o,a,u,l);return c!=null&&(p=ge(p,c)),Uf(p,f,d)}var m=k(t,"x","conv2d"),y=k(n,"filter","conv2d"),v=m,g=!1;m.rank===3&&(g=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),I(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),I(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),l!=null&&I(Ke(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),I(v.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),I(Vt(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),I(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,w,b=Eo(v.shape,y.shape,r,u,o,l);c!=null&&(x=He(x=k(c,"bias","fused conv2d"),m)[0],xe(b.outShape,x.shape)),d!=null&&(w=k(d,"prelu weights","fused conv2d"));var C={x:v,filter:y};c!=null&&(C.bias=x),d!=null&&(C.preluActivationWeights=w);var S=[y,v],E=A.runKernelFunc(function(R,N){var P=R.fusedConv2d({input:v,filter:y,convInfo:b,bias:x,activation:f,preluActivationWeights:w});return N([y,v,P]),P},C,function(R,N){var P=N,D=P[0],z=P[1],W=P[2],j=Wf(R,W,f);I(xi(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var $={};return c!=null&&($={bias:function(){return zf(x,j)}}),Object.assign({x:function(){return ny(z.shape,j,D,r,o)},filter:function(){return Df(z,j,D.shape,r,o)}},$)},"FusedConv2D",{convInfo:b,activation:f},S,[!0]);return g?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),jk=T({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,h=e.activation,f=h===void 0?"linear":h,d=e.preluActivationWeights;if(jf(A.state.gradientDepth,f)===!1){var p=Gu(t,n,r,o,a,u,l);return c!=null&&(p=ge(p,c)),Uf(p,f,d)}var m=k(t,"x","depthwiseConv2d"),y=k(n,"filter","depthwiseConv2d"),v=m,g=!1;m.rank===3&&(g=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),I(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),I(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),I(v.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),u==null&&(u=[1,1]),I(Vt(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&I(Ke(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var x,w,b=Eo(v.shape,y.shape,r,u,o,l,!0);c!=null&&(x=He(x=k(c,"bias","fused conv2d"),m)[0],xe(b.outShape,x.shape)),d!=null&&(w=k(d,"prelu weights","fused depthwiseConv2d"));var C={x:v,filter:y};c!=null&&(C.bias=x),d!=null&&(C.preluActivationWeights=w);var S=[y,v],E=A.runKernelFunc(function(R,N){var P=R.fusedDepthwiseConv2D({input:v,filter:y,convInfo:b,bias:x,activation:f,preluActivationWeights:w});return N([y,v,P]),P},C,function(R,N){I(xi(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var P=N[0],D=N[1],z=N[2],W=Wf(R,z,f),j={};return c!=null&&(j={bias:function(){return zf(x,W)}}),Object.assign({x:function(){return ry(D.shape,W,P,b)},filter:function(){return oy(D,W,P.shape,b)}},j)},"FusedDepthwiseConv2D",{convInfo:b,activation:f},S,[!0]);return g?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Wk=Object.freeze({matMul:Bk,conv2d:Lk,depthwiseConv2d:jk}),zk=Object.freeze({image:Lf,linalg:Ik,losses:kk,spectral:ck,fused:Wk,signal:vk,square:b_,squaredDifference:W0,conv1d:TE,conv2d:mn,conv3d:PE,depthwiseConv2d:Gu,separableConv2d:Af,conv2dTranspose:DE,conv3dTranspose:AE,op:T,batchNormalization2d:Y_,batchNormalization3d:J_,batchNormalization4d:Z_,batchNormalization:eE,batchNorm:G0,batchNorm2d:tE,batchNorm3d:nE,batchNorm4d:rE,booleanMaskAsync:IE,complex:ft,real:cn,imag:jn,concat:tt,concat1d:W2,concat2d:z2,concat3d:U2,concat4d:V2,split:xf,matMul:qu,dot:FE,outerProduct:ME,reverse:Oa,reverse1d:OE,reverse2d:BE,reverse3d:LE,reverse4d:jE,maxPool:at,avgPool:Ba,pool:WE,maxPool3d:zE,avgPool3d:UE,slice:Gn,slice1d:VE,slice2d:$E,slice3d:sy,slice4d:HE,abs:C_,acos:__,acosh:E_,asin:k_,asinh:S_,atan:N_,atanh:R_,ceil:I_,clipByValue:If,cos:T_,cosh:P_,erf:D_,exp:ch,expm1:A_,floor:F_,log:M_,log1p:O_,logSigmoid:B_,neg:gu,reciprocal:L_,round:j_,rsqrt:z0,sigmoid:U0,sign:W_,isNaN:z_,isInf:U_,isFinite:V_,sin:$_,sinh:H_,softplus:G_,sqrt:q_,step:X_,tan:K_,tanh:Q_,all:GE,any:qE,argMax:XE,argMin:KE,logSumExp:QE,max:Xu,mean:YE,min:JE,moments:ZE,sum:ly,prod:ek,equal:Y0,equalStrict:xE,greater:wE,greaterEqual:J0,greaterEqualStrict:bE,greaterStrict:CE,less:_E,lessEqual:EE,lessEqualStrict:kE,lessStrict:SE,notEqual:NE,notEqualStrict:RE,add:ge,addN:aE,addStrict:sE,atan2:uE,div:_n,divNoNan:lE,divStrict:cE,floorDiv:K0,maximum:Tf,maximumStrict:hE,minimum:Q0,minimumStrict:fE,mod:dE,modStrict:pE,mul:kt,mulStrict:vE,pow:yu,powStrict:mE,squaredDifferenceStrict:gE,sub:ot,subStrict:yE,elu:cy,leakyRelu:tk,prelu:hy,relu:Ue,relu6:fy,selu:nk,logicalAnd:Hu,logicalNot:oE,logicalOr:q0,logicalXor:iE,where:yo,whereAsync:X0,buffer:he,print:J2,batchToSpaceND:l0,broadcastTo:Z2,cast:eb,clone:tb,cumsum:nb,depthToSpace:rb,expandDims:ln,eye:c0,multinomial:ob,oneHot:ah,pad:_o,pad1d:ib,pad2d:ab,pad3d:sb,pad4d:ub,rand:lb,randomNormal:cb,randomGamma:hb,randomUniform:h0,reshape:En,spaceToBatchND:f0,squeeze:d0,stack:Zt,tile:ni,truncatedNormal:fb,unstack:nt,setdiff1dAsync:db,fill:Hn,linspace:j2,ones:Ei,range:lu,scalar:K,tensor:pt,tensor1d:Ye,tensor2d:jr,tensor3d:yf,tensor4d:Mt,tensor5d:O2,tensor6d:B2,variable:L2,zeros:Oe,onesLike:u0,zerosLike:Ce,transpose:$r,softmax:dr,logSoftmax:wb,localResponseNormalization:rk,norm:dy,gather:Pf,unsortedSegmentSum:Z0,basicLSTMCell:ok,multiRNNCell:ik,movingAverage:ak,stridedSlice:sk,topk:uk,scatterND:lk,fft:Ff,ifft:xu,rfft:Mf,irfft:py,sparseToDense:hk,gatherND:fk,diag:dk,dropout:pk,hannWindow:Of,hammingWindow:my,frame:Bf,stft:gy,inTopKAsync:mk});function H(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&I(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function ql(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Uk=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new w0(n,A),n}return In(t,e),t.prototype.write=function(n,r,o){this.firstUse&&(this.firstUse=!1,U().get("IS_NODE")&&su(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:n,dtype:o}),i},t.prototype.move=function(n,r,o,i){this.data.set(n,{values:r,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),o=r.dtype,i=r.complexTensors;return o==="complex64"?lh(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),o=r;if(n.dtype==="string")try{o=r.map(function(i){return ou(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return he(n.shape,n.dtype,o)},t.prototype.makeOutput=function(n,r,o){var i=this.write(n,r,o);return A.makeTensorFromDataId(i,r,o,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return Z(this,void 0,void 0,function(){var r;return ee(this,function(o){return r=On(),n(),[2,{kernelMs:On()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var o=this.makeOutput(null,n.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:A.keep(n.clone()),imag:A.keep(r.clone())},o},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(H(n,"slice"),y0(n.shape,r,o)){var i=x0(r,n.strides),a=te(o);return pt(this.readSync(n.dataId).subarray(i,i+a),o,n.dtype)}for(var s=he(o,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(h,f){return h+r[f]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(n,r,o,i){H(n,"stridedSlice");var a=bf(r,o,i);if(a.some(function(d){return d===0}))return pt([],a);for(var s=he(a,n.dtype),u=this.bufferSync(n),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),f=0;f<h.length;f++)h[f]=c[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),o=he([n.size,n.size],n.dtype),i=o.values,a=0;a<r.length;a++)i[a*n.size+a]=r[a];return o.toTensor()},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.reverse=function(n,r){H(n,"reverse");for(var o=he(n.shape,n.dtype),i=this.bufferSync(n),a=function(u){var l=o.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=n.shape[h]-1-c[h]}),o.set.apply(o,[i.get.apply(i,c)].concat(l))},s=0;s<o.size;s++)a(s);return o.toTensor()},t.prototype.concat=function(n,r){var o=this;if(n[0].dtype==="complex64"){var i=n.map(function(d){return cn(d)}),a=n.map(function(d){return jn(d)});return ft(this.concat(i,r),this.concat(a,r))}var s=n.map(function(d){var p=te(d.shape.slice(r));return d.as2D(-1,p)}),u=yi(s.map(function(d){return d.shape}),1),l=he(u,n[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(d){l.set(o.readSync(d.dataId),c),c+=d.size})}else{var h=0;s.forEach(function(d){for(var p=o.readSync(d.dataId),m=0,y=0;y<d.shape[0];++y)for(var v=y*u[1]+h,g=0;g<d.shape[1];++g)l[v+g]=p[m++];h+=d.shape[1]})}var f=yi(n.map(function(d){return d.shape}),r);return pt(l,f,n[0].dtype)},t.prototype.neg=function(n){return H(n,"neg"),this.multiply(K(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(n,r,dt(n.dtype,r.dtype),function(o,i){return o+i})},t.prototype.addN=function(n){var r=this;H(n,"addN");for(var o=n.map(function(c){return r.readSync(c.dataId)}),i=he(n[0].shape,n[0].dtype),a=i.values,s=0;s<n.length;s++)for(var u=o[s],l=0;l<a.length;l++)a[l]+=u[l];return i.toTensor()},t.prototype.softmax=function(n,r){var o=it([r],n.shape),i=this.max(n,o),a=Ut(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(n,r,dt(n.dtype,r.dtype),function(o,i){return o-i})},t.prototype.pow=function(n,r){return H([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.pow(o,i)})},t.prototype.batchMatMul=function(n,r,o,i){H([n,r],"matMul");for(var a=o?n.shape[1]:n.shape[2],s=o?n.shape[2]:n.shape[1],u=i?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),h=this.readSync(r.dataId),f=o?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],d=f[0],p=f[1],m=f[2],y=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=y[0],g=y[1],x=y[2],w=s*u,b=he([l,s,u],n.dtype),C=b.values,S=this.blockSize,E=0;E<l;E++)for(var R=0;R<s;R+=S)for(var N=0;N<u;N+=S)for(var P=0;P<a;P+=S)for(var D=Math.min(R+S,s),z=Math.min(N+S,u),W=Math.min(P+S,a),j=R;j<D;j++)for(var $=N;$<z;$++){for(var V=0,F=P;F<W;F++)V+=c[E*d+j*p+F*m]*h[F*v+$*g+E*x];C[E*w+(j*u+$)]+=V}return b.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,o,i,a);return s&&(c=this.add(c,s)),u&&(c=ql(this,c,u,l)),c},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(n,r,dt(n.dtype,r.dtype),function(o,i){return o*i})},t.prototype.realDivide=function(n,r){return H([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(o,i){return o/i})},t.prototype.floorDiv=function(n,r){return H([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(o,i){return Math.floor(o/i)})},t.prototype.sum=function(n,r){H(n,"sum"),Gt("sum",r,n.rank);for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,dt(n.dtype,"int32")),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=0,p=0;p<u;++p)d+=c[f+p];l[h]=d}return s},t.prototype.prod=function(n,r){H(n,"sum");for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,dt(n.dtype,"int32")),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=1,p=0;p<u;++p)d*=c[f+p];l[h]=d}return s},t.prototype.unsortedSegmentSum=function(n,r,o){H(n,"unsortedSegmentSum");for(var i=[],a=n.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=K(s,"int32"),l=Y0(u,r).asType("float32").mul(n).sum(0);i.push(l)}return Zt(i)},t.prototype.argMin=function(n,r){H(n,"argMin");var o=[r];Gt("argMin",o,n.rank);for(var i=wt(n.shape,o),a=i[0],s=i[1],u=Oe(a,"int32"),l=te(s),c=this.readSync(u.dataId),h=this.readSync(n.dataId),f=0;f<c.length;++f){for(var d=f*l,p=h[d],m=0,y=0;y<l;++y){var v=h[d+y];v<p&&(p=v,m=y)}c[f]=m}return u},t.prototype.argMax=function(n,r){H(n,"argMax");var o=[r];Gt("argMax",o,n.rank);for(var i=wt(n.shape,o),a=i[0],s=i[1],u=Oe(a,"int32"),l=te(s),c=this.readSync(u.dataId),h=this.readSync(n.dataId),f=0;f<c.length;++f){for(var d=f*l,p=h[d],m=0,y=0;y<l;++y){var v=h[d+y];v>p&&(p=v,m=y)}c[f]=m}return u},t.prototype.cumsum=function(n,r,o,i){if(H(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var a=dt(n.dtype,"int32"),s=Oe(n.shape,a),u=this.readSync(s.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],h=i?function(y,v){return y+c-v-1}:function(y,v){return y+v},f=0;f<l.length;f+=c)for(var d=0;d<c;d++){var p=h(f,d);if(d===0)u[p]=o?0:l[p];else{var m=h(f,d-1);u[p]=o?l[m]+u[m]:l[p]+u[m]}}return s},t.prototype.equal=function(n,r){return H([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o===i?1:0})},t.prototype.notEqual=function(n,r){return H([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o!==i?1:0})},t.prototype.less=function(n,r){return H([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<i?1:0})},t.prototype.lessEqual=function(n,r){return H([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<=i?1:0})},t.prototype.greater=function(n,r){return H([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>i?1:0})},t.prototype.greaterEqual=function(n,r){return H([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>=i?1:0})},t.prototype.logicalNot=function(n){H(n,"logicalNot");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return H([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o&&i})},t.prototype.logicalOr=function(n,r){return H([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o||i})},t.prototype.select=function(n,r,o){H([n,r,o],"select");for(var i=this.readSync(n.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Oe(r.shape,dt(r.dtype,o.dtype)),l=this.readSync(u.dataId),c=0,h=n.rank===0||n.rank>1||r.rank===1?1:te(r.shape.slice(1)),f=0;f<i.length;f++)for(var d=0;d<h;d++)i[f]===1?l[c++]=a[f]:l[c++]=s[f];return u},t.prototype.where=function(n){H([n],"where");var r=this.readSync(n.dataId);return kf(n.shape,r)},t.prototype.topk=function(n,r,o){return H(n,"topk"),R0(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){H(n,"min"),Gt("min",r,n.rank);for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,n.dtype),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var m=c[f+p];m<d&&(d=m)}l[h]=d}return s},t.prototype.minimum=function(n,r){return H([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.min(o,i)})},t.prototype.mod=function(n,r){return H([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},t.prototype.max=function(n,r){H(n,"max"),Gt("max",r,n.rank);for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,n.dtype),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var m=c[f+p];m>d&&(d=m)}l[h]=d}return s},t.prototype.maximum=function(n,r){return H([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.max(o,i)})},t.prototype.all=function(n,r){H(n,"all"),Gt("all",r,n.rank);for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,n.dtype),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var m=c[f+p];d=d&&m}l[h]=d}return s},t.prototype.any=function(n,r){H(n,"any"),Gt("any",r,n.rank);for(var o=wt(n.shape,r),i=o[0],a=o[1],s=Oe(i,n.dtype),u=te(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var m=c[f+p];d=d||m}l[h]=d}return s},t.prototype.squaredDifference=function(n,r){return H([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o-i;return a*a})},t.prototype.ceil=function(n){H(n,"ceil");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.floor=function(n){H(n,"floor");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.sign=function(n){H(n,"x");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,n.shape,"float32")},t.prototype.isNaN=function(n){H(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isInf=function(n){H(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isFinite=function(n){H(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.round=function(n){H(n,"round");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,n.shape,"float32")},t.prototype.exp=function(n){H(n,"exp");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.expm1=function(n){H(n,"expm1");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.log=function(n){H(n,"log");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.log1p=function(n){H(n,"log1p");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.sqrt=function(n){H(n,"sqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.rsqrt=function(n){H(n,"rsqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.reciprocal=function(n){H(n,"reciprocal");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){H(n,"relu");for(var r=Oe(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},t.prototype.relu6=function(n){H(n,"relu");for(var r=Oe(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},t.prototype.prelu=function(n,r){return H([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return o<0?i*o:o})},t.prototype.elu=function(n){H(n,"elu");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){H([n,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(n.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(n){H(n,"selu");for(var r=Nf,o=Rf,i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,n.shape,"float32")},t.prototype.clip=function(n,r,o){H(n,"clip");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<n.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){H(n,"int");for(var r=new Int32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){H(n,"sigmoid");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){H(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,l=Math.exp(i[a]),c=void 0;c=u?l:s?i[a]:Math.log(1+l),o[a]=c}return this.makeOutput(o,n.shape,"float32")},t.prototype.sin=function(n){H(n,"sin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){H(n,"cos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){H(n,"tan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){H(n,"asin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){H(n,"acos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){H(n,"atan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return H([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.atan2(o,i)})},t.prototype.sinh=function(n){H(n,"sinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){H(n,"cosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){H(n,"tanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Vw(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){H(n,"asinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){H(n,"acosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){H(n,"atanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){H(n,"erf");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),H(n,"step");for(var o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,o,i);return a&&(l=this.add(l,a)),s&&(l=ql(this,l,s,u)),l},t.prototype.conv2d=function(n,r,o){H([n,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,h=o.dataFormat==="channelsLast",f=he(o.outShape,n.dtype),d=n.strides[0],p=h?n.strides[1]:n.strides[2],m=h?n.strides[2]:1,y=h?1:n.strides[1],v=f.strides[0],g=h?f.strides[1]:f.strides[2],x=h?f.strides[2]:1,w=h?1:f.strides[1],b=this.readSync(n.dataId),C=this.readSync(r.dataId),S=f.values,E=0;E<o.batchSize;++E)for(var R=E*d,N=E*v,P=0;P<o.outHeight;++P)for(var D=N+P*g,z=P*o.strideHeight-c,W=0;W<i;W++){var j=z+W*s;if(!(j<0||j>=o.inHeight))for(var $=W*r.strides[0],V=R+j*p,F=0;F<o.outWidth;++F)for(var M=D+F*x,B=F*o.strideWidth-l,G=0;G<a;G++){var X=B+G*u;if(!(X<0||X>=o.inWidth))for(var ne=V+X*m,ae=$+G*r.strides[1],se=0;se<o.inChannels;++se){for(var ue=b[ne+se*y],de=0;de<o.outChannels;++de)S[M+de*w]+=ue*C[ae+de];ae+=o.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,l=o.dilationHeight,c=o.dilationWidth,h=o.padInfo.front,f=o.padInfo.left,d=o.padInfo.top,p=he(o.outShape,n.dtype),m=this.readSync(n.dataId),y=this.readSync(r.dataId),v=p.values,g=0;g<o.batchSize;++g)for(var x=g*n.strides[0],w=g*p.strides[0],b=0;b<o.outDepth;++b)for(var C=w+b*p.strides[1],S=b*o.strideDepth-h,E=0;E<i;E++){var R=S+E*u;if(!(R<0||R>=o.inDepth))for(var N=E*r.strides[0],P=x+R*n.strides[1],D=0;D<o.outHeight;++D)for(var z=C+D*p.strides[2],W=D*o.strideHeight-d,j=0;j<a;j++){var $=W+j*l;if(!($<0||$>=o.inHeight))for(var V=N+j*r.strides[1],F=P+$*n.strides[2],M=0;M<o.outWidth;++M)for(var B=z+M*o.outChannels,G=M*o.strideWidth-f,X=0;X<s;X++){var ne=G+X*c;if(!(ne<0||ne>=o.inWidth))for(var ae=V+X*r.strides[2],se=F+ne*o.inChannels,ue=ae,de=0;de<o.inChannels;++de){for(var ve=m[se+de],be=0;be<o.outChannels;++be)v[B+be]+=ve*y[ue+be];ue+=o.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(n,r,o){H([n,r],"conv2dDerInput");for(var i=he(o.inShape,"float32"),a=i.values,s=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],f=l[2],d=o.batchSize,p=o.filterHeight,m=o.filterWidth,y=o.inChannels,v=o.inHeight,g=o.inWidth,x=o.outChannels,w=o.outHeight,b=o.outWidth,C=o.strideHeight,S=o.strideWidth,E=o.dataFormat,R=p-1-o.padInfo.top,N=m-1-o.padInfo.left,P=E==="channelsLast",D=i.strides[0],z=P?i.strides[1]:i.strides[2],W=P?i.strides[2]:1,j=P?1:i.strides[1],$=n.strides[0],V=P?n.strides[1]:n.strides[2],F=P?n.strides[2]:1,M=P?1:n.strides[1],B=0;B<d;++B)for(var G=0;G<y;++G)for(var X=0;X<v;++X)for(var ne=X-R,ae=Math.max(0,Math.ceil(ne/C)),se=Math.min(w,(p+ne)/C),ue=0;ue<g;++ue){for(var de=ue-N,ve=Math.max(0,Math.ceil(de/S)),be=Math.min(b,(m+de)/S),De=0,ye=ae;ye<se;++ye)for(var Ee=ye*C-ne,me=ve;me<be;++me)for(var Le=$*B+V*ye+F*me,Ae=c*(p-1-Ee)+h*(m-1-(me*S-de))+f*G,Ie=0;Ie<x;++Ie)De+=s[Le+M*Ie]*u[Ae+Ie];a[D*B+z*X+W*ue+j*G]=De}return i.toTensor()},t.prototype.conv3dDerInput=function(n,r,o){for(var i=he(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],h=s[3],f=this.readSync(n.dataId),d=n.strides,p=d[0],m=d[1],y=d[2],v=d[3],g=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],C=x[2],S=x[3],E=o.batchSize,R=o.filterDepth,N=o.filterHeight,P=o.filterWidth,D=o.inChannels,z=o.inDepth,W=o.inHeight,j=o.inWidth,$=o.outChannels,V=o.outDepth,F=o.outHeight,M=o.outWidth,B=o.strideDepth,G=o.strideHeight,X=o.strideWidth,ne=R-1-o.padInfo.front,ae=N-1-o.padInfo.top,se=P-1-o.padInfo.left,ue=0;ue<E;++ue)for(var de=0;de<D;++de)for(var ve=0;ve<z;++ve)for(var be=ve-ne,De=Math.max(0,Math.ceil(be/B)),ye=Math.min(V,(R+be)/B),Ee=0;Ee<W;++Ee)for(var me=Ee-ae,Le=Math.max(0,Math.ceil(me/G)),Ae=Math.min(F,(N+me)/G),Ie=0;Ie<j;++Ie){for(var rn=Ie-se,on=Math.max(0,Math.ceil(rn/X)),Rt=Math.min(M,(P+rn)/X),yr=0,$t=De;$t<ye;++$t)for(var gn=$t*B-be,an=Le;an<Ae;++an)for(var Yn=an*G-me,yn=on;yn<Rt;++yn)for(var ki=p*ue+m*$t+y*an+v*yn,xr=w*(R-1-gn)+b*(N-1-Yn)+C*(P-1-(yn*X-rn))+S*de,Q=0;Q<$;++Q)yr+=f[ki+Q]*g[xr+Q];a[u*ue+l*ve+c*Ee+h*Ie+de]=yr}return i.toTensor()},t.prototype.conv2dDerFilter=function(n,r,o){H([n,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dataFormat==="channelsLast",c=he(o.filterShape,"float32"),h=o.padInfo.left,f=o.padInfo.top,d=this.bufferSync(n),p=this.bufferSync(r),m=0;m<s;++m)for(var y=Math.max(0,Math.ceil((f-m)/i)),v=Math.min(o.outHeight,(o.inHeight+f-m)/i),g=0;g<u;++g)for(var x=Math.max(0,Math.ceil((h-g)/a)),w=Math.min(o.outWidth,(o.inWidth+h-g)/a),b=0;b<o.inChannels;++b)for(var C=0;C<o.outChannels;++C){for(var S=0,E=0;E<o.batchSize;++E)for(var R=y;R<v;++R)for(var N=m+R*i-f,P=x;P<w;++P){var D=g+P*a-h;S+=l?d.get(E,N,D,b)*p.get(E,R,P,C):d.get(E,b,N,D)*p.get(E,C,R,P)}c.set(S,m,g,b,C)}return c.toTensor()},t.prototype.conv3dDerFilter=function(n,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,h=he(o.filterShape,"float32"),f=h.values,d=h.strides,p=d[0],m=d[1],y=d[2],v=d[3],g=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],C=x[2],S=x[3],E=this.readSync(n.dataId),R=n.strides,N=R[0],P=R[1],D=R[2],z=R[3],W=o.padInfo.front,j=o.padInfo.left,$=o.padInfo.top,V=0;V<u;++V)for(var F=Math.max(0,Math.ceil((W-V)/i)),M=Math.min(o.outDepth,(o.inDepth+W-V)/i),B=V*p,G=0;G<l;++G)for(var X=Math.max(0,Math.ceil(($-G)/a)),ne=Math.min(o.outHeight,(o.inHeight+$-G)/a),ae=G*m+B,se=0;se<c;++se)for(var ue=Math.max(0,Math.ceil((j-se)/s)),de=Math.min(o.outWidth,(o.inWidth+j-se)/s),ve=se*y+ae,be=0;be<o.inChannels;++be)for(var De=be*v+ve,ye=0;ye<o.outChannels;++ye){for(var Ee=0,me=0;me<o.batchSize;++me)for(var Le=me*N,Ae=me*w,Ie=F;Ie<M;++Ie)for(var rn=(V+Ie*i-W)*P+Le,on=Ie*b+Ae,Rt=X;Rt<ne;++Rt)for(var yr=(G+Rt*a-$)*D+rn,$t=Rt*C+on,gn=ue;gn<de;++gn){var an=gn*S+$t;Ee+=E[(se+gn*s-j)*z+yr+be]*g[an+ye]}f[De+ye]=Ee}return h.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,o,i);return a&&(l=this.add(l,a)),s&&(l=ql(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(n,r,o){H([n,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,h=o.outChannels/o.inChannels,f=he(o.outShape,n.dtype),d=this.readSync(n.dataId),p=this.readSync(r.dataId),m=f.values,y=0;y<o.batchSize;++y)for(var v=y*n.strides[0],g=y*f.strides[0],x=0;x<o.outHeight;++x)for(var w=g+x*f.strides[1],b=x*o.strideHeight-l,C=0;C<i;++C){var S=b+C*s;if(!(S<0||S>=o.inHeight))for(var E=C*r.strides[0],R=v+S*n.strides[1],N=0;N<o.outWidth;++N)for(var P=w+N*f.strides[2],D=N*o.strideWidth-c,z=0;z<a;++z){var W=D+z*u;if(!(W<0||W>=o.inWidth))for(var j=E+z*r.strides[1],$=R+W*o.inChannels,V=P,F=j,M=0;M<o.inChannels;++M){for(var B=d[$+M],G=0;G<h;++G)m[V+G]+=B*p[F+G];V+=h,F+=h}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,o){H([n,r],"depthwiseConv2DDerInput");for(var i=he(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(n.dataId),f=n.strides,d=f[0],p=f[1],m=f[2],y=this.readSync(r.dataId),v=r.strides,g=v[0],x=v[1],w=v[2],b=o.batchSize,C=o.filterHeight,S=o.filterWidth,E=o.inChannels,R=o.inHeight,N=o.inWidth,P=o.outChannels,D=o.outHeight,z=o.outWidth,W=o.strideHeight,j=o.strideWidth,$=C-1-o.padInfo.top,V=S-1-o.padInfo.left,F=P/E,M=0;M<b;++M)for(var B=0;B<E;++B)for(var G=0;G<R;++G)for(var X=G-$,ne=Math.max(0,Math.ceil(X/W)),ae=Math.min(D,(C+X)/W),se=0;se<N;++se){for(var ue=se-V,de=Math.max(0,Math.ceil(ue/j)),ve=Math.min(z,(S+ue)/j),be=0,De=ne;De<ae;++De)for(var ye=De*W-X,Ee=de;Ee<ve;++Ee)for(var me=d*M+p*De+m*Ee,Le=g*(C-1-ye)+x*(S-1-(Ee*j-ue))+w*B,Ae=0;Ae<F;++Ae)be+=h[me+(B*F+Ae)]*y[Le+Ae];a[u*M+l*G+c*se+B]=be}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){H([n,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=he(o.filterShape,"float32"),c=o.padInfo.left,h=o.padInfo.top,f=o.outChannels/o.inChannels,d=this.bufferSync(n),p=this.bufferSync(r),m=0;m<s;++m)for(var y=Math.max(0,Math.ceil((h-m)/i)),v=Math.min(o.outHeight,(o.inHeight+h-m)/i),g=0;g<u;++g)for(var x=Math.max(0,Math.ceil((c-g)/a)),w=Math.min(o.outWidth,(o.inWidth+c-g)/a),b=0;b<o.outChannels;++b){for(var C=Math.trunc(b/f),S=b%f,E=0,R=0;R<o.batchSize;++R)for(var N=y;N<v;++N)for(var P=m+N*i-h,D=x;D<w;++D){var z=g+D*a-c;E+=d.get(R,P,z,C)*p.get(R,N,D,b)}l.set(E,m,g,C,S)}return l.toTensor()},t.prototype.tile=function(n,r){return H(n,"tile"),N0(this.bufferSync(n),r)},t.prototype.pad=function(n,r,o){H(n,"pad");var i=r.map(function(f,d){return f[0]+n.shape[d]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(n),u=he(i,n.dtype);o!==0&&u.values.fill(o);for(var l=0;l<n.size;l++){var c=s.indexToLoc(l),h=c.map(function(f,d){return f+a[d]});u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},t.prototype.transpose=function(n,r){H(n,"transpose");for(var o=new Array(n.rank),i=0;i<o.length;i++)o[i]=n.shape[r[i]];var a=this.readSync(n.dataId),s=he(o,n.dtype),u=this.bufferSync(n);for(i=0;i<n.size;++i){for(var l=u.indexToLoc(i),c=new Array(l.length),h=0;h<c.length;h++)c[h]=l[r[h]];var f=s.locToIndex(c);s.values[f]=a[i]}return s.toTensor()},t.prototype.gather=function(n,r,o){H([n,r],"gather");var i=n.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=he(i,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[o]=a[c[o]];var f=u.locToIndex(h);s.values[l]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(n,r,o){H([n],"batchToSpaceND");var i=r.reduce(function(h,f){return h*f}),a=cu(n.shape,r,i),s=hu(a.length,r.length),u=fu(n.shape,r,i),l=p0(o,r.length),c=v0(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){H([n],"spaceToBatchND");var i=r.reduce(function(f,d){return f*d}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=cu(u.shape,r,i,!1),c=hu(l.length,r.length,!1),h=fu(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(h)},t.prototype.pool=function(n,r,o){H(n,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,d=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(n.dataId),m=he(r.outShape,n.dtype),y=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],g=r.outShape[2]*r.outShape[3],x=r.outShape[3],w=0;w<r.batchSize;++w)for(var b=w*v,C=w*n.strides[0],S=0;S<r.inChannels;++S)for(var E=0;E<r.outHeight;++E)for(var R=E*i-h,N=Math.max(0,R),P=Math.min(r.inHeight,l+R),D=b+E*g,z=0;z<r.outWidth;++z){for(var W=z*a-f,j=Math.max(0,W),$=Math.min(r.inWidth,c+W),V=d,F=0,M=0,B=N;B<P;B+=s){for(var G=C+B*n.strides[1],X=j;X<$;X+=u){var ne=p[G+X*n.strides[2]+S];o==="max"&&ne>V?V=ne:o==="avg"&&(F+=ne,M++)}if(isNaN(V))break}y[D+z*x+S]=o==="avg"?F/M:V}return m.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var o=he(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,d=this.bufferSync(n),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var y=0;y<r.outHeight;++y){for(var v=y*i-h,g=v;g<0;)g+=s;for(var x=Math.min(r.inHeight,l+v),w=0;w<r.outWidth;++w){for(var b=w*a-f,C=b;C<0;)C+=u;for(var S=Math.min(r.inWidth,c+b),E=Number.NEGATIVE_INFINITY,R=-1,N=g;N<x;N+=s)for(var P=N-v,D=C;D<S;D+=u){var z=D-b,W=d.get(p,N,D,m);W>E&&(E=W,R=P*c+z)}o.set(R,p,y,w,m)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(n,r,o,i){H([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,f=i.effectiveFilterWidth,d=f-1-i.padInfo.left,p=h-1-i.padInfo.top,m=he(r.shape,"float32"),y=this.bufferSync(a),v=this.bufferSync(n),g=0;g<i.batchSize;++g)for(var x=0;x<i.inChannels;++x)for(var w=0;w<i.inHeight;++w)for(var b=0;b<i.inWidth;++b){for(var C=w-p,S=b-d,E=0,R=0;R<h;R+=l){var N=(C+R)/s;if(!(N<0||N>=i.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=c){var D=(S+P)/u;if(!(D<0||D>=i.outWidth||Math.floor(D)!==D)){var z=h*f-1-y.get(g,N,D,x)===R*f+P?1:0;z!==0&&(E+=v.get(g,N,D,x)*z)}}}m.set(E,g,w,b,x)}return m.toTensor()},t.prototype.avgPoolBackprop=function(n,r,o){H([n,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dilationHeight,c=o.dilationWidth,h=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=f-1-o.padInfo.left,p=h-1-o.padInfo.top,m=he(r.shape,"float32"),y=1/(s*u),v=this.bufferSync(n),g=0;g<o.batchSize;++g)for(var x=0;x<o.inChannels;++x)for(var w=0;w<o.inHeight;++w)for(var b=0;b<o.inWidth;++b){for(var C=w-p,S=b-d,E=0,R=0;R<h;R+=l){var N=(C+R)/i;if(!(N<0||N>=o.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=c){var D=(S+P)/a;D<0||D>=o.outWidth||Math.floor(D)!==D||(E+=v.get(g,N,D,x))}}m.set(E*y,g,w,b,x)}return m.toTensor()},t.prototype.pool3d=function(n,r,o){H(n,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left,v=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(n.dataId),x=he(r.outShape,n.dtype),w=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],E=r.outShape[4],R=0;R<r.batchSize;++R)for(var N=R*b,P=R*n.strides[0],D=0;D<r.inChannels;++D)for(var z=0;z<r.outDepth;++z){for(var W=z*i-p,j=W;j<0;)j+=u;for(var $=Math.min(r.inDepth,h+W),V=N+z*C,F=0;F<r.outHeight;++F){for(var M=F*a-m,B=M;B<0;)B+=l;for(var G=Math.min(r.inHeight,f+M),X=V+F*S,ne=0;ne<r.outWidth;++ne){for(var ae=ne*s-y,se=ae;se<0;)se+=c;for(var ue=Math.min(r.inWidth,d+ae),de=X+ne*E,ve=v,be=0,De=0,ye=j;ye<$;ye+=u){for(var Ee=P+ye*n.strides[1],me=B;me<G;me+=l){for(var Le=Ee+me*n.strides[2],Ae=se;Ae<ue;Ae+=c){var Ie=g[Le+Ae*n.strides[3]+D];if(o==="max"&&Ie>ve?ve=Ie:o==="avg"&&(be+=Ie,De++),isNaN(ve))break}if(isNaN(ve))break}if(isNaN(ve))break}w[de+D]=o==="avg"?be/De:ve}}}return x.toTensor()},t.prototype.avgPool3d=function(n,r){return H(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,o){H([n,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,h=o.dilationDepth,f=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,m=o.effectiveFilterHeight,y=o.effectiveFilterWidth,v=p-1-o.padInfo.front,g=y-1-o.padInfo.left,x=m-1-o.padInfo.top,w=he(r.shape,"float32"),b=1/(u*l*c),C=this.bufferSync(n),S=0;S<o.batchSize;++S)for(var E=0;E<o.inChannels;++E)for(var R=0;R<o.inDepth;++R)for(var N=0;N<o.inHeight;++N)for(var P=0;P<o.inWidth;++P){for(var D=R-v,z=N-x,W=P-g,j=0,$=0;$<p;$+=h){var V=(D+$)/i;if(!(V<0||V>=o.outDepth||Math.floor(V)!==V))for(var F=0;F<m;F+=f){var M=(z+F)/a;if(!(M<0||M>=o.outHeight||Math.floor(M)!==M))for(var B=0;B<y;B+=d){var G=(W+B)/s;G<0||G>=o.outWidth||Math.floor(G)!==G||(j+=C.get(S,V,M,G,E))}}}w.set(j*b,S,R,N,P,E)}return w.toTensor()},t.prototype.maxPool3d=function(n,r){return H(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var o=he(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left,v=this.bufferSync(n),g=0;g<r.batchSize;++g)for(var x=0;x<r.inChannels;++x)for(var w=0;w<r.outDepth;++w){for(var b=w*i-p,C=b;C<0;)C+=u;for(var S=Math.min(r.inDepth,h+b),E=0;E<r.outHeight;++E){for(var R=E*a-m,N=R;N<0;)N+=l;for(var P=Math.min(r.inHeight,f+R),D=0;D<r.outWidth;++D){for(var z=D*s-y,W=z;W<0;)W+=c;for(var j=Math.min(r.inWidth,d+z),$=Number.NEGATIVE_INFINITY,V=-1,F=C;F<S;F+=u)for(var M=F-b,B=N;B<P;B+=l)for(var G=B-R,X=W;X<j;X+=c){var ne=X-z,ae=v.get(g,F,B,X,x);ae>=$&&($=ae,V=M*f*d+G*f+ne)}o.set(V,g,w,E,D,x)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,o,i){H([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,y=d-1-i.padInfo.front,v=m-1-i.padInfo.left,g=p-1-i.padInfo.top,x=he(r.shape,"float32"),w=this.bufferSync(a),b=this.bufferSync(n),C=0;C<i.batchSize;++C)for(var S=0;S<i.inChannels;++S)for(var E=0;E<i.inDepth;++E)for(var R=0;R<i.inHeight;++R)for(var N=0;N<i.inWidth;++N){for(var P=E-y,D=R-g,z=N-v,W=0,j=0;j<d;j+=c){var $=(P+j)/s;if(!($<0||$>=i.outDepth||Math.floor($)!==$))for(var V=0;V<p;V+=h){var F=(D+V)/u;if(!(F<0||F>=i.outHeight||Math.floor(F)!==F))for(var M=0;M<m;M+=f){var B=(z+M)/l;if(!(B<0||B>=i.outWidth||Math.floor(B)!==B)){var G=d*p*m-1-w.get(C,$,F,B,S)===j*p*m+V*m+M?1:0;G!==0&&(W+=b.get(C,$,F,B,S)*G)}}}}x.set(W,C,E,R,N,S)}return x.toTensor()},t.prototype.cast=function(n,r){return _0(n,r,this)},t.prototype.reshape=function(n,r){return uh(n,r)},t.prototype.avgPool=function(n,r){return H(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,o,i){H(n,"resizeBilinear");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(n.dataId),f=new Float32Array(te([s,r,o,c])),d=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=0,y=d[0]/p[0],v=d[1]/p[1],g=0;g<s;g++)for(var x=0;x<r;x++)for(var w=y*x,b=Math.floor(w),C=w-b,S=Math.min(u-1,Math.ceil(w)),E=g*n.strides[0]+b*n.strides[1],R=g*n.strides[0]+S*n.strides[1],N=0;N<o;N++)for(var P=v*N,D=Math.floor(P),z=P-D,W=Math.min(l-1,Math.ceil(P)),j=E+D*n.strides[2],$=R+D*n.strides[2],V=E+W*n.strides[2],F=R+W*n.strides[2],M=0;M<c;M++){var B=h[j+M],G=h[$+M],X=B+(h[V+M]-B)*z,ne=X+(G+(h[F+M]-G)*z-X)*C;f[m++]=ne}return pt(f,[s,r,o,c])},t.prototype.resizeBilinearBackprop=function(n,r,o){H([n,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,h=c[1],f=c[2],d=new Float32Array(a*s*u*l),p=[o&&h>1?s-1:s,o&&f>1?u-1:u],m=[o&&h>1?h-1:h,o&&f>1?f-1:f],y=p[0]/m[0],v=p[1]/m[1],g=this.readSync(n.dataId),x=0,w=0;w<a;w++)for(var b=w*r.strides[0],C=0;C<h;C++)for(var S=C*y,E=Math.floor(S),R=Math.min(Math.ceil(S),s-1),N=b+E*r.strides[1],P=b+R*r.strides[1],D=S-E,z=1-D,W=0;W<f;W++)for(var j=W*v,$=Math.floor(j),V=Math.min(Math.ceil(j),u-1),F=j-$,M=1-F,B=N+$*r.strides[2],G=N+V*r.strides[2],X=P+$*r.strides[2],ne=P+V*r.strides[2],ae=z*M,se=z*F,ue=D*M,de=D*F,ve=0;ve<l;ve++){var be=g[x++];d[B+ve]+=be*ae,d[G+ve]+=be*se,d[X+ve]+=be*ue,d[ne+ve]+=be*de}return Mt(d,[a,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,o,i){H(n,"resizeNearestNeighbor");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(n.dataId),f=new Float32Array(s*r*o*c),d=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=d[0]/p[0],y=d[1]/p[1],v=0,g=0;g<s;g++)for(var x=g*n.strides[0],w=0;w<r;w++)for(var b=m*w,C=x+Math.min(u-1,i?Math.round(b):Math.floor(b))*n.strides[1],S=0;S<o;S++)for(var E=y*S,R=C+Math.min(l-1,i?Math.round(E):Math.floor(E))*n.strides[2],N=0;N<c;N++){var P=h[R+N];f[v++]=P}return pt(f,[s,r,o,c],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){H([n,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,h=c[1],f=c[2],d=new Float32Array(a*s*u*l),p=this.readSync(n.dataId),m=[o&&h>1?s-1:s,o&&f>1?u-1:u],y=[o&&h>1?h-1:h,o&&f>1?f-1:f],v=m[0]/y[0],g=m[1]/y[1],x=1/v,w=1/g,b=2*Math.ceil(x)+2,C=2*Math.ceil(w)+2,S=0;S<a;S++)for(var E=S*r.strides[0],R=0;R<s;R++)for(var N=E+R*r.strides[1],P=Math.floor(R*x),D=Math.floor(P-b/2),z=0;z<u;z++)for(var W=N+z*r.strides[2],j=Math.floor(z*w),$=Math.floor(j-C/2),V=0;V<l;V++){for(var F=0,M=0;M<b;M++){var B=M+D;if(!(B<0||B>=h)){var G=E+B*n.strides[1],X=B*v;if(R===Math.min(s-1,o?Math.round(X):Math.floor(X)))for(var ne=0;ne<C;ne++){var ae=ne+$;if(!(ae<0||ae>=f)){var se=G+ae*n.strides[2],ue=ae*g;z===Math.min(u-1,o?Math.round(ue):Math.floor(ue))&&(F+=p[se+V])}}}}d[W+V]=F}return Mt(d,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){H([n,r,o,a,s],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(o.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),d=new Float32Array(u.length),p=f.length,m=h.length,y=c.length,v=l.length,g=0,x=0,w=0,b=0,C=0;C<u.length;++C)d[C]=f[g++]+(u[C]-l[x++])*h[w++]/Math.sqrt(c[b++]+i),g>=p&&(g=0),x>=v&&(x=0),w>=m&&(w=0),b>=y&&(b=0);return Mt(d,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){H(n,"localResponseNormalization4D");var s=n.shape[3],u=s-1,l=this.readSync(n.dataId),c=n.size,h=new Float32Array(c);function f(y){for(var v=y%s,g=y-v+Math.max(0,v-r),x=y-v+Math.min(v+r,u),w=0;g<=x;g++){var b=l[g];w+=b*b}return w}for(var d=0;d<c;d++){var p=f(d),m=l[d]*Math.pow(o+i*p,-a);h[d]=m}return Mt(h,n.shape)},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){H(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),h=this.readSync(r.dataId),f=this.readSync(o.dataId),d=new Float32Array(n.size),p=n.size,m=0;m<p;m++){for(var y=m%l,v=m-y+Math.max(0,y-i),g=m-y+Math.min(l,y+i+1),x=0,w=v;w<g;w++)x+=Math.pow(h[w],2);for(x=s*x+a,w=v;w<g;w++){var b=-2*s*u*h[w]*f[m]/x;m===w&&(b+=Math.pow(x,-u)),b*=c[m],d[w]+=b}}return Mt(d,n.shape)},t.prototype.multinomial=function(n,r,o,i){H(n,"multinomial");for(var a=r?n:dr(n),s=a.shape[0],u=a.shape[1],l=Oe([s,o],"int32"),c=this.readSync(l.dataId),h=this.readSync(a.dataId),f=0;f<s;++f){var d=f*u,p=new Float32Array(u-1);p[0]=h[d];for(var m=1;m<p.length;++m)p[m]=p[m-1]+h[d+m];for(var y=Uu(i.toString()),v=f*o,g=0;g<o;++g){var x=y();c[v+g]=p.length;for(var w=0;w<p.length;w++)if(x<p[w]){c[v+g]=w;break}}}return l},t.prototype.oneHot=function(n,r,o,i){H(n,"oneHot");var a=new Float32Array(n.size*r);a.fill(i);for(var s=this.readSync(n.dataId),u=0;u<n.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return jr(a,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return H(n,"nonMaxSuppression"),_f(this.readSync(n.dataId),this.readSync(r.dataId),o,i,a)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var o=n.shape[0],i=n.shape[1],a=he(n.shape,"float32"),s=he(n.shape,"float32"),u=cn(n).as2D(o,i),l=jn(n).as2D(o,i),c=0;c<o;c++)for(var h=u.slice([c,0],[1,i]),f=l.slice([c,0],[1,i]),d=ft(h,f),p=this.readSync(this.fftImpl(d,r).dataId),m=0;m<i;m++){var y=jp(p,m);a.values[c*i+m]=y.real,s.values[c*i+m]=y.imag}return ft(a.toTensor(),s.toTensor()).as2D(o,i)},t.prototype.fftImpl=function(n,r){var o=n.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(n.shape[0],n.shape[1]);return r&&(a=ft(cn(a).div(K(i)),jn(a).div(K(i)))),a}var s=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],h[f/2]=l[f+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(s,i,r));return ft(u.real,u.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,o){if(r===1)return n;var i=this.readSync(n.dataId),a=r/2,s=function(v){for(var g=Math.ceil(v.length/4),x=new Float32Array(g),w=new Float32Array(g),b=0;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],w[Math.floor(b/4)]=v[b+1];return{real:x,imag:w}}(i),u=ft(s.real,s.imag).as1D(),l=function(v){for(var g=Math.floor(v.length/4),x=new Float32Array(g),w=new Float32Array(g),b=2;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],w[Math.floor(b/4)]=v[b+1];return{real:x,imag:w}}(i),c=ft(l.real,l.imag).as1D();u=this.fftRadix2(u,a,o),c=this.fftRadix2(c,a,o);var h=function(v,g){for(var x=new Float32Array(v/2),w=new Float32Array(v/2),b=0;b<Math.ceil(v/2);b++){var C=(g?2:-2)*Math.PI*(b/v);x[b]=Math.cos(C),w[b]=Math.sin(C)}return{real:x,imag:w}}(r,o),f=ft(h.real,h.imag).mul(c),d=u.add(f),p=u.sub(f),m=cn(d).concat(cn(p)),y=jn(d).concat(jn(p));return ft(m,y).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=Cb(a*l,r,o),h=jp(n,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}o&&(s/=r,u/=r),bb(i,s,u,a)}return i},t.prototype.depthToSpace=function(n,r,o){I(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=n.shape[0],a=n.shape[1],s=n.shape[2],u=n.shape[3],l=a*r,c=s*r,h=u/(r*r),f=this.readSync(n.dataId),d=new Float32Array(i*l*c*h),p=0,m=0;m<i;++m)for(var y=0;y<l;++y)for(var v=Math.floor(y/r),g=y%r,x=0;x<c;++x)for(var w=Math.floor(x/r),b=(g*r+x%r)*h,C=0;C<h;++C){var S=C+b+u*(w+s*(v+a*m));d[p++]=f[S]}return Mt(d,[i,l,c,h])},t.prototype.broadcastedBinaryOp=function(n,r,o,i){var a=xe(n.shape,r.shape),s=he(a,o),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ir(n.shape,a),h=Ir(r.shape,a),f=s.values;if(c.length+h.length===0)for(var d=0;d<f.length;++d)f[d]=i(u[d%u.length],l[d%l.length]);else{var p=this.bufferSync(n),m=this.bufferSync(r),y=function(v){var g=s.indexToLoc(v),x=g.slice(-n.rank);c.forEach(function(S){return x[S]=0});var w=p.locToIndex(x),b=g.slice(-r.rank);h.forEach(function(S){return b[S]=0});var C=m.locToIndex(b);f[v]=i(u[w],l[C])};for(d=0;d<f.length;++d)y(d)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,o){var i=xe(n.shape,r.shape),a=he(i,"float32"),s=he(i,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ir(n.shape,i),h=Ir(r.shape,i),f=a.values,d=s.values;if(c.length+h.length===0)for(var p=0;p<f.length;p++){var m=p%u.length,y=p%l.length,v=o(u[2*m],u[2*m+1],l[2*y],l[2*y+1]);f[p]=v.real,d[p]=v.imag}else{var g=this.bufferSync(this.data.get(n.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(b){var C=a.indexToLoc(b),S=C.slice(-n.rank);c.forEach(function(D){return S[D]=0});var E=g.locToIndex(S),R=C.slice(-r.rank);h.forEach(function(D){return R[D]=0});var N=x.locToIndex(R),P=o(u[2*E],u[2*E+1],l[2*N],l[2*N+1]);f[b]=P.real,d[b]=P.imag};for(p=0;p<f.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},t.prototype.split=function(n,r,o){return S0(n,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,o,i,a,s){for(var u=n.shape,l=u[0],c=u[1],h=u[2],f=u[3],d=r.shape[0],p=i[0],m=i[1],y=he([d,p,m,f],"float32"),v=this.readSync(r.dataId),g=this.readSync(o.dataId),x=this.readSync(n.dataId),w=n.strides,b=y.strides,C=0;C<d;C++){var S=4*C,E=v[S],R=v[S+1],N=v[S+2],P=v[S+3],D=g[C];if(!(D>=l))for(var z=p>1?(N-E)*(c-1)/(p-1):0,W=m>1?(P-R)*(h-1)/(m-1):0,j=0;j<p;j++){var $=p>1?E*(c-1)+j*z:.5*(E+N)*(c-1);if($<0||$>c-1)for(var V=0;V<m;V++)for(var F=0;F<f;F++){var M=F+V*b[2]+j*b[1]+C*b[0];y.values[M]=s}else if(a==="bilinear"){var B=Math.floor($),G=Math.ceil($),X=$-B;for(V=0;V<m;V++)if((ye=m>1?R*(h-1)+V*W:.5*(R+P)*(h-1))<0||ye>h-1)for(F=0;F<f;F++)M=F+V*b[2]+j*b[1]+C*b[0],y.values[M]=s;else{var ne=Math.floor(ye),ae=Math.ceil(ye),se=ye-ne;for(F=0;F<f;F++){var ue=x[M=F+ne*w[2]+B*w[1]+D*w[0]],de=x[M=F+ae*w[2]+B*w[1]+D*w[0]],ve=x[M=F+ne*w[2]+G*w[1]+D*w[0]],be=ue+(de-ue)*se,De=ve+(x[M=F+ae*w[2]+G*w[1]+D*w[0]]-ve)*se;M=F+V*b[2]+j*b[1]+C*b[0],y.values[M]=be+(De-be)*X}}}else for(V=0;V<m;++V){var ye;if((ye=m>1?R*(h-1)+V*W:.5*(R+P)*(h-1))<0||ye>h-1)for(F=0;F<f;F++)M=F+V*b[2]+j*b[1]+C*b[0],y.values[M]=s;else{var Ee=Math.round(ye),me=Math.round($);for(F=0;F<f;F++){var Le=F+Ee*w[2]+me*w[1]+D*w[0],Ae=F+V*b[2]+j*b[1]+C*b[0];y.values[Ae]=x[Le]}}}}}return y.toTensor()},t.prototype.sparseToDense=function(n,r,o,i){var a=du(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,h=a.outputSize;return this.scatter(n,r,o,h,l,u,s,c,i,!1)},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=m0(n,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return pt([],s,n.dtype);for(var h=new wa([u,l],n.dtype),f=this.readSync(r.dataId),d=this.readSync(n.dataId),p=0;p<u;p++){for(var m=[],y=0,v=0;v<i;v++){var g=f[p*i+v];y+=g*c[v],m.push(g)}if(y<0||y>=n.size/l)throw new Error("Invalid indices: "+m+" does not index into "+n.shape);for(var x=0;x<l;x++)h.values[p*l+x]=d[y*l+x]}return h.toTensor().reshape(s)},t.prototype.scatterND=function(n,r,o){var i=du(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,h=K(0);return this.scatter(n,r,o,c,u,s,a,l,h,!0)},t.prototype.fill=function(n,r,o){var i=ru(o=o||Pa(r),te(n));return i.fill(r),A.makeTensor(i,n,o,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=ru(n.dtype,te(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,o){return E0(n,r,o)},t.prototype.scatter=function(n,r,o,i,a,s,u,l,c,h){var f=[i/a,a],d=this.readSync(n.dataId),p=this.readSync(r.dataId);if(i===0)return pt([],o,r.dtype);var m=new wa(f,r.dtype);m.values.fill(this.readSync(c.dataId)[0]);for(var y=0;y<s;y++){for(var v=[],g=0,x=0;x<u;x++){var w=d[y*u+x];v.push(w),g+=w*l[x]}if(g<0||g>=i/a)throw new Error("Invalid indices: "+v+" does not index into "+o);for(var b=0;b<a;b++)h?m.values[g*a+b]+=p[y*a+b]:m.values[g*a+b]=r.rank===0?p[0]:p[y*a+b]}return m.toTensor().reshape(o)},t}(b0);A.registerBackend("cpu",function(){return new Uk},1);for(var Xl=0,sv=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=n;H(i,"NonMaxSuppressionWithScore");var d=Ef(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,l,c,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;H(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:_a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n;H([o,i],_a);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,l=function(f,d,p,m,y,v){var g=xe(f,d),x=g.length,w=$n(g),b=xa(y,te(g)),C=f.length,S=d.length,E=$n(f),R=$n(d),N=Ir(f,g),P=Ir(d,g);if(N.length+P.length===0)for(var D=0;D<b.length;++D)b[D]=v(p[D%p.length],m[D%m.length]);else{var z=function(W){var j=Jw(W,x,w),$=j.slice(-C);N.forEach(function(B){return $[B]=0});var V=Tp($,C,E),F=j.slice(-S);P.forEach(function(B){return F[B]=0});var M=Tp(F,S,R);b[W]=v(p[V],m[M])};for(D=0;D<b.length;++D)z(D)}return[b,g]}(o.shape,i.shape,s,u,o.dtype,function(f,d){var p=f-d;return p*p}),c=l[0],h=l[1];return{dataId:a.write(c,h,o.dtype),shape:h,dtype:o.dtype}}}];Xl<sv.length;Xl++)Kg(sv[Xl]);var To,Vk=function(e){this.variableNames=["A"];var t=_t(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},$k=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=_t(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var Kl=0,uv=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],h=[c,l],f=[c,l,i];(s||a)&&(To==null&&(To=document.createElement("canvas").getContext("2d")),To.canvas.width=l,To.canvas.height=c,To.drawImage(o,0,0,l,c),o=To.canvas);var d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=Kt.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),o);var p=U().getBool("WEBGL_PACK")?new $k(f):new Vk(f),m=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;su("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=n,d=Ef(f.readSync(i.dataId),f.readSync(a.dataId),u,l,c,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,i=new pe(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:_a,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n,s=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new er("return (a - b) * (a - b);",o.shape,i.shape):new Ge("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Kl<uv.length;Kl++)Kg(uv[Kl]);for(var Ql=0,lv=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:_a,gradFunc:function(e,t){var n=t[0],r=t[1],o=K(2);return{a:function(){return kt(e,kt(o,ot(n,r)))},b:function(){return kt(e,kt(o,ot(r,n)))}}}}];Ql<lv.length;Ql++)zw(lv[Ql]);var Hk=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();U().get("IS_BROWSER")&&U().setPlatform("browser",new Hk);var Yl,Gk=function(){return require("node-fetch")},qk=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return U().global.fetch!=null?U().global.fetch(t,n):(Yl==null&&(Yl=Gk()),Yl(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();U().get("IS_NODE")&&U().setPlatform("node",new qk);var hh={float32:4,int32:4,uint16:2,uint8:1,bool:1},wu=4;function yy(e,t){for(var n={},r=0,o=function(s){var u=s.name,l=s.dtype,c=s.shape,h=te(c),f=void 0;if("quantization"in s){var d=s.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=hh[d.dtype],m=e.slice(r,r+h*p),y=d.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(l==="float32")f=Float32Array.from(y,function(C){return C*d.scale+d.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(y,function(C){return Math.round(C*d.scale+d.min)})}r+=h*p}else if(l==="string"){var v=te(s.shape);f=[];for(var g=0;g<v;g++){var x=new Uint32Array(e.slice(r,r+wu))[0];r+=wu;var w=new Uint8Array(e.slice(r,r+x));f.push(w),r+=x}}else{var b=hh[l];if(m=e.slice(r,r+h*b),l==="float32")f=new Float32Array(m);else if(l==="int32")f=new Int32Array(m);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(m)}r+=h*b}n[u]=pt(f,c,l)},i=0,a=t;i<a.length;i++)o(a[i]);return n}function Xk(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(i){if(t+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var fh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function cv(e){return fh?Buffer.byteLength(e):new Blob([e]).size}function Vf(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function hv(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function La(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:cv(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:cv(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var Qt=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(i){var a=i(t,r);a!==null&&o.push(a)}),o},e}(),oi="://",Wr=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){I(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(oi)&&(t=t.slice(0,t.indexOf(oi))),I(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();I(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Ps(e){if(e.indexOf(oi)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Wr.getSchemes().join(","));return{scheme:e.split(oi)[0],path:e.split(oi)[1]}}function fv(e,t,n){return n===void 0&&(n=!1),Z(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,h;return ee(this,function(f){switch(f.label){case 0:return I(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),I((r=Qt.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),I(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],I((i=Qt.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),I(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),a=i[0],s=Ps(e).scheme,u=Ps(e).path,l=s===Ps(e).scheme,[4,o.load()];case 1:return c=f.sent(),n&&l?[4,Wr.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(c)];case 4:return h=f.sent(),!n||l?[3,6]:[4,Wr.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var uo="models_store",Tr="model_info_store";function xy(){if(!U().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function dh(e){var t=e.result;t.createObjectStore(uo,{keyPath:"modelPath"}),t.createObjectStore(Tr,{keyPath:"modelPath"})}var ii=function(){function e(t){if(this.indexedDB=xy(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return Z(this,void 0,void 0,function(){return ee(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return Z(this,void 0,void 0,function(){return ee(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return dh(a)},a.onsuccess=function(){var s=a.result;if(n==null){var u=s.transaction(uo,"readonly"),l=u.objectStore(uo).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=La(n),f=s.transaction(Tr,"readwrite"),d=f.objectStore(Tr),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var m=(c=s.transaction(uo,"readwrite")).objectStore(uo).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:h});m.onsuccess=function(){return o({modelArtifactsInfo:h})},m.onerror=function(y){var v=(d=f.objectStore(Tr)).delete(r.modelPath);v.onsuccess=function(){return s.close(),i(m.error)},v.onerror=function(g){return s.close(),i(m.error)}}},p.onerror=function(m){return s.close(),i(p.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),dv=function(e){return U().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ii.URL_SCHEME)?(t=e.slice(ii.URL_SCHEME.length),new ii(t)):null;var t};Qt.registerSaveRouter(dv),Qt.registerLoadRouter(dv);var Kk=function(){function e(){this.indexedDB=xy()}return e.prototype.listModels=function(){return Z(this,void 0,void 0,function(){var t=this;return ee(this,function(n){return[2,new Promise(function(r,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return dh(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Tr,"readonly"),u=s.objectStore(Tr).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},e.prototype.removeModel=function(t){return Z(this,void 0,void 0,function(){var n=this;return ee(this,function(r){var o;return t=(o=t).startsWith(ii.URL_SCHEME)?o.slice(ii.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return dh(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Tr,"readwrite"),h=c.objectStore(Tr),f=h.get(t);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var d=h.delete(t),p=function(){var m=(u=l.transaction(uo,"readwrite")).objectStore(uo).delete(t);m.onsuccess=function(){return i(f.result.modelArtifactsInfo)},m.onerror=function(y){return a(f.error)}};d.onsuccess=p,d.onerror=function(m){return p(),l.close(),a(f.error)}},f.onerror=function(d){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},e}();if(U().getBool("IS_BROWSER"))try{Wr.registerManager(ii.URL_SCHEME,new Kk)}catch{}var rr="/",Oo="tensorflowjs_models",wy="info",Qk="model_topology",Yk="weight_specs",Jk="weight_data",Zk="model_metadata";function by(e){return{info:[Oo,e,wy].join(rr),topology:[Oo,e,Qk].join(rr),weightSpecs:[Oo,e,Yk].join(rr),weightData:[Oo,e,Jk].join(rr),modelMetadata:[Oo,e,Zk].join(rr)}}function eS(e){var t=e.split(rr);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(rr)}var ai=function(){function e(t){if(!U().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=by(this.modelPath)}return e.prototype.save=function(t){return Z(this,void 0,void 0,function(){var n,r,o;return ee(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=La(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(fh)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return Z(this,void 0,void 0,function(){var t,n,r,o,i,a,s;return ee(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,n.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(fh){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),d=0;d<h.length;++d)f.set([h.charCodeAt(d)],d);return f.buffer}(s),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),pv=function(e){return U().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ai.URL_SCHEME)?(t=e.slice(ai.URL_SCHEME.length),new ai(t)):null;var t};Qt.registerSaveRouter(pv),Qt.registerLoadRouter(pv);var tS=function(){function e(){I(U().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),I(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return Z(this,void 0,void 0,function(){var t,n,r,o,i,a;return ee(this,function(s){for(t={},n=Oo+rr,r=rr+wy,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(n)&&i.endsWith(r)&&(a=eS(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},e.prototype.removeModel=function(t){return Z(this,void 0,void 0,function(){var n,r;return ee(this,function(o){var i;if(t=(i=t).startsWith(ai.URL_SCHEME)?i.slice(ai.URL_SCHEME.length):i,n=by(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(U().getBool("IS_BROWSER"))try{Wr.registerManager(ai.URL_SCHEME,new tS)}catch{}var nS="model",rS=".json",oS=".weights.bin";function vv(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var Jl=function(){function e(t){if(!U().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=nS),this.modelTopologyFileName=t+rS,this.weightDataFileName=t+oS}return e.prototype.save=function(t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s;return ee(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,vv(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,[4,vv(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:La(t)}]}})})},e.URL_SCHEME="downloads://",e}(),iS=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return Z(this,void 0,void 0,function(){var t,n,r=this;return ee(this,function(o){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&i({modelTopology:c});var h=l.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,n)}catch(y){return void a(y)}var d=[],p=[],m=[];h.forEach(function(y){y.paths.forEach(function(v){p.push(v),m.push(null)}),d.push.apply(d,y.weights)}),h.forEach(function(y){y.paths.forEach(function(v){var g=new FileReader;g.onload=function(x){var w=x.target.result,b=p.indexOf(v);m[b]=w,m.indexOf(null)===-1&&i({modelTopology:c,weightSpecs:d,weightData:Vf(m),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},g.onerror=function(x){return a("Failed to weights data from file of path '"+v+"'.")},g.readAsArrayBuffer(f[v])})})}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],o=n.map(function(u){return hv(u.name)}),i={},a=0,s=t;a<s.length;a++)s[a].paths.forEach(function(u){var l=hv(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");i[u]=n[o.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return i},e}();function mv(e,t,n,r){(function(i){I(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(e),function(i,a){I(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),I(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),I(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(n=n??0,r=r??1);var o=0;return Promise.all(e.map(function(i){return i.then(function(a){var s=n+ ++o/e.length*(r-n);return t(s),a}),i}))}function Cy(e,t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return ee(this,function(h){switch(h.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?U().platform.fetch:t.fetchFunc,r=e.map(function(f){return n(f,t.requestInit,{isBinary:!0})}),o=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,mv(r,t.onProgress,o,i)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,mv(s,t.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function gv(e){var t=this;return function(n,r,o){return r===void 0&&(r=""),Z(t,void 0,void 0,function(){var i,a,s,u,l,c,h,f,d,p;return ee(this,function(m){switch(m.label){case 0:if(i=n.map(function(){return!1}),a={},s=o!=null?o.map(function(){return!1}):[],u=[],n.forEach(function(y,v){var g=0;y.weights.forEach(function(x){var w="quantization"in x?x.quantization.dtype:x.dtype,b=hh[w]*te(x.shape),C=function(){i[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:x,groupOffset:g,sizeBytes:b})};o!=null?o.forEach(function(S,E){S===x.name&&(C(),s[E]=!0)}):C(),u.push(x.name),g+=b})}),!s.every(function(y){return y}))throw l=o.filter(function(y,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=i.reduce(function(y,v,g){return v&&y.push(g),y},[]),h=[],c.forEach(function(y){n[y].paths.forEach(function(v){var g=r+(r.endsWith("/")?"":"/")+v;h.push(g)})}),[4,e(h)];case 1:return f=m.sent(),d={},p=0,c.forEach(function(y){for(var v=n[y].paths.length,g=0,x=0;x<v;x++)g+=f[p+x].byteLength;for(var w=new ArrayBuffer(g),b=new Uint8Array(w),C=0,S=0;S<v;S++){var E=new Uint8Array(f[p+S]);b.set(E,C),C+=E.byteLength}a[y].forEach(function(R){var N=yy(w.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var P in N)d[P]=N[P]}),p+=v}),[2,d]}})})}}Qt.registerSaveRouter(function(e){return U().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Jl.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new Jl(t)}(e.slice(Jl.URL_SCHEME.length)):null});var _y=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(I(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=U().platform.fetch,I(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&I(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return Z(this,void 0,void 0,function(){var n,r,o,i;return ee(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:La(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return Z(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,l,c,h,f;return ee(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return n=d.sent(),[3,5];case 4:throw d.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=n.modelTopology,i=n.weightsManifest,a=n.generatedBy,s=n.convertedBy,u=n.format,l=n.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:f=d.sent(),c=f[0],h=f[1],d.label=7;case 7:return[2,{modelTopology:o,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},e.prototype.loadWeights=function(t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,h,f;return ee(this,function(d){switch(d.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),y=p.lastIndexOf("?"),v=p.substring(0,m),g=y>m?p.substring(y):"";return[v+"/",g]}(n),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],t.forEach(function(p){p.paths.forEach(function(m){h.push(a+m+i)})}),[4,Cy(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[s,Vf(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function ph(e){return e.match(_y.URL_SCHEME_REGEX)!=null}var yv=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return ph(n)}):ph(e))?vh(e,{onProgress:t}):null};function vh(e,t){return new _y(e,t)}Qt.registerSaveRouter(yv),Qt.registerLoadRouter(yv);var Zl=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return Z(this,void 0,void 0,function(){return ee(this,function(t){return[2,this.modelArtifacts]})})},e}(),aS=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.saveHandler(t)]})})},e}(),Ey=Object.freeze({browserFiles:function(e){return new iS(e)},browserHTTPRequest:function(e,t){return vh(e,t)},concatenateArrayBuffers:Vf,decodeWeights:yy,encodeWeights:function(e,t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return ee(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(l){return l.name}):Object.keys(e),i=function(l){var c=o[l],h=Array.isArray(e)?e[l].tensor:e[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var f={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(p){return Z(s,void 0,void 0,function(){var m,y,v,g,x,w,b;return ee(this,function(C){switch(C.label){case 0:return[4,h.bytes()];case 1:for(m=C.sent(),y=m.reduce(function(S,E){return S+E.length},0)+wu*m.length,v=new Uint8Array(y),g=0,x=0;x<m.length;x++)w=m[x],b=new Uint8Array(new Uint32Array([w.length]).buffer),v.set(b,g),g+=wu,v.set(w,g),g+=w.length;return p(v),[2]}})})});r.push(d)}else r.push(h.data());t!=null&&(f.group=t),n.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:Xk(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Zl(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zl({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zl({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Qt.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:La,getSaveHandlers:function(e){return Qt.getSaveHandlers(e)},http:vh,isHTTPScheme:ph,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),Z(this,void 0,void 0,function(){return ee(this,function(o){return[2,gv(function(i){return Cy(i,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Qt.registerLoadRouter(e)},registerSaveRouter:function(e){return Qt.registerSaveRouter(e)},weightsLoaderFactory:gv,withSaveHandler:function(e){return new aS(e)},copyModel:function(e,t){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,fv(e,t,!1)]})})},listModels:function(){return Z(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return ee(this,function(s){switch(s.label){case 0:e=Wr.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,Wr.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())t[o+oi+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,fv(e,t,!0)]})})},removeModel:function(e){return Z(this,void 0,void 0,function(){var t;return ee(this,function(n){return t=Ps(e),[2,Wr.getManager(t.scheme).removeModel(t.path)]})})}}),Po;T({confusionMatrix_:function(e,t,n){var r=k(e,"labels","confusionMatrix"),o=k(t,"predictions","confusionMatrix");I(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),I(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),I(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),I(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),I(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=ah(r.asType("int32"),n),a=ah(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}});var sS=T({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Xg("FromPixels",A.backendName)!=null)return A.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],h=l[1];if(a?s=e.getContext("2d").getImageData(0,0,c,h).data:r||n?s=e.data:(i||o)&&(Po==null&&(Po=document.createElement("canvas").getContext("2d")),Po.canvas.width=c,Po.canvas.height=h,Po.drawImage(e,0,0,c,h),s=Po.getImageData(0,0,c,h).data),t===4)u=new Int32Array(s);else{var f=c*h;u=new Int32Array(f*t);for(var d=0;d<f;d++)for(var p=0;p<t;++p)u[d*t+p]=s[4*d+p]}return yf(u,[h,c,t],"int32")}}),$f=Object.freeze({toPixels:function(e,t){return Z(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,h,f,d,p,m,y,v,g,x,w,b,C,S,E;return ee(this,function(R){switch(R.label){case 0:if(n=k(e,"img","toPixels"),e instanceof ze||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=n.rank===2?1:n.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=R.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=R.sent(),h=c[0],f=c[1],d=h[0],p=f[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(m=n.dtype==="float32"?255:1,y=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)g=void 0,x=void 0,w=void 0,b=void 0,a===1?(g=s[v]*m,x=s[v]*m,w=s[v]*m,b=255):a===3?(g=s[3*v]*m,x=s[3*v+1]*m,w=s[3*v+2]*m,b=255):a===4&&(g=s[4*v]*m,x=s[4*v+1]*m,w=s[4*v+2]*m,b=s[4*v+3]*m),y[(C=4*v)+0]=Math.round(g),y[C+1]=Math.round(x),y[C+2]=Math.round(w),y[C+3]=Math.round(b);return t!=null&&(t.width=i,t.height=o,S=t.getContext("2d"),E=new ImageData(y,i,o),S.putImageData(E,0,0)),n!==e&&n.dispose(),[2,y]}})})},fromPixels:sS}),uS=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),lS=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function ko(e){I(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),I(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),I(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),lS.register(e)}var So=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return In(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var i=this.computeGradients(n,o),a=i.value,s=i.grads;if(o!=null){var u=o.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return zt(s),r?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return xb(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&zt(this.iterations_)},t.prototype.saveIterations=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:K(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return Z(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,n.slice(1)]}})})},t}(uS);Object.defineProperty(So,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var cS=function(e){function t(n,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=n,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=A.backend.epsilon()),i}return In(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=A.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:Y(function(){return Ce(a).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:Y(function(){return Ce(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable,l=r.accumulatedUpdates[i].variable;Y(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var d=h.mul(-r.learningRate).add(a);a.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(zt(this.accumulatedGrads.map(function(n){return n.variable})),zt(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){var n;return ee(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(So);ko(cS);var hS=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return In(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=A.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:Y(function(){return Hn(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable;Y(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(A.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&zt(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(So);ko(hS);var fS=function(e){function t(n,r,o,i){i===void 0&&(i=null);var a=e.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Y(function(){a.accBeta1=K(r).variable(),a.accBeta2=K(o).variable()}),i==null&&(a.epsilon=A.backend.epsilon()),a}return In(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);Y(function(){var i=ot(1,r.accBeta1),a=ot(1,r.accBeta2);o.forEach(function(s,u){var l=A.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Y(function(){return Ce(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Y(function(){return Ce(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),m=d.div(i),y=p.div(a);h.assign(d),f.assign(p);var v=m.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&zt(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&zt(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){var n;return ee(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){var r,o=this;return ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),Y(function(){o.accBeta1.assign(yu(o.beta1,o.iterations_+1)),o.accBeta2.assign(yu(o.beta2,o.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(So);ko(fS);var dS=function(e){function t(n,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Y(function(){s.iteration=K(0).variable(),s.accBeta1=K(r).variable()}),i==null&&(s.epsilon=A.backend.epsilon()),s}return In(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);Y(function(){var i=ot(1,r.accBeta1),a=_n(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var l=A.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ce(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Ce(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2),m=c.abs(),y=p.maximum(m);h.assign(d),f.assign(y);var v=a.div(i).mul(d.div(y.add(r.epsilon))).add(l);l.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&zt(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&zt(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(So);ko(dS);var ky=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return In(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=Array.isArray(n)?n[i].tensor:n[o];if(a!=null){var s=A.registeredVariables[o];Y(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=A2(K(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(So);ko(ky);var pS=function(e){function t(n,r,o){o===void 0&&(o=!1);var i=e.call(this,n)||this;return i.learningRate=n,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=K(i.momentum),i}return In(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=A.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:Y(function(){return Ce(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(n)?n[i].tensor:n[o];u!=null&&Y(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&zt(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){return ee(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(ky);ko(pS);var vS=function(e){function t(n,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=n,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=A.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return In(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=A.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:Y(function(){return Ce(a).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:Y(function(){return Ce(a).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:Y(function(){return Ce(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,l=r.accumulatedMoments[i].variable;Y(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[i].variable,f=h.mul(r.decay).add(s.mul(1-r.decay)),d=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(d);var p=a.sub(d);a.assign(p)}else{var m=u.mul(r.decay).add(s.square().mul(1-r.decay));d=l.mul(r.momentum).add(s.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),l.assign(d),p=a.sub(d),a.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&zt(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&zt(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&zt(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return Z(this,void 0,void 0,function(){var n;return ee(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return Z(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(So);ko(vS);ze.prototype.squaredDifference=function(e){return W0(this,e)},L=zk;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var mh=function(e,t){return mh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},mh(e,t)};function ce(e,t){mh(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Ct=function(){return Ct=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ct.apply(this,arguments)};function oe(e,t,n,r){function o(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function s(c){try{l(r.next(c))}catch(h){a(h)}}function u(c){try{l(r.throw(c))}catch(h){a(h)}}function l(c){c.done?i(c.value):o(c.value).then(s,u)}l((r=r.apply(e,[])).next())})}function ie(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1],i=l;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(l);break}i[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(c){l=[6,c],o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ta(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var si=function(){function e(t,n){if(!ho(t)||!ho(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Qu(e,t){return e instanceof ze&&e.shape.length===t}function mS(e){return Qu(e,2)}function Yu(e){return Qu(e,3)}function zr(e){return Qu(e,4)}function gS(e){return e%1!==0}function xv(e){return e%2===0}function yS(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function wv(e){return e&&e.width&&e.height}function xS(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new si(Math.round(n*o),Math.round(r*o))}function Hf(e){return e.reduce(function(t,n){return t.add(n)},new Se(0,0)).div(new Se(e.length,e.length))}function Ea(e,t,n){return Array(e).fill(0).map(function(r,o){return t+o*n})}function ho(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function bv(e){return ho(e)&&0<=e&&e<=1}var Se=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Hr=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(ho),i=[r.x,r.y,r.width,r.height].every(ho);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(ho)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Se(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Se(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Se(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Se(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,i=t.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:n,y:r,width:o,height:i})},e.prototype.rescale=function(t){var n=wv(t)?t.width:t,r=wv(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],o=r[0],i=r[1],a=r[2],s=r[3];return new e({x:o,y:i,width:a,height:s})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(i,0),c=a-u,h=s-l,f=Math.min(c,t-u),d=Math.min(h,n-l);return new e({x:u,y:l,width:f,height:d}).floor()},e.prototype.shift=function(t,n){var r=this,o=r.width,i=r.height,a=this.x+t,s=this.y+n;return new e({x:a,y:s,width:o,height:i})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,l=this.left,c=this.top,h=this.right,f=this.bottom;return h>n&&(s=-h+n+r,h=n),f>t&&(u=-f+t+o,f=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:i,edx:s,y:c,ey:f,x:l,ex:h,w:r,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Ju=function(e){ce(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{left:n,top:r,right:o,bottom:i},a)||this}return t}(Hr),Sy=function(){function e(t,n,r,o,i){this._imageDims=new si(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new Hr(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Hr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Qn=function(e){ce(t,e);function t(n,r,o){return e.call(this,n,n,"",r,o)||this}return t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new t(i,a,s)},t}(Sy);function wS(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*o;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function bS(e){var t=e.map(function(s){return s.x}),n=e.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=n.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return s<u?u:s},0),a=n.reduce(function(s,u){return s<u?u:s},0);return new Ju(r,o,i,a)}function ka(e,t,n,r){r===void 0&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,l=[],c=0;c<u.length;c++){var h=u[c],f=e[s],d=e[h];l.push(wS(f,d,r))}o=o.filter(function(p,m){return l[m]<=n})};o.length>0;)a();return i}function ja(e,t){return Y(function(){var n=t[0],r=t[1],o=t[2],i=Hn(ta(e.shape.slice(0,3),[1]),n),a=Hn(ta(e.shape.slice(0,3),[1]),r),s=Hn(ta(e.shape.slice(0,3),[1]),o),u=tt([i,a,s],3);return ot(e,u)})}function CS(e,t){return t===void 0&&(t=!1),Y(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(t?.5:1)),s=r>o?2:1,u=function(d){var p=e.shape.slice();return p[s]=d,Hn(p,0)},l=u(a),c=i-l.shape[s],h=t&&c?u(c):null,f=[h,e,l].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return tt(f,s)})}function ec(e){return 1/(1+Math.exp(-e))}var Gf=function(e){ce(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{x:n,y:r,width:o,height:i},a)||this}return t}(Hr),_S=.5,ES=.43,kS=.45,bu=function(){function e(t,n,r){r===void 0&&(r=new Se(0,0));var o=n.width,i=n.height;this._imgDims=new si(o,i),this._shift=r,this._positions=t.map(function(a){return a.mul(new Se(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Se(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new Se(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new Se(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof Qn?t.box.floor():new Hr(t);return this.shiftBy(r.x,r.y).align(null,n)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],o=t[2],i=function(h){return o.sub(h).magnitude()},a=(i(n)+i(r))/2,s=Math.floor(a/kS),u=Hf(t),l=Math.floor(Math.max(0,u.x-_S*s)),c=Math.floor(Math.max(0,u.y-ES*s));return new Gf(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},e.prototype.alignMinBbox=function(t){var n=bS(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),SS=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],Hf([n[3],n[4]])]},t}(bu),NS=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Hf)},t}(bu),Cv=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+yS(this.distance)+")":"")},e}(),_v=function(e){ce(t,e);function t(n,r){var o=e.call(this,n)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(n,r){if(Hr.assertIsValidBox(n,r),!ho(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Hr),ds=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){ce(t,e);function t(n,r,o,i){var a=e.call(this,n,r)||this;return a._score=o,a._classScore=i,a}return t.assertIsValidPredictedBox=function(n,r){if(_v.assertIsValidLabeledBox(n,r),!bv(n.score)||!bv(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(_v);function RS(e){return e.detection instanceof Qn}function qf(e,t){var n={detection:t};return Object.assign({},e,n)}function Ny(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function Ry(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(o,i){e.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function Iy(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=Ry();return Ct({Canvas:e||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:t||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:n,createImageElement:r,fetch:o},i)}function Ty(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Py(){return typeof global=="object"&&typeof require=="function"&&typeof c1<"u"&&typeof process<"u"&&!!process.version}var Je;function IS(){if(!Je)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Je}function gh(e){Je=e}function Xf(){Ty()&&gh(Ny()),Py()&&gh(Iy())}function TS(e){if(Je||Xf(),!Je)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?Je.Canvas:t,r=e.Image,o=r===void 0?Je.Image:r;Je.Canvas=n,Je.Image=o,Je.createCanvasElement=e.createCanvasElement||function(){return new n},Je.createImageElement=e.createImageElement||function(){return new o},Je.ImageData=e.ImageData||Je.ImageData,Je.Video=e.Video||Je.Video,Je.fetch=e.fetch||Je.fetch,Je.readFile=e.readFile||Je.readFile}var Nt={getEnv:IS,setEnv:gh,initialize:Xf,createBrowserEnv:Ny,createFileSystem:Ry,createNodejsEnv:Iy,monkeyPatch:TS,isBrowser:Ty,isNodejs:Py};Xf();function Dy(e){return!Nt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function xo(e){var t=Nt.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var o=Dy(e);if(!(o instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var Ev;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Ev||(Ev={}));function Ay(e){var t=Nt.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function PS(e){return new Promise(function(t,n){if(e instanceof Nt.getEnv().Canvas||Ay(e))return t();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function Fy(e){var t=Nt.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new si(e.naturalWidth,e.naturalHeight):e instanceof r?new si(e.videoWidth,e.videoHeight):new si(e.width,e.height)}function Zu(e){var t=e.width,n=e.height,r=Nt.getEnv().createCanvasElement,o=r();return o.width=t,o.height=n,o}function Kf(e,t){var n=Nt.getEnv().ImageData;if(!(e instanceof n)&&!Ay(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=Fy(e),o=r.width,i=r.height,a=Zu({width:o,height:i});return e instanceof n?xo(a).putImageData(e,0,0):xo(a).drawImage(e,0,0,o,i),a}function DS(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s;return ie(this,function(u){switch(u.label){case 0:return n=Nt.getEnv().createCanvasElement(),r=e.shape.slice(zr(e)?1:0),o=r[0],i=r[1],a=r[2],s=Y(function(){return e.as3D(o,i,a).toInt()}),[4,$f.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function kv(e){var t=Nt.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function AS(e,t,n){n===void 0&&(n=!1);var r=Nt.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Fy(e),s=t/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=Zu({width:t,height:t}),h=e instanceof i?e:Kf(e),f=Math.abs(u-l)/2,d=n&&u<l?f:0,p=n&&l<u?f:0;return xo(c).drawImage(h,d,p,u,l),c}var Cu=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(o,i){if(Yu(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(zr(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Nt.getEnv().Canvas?o:Kf(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Ea(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return xS({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,Y(function(){var o=Ea(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof ze){var u=zr(s)?s:s.expandDims();return u=CS(u,n),(u.shape[1]!==t||u.shape[2]!==t)&&(u=Lf.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof Nt.getEnv().Canvas)return $f.fromPixels(AS(s,t,n));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=Zt(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,t,t,3);return i})},e}();function ct(e){return oe(this,void 0,void 0,function(){var t,n,r;return ie(this,function(o){switch(o.label){case 0:if(e instanceof Cu)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=t.map(Dy),r.forEach(function(i,a){if(!kv(i)&&!Yu(i)&&!zr(i))throw typeof t[a]=="string"?new Error("toNetInput -"+n(a)+" string passed, but could not resolve HTMLElement for element id "+t[a]):new Error("toNetInput -"+n(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(zr(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+n(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return kv(i)&&PS(i)}))];case 1:return o.sent(),[2,new Cu(r,Array.isArray(e))]}})})}function Qf(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u;return ie(this,function(l){switch(l.label){case 0:return n=Nt.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,ct(e)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,DS(i)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=xo(r),u=t.map(function(c){return c instanceof Qn?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,f=c.y,d=c.width,p=c.height,m=Zu({width:d,height:p});return xo(m).putImageData(s.getImageData(h,f,d,p),0,0),m})]}})})}function Yf(e,t){return oe(this,void 0,void 0,function(){return ie(this,function(n){if(!Yu(e)&&!zr(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(zr(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Y(function(){var r=e.shape.slice(zr(e)?1:0),o=r[0],i=r[1],a=r[2],s=t.map(function(l){return l instanceof Qn?l.forSize(i,o).box:l}).map(function(l){return l.clipAtImageBorders(i,o)}),u=s.map(function(l){var c=l.x,h=l.y,f=l.width,d=l.height;return sy(e.as3D(o,i,a),[h,c,0],[d,f,a])});return u})]})})}function FS(e,t){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return n=Nt.getEnv().fetch,[4,n(e,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function MS(e){return oe(this,void 0,void 0,function(){return ie(this,function(t){switch(t.label){case 0:return[4,FS(e)];case 1:return[2,t.sent().json()]}})})}function My(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),i=e.endsWith(".json")?o[o.length-1]:n,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function OS(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i;return ie(this,function(a){switch(a.label){case 0:return n=My(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,MS(r)];case 1:return i=a.sent(),[2,Ey.loadWeights(i,o)]}})})}var vr=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;return r[o]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof gi})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof gi)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,o=n.tensor;t.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,o=n.tensor,i=pt(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return oe(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return oe(this,void 0,void 0,function(){var n;return ie(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,OS(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,h;return ie(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Nt.getEnv().readFile,r=My(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(d){return Promise.all(d.map(function(p){return n(p).then(function(m){return m.buffer})}))},s=Ey.weightsLoaderFactory(a),c=(l=JSON).parse,[4,n(o)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,i)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+t);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=n.obj,o=n.objProp;if(!r||!o||!(r[o]instanceof ze))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},e}();function Yt(e,t,n){return Y(function(){var r=Af(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=ge(r,t.bias),r})}function tc(e,t,n){return n===void 0&&(n=!1),Y(function(){var r=Ue(n?ge(mn(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Yt(e,t.conv0,[2,2])),o=Yt(r,t.conv1,[1,1]),i=Ue(ge(r,o)),a=Yt(i,t.conv2,[1,1]);return Ue(ge(r,ge(o,a)))})}function ps(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),Y(function(){var o=Ue(n?ge(mn(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Yt(e,t.conv0,r?[2,2]:[1,1])),i=Yt(o,t.conv1,[1,1]),a=Ue(ge(o,i)),s=Yt(a,t.conv2,[1,1]),u=Ue(ge(o,ge(i,s))),l=Yt(u,t.conv3,[1,1]);return Ue(ge(o,ge(i,ge(s,l))))})}function Nn(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),Y(function(){var o=ge(mn(e,t.filters,[1,1],n),t.bias);return r?Ue(o):o})}function mr(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function el(e,t){return function(n,r,o,i){var a=Mt(e(n*r*o*o),[o,o,n,r]),s=Ye(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function Jf(e,t){return function(n,r,o){var i=jr(e(n*r),[n,r]),a=Ye(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var Oy=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function Zf(e,t){return function(n,r,o){var i=Mt(e(9*n),[3,3,n,1]),a=Mt(e(n*r),[1,1,n,r]),s=Ye(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Oy(i,a,s)}}function ed(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new Oy(n,r,o)}}function Yr(e,t){return function(n,r,o){var i=e[n];if(!Qu(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:o||n}),i}}function gr(e){var t=e;function n(o){var i=t.slice(0,o);return t=t.slice(o),i}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function By(e,t){var n=el(e,t),r=Zf(e,t);function o(a,s,u,l){l===void 0&&(l=!1);var c=l?n(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),h=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:f}}function i(a,s,u,l){l===void 0&&(l=!1);var c=o(a,s,u,l),h=c.conv0,f=c.conv1,d=c.conv2,p=r(s,s,u+"/conv3");return{conv0:h,conv1:f,conv2:d,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function BS(e){var t=[],n=gr(e),r=n.extractWeights,o=n.getRemainingWeights,i=By(r,t).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),l=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function Ly(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function jy(e,t){var n=Yr(e,t),r=Ly(n),o=ed(n);function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),h=o(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),h=o(s+"/conv2"),f=o(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:f}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function LS(e){var t=[],n=jy(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return mr(e,t),{params:r,paramMappings:t}}var Wy=function(e){ce(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Y(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=ja(o,i).div(K(255)),s=ps(a,r.dense0,!0);return s=ps(s,r.dense1),s=ps(s,r.dense2),s=ps(s,r.dense3),s=Ba(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return LS(n)},t.prototype.extractParams=function(n){return BS(n)},t}(vr);function Wn(e,t){return Y(function(){return ge(qu(e,t.weights),t.bias)})}function jS(e,t,n){var r=[],o=gr(e),i=o.extractWeights,a=o.getRemainingWeights,s=Jf(i,r),u=s(t,n,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function WS(e){var t=[],n=Yr(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return mr(e,t),{params:o,paramMappings:t}}function zy(e){var t={},n={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?n:t;o[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Uy=function(e){ce(t,e);function t(n,r){var o=e.call(this,n)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Y(function(){var i=n instanceof Cu?r.faceFeatureExtractor.forwardInput(n):n;return Wn(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return jS(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=zy(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),WS(i)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=n.slice(0,n.length-i),s=n.slice(n.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(vr),Sv=["neutral","happy","sad","angry","fearful","disgusted","surprised"],zS=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);Sv.forEach(function(r,o){n[r]=t[o]})}return e.prototype.asSortedArray=function(){var t=this;return Sv.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),US=function(e){ce(t,e);function t(n){return n===void 0&&(n=new Wy),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return Y(function(){return dr(r.runNet(n))})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s=this;return ie(this,function(u){switch(u.label){case 0:return[4,ct(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(nt(o).map(function(l){return oe(s,void 0,void 0,function(){var c;return ie(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(l){return new zS(l)}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Uy);function Vy(e,t){var n={expressions:t};return Object.assign({},e,n)}function VS(e){return RS(e)&&e.landmarks instanceof bu&&e.unshiftedLandmarks instanceof bu&&e.alignedRect instanceof Qn}function td(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),i=e.detection.imageDims,a=new Qn(e.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:t,alignedRect:a};return Object.assign({},e,s)}function $S(e,t){var n=el(e,t),r=Zf(e,t);function o(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),h=n(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function HS(e,t){var n=[],r=gr(e),o=r.extractWeights,i=r.getRemainingWeights,a=$S(o,n),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),d=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:f,reduction_block_1:d},m={};Ea(t,0,1).forEach(function(x){m["main_block_"+x]=c(128,"middle_flow/main_block_"+x)});var y=l(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),g={reduction_block:y,separable_conv:v};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:p,middle_flow:m,exit_flow:g}}}function GS(e,t){var n=Yr(e,t),r=Ly(n),o=ed(n);function i(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function qS(e,t){var n=[],r=GS(e,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};Ea(t,0,1).forEach(function(y){f["main_block_"+y]=s("middle_flow/main_block_"+y)});var d=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),m={reduction_block:d,separable_conv:p};return mr(e,n),{params:{entry_flow:h,middle_flow:f,exit_flow:m},paramMappings:n}}function $y(e,t,n){return ge(mn(e,t.filters,n,"same"),t.bias)}function nc(e,t,n){n===void 0&&(n=!0);var r=n?Ue(e):e;return r=Yt(r,t.separable_conv0,[1,1]),r=Yt(Ue(r),t.separable_conv1,[1,1]),r=at(r,[3,3],[2,2],"same"),r=ge(r,$y(e,t.expansion_conv,[2,2])),r}function XS(e,t){var n=Yt(Ue(e),t.separable_conv0,[1,1]);return n=Yt(Ue(n),t.separable_conv1,[1,1]),n=Yt(Ue(n),t.separable_conv2,[1,1]),n=ge(n,e),n}var KS=function(e){ce(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return Y(function(){var i=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=ja(i,a).div(K(256)),u=Ue($y(s,o.entry_flow.conv_in,[2,2]));return u=nc(u,o.entry_flow.reduction_block_0,!1),u=nc(u,o.entry_flow.reduction_block_1),Ea(r._numMainBlocks,0,1).forEach(function(l){u=XS(u,o.middle_flow["main_block_"+l])}),u=nc(u,o.exit_flow.reduction_block),u=Ue(Yt(u,o.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return qS(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return HS(n,this._numMainBlocks)},t}(vr);function QS(e){var t=[],n=gr(e),r=n.extractWeights,o=n.getRemainingWeights,i=Jf(r,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}function YS(e){var t=[],n=Yr(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return mr(e,t),{params:o,paramMappings:t}}var _u;(function(e){e.FEMALE="female",e.MALE="male"})(_u||(_u={}));var JS=function(e){ce(t,e);function t(n){n===void 0&&(n=new KS(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Y(function(){var i=n instanceof Cu?r.faceFeatureExtractor.forwardInput(n):n,a=Ba(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=Wn(a,o.fc.age).as1D(),u=Wn(a,o.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(n){var r=this;return Y(function(){var o=r.runNet(n),i=o.age,a=o.gender;return{age:i,gender:dr(a)}})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l=this;return ie(this,function(c){switch(c.label){case 0:return[4,ct(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),i=nt(o.age),a=nt(o.gender),s=i.map(function(h,f){return{ageTensor:h,genderTensor:a[f]}}),[4,Promise.all(s.map(function(h){var f=h.ageTensor,d=h.genderTensor;return oe(l,void 0,void 0,function(){var p,m,y,v,g;return ie(this,function(x){switch(x.label){case 0:return[4,f.data()];case 1:return p=x.sent()[0],[4,d.data()];case 2:return m=x.sent()[0],y=m>.5,v=y?_u.MALE:_u.FEMALE,g=y?m:1-m,f.dispose(),d.dispose(),[2,{age:p,gender:v,genderProbability:g}]}})})}))];case 3:return u=c.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return QS(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=zy(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),YS(i)},t.prototype.extractParams=function(n){var r=1539,o=n.slice(0,n.length-r),i=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(vr),Hy=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,o){var i=o.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=i.length;return Y(function(){var s=function(f,d){return Zt([Hn([68],f),Hn([68],d)],1).as2D(1,136).as1D()},u=function(f,d){var p=i[f],m=p.width,y=p.height;return d(m,y)?Math.abs(m-y)/2:0},l=function(f){return u(f,function(d,p){return d<p})},c=function(f){return u(f,function(d,p){return p<d})},h=n.mul(Hn([a,136],r)).sub(Zt(Array.from(Array(a),function(f,d){return s(l(d),c(d))}))).div(Zt(Array.from(Array(a),function(f,d){return s(i[d].width,i[d].height)})));return h})},t.prototype.forwardInput=function(n){var r=this;return Y(function(){var o=r.runNet(n);return r.postProcess(o,n.inputSize,n.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a=this;return ie(this,function(s){switch(s.label){case 0:return[4,ct(n)];case 1:return r=s.sent(),o=Y(function(){return nt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,l){return oe(a,void 0,void 0,function(){var c,h,f,d,p;return ie(this,function(m){switch(m.label){case 0:return f=(h=Array).from,[4,u.data()];case 1:return c=f.apply(h,[m.sent()]),d=c.filter(function(y,v){return xv(v)}),p=c.filter(function(y,v){return!xv(v)}),[2,new NS(Array(68).fill(0).map(function(y,v){return new Se(d[v],p[v])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Uy),Gy=function(e){ce(t,e);function t(n){return n===void 0&&(n=new Wy),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Hy);function ZS(e){var t=[],n=jy(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return mr(e,t),{params:r,paramMappings:t}}function eN(e){var t=[],n=gr(e),r=n.extractWeights,o=n.getRemainingWeights,i=By(r,t).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u}}}var tN=function(e){ce(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Y(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=ja(o,i).div(K(255)),s=tc(a,r.dense0,!0);return s=tc(s,r.dense1),s=tc(s,r.dense2),s=Ba(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return ZS(n)},t.prototype.extractParams=function(n){return eN(n)},t}(vr),nN=function(e){ce(t,e);function t(n){return n===void 0&&(n=new tN),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Hy);(function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Gy);function rN(e,t){return ge(kt(e,t.weights),t.biases)}function nd(e,t,n,r,o){o===void 0&&(o="same");var i=t.conv,a=i.filters,s=i.bias,u=mn(e,a,n,o);return u=ge(u,s),u=rN(u,t.scale),r?Ue(u):u}function oN(e,t){return nd(e,t,[1,1],!0)}function qy(e,t){return nd(e,t,[1,1],!1)}function Xy(e,t){return nd(e,t,[2,2],!0,"valid")}function iN(e,t){function n(s,u,l){var c=e(s),h=c.length/(u*l*l);if(gS(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Y(function(){return $r(Mt(c,[u,h,l,l]),[2,3,1,0])})}function r(s,u,l,c){var h=n(s,u,l),f=Ye(e(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:f}}function o(s,u){var l=Ye(e(s)),c=Ye(e(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function i(s,u,l,c){var h=r(s,u,l,c+"/conv"),f=o(u,c+"/scale");return{conv:h,scale:f}}function a(s,u,l,c,h){h===void 0&&(h=!1);var f=i((h?.5:1)*s,u,l,c+"/conv1"),d=i(s,u,l,c+"/conv2");return{conv1:f,conv2:d}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function aN(e){var t=gr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=iN(n,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),y=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),g=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),b=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),S=Y(function(){return $r(jr(n(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:f,conv64_1:d,conv64_2:p,conv64_3:m,conv128_down:y,conv128_1:v,conv128_2:g,conv256_down:x,conv256_1:w,conv256_2:b,conv256_down_out:C,fc:S};return{params:E,paramMappings:o}}function sN(e,t){var n=Yr(e,t);function r(a){var s=n(a+"/scale/weights",1),u=n(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=n(a+"/conv/filters",4),u=n(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function uN(e){var t=[],n=sN(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),h=o("conv64_2"),f=o("conv64_3"),d=o("conv128_down"),p=o("conv128_1"),m=o("conv128_2"),y=o("conv256_down"),v=o("conv256_1"),g=o("conv256_2"),x=o("conv256_down_out"),w=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!mS(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var b={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:f,conv128_down:d,conv128_1:p,conv128_2:m,conv256_down:y,conv256_1:v,conv256_2:g,conv256_down_out:x,fc:w};return mr(e,t),{params:b,paramMappings:t}}function An(e,t){var n=oN(e,t.conv1);return n=qy(n,t.conv2),n=ge(n,e),n=Ue(n),n}function vs(e,t){var n=Xy(e,t.conv1);n=qy(n,t.conv2);var r=Ba(e,2,2,"valid"),o=Oe(r.shape),i=r.shape[3]!==n.shape[3],a=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(a){var s=ta(n.shape);s[1]=1;var u=Oe(s);n=tt([n,u],1);var l=ta(n.shape);l[2]=1;var c=Oe(l);n=tt([n,c],2)}return r=i?tt([r,o],3):r,n=ge(r,n),n=Ue(n),n}var lN=function(e){ce(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Y(function(){var o=n.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=ja(o,i).div(K(256)),s=Xy(a,r.conv32_down);s=at(s,3,2,"valid"),s=An(s,r.conv32_1),s=An(s,r.conv32_2),s=An(s,r.conv32_3),s=vs(s,r.conv64_down),s=An(s,r.conv64_1),s=An(s,r.conv64_2),s=An(s,r.conv64_3),s=vs(s,r.conv128_down),s=An(s,r.conv128_1),s=An(s,r.conv128_2),s=vs(s,r.conv256_down),s=An(s,r.conv256_1),s=An(s,r.conv256_2),s=vs(s,r.conv256_down_out);var u=s.mean([1,2]),l=qu(u,r.fc);return l})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a=this;return ie(this,function(s){switch(s.label){case 0:return[4,ct(n)];case 1:return r=s.sent(),o=Y(function(){return nt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return uN(n)},t.prototype.extractParams=function(n){return aN(n)},t}(vr);function Ky(e,t){var n={descriptor:t};return Object.assign({},e,n)}function Qy(e,t){var n={age:t};return Object.assign({},e,n)}function Yy(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Jy=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,o=n.scaleFactor,i=n.maxNumScales,a=n.scoreThresholds,s=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function cN(e,t){function n(u,l){var c=Mt(e(9*u),[3,3,u,1]),h=Ye(e(u)),f=Ye(e(u)),d=Ye(e(u)),p=Ye(e(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:d,batch_norm_variance:p}}function r(u,l,c,h,f){var d=Mt(e(u*l*c*c),[c,c,u,l]),p=Ye(e(l));return t.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:d,bias:p}}function o(u,l,c,h){var f=r(u,l,c,h,!0),d=f.filters,p=f.bias;return{filters:d,batch_norm_offset:p}}function i(u,l,c){var h=n(u,c+"/depthwise_conv"),f=o(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),l=i(32,64,"mobilenetv1/conv_1"),c=i(64,128,"mobilenetv1/conv_2"),h=i(128,128,"mobilenetv1/conv_3"),f=i(128,256,"mobilenetv1/conv_4"),d=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),m=i(512,512,"mobilenetv1/conv_7"),y=i(512,512,"mobilenetv1/conv_8"),v=i(512,512,"mobilenetv1/conv_9"),g=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),w=i(512,1024,"mobilenetv1/conv_12"),b=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:m,conv_8:y,conv_9:v,conv_10:g,conv_11:x,conv_12:w,conv_13:b}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),c=o(512,128,1,"prediction_layer/conv_2"),h=o(128,256,3,"prediction_layer/conv_3"),f=o(256,128,1,"prediction_layer/conv_4"),d=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),m=o(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),g=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),b=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),N=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),P=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),D={box_encoding_predictor:y,class_predictor:v},z={box_encoding_predictor:g,class_predictor:x},W={box_encoding_predictor:w,class_predictor:b},j={box_encoding_predictor:C,class_predictor:S},$={box_encoding_predictor:E,class_predictor:R},V={box_encoding_predictor:N,class_predictor:P};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:m,box_predictor_0:D,box_predictor_1:z,box_predictor_2:W,box_predictor_3:j,box_predictor_4:$,box_predictor_5:V}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function hN(e){var t=[],n=gr(e),r=n.extractWeights,o=n.getRemainingWeights,i=cN(r,t),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),l=s(),c=yf(r(5118*4),[1,5118,4]),h={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:t}}function fN(e,t){var n=Yr(e,t);function r(l,c,h){var f=n(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),d=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:d}}function o(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",d=c+"/pointwise_conv",p=n(h+"/depthwise_weights",4,f+"/filters"),m=n(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),y=n(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),v=n(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),g=n(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:y,batch_norm_mean:v,batch_norm_variance:g},pointwise_conv:r("MobilenetV1",l,d)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(l,c){var h=n(l+"/weights",4,c+"/filters"),f=n(l+"/biases",1,c+"/bias");return{filters:h,bias:f}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function dN(e){var t=[],n=fN(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Yu(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return mr(e,t),{params:a,paramMappings:t}}function Mn(e,t,n){return Y(function(){var r=mn(e,t.filters,n,"same");return r=ge(r,t.batch_norm_offset),If(r,0,6)})}var pN=.0010000000474974513;function vN(e,t,n){return Y(function(){var r=Gu(e,t.filters,n,"same");return r=G0(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,pN),If(r,0,6)})}function mN(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function gN(e,t){return Y(function(){var n=null,r=Mn(e,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(i,a){var s=a+1,u=mN(s);r=vN(r,i.depthwise_conv,u),r=Mn(r,i.pointwise_conv,[1,1]),s===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function yN(e,t,n,r,o){var i=e.shape[0],a=Math.min(n,i),s=t.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>o}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var h=c.score,f=l.length-1;f>=0;--f){var d=xN(e,c.boxIndex,l[f]);if(d!==0&&(c.score*=u(d),c.score<=o))break}h===c.score&&l.push(c.boxIndex)}}),l}function xN(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),f=(a-o)*(s-i),d=(c-u)*(h-l);if(f<=0||d<=0)return 0;var p=Math.max(o,u),m=Math.max(i,l),y=Math.min(a,c),v=Math.min(s,h),g=Math.max(y-p,0)*Math.max(v-m,0);return g/(f+d-g)}function wN(e){var t=nt($r(e,[1,0])),n=[ot(t[2],t[0]),ot(t[3],t[1])],r=[ge(t[0],_n(n[0],K(2))),ge(t[1],_n(n[1],K(2)))];return{sizes:n,centers:r}}function bN(e,t){var n=wN(e),r=n.sizes,o=n.centers,i=nt($r(t,[1,0])),a=_n(kt(ch(_n(i[2],K(5))),r[0]),K(2)),s=ge(kt(_n(i[0],K(10)),r[0]),o[0]),u=_n(kt(ch(_n(i[3],K(5))),r[1]),K(2)),l=ge(kt(_n(i[1],K(10)),r[1]),o[1]);return $r(Zt([ot(s,a),ot(l,u),ge(s,a),ge(l,u)]),[1,0])}function CN(e,t,n){return Y(function(){var r=e.shape[0],o=bN(En(ni(n.extra_dim,[r,1,1]),[-1,4]),En(e,[-1,4]));o=En(o,[r,o.shape[0]/r,4]);var i=U0(Gn(t,[0,0,1],[-1,-1,-1])),a=Gn(i,[0,0,0],[-1,-1,1]);a=En(a,[r,a.shape[1]]);var s=nt(o),u=nt(a);return{boxes:s,scores:u}})}function Do(e,t){return Y(function(){var n=e.shape[0],r=En(Nn(e,t.box_encoding_predictor),[n,-1,1,4]),o=En(Nn(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function _N(e,t,n){return Y(function(){var r=Mn(e,n.conv_0,[1,1]),o=Mn(r,n.conv_1,[2,2]),i=Mn(o,n.conv_2,[1,1]),a=Mn(i,n.conv_3,[2,2]),s=Mn(a,n.conv_4,[1,1]),u=Mn(s,n.conv_5,[2,2]),l=Mn(u,n.conv_6,[1,1]),c=Mn(l,n.conv_7,[2,2]),h=Do(t,n.box_predictor_0),f=Do(e,n.box_predictor_1),d=Do(o,n.box_predictor_2),p=Do(a,n.box_predictor_3),m=Do(u,n.box_predictor_4),y=Do(c,n.box_predictor_5),v=tt([h.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,y.boxPredictionEncoding],1),g=tt([h.classPrediction,f.classPrediction,d.classPrediction,p.classPrediction,m.classPrediction,y.classPrediction],1);return{boxPredictions:v,classPredictions:g}})}var tl=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,o=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Zy=function(e){ce(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Y(function(){var o=n.toBatchTensor(512,!1).toFloat(),i=ot(kt(o,K(.007843137718737125)),K(1)),a=gN(i,r.mobilenetv1),s=_N(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return CN(u,l,r.output_layer)})},t.prototype.forward=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,ct(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),oe(this,void 0,void 0,function(){var o,i,a,s,u,l,c,h,f,d,p,m,y,v,g,x,w,b,C,S,E;return ie(this,function(R){switch(R.label){case 0:return o=new tl(r),i=o.maxResults,a=o.minConfidence,[4,ct(n)];case 1:for(s=R.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],f=c[0],d=1;d<l.length;d++)l[d].dispose(),c[d].dispose();return y=(m=Array).from,[4,f.data()];case 2:return p=y.apply(m,[R.sent()]),v=.5,g=yN(h,p,i,v,a),x=s.getReshapedInputDimensions(0),w=s.inputSize,b=w/x.width,C=w/x.height,S=h.arraySync(),E=g.map(function(N){var P=[Math.max(0,S[N][0]),Math.min(1,S[N][2])].map(function(V){return V*C}),D=P[0],z=P[1],W=[Math.max(0,S[N][1]),Math.min(1,S[N][3])].map(function(V){return V*b}),j=W[0],$=W[1];return new Qn(p[N],new Gf(j,D,$-j,z-D),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,E]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return dN(n)},t.prototype.extractParams=function(n){return hN(n)},t}(vr);(function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Zy);var EN=.4,kN=[new Se(.738768,.874946),new Se(2.42204,2.65704),new Se(4.30971,7.04493),new Se(10.246,4.59428),new Se(12.6868,11.8741)],SN=[new Se(1.603231,2.094468),new Se(6.041143,7.080126),new Se(2.882459,3.518061),new Se(4.266906,5.178857),new Se(9.041765,10.66308)],NN=[117.001,114.697,97.404],RN="tiny_yolov2_model",IN="tiny_yolov2_separable_conv_model",ms=function(e){return typeof e=="number"};function TN(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!ms(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return ms(t.x)&&ms(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(ms)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function rd(e){return Y(function(){var t=kt(e,K(.10000000149011612));return ge(Ue(ot(e,t)),t)})}function br(e,t){return Y(function(){var n=_o(e,[[0,0],[1,1],[1,1],[0,0]]);return n=mn(n,t.conv.filters,[1,1],"valid"),n=ot(n,t.bn.sub),n=kt(n,t.bn.truediv),n=ge(n,t.conv.bias),rd(n)})}function Cr(e,t){return Y(function(){var n=_o(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Af(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=ge(n,t.bias),rd(n)})}function PN(e,t){var n=el(e,t);function r(a,s){var u=Ye(e(a)),l=Ye(e(a));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function o(a,s,u){var l=n(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var i=Zf(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function DN(e,t,n,r){var o=gr(e),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=PN(i,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,f;if(t.withSeparableConvs){var d=r[0],p=r[1],m=r[2],y=r[3],v=r[4],g=r[5],x=r[6],w=r[7],b=r[8],C=t.isFirstLayerConv2d?l(d,p,3,"conv0"):h(d,p,"conv0"),S=h(p,m,"conv1"),E=h(m,y,"conv2"),R=h(y,v,"conv3"),N=h(v,g,"conv4"),P=h(g,x,"conv5"),D=w?h(x,w,"conv6"):void 0,z=b?h(w,b,"conv7"):void 0,W=l(b||w||x,5*n,1,"conv8");f={conv0:C,conv1:S,conv2:E,conv3:R,conv4:N,conv5:P,conv6:D,conv7:z,conv8:W}}else{var d=r[0],p=r[1],m=r[2],y=r[3],v=r[4],g=r[5],x=r[6],w=r[7],b=r[8],C=c(d,p,"conv0"),S=c(p,m,"conv1"),E=c(m,y,"conv2"),R=c(y,v,"conv3"),N=c(v,g,"conv4"),P=c(g,x,"conv5"),D=c(x,w,"conv6"),z=c(w,b,"conv7"),W=l(b,5*n,1,"conv8");f={conv0:C,conv1:S,conv2:E,conv3:R,conv4:N,conv5:P,conv6:D,conv7:z,conv8:W}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}function AN(e,t){var n=Yr(e,t);function r(s){var u=n(s+"/sub",1),l=n(s+"/truediv",1);return{sub:u,truediv:l}}function o(s){var u=n(s+"/filters",4),l=n(s+"/bias",1);return{filters:u,bias:l}}function i(s){var u=o(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=ed(n);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function FN(e,t){var n=[],r=AN(e,n),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return mr(e,n),{params:s,paramMappings:n}}var Nv;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Nv||(Nv={}));var od=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,o=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),e1=function(e){ce(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return TN(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var o=br(n,r.conv0);return o=at(o,[2,2],[2,2],"same"),o=br(o,r.conv1),o=at(o,[2,2],[2,2],"same"),o=br(o,r.conv2),o=at(o,[2,2],[2,2],"same"),o=br(o,r.conv3),o=at(o,[2,2],[2,2],"same"),o=br(o,r.conv4),o=at(o,[2,2],[2,2],"same"),o=br(o,r.conv5),o=at(o,[2,2],[1,1],"same"),o=br(o,r.conv6),o=br(o,r.conv7),Nn(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var o=this.config.isFirstLayerConv2d?rd(Nn(n,r.conv0,"valid",!1)):Cr(n,r.conv0);return o=at(o,[2,2],[2,2],"same"),o=Cr(o,r.conv1),o=at(o,[2,2],[2,2],"same"),o=Cr(o,r.conv2),o=at(o,[2,2],[2,2],"same"),o=Cr(o,r.conv3),o=at(o,[2,2],[2,2],"same"),o=Cr(o,r.conv4),o=at(o,[2,2],[2,2],"same"),o=Cr(o,r.conv5),o=at(o,[2,2],[1,1],"same"),o=r.conv6?Cr(o,r.conv6):o,o=r.conv7?Cr(o,r.conv7):o,Nn(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Y(function(){var a=n.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?ja(a,o.config.meanRgb):a,a=a.div(K(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},t.prototype.forward=function(n,r){return oe(this,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,ct(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),oe(this,void 0,void 0,function(){var o,i,a,s,u,l,c,h,f,d,p,m,y,v,g=this;return ie(this,function(x){switch(x.label){case 0:return o=new od(r),i=o.inputSize,a=o.scoreThreshold,[4,ct(n)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),l=Y(function(){return nt(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return h=x.sent(),u.dispose(),l.dispose(),f=h.map(function(w){return w.box}),d=h.map(function(w){return w.score}),p=h.map(function(w){return w.classScore}),m=h.map(function(w){return g.config.classes[w.label]}),y=ka(f.map(function(w){return w.rescale(i)}),d,this.config.iouThreshold,!0),v=y.map(function(w){return new Sy(d[w],p[w],m[w],f[w],c)}),[2,v]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return FN(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return DN(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,o){return oe(this,void 0,void 0,function(){var i,a,s,u,l,c,h,f,d,p,m,y,v,g,x,w,b,C,S,E,R,N,P,D,z,W,j,$,V,F=this;return ie(this,function(M){switch(M.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,l=s/a,c=n.shape[1],h=this.config.anchors.length,f=Y(function(){var B=n.reshape([c,c,h,F.boxEncodingSize]),G=B.slice([0,0,0,0],[c,c,h,4]),X=B.slice([0,0,0,4],[c,c,h,1]),ne=F.withClassScores?dr(B.slice([0,0,0,5],[c,c,h,F.config.classes.length]),3):K(0);return[G,X,ne]}),d=f[0],p=f[1],m=f[2],y=[],[4,p.array()];case 1:return v=M.sent(),[4,d.array()];case 2:g=M.sent(),x=0,M.label=3;case 3:if(!(x<c))return[3,12];w=0,M.label=4;case 4:if(!(w<c))return[3,11];b=0,M.label=5;case 5:return b<h?(C=ec(v[x][w][b][0]),!o||C>o?(S=(w+ec(g[x][w][b][0]))/c*u,E=(x+ec(g[x][w][b][1]))/c*l,R=Math.exp(g[x][w][b][2])*this.config.anchors[b].x/c*u,N=Math.exp(g[x][w][b][3])*this.config.anchors[b].y/c*l,P=S-R/2,D=E-N/2,z={row:x,col:w,anchor:b},this.withClassScores?[4,this.extractPredictedClass(m,z)]:[3,7]):[3,9]):[3,10];case 6:return V=M.sent(),[3,8];case 7:V={classScore:1,label:0},M.label=8;case 8:W=V,j=W.classScore,$=W.label,y.push(Ct({box:new Ju(P,D,P+R,D+N),score:C,classScore:C*j,label:$},z)),M.label=9;case 9:return b++,[3,5];case 10:return w++,[3,4];case 11:return x++,[3,3];case 12:return d.dispose(),p.dispose(),m.dispose(),[2,y]}})})},t.prototype.extractPredictedClass=function(n,r){return oe(this,void 0,void 0,function(){var o,i,a,s;return ie(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,n.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[o][i][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(vr),MN=function(e){ce(t,e);function t(n){n===void 0&&(n=!0);var r=this,o=Object.assign({},{withSeparableConvs:n,iouThreshold:EN,classes:["face"]},n?{anchors:SN,meanRgb:NN}:{anchors:kN,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return oe(this,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?IN:RN},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(e1),t1=function(e){ce(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(od),Wa=function(){function e(){}return e.prototype.then=function(t){return oe(this,void 0,void 0,function(){var n;return ie(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return oe(this,void 0,void 0,function(){return ie(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function nl(e,t,n,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),oe(this,void 0,void 0,function(){var i,a,s,u,l;return ie(this,function(c){switch(c.label){case 0:return i=e.map(function(h){return VS(h)?o(h):h.detection}),s=r,s?[3,5]:t instanceof ze?[4,Yf(t,i)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,Qf(t,i)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,n(a)];case 6:return l=c.sent(),a.forEach(function(h){return h instanceof ze&&h.dispose()}),[2,l]}})})}function id(e,t,n,r,o){return oe(this,void 0,void 0,function(){var i=this;return ie(this,function(a){return[2,nl([e],t,function(s){return oe(i,void 0,void 0,function(){return ie(this,function(u){return[2,n(s[0])]})})},r,o)]})})}function ON(e){return Y(function(){return Zt(nt(e,3).reverse(),3)})}var gs=2,Eu=12;function BN(e,t){var n=el(e,t),r=Jf(e,t);function o(l,c){var h=Ye(e(l));return t.push({paramPath:c}),h}function i(l,c,h){h===void 0&&(h=!1);var f=n(l[0],l[1],3,c+"/conv1"),d=o(l[1],c+"/prelu1_alpha"),p=n(l[1],l[2],3,c+"/conv2"),m=o(l[2],c+"/prelu2_alpha"),y=n(l[2],l[3],h?2:3,c+"/conv3"),v=o(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:p,prelu2_alpha:m,conv3:y,prelu3_alpha:v}}function a(){var l=i([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),h=n(32,4,1,"pnet/conv4_2");return Ct(Ct({},l),{conv4_1:c,conv4_2:h})}function s(){var l=i([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),d=r(128,4,"rnet/fc2_2");return Ct(Ct({},l),{fc1:c,prelu4_alpha:h,fc2_1:f,fc2_2:d})}function u(){var l=i([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),h=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),d=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return Ct(Ct({},l),{conv4:c,prelu4_alpha:h,fc1:f,prelu5_alpha:d,fc2_1:p,fc2_2:m,fc2_3:y})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function LN(e){var t=gr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=BN(n,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,l=a(),c=s(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:o}}function jN(e,t){var n=Yr(e,t);function r(c){var h=n(c+"/weights",4,c+"/filters"),f=n(c+"/bias",1);return{filters:h,bias:f}}function o(c){var h=n(c+"/weights",2),f=n(c+"/bias",1);return{weights:h,bias:f}}function i(c){return n(c,1)}function a(c){var h=r(c+"/conv1"),f=i(c+"/prelu1_alpha"),d=r(c+"/conv2"),p=i(c+"/prelu2_alpha"),m=r(c+"/conv3"),y=i(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:d,prelu2_alpha:p,conv3:m,prelu3_alpha:y}}function s(){var c=a("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Ct(Ct({},c),{conv4_1:h,conv4_2:f})}function u(){var c=a("rnet"),h=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),d=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Ct(Ct({},c),{fc1:h,prelu4_alpha:f,fc2_1:d,fc2_2:p})}function l(){var c=a("onet"),h=r("onet/conv4"),f=i("onet/prelu4_alpha"),d=o("onet/fc1"),p=i("onet/prelu5_alpha"),m=o("onet/fc2_1"),y=o("onet/fc2_2"),v=o("onet/fc2_3");return Ct(Ct({},c),{conv4:h,prelu4_alpha:f,fc1:d,prelu5_alpha:p,fc2_1:m,fc2_2:y,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function WN(e){var t=[],n=jN(e,t),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),u=i();return mr(e,t),{params:{pnet:a,rnet:s,onet:u},paramMappings:t}}function yh(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function zN(e,t,n){for(var r=n[0],o=n[1],i=Eu/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(t,u)),s=s*t,u+=1;return a}var ad=function(e){ce(t,e);function t(n,r,o,i){return e.call(this,{left:n,top:r,right:o,bottom:i},!0)||this}return t}(Hr);function n1(e){return Y(function(){return kt(ot(e,K(127.5)),K(.0078125))})}function ui(e,t){return Y(function(){return ge(Ue(e),kt(t,gu(Ue(gu(e)))))})}function sd(e,t,n){return n===void 0&&(n=!1),Y(function(){var r=Nn(e,t.conv1,"valid");return r=ui(r,t.prelu1_alpha),r=at(r,n?[2,2]:[3,3],[2,2],"same"),r=Nn(r,t.conv2,"valid"),r=ui(r,t.prelu2_alpha),r=n?r:at(r,[3,3],[2,2],"valid"),r=Nn(r,t.conv3,"valid"),r=ui(r,t.prelu3_alpha),r})}function UN(e,t){return Y(function(){var n=sd(e,t,!0),r=Nn(n,t.conv4_1,"valid"),o=ln(Xu(r,3),3),i=dr(ot(r,o),3),a=Nn(n,t.conv4_2,"valid");return{prob:i,regions:a}})}function VN(e,t){return Y(function(){var n=yh(t,e.shape.slice(1)),r=n.height,o=n.width,i=Lf.resizeBilinear(e,[r,o]),a=n1(i);return $r(a,[0,2,1,3])})}function $N(e,t,n,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new Se(s,a));var u=o.map(function(l){var c=new Ju(Math.round((l.y*gs+1)/n),Math.round((l.x*gs+1)/n),Math.round((l.y*gs+Eu)/n),Math.round((l.x*gs+Eu)/n)),h=i[l.y][l.x],f=t.arraySync(),d=new ad(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:h,region:d}});return u}function HN(e,t,n,r,o){o.stage1=[];var i=t.map(function(f){return Y(function(){var d={scale:f},p=VN(e,f),m=Date.now(),y=UN(p,r),v=y.prob,g=y.regions;d.pnet=Date.now()-m;var x=nt(nt(v,3)[1])[0],w=nt(g)[0];return{scoresTensor:x,regionsTensor:w,scale:f,statsForScale:d}})}),a=i.map(function(f){var d=f.scoresTensor,p=f.regionsTensor,m=f.scale,y=f.statsForScale,v=$N(d,p,m,n);if(d.dispose(),p.dispose(),!v.length)return o.stage1.push(y),[];var g=Date.now(),x=ka(v.map(function(w){return w.cell}),v.map(function(w){return w.score}),.5);return y.nms=Date.now()-g,y.numBoxes=x.length,o.stage1.push(y),x.map(function(w){return v[w]})}),s=a.reduce(function(f,d){return f.concat(d)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=ka(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-c,l=h.map(function(f){return s[f].score}),u=h.map(function(f){return s[f]}).map(function(f){var d=f.cell,p=f.region;return new Ju(d.left+p.left*d.width,d.top+p.top*d.height,d.right+p.right*d.width,d.bottom+p.bottom*d.height).toSquare().round()})}return{boxes:u,scores:l}}function r1(e,t,n){var r=n.width,o=n.height;return oe(this,void 0,void 0,function(){var i,a,s,u=this;return ie(this,function(l){switch(l.label){case 0:return i=xo(e),[4,Promise.all(t.map(function(c){return oe(u,void 0,void 0,function(){var h,f,d,p,m,y,v,g;return ie(this,function(x){return h=c.padAtBorders(e.height,e.width),f=h.y,d=h.ey,p=h.x,m=h.ex,y=p-1,v=f-1,g=i.getImageData(y,v,m-y,d-v),[2,Nt.isNodejs()?Kf(g):createImageBitmap(g)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var h=Zu({width:r,height:o}),f=xo(h);f.drawImage(c,0,0,r,o);for(var d=f.getImageData(0,0,r,o).data,p=[],m=0;m<d.length;m+=4)p.push(d[m+2]),p.push(d[m+1]),p.push(d[m]);s.push(p)}),[2,s.map(function(c){var h=Y(function(){var f=$r(Mt(c,[1,r,o,3]),[0,2,1,3]).toFloat();return n1(f)});return h})]}})})}function GN(e,t){return Y(function(){var n=sd(e,t),r=En(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Wn(r,t.fc1),i=ui(o,t.prelu4_alpha),a=Wn(i,t.fc2_1),s=ln(Xu(a,1),1),u=dr(ot(a,s),1),l=Wn(i,t.fc2_2),c=nt(u,1)[1];return{scores:c,regions:l}})}function qN(e,t,n,r,o){return oe(this,void 0,void 0,function(){var i,a,s,u,l,c,h,f,d,p,m,y,v,g;return ie(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,r1(e,t,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var b=GN(w,r);return w.dispose(),b}),o.stage2_rnet=Date.now()-i,u=s.length>1?tt(s.map(function(w){return w.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[x.sent()]),u.dispose(),f=l.map(function(w,b){return{score:w,idx:b}}).filter(function(w){return w.score>n}).map(function(w){var b=w.idx;return b}),d=f.map(function(w){return t[w]}),p=f.map(function(w){return l[w]}),m=[],y=[],d.length>0&&(i=Date.now(),v=ka(d,p,.7),o.stage2_nms=Date.now()-i,g=v.map(function(w){var b=s[f[w]].regions.arraySync();return new ad(b[0][0],b[0][1],b[0][2],b[0][3])}),y=v.map(function(w){return p[w]}),m=v.map(function(w,b){return d[w].calibrate(g[b])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:m,scores:y}]}})})}function XN(e,t){return Y(function(){var n=sd(e,t);n=at(n,[2,2],[2,2],"same"),n=Nn(n,t.conv4,"valid"),n=ui(n,t.prelu4_alpha);var r=En(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Wn(r,t.fc1),i=ui(o,t.prelu5_alpha),a=Wn(i,t.fc2_1),s=ln(Xu(a,1),1),u=dr(ot(a,s),1),l=Wn(i,t.fc2_2),c=Wn(i,t.fc2_3),h=nt(u,1)[1];return{scores:h,regions:l,points:c}})}function KN(e,t,n,r,o){return oe(this,void 0,void 0,function(){var i,a,s,u,l,c,h,f,d,p,m,y,v,g,x;return ie(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,r1(e,t,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(b){var C=XN(b,r);return b.dispose(),C}),o.stage3_onet=Date.now()-i,u=s.length>1?tt(s.map(function(b){return b.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[w.sent()]),u.dispose(),f=l.map(function(b,C){return{score:b,idx:C}}).filter(function(b){return b.score>n}).map(function(b){var C=b.idx;return C}),d=f.map(function(b){var C=s[b].regions.arraySync();return new ad(C[0][0],C[0][1],C[0][2],C[0][3])}),p=f.map(function(b,C){return t[b].calibrate(d[C])}),m=f.map(function(b){return l[b]}),y=[],v=[],g=[],p.length>0&&(i=Date.now(),x=ka(p,m,.7,!1),o.stage3_nms=Date.now()-i,y=x.map(function(b){return p[b]}),v=x.map(function(b){return m[b]}),g=x.map(function(b,C){return Array(5).fill(0).map(function(S,E){var R=s[b].points.arraySync();return new Se(R[0][E]*(y[C].width+1)+y[C].left,R[0][E+5]*(y[C].height+1)+y[C].top)})})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose(),b.points.dispose()}),[2,{boxes:y,scores:v,points:g}]}})})}var QN=function(e){ce(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),oe(this,void 0,void 0,function(){var o,i,a,s,u,l,c,h,f,d,p,m,y,v,g,x,w,b,C,S,E;return ie(this,function(R){switch(R.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=n.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Y(function(){return ON(ln($f.fromPixels(i)).toFloat())}),l=function(N){return u.dispose(),a.total=Date.now()-s,N},c=u.shape.slice(1),h=c[0],f=c[1],d=new Jy(r),p=d.minFaceSize,m=d.scaleFactor,y=d.maxNumScales,v=d.scoreThresholds,g=d.scaleSteps,x=(g||zN(p,m,[h,f])).filter(function(N){var P=yh(N,[h,f]);return Math.min(P.width,P.height)>Eu}).slice(0,y),a.scales=x,a.pyramid=x.map(function(N){return yh(N,[h,f])}),w=Date.now(),[4,HN(u,x,v[0],o.pnet,a)];case 1:return b=R.sent(),a.total_stage1=Date.now()-w,b.boxes.length?(a.stage2_numInputBoxes=b.boxes.length,w=Date.now(),[4,qN(i,b.boxes,v[1],o.rnet,a)]):[2,l({results:[],stats:a})];case 2:return C=R.sent(),a.total_stage2=Date.now()-w,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,w=Date.now(),[4,KN(i,C.boxes,v[2],o.onet,a)]):[2,l({results:[],stats:a})];case 3:return S=R.sent(),a.total_stage3=Date.now()-w,E=S.boxes.map(function(N,P){return td(qf({},new Qn(S.scores[P],new Gf(N.left/f,N.top/h,N.width/f,N.height/h),{height:h,width:f})),new SS(S.points[P].map(function(D){return D.sub(new Se(N.left,N.top)).div(new Se(N.width,N.height))}),{width:N.width,height:N.height}))}),[2,l({results:E,stats:a})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),oe(this,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,ct(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),oe(this,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,ct(n)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return WN(n)},t.prototype.extractParams=function(n){return LN(n)},t}(vr),YN=.4,JN=[new Se(1.603231,2.094468),new Se(6.041143,7.080126),new Se(2.882459,3.518061),new Se(4.266906,5.178857),new Se(9.041765,10.66308)],ZN=[117.001,114.697,97.404],eR=function(e){ce(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:YN,classes:["face"],anchors:JN,meanRgb:ZN,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return oe(this,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(e1),Tt={ssdMobilenetv1:new Zy,tinyFaceDetector:new eR,tinyYolov2:new MN,mtcnn:new QN,faceLandmark68Net:new Gy,faceLandmark68TinyNet:new nN,faceRecognitionNet:new lN,faceExpressionNet:new US,ageGenderNet:new JS},o1=function(e){ce(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(Wa),ud=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,nl(n,this.input,function(a){return oe(o,void 0,void 0,function(){return ie(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Tt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){return Vy(a,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new fd(this,this.input)},t}(o1),ld=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,id(n,this.input,function(i){return Tt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,Vy(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new dd(this,this.input)},t}(o1),cd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new pd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new md(this,this.input)},t}(ud),hd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new vd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new gd(this,this.input)},t}(ld),i1=function(e){ce(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(Wa),fd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,nl(n,this.input,function(a){return oe(o,void 0,void 0,function(){return ie(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Tt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){var u=r[s],l=u.age,c=u.gender,h=u.genderProbability;return Qy(Yy(a,c,h),l)})]}})})},t.prototype.withFaceExpressions=function(){return new ud(this,this.input)},t}(i1),dd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o,i,a;return ie(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?[4,id(n,this.input,function(u){return Tt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,Qy(Yy(n,i,a),o)]}})})},t.prototype.withFaceExpressions=function(){return new ld(this,this.input)},t}(i1),pd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new cd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new md(this,this.input)},t}(fd),vd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new hd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new gd(this,this.input)},t}(dd),a1=function(e){ce(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(Wa),md=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,nl(n,this.input,function(i){return Promise.all(i.map(function(a){return Tt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return Ky(n[a],i)})]}})})},t.prototype.withFaceExpressions=function(){return new cd(this,this.input)},t.prototype.withAgeAndGender=function(){return new pd(this,this.input)},t}(a1),gd=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,id(n,this.input,function(i){return Tt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,Ky(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new hd(this,this.input)},t.prototype.withAgeAndGender=function(){return new vd(this,this.input)},t}(a1),s1=function(e){ce(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Tt.faceLandmark68TinyNet:Tt.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Wa),tR=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return ie(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof ze?[4,Yf(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Qf(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),o.forEach(function(l){return l instanceof ze&&l.dispose()}),[2,n.map(function(l,c){return td(l,a[c])})]}})})},t.prototype.withFaceExpressions=function(){return new cd(this,this.input)},t.prototype.withAgeAndGender=function(){return new pd(this,this.input)},t.prototype.withFaceDescriptors=function(){return new md(this,this.input)},t}(s1),nR=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o,i,a;return ie(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?(r=n.detection,this.input instanceof ze?[4,Yf(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Qf(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof ze&&u.dispose()}),[2,td(n,a)]}})})},t.prototype.withFaceExpressions=function(){return new hd(this,this.input)},t.prototype.withAgeAndGender=function(){return new vd(this,this.input)},t.prototype.withFaceDescriptor=function(){return new gd(this,this.input)},t}(s1),u1=function(e){ce(t,e);function t(n,r){r===void 0&&(r=new tl);var o=e.call(this)||this;return o.input=n,o.options=r,o}return t}(Wa),rR=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r,o,i;return ie(this,function(a){switch(a.label){case 0:return n=this,r=n.input,o=n.options,o instanceof Jy?[4,Tt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof t1?function(s){return Tt.tinyFaceDetector.locateFaces(s,o)}:o instanceof tl?function(s){return Tt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof od?function(s){return Tt.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return oe(n,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return qf({},a)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new tR(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new ud(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new fd(this.runAndExtendWithFaceDetections(),this.input)},t}(u1),oR=function(e){ce(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return[4,new rR(this.input,this.options)];case 1:return n=o.sent(),r=n[0],n.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return oe(n,void 0,void 0,function(){var o;return ie(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?qf({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new nR(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new ld(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new dd(this.runAndExtendWithFaceDetection(),this.input)},t}(u1);function iR(e,t){return t===void 0&&(t=new tl),new oR(e,t)}function aR(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof ds)return a;if(a instanceof Float32Array)return new ds(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new ds(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return aR(r,t)}).reduce(function(r,o){return r+o},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new Cv(i,n.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new Cv("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return ds.fromJSON(r)});return new e(n,t.distanceThreshold)},e})();const sR=[{userID:1,fullName:"Chng Nguyn",email:"chuongnn12.work@gmail.com",passwordHash:"hash-demo",phoneNumber:"0915539311",createdAt:"2023-05-12T08:12:00Z",isActive:!0,avatarUrl:"https://i.pravatar.cc/150?img=15"},{userID:2,fullName:"Lan Nguyn",email:"lan.nguyen@pos.local",passwordHash:"hash-demo",phoneNumber:"0978 111 222",createdAt:"2022-11-02T10:30:00Z",isActive:!0,avatarUrl:"https://i.pravatar.cc/150?img=32"}],ji=[{id:"loc-101",zone:"A",aisle_number:1,shelf_number:2,position:"Gn ca ra vo"},{id:"loc-102",zone:"B",aisle_number:2,shelf_number:3,position:"Gia ca hng"},{id:"loc-103",zone:"C",aisle_number:4,shelf_number:1,position:"Khu  ung"},{id:"loc-104",zone:"D",aisle_number:3,shelf_number:2,position:"Khu  n nhanh"}],l1=[{id:"prod-001",name:"C ph latte",barcode:"CF001",price:45e3,stock:25,location_id:"loc-103",image_url:"https://images.pexels.com/photos/296888/pexels-photo-296888.jpeg?auto=compress&cs=tinysrgb&w=400",category:"Cafe",location:ji[2]},{id:"prod-002",name:"Tr sa trn chu",barcode:"TS001",price:55e3,stock:30,location_id:"loc-103",image_url:"https://images.pexels.com/photos/3737694/pexels-photo-3737694.jpeg?auto=compress&cs=tinysrgb&w=400",category:"Tr sa",location:ji[2]},{id:"prod-003",name:"Sandwich g nng",barcode:"SW001",price:6e4,stock:12,location_id:"loc-104",image_url:"https://images.pexels.com/photos/1600711/pexels-photo-1600711.jpeg?auto=compress&cs=tinysrgb&w=400",category:" n nhanh",location:ji[3]},{id:"prod-004",name:"Bnh croissant b",barcode:"BK001",price:35e3,stock:18,location_id:"loc-101",image_url:"https://images.pexels.com/photos/2135/food-salad-healthy-vegetables.jpg?auto=compress&cs=tinysrgb&w=400",category:"Bnh",location:ji[0]},{id:"prod-005",name:"Sinh t xoi",barcode:"SM001",price:49e3,stock:20,location_id:"loc-102",image_url:"https://images.pexels.com/photos/775032/pexels-photo-775032.jpeg?auto=compress&cs=tinysrgb&w=400",category:"Sinh t",location:ji[1]}],uR=()=>l1.map(e=>({...e,location:e.location?{...e.location}:void 0})),lR=[{id:"hist-001",userID:1,orderNumber:"POS23091201",items:4,totalAmount:182e3,method:"pickup",status:"completed",createdAt:"2024-02-12T09:45:00Z"},{id:"hist-002",userID:1,orderNumber:"POS23082102",items:2,totalAmount:92e3,method:"delivery",status:"shipping",createdAt:"2024-01-03T14:10:00Z"},{id:"hist-003",userID:2,orderNumber:"POS23070105",items:5,totalAmount:25e4,method:"pickup",status:"completed",createdAt:"2023-12-21T08:30:00Z"}],cR=e=>e===0?[]:lR.filter(t=>t.userID===e);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var hR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fR=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),gt=(e,t)=>{const n=fe.forwardRef(({color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:s="",children:u,...l},c)=>fe.createElement("svg",{ref:c,...hR,width:o,height:o,stroke:r,strokeWidth:a?Number(i)*24/Number(o):i,className:["lucide",`lucide-${fR(e)}`,s].join(" "),...l},[...t.map(([h,f])=>fe.createElement(h,f)),...Array.isArray(u)?u:[u]]));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dR=gt("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=gt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pR=gt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vR=gt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rv=gt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mR=gt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gR=gt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yR=gt("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xR=gt("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wR=gt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iv=gt("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bR=gt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=gt("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tv=gt("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CR=gt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _R=gt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ER=gt("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);function kR({onLogin:e}){const t=fe.useRef(null),n=fe.useRef(null),[r,o]=fe.useState(!0),[i,a]=fe.useState(!1),[s,u]=fe.useState("ang khi to camera..."),[l,c]=fe.useState(!1);fe.useEffect(()=>{h()},[]);const h=async()=>{try{u("ang ti m hnh nhn din...");const w="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/";await Promise.all([Tt.tinyFaceDetector.loadFromUri(w),Tt.faceLandmark68Net.loadFromUri(w),Tt.faceRecognitionNet.loadFromUri(w)]),c(!0),u(" sn sng. Nhn  qut khun mt"),o(!1)}catch(w){console.error("Error loading models:",w),u("Li ti m hnh. Vui lng th li."),o(!1)}},f=async()=>{try{a(!0),u("ang m camera...");const w=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});t.current&&(t.current.srcObject=w,t.current.play(),u("Hy nhn vo camera..."),setTimeout(()=>{d()},1e3))}catch(w){console.error("Error accessing camera:",w),u("Khng th truy cp camera. Vui lng kim tra quyn truy cp."),a(!1)}},d=async()=>{if(!(!t.current||!l))try{u("ang nhn din khun mt..."),await iR(t.current,new t1).withFaceLandmarks().withFaceDescriptor()?(u(" pht hin khun mt. ang so khp..."),await p()):(u("Khng pht hin khun mt. Th li..."),setTimeout(d,2e3))}catch(w){console.error("Error detecting face:",w),u("Li nhn din. Vui lng th li."),m()}},p=async()=>{const w=sR[0];if(!w){u("Khng c d liu ngi dng demo."),m();return}u(`Xin cho ${w.fullName}! ang ti h s...`),setTimeout(()=>{m(),e(w)},1200)},m=()=>{t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(b=>b.stop()),t.current.srcObject=null),a(!1)},y=[{label:"Camera",value:i?"ang hot ng":"Cha bt",icon:_.jsx(ys,{className:"w-4 h-4"})},{label:"M hnh",value:l?" ti":"ang ti",icon:l?_.jsx(rc,{className:"w-4 h-4"}):_.jsx(Rv,{className:"w-4 h-4 animate-spin"})},{label:"nh sng",value:"n nh",icon:_.jsx(CR,{className:"w-4 h-4"})}],v=["Gi khun mt trong khung mu xanh","Nhn thng v gi khong cch 40-50cm","m bo  nh sng v khng eo khu trang"],g={userID:0,fullName:"Guest",email:"guest@megapos.app",passwordHash:"guest",phoneNumber:"",createdAt:new Date().toISOString(),isActive:!0},x=()=>{t.current&&t.current.srcObject&&(t.current.srcObject.getTracks().forEach(b=>b.stop()),t.current.srcObject=null),a(!1),e(g)};return _.jsxs("div",{className:"min-h-screen bg-slate-950 relative overflow-hidden flex items-center justify-center p-4",children:[_.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(59,130,246,.35),_transparent_65%)]"}),_.jsx("div",{className:"absolute -bottom-32 inset-x-0 h-72 bg-gradient-to-t from-sky-500/20 blur-3xl"}),_.jsxs("button",{type:"button",onClick:x,className:"absolute top-6 right-6 z-50 bg-white/90 backdrop-blur px-5 py-2 rounded-full text-sm font-semibold text-slate-700 shadow-lg hover:bg-white transition-colors flex items-center gap-2 border border-slate-200",children:[_.jsx(Iv,{className:"w-4 h-4"}),"Mua hng nhanh"]}),_.jsxs("div",{className:"relative max-w-5xl w-full grid md:grid-cols-5 gap-6",children:[_.jsxs("section",{className:"md:col-span-3 bg-slate-900/70 border border-slate-800 rounded-3xl p-6 shadow-[0_25px_60px_rgba(15,23,42,.35)] backdrop-blur",children:[_.jsxs("header",{className:"flex items-center justify-between mb-4 text-white",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-slate-400",children:"Trm ng nhp"}),_.jsx("h1",{className:"text-2xl font-semibold",children:"Qut khun mt"})]}),_.jsx("span",{className:"text-xs px-3 py-1 rounded-full bg-slate-800 text-slate-200 border border-slate-700",children:"MegaPOS  Bo mt a lp"})]}),_.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4",children:y.map(w=>_.jsxs("div",{className:"bg-slate-800/60 rounded-2xl px-3 py-2 text-slate-200 flex items-center gap-2",children:[_.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center text-sky-300",children:w.icon}),_.jsxs("div",{children:[_.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:w.label}),_.jsx("p",{className:"text-sm font-semibold",children:w.value})]})]},w.label))}),_.jsxs("div",{className:"relative rounded-3xl overflow-hidden border border-slate-800 mb-4",style:{aspectRatio:"4/3"},children:[_.jsx("video",{ref:t,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0}),_.jsx("canvas",{ref:n,className:"absolute inset-0 w-full h-full"}),_.jsx("div",{className:"absolute inset-8 border-2 border-emerald-400/70 rounded-3xl pointer-events-none"}),!i&&_.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/70 backdrop-blur",children:_.jsxs("div",{className:"text-center text-white space-y-3",children:[_.jsx(ys,{className:"w-14 h-14 mx-auto opacity-70"}),_.jsx("p",{className:"text-lg font-semibold",children:"Camera ang ch kch hot"}),_.jsx("p",{className:"text-sm text-slate-300",children:"Nhn Bt u qut  kch hot camera v tin hnh nhn din"})]})})]}),_.jsxs("div",{className:"flex flex-col gap-4 bg-slate-800/60 rounded-2xl px-4 py-4 text-slate-200",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[r?_.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-900 flex items-center justify-center",children:_.jsx(Rv,{className:"w-5 h-5 animate-spin"})}):_.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 border border-emerald-400 flex items-center justify-center text-emerald-300",children:_.jsx(rc,{className:"w-5 h-5"})}),_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-slate-400",children:"Trng thi"}),_.jsx("p",{className:"font-medium",children:s})]})]}),_.jsxs("div",{className:"flex flex-wrap gap-3",children:[!i&&!r&&_.jsxs("button",{onClick:f,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-sky-500 to-blue-600 text-white font-semibold flex items-center gap-2 shadow-lg shadow-sky-500/30",children:[_.jsx(ys,{className:"w-4 h-4"}),"Qut khun mt"]}),i&&_.jsxs("button",{onClick:m,className:"px-6 py-3 rounded-2xl bg-red-600 hover:bg-red-700 text-white font-semibold flex items-center gap-2",children:[_.jsx(Iv,{className:"w-4 h-4"}),"Dng qut"]})]})]})]}),_.jsxs("section",{className:"md:col-span-2 bg-white/95 rounded-3xl border border-slate-100 p-6 shadow-lg",children:[_.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[_.jsx("div",{className:"p-3 rounded-2xl bg-blue-100 text-blue-600",children:_.jsx(ys,{className:"w-6 h-6"})}),_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-slate-500",children:"Bo mt nng cao"}),_.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Hng dn nhn din"})]})]}),_.jsx("div",{className:"space-y-4 mb-6",children:v.map((w,b)=>_.jsxs("div",{className:"flex items-start gap-4 p-4 border border-slate-200 rounded-2xl",children:[_.jsx("span",{className:"w-8 h-8 rounded-full bg-slate-100 text-slate-700 font-semibold flex items-center justify-center",children:b+1}),_.jsx("p",{className:"text-slate-700",children:w})]},w))}),_.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4 border border-slate-200 text-sm text-slate-600 flex items-start gap-3",children:[_.jsx(rc,{className:"w-5 h-5 text-emerald-500 mt-0.5"}),_.jsx("p",{children:"D liu nhn din c m ho hon ton v ch dng  ng nhp vo h thng POS. Sau khi xc thc thnh cng, camera s t ng tt."})]})]})]})]})}const xh=[{city:"TP. H Ch Minh",districts:[{name:"Thnh ph Th c",wards:["An Khnh","An Li ng","An Ph","Bnh Chiu","Bnh Th","Bnh Trng ng","Bnh Trng Ty","Ct Li","Hip Bnh Chnh","Hip Bnh Phc","Hip Ph","Linh Chiu","Linh ng","Linh Ty","Linh Trung","Linh Xun","Long Bnh","Long Phc","Long Thnh M","Long Trng","Ph Hu","Phc Bnh","Phc Long A","Phc Long B","Tng Nhn Ph A","Tng Nhn Ph B","Tam Bnh","Tam Ph","Thnh M Li","Tho in","Th Thim","Trng Thnh","Trng Th"]},{name:"Qun 1",wards:["Phng Bn Ngh","Phng Bn Thnh","Phng Cu Kho","Phng Cu ng Lnh","Phng C Giang","Phng a Kao","Phng Nguyn C Trinh","Phng Nguyn Thi Bnh","Phng Phm Ng Lo","Phng Tn nh"]},{name:"Qun 3",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14"]},{name:"Qun 4",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 8","Phng 9","Phng 10","Phng 12","Phng 13","Phng 14","Phng 15","Phng 16","Phng 18"]},{name:"Qun 5",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15"]},{name:"Qun 6",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14"]},{name:"Qun 7",wards:["Phng Bnh Thun","Phng Ph M","Phng Ph Thun","Phng Tn Hng","Phng Tn King","Phng Tn Phong","Phng Tn Ph","Phng Tn Quy","Phng Tn Thun ng","Phng Tn Thun Ty"]},{name:"Qun 10",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15"]},{name:"Qun 11",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15","Phng 16"]},{name:"Qun 12",wards:["Phng An Ph ng","Phng ng Hng Thun","Phng Hip Thnh","Phng Tn Chnh Hip","Phng Tn Hng Thun","Phng Tn Thi Hip","Phng Tn Thi Nht","Phng Thnh Lc","Phng Thnh Xun","Phng Thi An","Phng Trung M Ty"]},{name:"Qun Bnh Thnh",wards:["Phng 1","Phng 2","Phng 3","Phng 5","Phng 6","Phng 7","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15","Phng 17","Phng 19","Phng 21","Phng 22","Phng 24","Phng 25","Phng 26","Phng 27","Phng 28"]},{name:"Qun Bnh Tn",wards:["Phng An Lc","Phng An Lc A","Phng Bnh Hng Ha","Phng Bnh Hng Ha A","Phng Bnh Hng Ha B","Phng Bnh Tr ng","Phng Bnh Tr ng A","Phng Bnh Tr ng B","Phng Tn To","Phng Tn To A"]},{name:"Qun G Vp",wards:["Phng 1","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15","Phng 16","Phng 17"]},{name:"Qun Ph Nhun",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 13","Phng 15","Phng 17"]},{name:"Qun Tn Bnh",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15"]},{name:"Qun Tn Ph",wards:["Phng Hip Tn","Phng Ha Thnh","Phng Ph Thnh","Phng Ph Th Ha","Phng Ph Trung","Phng Sn K","Phng Tn Qu","Phng Tn Sn Nh","Phng Tn Thnh","Phng Tn Thi Ha","Phng Ty Thnh"]},{name:"Qun 8",wards:["Phng 1","Phng 2","Phng 3","Phng 4","Phng 5","Phng 6","Phng 7","Phng 8","Phng 9","Phng 10","Phng 11","Phng 12","Phng 13","Phng 14","Phng 15","Phng 16"]},{name:"Huyn Bnh Chnh",wards:["Th trn Tn Tc","X An Ph Ty","X Bnh Chnh","X Bnh Hng","X Bnh Li","X a Phc","X Hng Long","X L Minh Xun","X Phm Vn Hai","X Phong Ph","X Quy c","X Tn Kin","X Tn Nht","X Tn Qu Ty","X Vnh Lc A","X Vnh Lc B"]},{name:"Huyn Cn Gi",wards:["Th trn Cn Thnh","X An Thi ng","X Bnh Khnh","X Long Ha","X L Nhn","X Tam Thn Hip","X Thnh An"]},{name:"Huyn C Chi",wards:["Th trn C Chi","X An Nhn Ty","X An Ph","X Bnh M","X Ha Ph","X Nhun c","X Phm Vn Ci","X Ph Ha ng","X Ph M Hng","X Phc Hip","X Phc Thnh","X Phc Vnh An","X Tn An Hi","X Tn Ph Trung","X Tn Thnh ng","X Tn Thnh Ty","X Tn Thng Hi","X Thi M","X Trung An","X Trung Lp H","X Trung Lp Thng"]},{name:"Huyn Hc Mn",wards:["Th trn Hc Mn","X B im","X ng Thnh","X Nh Bnh","X Tn Hip","X Tn Thi Nh","X Tn Xun","X Thi Tam Thn","X Trung Chnh","X Xun Thi ng","X Xun Thi Sn","X Xun Thi Thng"]},{name:"Huyn Nh B",wards:["Th trn Ph Xun","X Hip Phc","X Long Thi","X Nhn c","X Phc Kin","X Phc Lc"]}]}];var Dv;const SR=((Dv=xh[0])==null?void 0:Dv.city)??"",Pv=()=>({fullName:"",phone:"",address:"",email:"",city:SR,district:"",ward:""});function NR({user:e,onLogout:t}){const[n,r]=fe.useState(()=>uR()),[o,i]=fe.useState([]),[a,s]=fe.useState([]),[u,l]=fe.useState(""),[c,h]=fe.useState("all"),[f]=fe.useState(()=>[...new Set(l1.map(Q=>Q.category))]),[d,p]=fe.useState(null),[m,y]=fe.useState(!1),[v,g]=fe.useState(!1),[x,w]=fe.useState(!1),[b,C]=fe.useState(!1),[S,E]=fe.useState(!1),[R,N]=fe.useState("pickup"),[P,D]=fe.useState(()=>Pv()),[z,W]=fe.useState({}),[j,$]=fe.useState(1),V=3,[F,M]=fe.useState(0),[B,G]=fe.useState(0),X=fe.useMemo(()=>cR(e.userID),[e.userID]),[ne,ae]=fe.useState(!1),[se,ue]=fe.useState(null),[de,ve]=fe.useState([]),[be,De]=fe.useState(!1),[ye,Ee]=fe.useState("scan"),me=Math.max(1,Math.ceil(a.length/V)),Le=fe.useMemo(()=>a.slice((j-1)*V,j*V),[a,j,V]),Ae=fe.useMemo(()=>e.fullName.split(" ").slice(-2).map(Q=>Q[0]).join("").toUpperCase(),[e.fullName]),Ie=fe.useRef(null);fe.useEffect(()=>{if(!S)return;const Q=ke=>{Ie.current&&!Ie.current.contains(ke.target)&&E(!1)};return document.addEventListener("mousedown",Q),()=>document.removeEventListener("mousedown",Q)},[S]),fe.useEffect(()=>{rn()},[n,u,c]),fe.useEffect(()=>{j>me&&$(me)},[j,me]);const rn=()=>{let Q=n;u&&(Q=Q.filter(ke=>ke.name.toLowerCase().includes(u.toLowerCase())||ke.barcode.includes(u))),c!=="all"&&(Q=Q.filter(ke=>ke.category===c)),i(Q)},on=Q=>{const ke=a.find(Fe=>Fe.product.id===Q.id);ke?ke.quantity<Q.stock&&s(a.map(Fe=>Fe.product.id===Q.id?{...Fe,quantity:Fe.quantity+1}:Fe)):s([...a,{product:Q,quantity:1}]),p(Q),setTimeout(()=>p(null),2e3)},Rt=(Q,ke)=>{s(a.map(Fe=>{if(Fe.product.id===Q){const Pn=Fe.quantity+ke;return Pn<=0||Pn>Fe.product.stock?Fe:{...Fe,quantity:Pn}}return Fe}))},yr=Q=>{s(a.filter(ke=>ke.product.id!==Q))},$t=()=>a.reduce((Q,ke)=>Q+ke.product.price*ke.quantity,0),gn=()=>a.reduce((Q,ke)=>Q+ke.quantity,0),an=(Q,ke,Fe)=>{setTimeout(()=>{r(Pn=>Pn.map(Jn=>{const No=Q.find(Si=>Si.product.id===Jn.id);return No?{...Jn,stock:Math.max(Jn.stock-No.quantity,0)}:Jn})),s([]),y(!1),M(ke),G(Fe),N("pickup"),D(Pv()),W({}),g(!0),ue(null),ve([])},500)},Yn=async Q=>{if(a.length===0||m)return;const ke=a.map(Jn=>({product:{...Jn.product},quantity:Jn.quantity})),Fe=$t(),Pn=gn();if(ue({total:Fe,items:Pn}),ve(ke),y(!0),Q==="transfer"){Ee("scan"),De(!0);return}an(ke,Fe,Pn)},yn=()=>{De(!1),y(!1),ue(null),ve([])},ki=()=>{!se||de.length===0||(Ee("success"),setTimeout(()=>{De(!1),an(de,se.total,se.items)},1200))},xr=()=>{if(R==="delivery"){const Q={};if(P.fullName||(Q.fullName="Vui lng nhp h tn"),P.phone||(Q.phone="Vui lng nhp s in thoi"),P.city||(Q.city="Vui lng chn thnh ph"),P.district||(Q.district="Vui lng chn qun/huyn"),P.ward||(Q.ward="Vui lng chn phng/x"),P.address||(Q.address="Vui lng nhp a ch nh"),P.phone&&!/^\d{10}$/.test(P.phone)&&(Q.phone="S in thoi phi gm ng 10 ch s"),P.email&&!P.email.endsWith("@gmail.com")&&(Q.email="Email giao hng cn c ui @gmail.com"),W(Q),Object.values(Q).some(ke=>ke))return;W({})}g(!1),ae(!0)};return _.jsxs("div",{className:"min-h-screen bg-gray-50",children:[_.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:_.jsx("div",{className:"px-6 py-4",children:_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx(xR,{className:"w-8 h-8 text-blue-600"}),_.jsxs("div",{children:[_.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"MegaPOS"}),_.jsxs("p",{className:"text-sm text-gray-600",children:["Khch hng: ",e.fullName]})]})]}),_.jsxs("div",{className:"relative flex items-center",ref:Ie,children:[_.jsx("button",{type:"button",className:"w-12 h-12 rounded-full bg-blue-100 text-blue-600 font-semibold text-lg flex items-center justify-center hover:opacity-80 transition",onClick:()=>E(Q=>!Q),"aria-label":"M menu ngi dng",children:Ae}),S&&_.jsxs("div",{className:"absolute right-0 top-16 bg-white rounded-xl shadow-2xl border border-gray-200 w-64 z-20",children:[_.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors text-left",onClick:()=>{E(!1),w(!0)},children:[_.jsx(ER,{className:"w-4 h-4 text-blue-600"}),"Thng tin khch hng"]}),_.jsx("div",{className:"border-t border-gray-100"}),_.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors text-left",onClick:()=>{E(!1),C(!0)},children:[_.jsx(vR,{className:"w-4 h-4 text-blue-600"}),"Lch s mua hng"]}),_.jsx("div",{className:"border-t border-gray-100"}),_.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors text-left",onClick:()=>{E(!1),t()},children:[_.jsx(mR,{className:"w-4 h-4"}),"ng xut"]})]})]})]})})}),_.jsx("div",{className:"p-6 space-y-6",children:_.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[_.jsxs("div",{className:"flex-1 bg-white rounded-xl p-6 border border-gray-200 overflow-y-auto",children:[_.jsxs("div",{className:"mb-6",children:[_.jsxs("div",{className:"relative mb-4",children:[_.jsx(bR,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),_.jsx("input",{type:"text",placeholder:"Tm kim sn phm theo tn hoc m vch...",value:u,onChange:Q=>l(Q.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${c==="all"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:"Tt c"}),f.map(Q=>_.jsx("button",{onClick:()=>h(Q),className:`px-4 py-2 rounded-lg font-medium transition-colors ${c===Q?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:Q},Q))]})]}),_.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:o.map(Q=>_.jsx(RR,{product:Q,onAdd:on,isSelected:(d==null?void 0:d.id)===Q.id},Q.id))}),o.length===0&&_.jsx("div",{className:"text-center py-12",children:_.jsx("p",{className:"text-gray-500",children:"Khng tm thy sn phm no"})})]}),_.jsxs("div",{className:"lg:w-[400px] w-full bg-white border border-gray-200 rounded-xl flex flex-col",children:[_.jsx("div",{className:"p-6 border-b border-gray-200",children:_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[_.jsx(Tv,{className:"w-6 h-6"}),"Gi hng"]}),_.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold",children:[gn()," mn"]})]})}),_.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.length===0?_.jsxs("div",{className:"text-center py-12",children:[_.jsx(Tv,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),_.jsx("p",{className:"text-gray-500",children:"Gi hng trng"})]}):_.jsxs("div",{className:"space-y-4",children:[Le.map(Q=>_.jsx(IR,{item:Q,onUpdateQuantity:Rt,onRemove:yr},Q.product.id)),a.length>V&&_.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 text-sm",children:[_.jsx("button",{type:"button",disabled:j===1,onClick:()=>$(Q=>Math.max(Q-1,1)),className:"px-3 py-1 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Trc"}),_.jsxs("span",{className:"text-gray-500",children:["Trang ",j,"/",me]}),_.jsx("button",{type:"button",disabled:j===me,onClick:()=>$(Q=>Math.min(Q+1,me)),className:"px-3 py-1 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Sau"})]})]})}),_.jsxs("div",{className:"border-t border-gray-200 p-6",children:[_.jsxs("div",{className:"mb-4",children:[_.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[_.jsx("span",{children:"Tm tnh:"}),_.jsxs("span",{children:[$t().toLocaleString("vi-VN"),""]})]}),_.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-800",children:[_.jsx("span",{children:"Tng cng:"}),_.jsxs("span",{className:"text-blue-600",children:[$t().toLocaleString("vi-VN"),""]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("button",{onClick:()=>Yn("cash"),disabled:a.length===0||m,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[_.jsx(dR,{className:"w-5 h-5"}),"Thanh ton tin mt"]}),_.jsxs("button",{onClick:()=>Yn("transfer"),disabled:a.length===0||m,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[_.jsx(pR,{className:"w-5 h-5"}),"Thanh ton chuyn khon"]})]})]})]})]})}),v&&_.jsx(OR,{method:R,onMethodChange:N,info:P,onInfoChange:(Q,ke)=>{D(Fe=>({...Fe,[Q]:ke})),W(Fe=>({...Fe,[Q]:""}))},onClose:()=>g(!1),onConfirm:xr,total:F,items:B,errors:z}),x&&_.jsx(PR,{user:e,onClose:()=>w(!1)}),b&&_.jsx(AR,{entries:X,onClose:()=>C(!1)}),be&&se&&_.jsx(FR,{total:se.total,items:se.items,step:ye,onClose:yn,onSuccess:ki}),ne&&_.jsx(MR,{method:R,onClose:()=>ae(!1)})]})}function RR({product:e,onAdd:t,isSelected:n}){return _.jsxs("div",{className:`bg-white rounded-lg border-2 transition-all cursor-pointer hover:shadow-lg ${n?"border-green-500 shadow-lg":"border-gray-200"}`,onClick:()=>t(e),children:[_.jsx("div",{className:"aspect-square bg-gray-100 rounded-t-lg overflow-hidden",children:_.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",onError:r=>{r.target.src="https://images.pexels.com/photos/164005/pexels-photo-164005.jpeg?auto=compress&cs=tinysrgb&w=400"}})}),_.jsxs("div",{className:"p-3",children:[_.jsx("h3",{className:"font-semibold text-gray-800 mb-1 line-clamp-2 text-sm",children:e.name}),_.jsxs("p",{className:"text-lg font-bold text-blue-600 mb-2",children:[e.price.toLocaleString("vi-VN"),""]}),e.location&&_.jsxs("div",{className:"flex items-start gap-1 text-xs text-gray-600 bg-yellow-50 p-2 rounded border border-yellow-200 mb-2",children:[_.jsx(gR,{className:"w-3 h-3 mt-0.5 flex-shrink-0 text-yellow-600"}),_.jsxs("div",{className:"leading-tight",children:[_.jsxs("div",{className:"font-semibold text-yellow-800",children:["Khu ",e.location.zone,"  K ",e.location.aisle_number,"  Ngn"," ",e.location.shelf_number]}),_.jsxs("div",{children:["Gi : ",e.location.position]})]})]}),_.jsxs("div",{className:"flex items-center justify-between text-xs",children:[_.jsxs("span",{className:`px-2 py-1 rounded ${e.stock>10?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Cn: ",e.stock]}),_.jsx("span",{className:"text-gray-500",children:e.category})]})]})]})}function IR({item:e,onUpdateQuantity:t,onRemove:n}){return _.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[_.jsxs("div",{className:"flex gap-3",children:[_.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded overflow-hidden flex-shrink-0",children:_.jsx("img",{src:e.product.image_url,alt:e.product.name,className:"w-full h-full object-cover",onError:r=>{r.target.src="https://images.pexels.com/photos/164005/pexels-photo-164005.jpeg?auto=compress&cs=tinysrgb&w=400"}})}),_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsx("h4",{className:"font-semibold text-gray-800 text-sm mb-1 line-clamp-2",children:e.product.name}),_.jsxs("p",{className:"text-blue-600 font-bold text-sm mb-2",children:[e.product.price.toLocaleString("vi-VN"),""]}),_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:()=>t(e.product.id,-1),className:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors",children:_.jsx(yR,{className:"w-4 h-4"})}),_.jsx("span",{className:"font-semibold text-gray-800 w-8 text-center",children:e.quantity}),_.jsx("button",{onClick:()=>t(e.product.id,1),className:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors",disabled:e.quantity>=e.product.stock,children:_.jsx(wR,{className:"w-4 h-4"})})]}),_.jsx("button",{onClick:()=>n(e.product.id),className:"text-red-600 hover:text-red-700 p-1",children:_.jsx(_R,{className:"w-4 h-4"})})]})]})]}),_.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 flex justify-between items-center",children:[_.jsx("span",{className:"text-sm text-gray-600",children:"Thnh tin:"}),_.jsxs("span",{className:"font-bold text-gray-800",children:[(e.product.price*e.quantity).toLocaleString("vi-VN"),""]})]})]})}function TR({user:e}){const t=[{label:"Email",value:e.email},{label:"S in thoi",value:e.phoneNumber??"Cha cp nht"},{label:"Ngy tham gia",value:new Date(e.createdAt).toLocaleString("vi-VN",{dateStyle:"medium",timeStyle:"short"})},{label:"Trng thi",value:e.isActive?"Hot ng":"Tm kho"}];return _.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 text-blue-600 font-semibold flex items-center justify-center text-2xl uppercase",children:e.fullName.split(" ").slice(-2).map(n=>n[0]).join("")}),_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"H s ngi dng"}),_.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:e.fullName}),_.jsxs("p",{className:"text-sm text-gray-500",children:["M ngi dng: #",e.userID.toString().padStart(4,"0")]})]})]}),_.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(n=>_.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 bg-gray-50 text-sm text-gray-600",children:[_.jsx("p",{className:"font-medium text-gray-500",children:n.label}),_.jsx("p",{className:"text-gray-900",children:n.value})]},n.label))})]})}function PR({user:e,onClose:t}){return _.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full overflow-hidden",children:[_.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"H s khch hng"}),_.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:e.fullName})]}),_.jsx("button",{type:"button",onClick:t,className:"text-gray-500 hover:text-gray-900 text-xl leading-none px-2 py-1","aria-label":"ng h s",children:""})]}),_.jsx("div",{className:"p-6",children:_.jsx(TR,{user:e})})]})})}function DR({entries:e}){return _.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[_.jsxs("div",{className:"flex items-center justify-between mb-4",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"Lch s mua hng"}),_.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"n gn y"})]}),_.jsxs("span",{className:"text-sm text-gray-500",children:["Tng ",e.length," n"]})]}),e.length===0?_.jsx("p",{className:"text-gray-500 text-sm",children:"Cha c n hng no."}):_.jsx("div",{className:"overflow-x-auto",children:_.jsxs("table",{className:"w-full text-left text-sm",children:[_.jsx("thead",{children:_.jsxs("tr",{className:"text-gray-500 border-b",children:[_.jsx("th",{className:"py-2",children:"M n"}),_.jsx("th",{className:"py-2",children:"Thi gian"}),_.jsx("th",{className:"py-2",children:"S mn"}),_.jsx("th",{className:"py-2",children:"Tng tin"}),_.jsx("th",{className:"py-2",children:"Hnh thc"}),_.jsx("th",{className:"py-2",children:"Trng thi"})]})}),_.jsx("tbody",{children:e.map(t=>_.jsxs("tr",{className:"border-b last:border-0",children:[_.jsx("td",{className:"py-3 font-semibold text-gray-800",children:t.orderNumber}),_.jsx("td",{className:"py-3 text-gray-600",children:new Date(t.createdAt).toLocaleString("vi-VN",{dateStyle:"medium",timeStyle:"short"})}),_.jsxs("td",{className:"py-3",children:[t.items," mn"]}),_.jsxs("td",{className:"py-3 font-semibold text-blue-600",children:[t.totalAmount.toLocaleString("vi-VN"),""]}),_.jsx("td",{className:"py-3 capitalize",children:t.method==="pickup"?"Ti quy":"Giao tn ni"}),_.jsx("td",{className:"py-3",children:_.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="shipping"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:t.status==="completed"?"Hon tt":t.status==="shipping"?"ang giao":"ang chun b"})})]},t.id))})]})})]})}function AR({entries:e,onClose:t}){return _.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full overflow-hidden",children:[_.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"Khch hng"}),_.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Lch s mua hng"})]}),_.jsx("button",{type:"button",onClick:t,className:"text-gray-500 hover:text-gray-900 text-xl leading-none px-2 py-1","aria-label":"ng lch s",children:""})]}),_.jsx("div",{className:"p-6",children:_.jsx(DR,{entries:e})})]})})}function FR({total:e,items:t,step:n,onClose:r,onSuccess:o}){return _.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden",children:[_.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"Thanh ton chuyn khon"}),_.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:[t," mn  ",e.toLocaleString("vi-VN"),""]})]}),_.jsx("button",{type:"button",onClick:r,className:"text-gray-500 hover:text-gray-900 text-xl leading-none px-2 py-1","aria-label":"ng thanh ton",disabled:n==="success",children:""})]}),_.jsx("div",{className:"p-6 space-y-6",children:n==="scan"?_.jsxs(_.Fragment,{children:[_.jsxs("div",{className:"text-center space-y-2",children:[_.jsx("p",{className:"text-gray-500 text-sm",children:"Qut m QR bn di  chuyn khon."}),_.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[e.toLocaleString("vi-VN"),""]}),_.jsx("p",{className:"text-sm text-gray-500",children:"Ngi nhn: MegaPOS"})]}),_.jsxs("div",{className:"flex flex-col items-center gap-4",children:[_.jsx("div",{className:"bg-gray-50 p-4 rounded-2xl border border-gray-200",children:_.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=MegaPOS%20${e}`,alt:"M QR thanh ton chuyn khon",className:"w-48 h-48 object-contain"})}),_.jsxs("p",{className:"text-sm text-gray-500",children:["Ni dung chuyn khon: ",_.jsxs("span",{className:"font-semibold text-gray-700",children:["MEGAPOS-",t]})]})]})]}):_.jsxs("div",{className:"text-center py-8 space-y-3",children:[_.jsx("div",{className:"text-5xl",children:""}),_.jsx("p",{className:"text-xl font-semibold text-gray-800",children:"Thanh ton thnh cng!"}),_.jsx("p",{className:"text-gray-500",children:"ang chuyn sang bc chn hnh thc nhn hng..."})]})}),_.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:n==="scan"?_.jsxs(_.Fragment,{children:[_.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors",children:"Hu"}),_.jsx("button",{type:"button",onClick:o,className:"px-5 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors",children:"Xc nhn  chuyn khon"})]}):_.jsx("button",{type:"button",disabled:!0,className:"px-5 py-2 rounded-lg bg-gray-200 text-gray-600 cursor-wait",children:"ang x l..."})})]})})}function MR({onClose:e,method:t}){return _.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:_.jsxs("div",{className:"bg-gradient-to-b from-amber-50 via-white to-white rounded-[32px] shadow-[0_30px_80px_rgba(15,23,42,.35)] max-w-lg w-full text-center relative overflow-hidden border border-amber-100",children:[_.jsx("div",{className:"absolute inset-x-[-20%] top-[-40%] h-64 bg-gradient-to-b from-amber-200/70 to-transparent rotate-6 blur-3xl pointer-events-none"}),_.jsx("button",{type:"button",onClick:e,className:"absolute top-4 right-4 text-amber-500 hover:text-amber-600 text-xl","aria-label":"ng",children:""}),_.jsxs("div",{className:"p-10 space-y-6 relative",children:[_.jsxs("div",{className:"flex flex-col items-center gap-4",children:[_.jsx("div",{className:"w-24 h-24 rounded-3xl bg-white shadow-inner flex items-center justify-center text-5xl",children:""}),_.jsxs("div",{children:[_.jsx("p",{className:"text-sm uppercase tracking-[0.3em] text-amber-500 font-semibold",children:"Chc mng"}),_.jsx("h3",{className:"text-3xl font-bold text-slate-900 mt-1",children:"Mua hng thnh cng"})]})]}),_.jsx("div",{className:"bg-white/80 border border-amber-100 rounded-2xl px-5 py-4 text-slate-600 text-sm leading-relaxed shadow-inner",children:t==="pickup"?"Vui lng li quy nhn hng, n ca bn ang c ng gi. Nhn vin s chun b xong trong khong 3-5 pht. Cm n bn  tin tng MegaPOS!":"n ca bn ang c ng gi. Nhn vin s chun b giao trong khong 15-30 pht na. Cm n bn  tin tng MegaPOS!"}),_.jsxs("div",{className:"flex items-center justify-center gap-3",children:[_.jsx("button",{type:"button",onClick:e,className:"px-5 py-3 rounded-2xl border border-slate-200 text-slate-600 font-semibold hover:bg-slate-50 transition-colors",children:"ng"}),_.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-amber-400 to-orange-500 text-white font-semibold shadow-lg shadow-amber-300/40 hover:opacity-95 transition",children:"Ti  hiu"})]})]})]})})}function OR({method:e,onMethodChange:t,info:n,onInfoChange:r,onClose:o,onConfirm:i,total:a,items:s,errors:u}){const l=xh.find(d=>d.city===n.city),c=l?l.districts:[],h=c.find(d=>d.name===n.district),f=h?h.wards:[];return _.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[_.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500",children:"n hng  thanh ton"}),_.jsxs("h3",{className:"text-2xl font-bold text-gray-800",children:[s," mn  ",a.toLocaleString("vi-VN"),""]})]}),_.jsx("button",{onClick:o,className:"text-gray-500 hover:text-gray-800 rounded-full p-2 hover:bg-gray-100","aria-label":"ng",children:""})]}),_.jsxs("div",{className:"p-6 space-y-6",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Chn hnh thc nhn hng"}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("button",{onClick:()=>t("pickup"),className:`border rounded-xl p-4 text-left transition-all ${e==="pickup"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[_.jsx("p",{className:"font-semibold text-lg text-gray-800",children:"Nhn ti quy"}),_.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Khch nhn ngay ti quy, chun b hng trong 2-3 pht."})]}),_.jsxs("button",{onClick:()=>t("delivery"),className:`border rounded-xl p-4 text-left transition-all ${e==="delivery"?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[_.jsx("p",{className:"font-semibold text-lg text-gray-800",children:"Shipper giao tn nh"}),_.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"in thng tin khch  iu phi shipper."})]})]})]}),e==="delivery"&&_.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200 space-y-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"H v tn"}),_.jsx("input",{type:"text",value:n.fullName,onChange:d=>r("fullName",d.target.value),className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.fullName?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"}`,placeholder:"V d: Nguyn Vn A"}),u.fullName&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.fullName})]}),_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"S in thoi"}),_.jsx("input",{type:"tel",value:n.phone,onChange:d=>{const p=d.target.value.replace(/\D/g,"").slice(0,10);r("phone",p)},className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.phone?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"}`,placeholder:"0987 123 456"}),u.phone&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.phone})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (tu chn)"}),_.jsx("input",{type:"email",value:n.email,onChange:d=>r("email",d.target.value),className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.email?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"}`,placeholder:"khachhang@email.com"}),u.email&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.email})]})]}),_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Thnh ph"}),_.jsxs("select",{value:n.city,onChange:d=>{const p=d.target.value;r("city",p),r("district",""),r("ward","")},className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.city?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"}`,children:[_.jsx("option",{value:"",children:"Chn thnh ph"}),xh.map(d=>_.jsx("option",{value:d.city,children:d.city},d.city))]}),u.city&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.city})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Qun/Huyn"}),_.jsxs("select",{value:n.district,onChange:d=>{const p=d.target.value;r("district",p),r("ward","")},disabled:!n.city,className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.district?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"} ${n.city?"":"bg-gray-100 cursor-not-allowed"}`,children:[_.jsx("option",{value:"",children:n.city?"Chn qun/huyn":"Chn thnh ph trc"}),c.map(d=>_.jsx("option",{value:d.name,children:d.name},d.name))]}),u.district&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.district})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phng/X"}),_.jsxs("select",{value:n.ward,onChange:d=>r("ward",d.target.value),disabled:!n.district,className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.ward?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"} ${n.district?"":"bg-gray-100 cursor-not-allowed"}`,children:[_.jsx("option",{value:"",children:n.district?"Chn phng/x":"Chn qun/huyn trc"}),f.map(d=>_.jsx("option",{value:d,children:d},d))]}),u.ward&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.ward}),!n.district&&_.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Vui lng chn qun/huyn  hin th danh sch phng/x."})]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"a ch nh"}),_.jsx("input",{type:"text",value:n.address,onChange:d=>r("address",d.target.value),className:`w-full rounded-lg px-3 py-2 focus:ring-2 ${u.address?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-transparent"}`,placeholder:"S nh, tn ng..."}),u.address&&_.jsx("p",{className:"text-xs text-red-500 mt-1",children:u.address})]})]})]}),_.jsxs("div",{className:"p-6 border-t border-gray-200 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[_.jsxs("p",{className:"text-sm text-gray-500",children:["Hnh thc: ",e==="pickup"?"Nhn ti quy":"Shipper giao tn nh"]}),_.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[_.jsx("button",{onClick:o,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors",children:" sau"}),_.jsx("button",{onClick:i,className:"px-6 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors",children:"Xc nhn x l"})]})]})]})})}function BR(){const[e,t]=fe.useState(null),n=o=>{t(o)},r=()=>{t(null)};return _.jsx(_.Fragment,{children:e?_.jsx(NR,{user:e,onLogout:r}):_.jsx(kR,{onLogin:n})})}Hg(document.getElementById("root")).render(_.jsx(fe.StrictMode,{children:_.jsx(BR,{})}))});export default LR();
